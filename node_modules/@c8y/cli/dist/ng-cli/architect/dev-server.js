"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const architect_1 = require("@angular-devkit/architect");
const dev_server_1 = require("@angular-devkit/build-angular/src/builders/dev-server");
const shared_1 = require("./shared");
const options_1 = require("../../options");
const url = require("url");
const _ = require("lodash");
exports.default = (0, architect_1.createBuilder)((options, context) => {
    const root = context.workspaceRoot;
    const { app, cli } = (0, shared_1.c8yConfig)(root);
    if (!options.proxyConfig) {
        options.proxyConfig = (0, shared_1.cliPath)(root, 'ng-cli', 'architect', 'proxy.js');
    }
    options.liveReload = false;
    global.c8yServePath = `/apps/${app.contextPath}`;
    global.c8yUrl = cli.url || options_1.options.C8Y_BASE_URL_DEFAULT;
    global.c8yUrlLocal = url.format({
        protocol: options.ssl ? 'https' : 'http',
        hostname: options.host === '0.0.0.0' ? 'localhost' : options.host.toString(),
        port: options.port.toString()
    });
    const cleanedOptions = _.omitBy(options, _.isUndefined);
    return (0, dev_server_1.serveWebpackBrowser)(cleanedOptions, context, {
        webpackConfiguration: shared_1.webpackConfigurationTransformer
    });
});
//# sourceMappingURL=dev-server.js.map