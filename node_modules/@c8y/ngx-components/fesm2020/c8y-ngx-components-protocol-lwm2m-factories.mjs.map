{"version":3,"file":"c8y-ngx-components-protocol-lwm2m-factories.mjs","sources":["../../protocol-lwm2m/factories/lwm2m-device-grid.factory.ts","../../protocol-lwm2m/factories/lwm2m-post-operations.factory.ts","../../protocol-lwm2m/factories/c8y-ngx-components-protocol-lwm2m-factories.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { FetchClient, IIdentified, IResult } from '@c8y/client';\nimport { DeviceGridExtensionFactory, DeviceGridActionHook } from '@c8y/ngx-components/device-grid';\nimport {\n  AlertService,\n  gettext,\n  ModalService,\n  Status,\n  TenantUiService,\n  BuiltInActionType\n} from '@c8y/ngx-components';\nimport { TranslateService } from '@ngx-translate/core';\nimport { Lwm2mClientService } from '@c8y/ngx-components/protocol-lwm2m/services';\nimport { agentName, Lwm2mManagedObject } from '@c8y/ngx-components/protocol-lwm2m/model';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class Lwm2mDeviceGridFactory\n  extends Lwm2mClientService<Lwm2mManagedObject>\n  implements DeviceGridExtensionFactory\n{\n  protected listUrl = 'deviceRegistration';\n\n  constructor(\n    client: FetchClient,\n    private tenantService: TenantUiService,\n    private modal: ModalService,\n    private translateService: TranslateService,\n    private alertService: AlertService\n  ) {\n    super(client);\n  }\n\n  get() {\n    return {\n      type: BuiltInActionType.Delete,\n      deviceMatches: (mo: Lwm2mManagedObject) => super.isLwm2mDevice(mo),\n      onAction: (mo: Lwm2mManagedObject) => this.onDelete(mo),\n      refreshAfterActionDone: true\n    } as DeviceGridActionHook;\n  }\n\n  async onDelete(device: Lwm2mManagedObject) {\n    if (this.tenantService.isMicroserviceSubscribedInCurrentTenant(agentName)) {\n      try {\n        await this.modal.confirm(\n          gettext('Delete LWM2M device'),\n          this.translateService.instant(\n            gettext(`You are about to delete device \"{{ name }}\". Do you want to proceed?`),\n            device\n          ),\n          Status.DANGER,\n          { ok: gettext('Delete'), cancel: gettext('Cancel') }\n        );\n        await this.delete(device);\n        this.alertService.success(gettext('Device deleted.'));\n        return Promise.resolve();\n      } catch (ex) {\n        if (ex) {\n          this.alertService.addServerFailure(ex);\n        }\n        return Promise.reject();\n      }\n    } else {\n      this.alertService.danger(\n        this.translateService.instant(\n          gettext(`You can't delete this device. The service \"{{ name }}\" is not subscribed.`),\n          { name: agentName }\n        )\n      );\n      return Promise.reject();\n    }\n  }\n\n  delete(entityOrId: string | number | IIdentified): Promise<IResult<null>> {\n    return super.delete(entityOrId);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { gettext, NavigatorNode, NavigatorNodeFactory } from '@c8y/ngx-components';\nimport { Lwm2mMicroserviceSubscribedGuard } from '@c8y/ngx-components/protocol-lwm2m/guards';\n\n@Injectable()\nexport class LWM2MPostOpertaionsNavigationFactory implements NavigatorNodeFactory {\n  node = new NavigatorNode({\n    label: gettext('LWM2M post-operations'),\n    path: 'post-operations',\n    icon: 'terminal',\n    parent: {\n      label: gettext('Device types'),\n      icon: 'c8y-device-protocols'\n    },\n    priority: 0\n  });\n\n  constructor(private guard: Lwm2mMicroserviceSubscribedGuard) {}\n\n  get() {\n    return this.guard.canActivate() ? this.node : [];\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":["i1"],"mappings":"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"}