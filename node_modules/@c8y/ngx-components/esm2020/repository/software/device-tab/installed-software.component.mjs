import { Component, EventEmitter, Input, Output, TemplateRef, ViewChild } from '@angular/core';
import { QueriesUtil } from '@c8y/client';
import { gettext, ModalSelectionMode } from '@c8y/ngx-components';
import { PRODUCT_EXPERIENCE, RepositorySelectModalComponent, RepositoryService, RepositoryType } from '@c8y/ngx-components/repository/shared';
import { get } from 'lodash-es';
import { BsModalService } from 'ngx-bootstrap/modal';
import { BehaviorSubject, combineLatest, from, of, pipe, Subject } from 'rxjs';
import { distinctUntilChanged, filter, map, mergeMap, shareReplay, switchMap, takeUntil, tap } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@c8y/ngx-components/repository/shared";
import * as i2 from "ngx-bootstrap/modal";
import * as i3 from "@angular/common";
import * as i4 from "@c8y/ngx-components";
import * as i5 from "@angular/forms";
import * as i6 from "@c8y/ngx-components/operations/operation-details";
import * as i7 from "ngx-bootstrap/tooltip";
import * as i8 from "./device-software-list.component";
export class InstalledSoftwareComponent {
    constructor(repository, bsModal) {
        this.repository = repository;
        this.bsModal = bsModal;
        this.PRODUCT_EXPERIENCE = PRODUCT_EXPERIENCE;
        this.changes = new EventEmitter();
        this.showSoftwareChanges = new EventEmitter();
        this.alreadyInstalledMessage = gettext('{{ name }} (v. {{ version }}) is already installed on this device');
        this.showFilter = false;
        this.supportsSoftwareOperations = false;
        this.textFilter$ = new BehaviorSubject('');
        this.softwareTypeFilter$ = new BehaviorSubject('');
        this.operationTypes = ['c8y_SoftwareUpdate', 'c8y_SoftwareList', 'c8y_Software'];
        this.destroyed$ = new Subject();
        this.filterCriteria$ = combineLatest([this.textFilter$, this.softwareTypeFilter$]).pipe(map(([textFilter, softwareTypeFilter]) => ({
            name: textFilter,
            softwareType: softwareTypeFilter
        })), map(filterCriteria => !filterCriteria.name && !filterCriteria.softwareType ? null : filterCriteria));
        this.queriesUtil = new QueriesUtil();
    }
    ngOnInit() {
        const supportedOperations = get(this.device, 'c8y_SupportedOperations', []);
        this.supportsSoftwareOperations = this.operationTypes.some(operationType => supportedOperations.indexOf(operationType) > -1);
    }
    installSoftware() {
        const { resultEmitter, choiceEmitter, updateInstallableList$ } = this.displaySoftwareSelectModal({
            title: gettext('Install software'),
            subTitle: gettext('Available softwares matching the device type'),
            labels: { ok: gettext('Install') },
            showAdditionalFilter: true,
            additionalFilterTemplate: this.softwareTypeTemplate,
            repositoryEntriesWithVersions$: of([]),
            repositoryEntriesWithVersionsFn$: modal => this.getInstallableSoftwareListWithVersions$(modal.content.searchTerm)
        });
        resultEmitter.pipe(takeUntil(this.destroyed$)).subscribe(softwareToInstall => {
            this.emitSoftwareInstall(softwareToInstall);
            this.showSoftwareChanges.emit();
        });
        choiceEmitter
            .pipe(this.isSoftwareInstalledOnDevicePipe(updateInstallableList$), takeUntil(this.destroyed$))
            .subscribe(({ item }) => updateInstallableList$.next({
            object: item,
            template: this.alreadyInstalledWarningTemplate,
            mapper: object => {
                object.installed = true;
                return object;
            }
        }));
    }
    updateSoftware(softwareToUpdate) {
        const { resultEmitter, choiceEmitter, updateInstallableList$ } = this.displaySoftwareSelectModal({
            title: gettext('Update software'),
            subTitle: gettext('Select one of the available software versions'),
            labels: { ok: gettext('Update') },
            noItemsMessage: gettext('No other software versions available.'),
            showFilter: false,
            repositoryEntriesWithVersions$: this.getSingleSoftwareWithVersions$(softwareToUpdate)
        });
        resultEmitter.pipe(takeUntil(this.destroyed$)).subscribe(softwareToInstall => {
            this.emitSoftwareInstall(softwareToInstall);
            this.showSoftwareChanges.emit();
        });
        choiceEmitter
            .pipe(this.isSoftwareInstalledOnDevicePipe(updateInstallableList$), takeUntil(this.destroyed$))
            .subscribe(({ item }) => updateInstallableList$.next({
            object: item,
            template: this.alreadyInstalledWarningTemplate,
            mapper: object => {
                object.installed = true;
                return object;
            }
        }));
    }
    removeSoftware(softwareToRemove) {
        this.emitSoftwareRemoval([softwareToRemove]);
    }
    getInstallableSoftwareListWithVersions$(searchTerm$) {
        const installedSoftwareNames = (this.softwareList || []).map(s => s.name);
        return searchTerm$.pipe(distinctUntilChanged(), switchMap(searchTerm => this.repository.listRepositoryEntries(RepositoryType.SOFTWARE, {
            query: searchTerm.softwareType
                ? this.queriesUtil.addAndFilter(this.typesQuery, {
                    softwareType: searchTerm.softwareType
                })
                : this.typesQuery,
            partialName: searchTerm?.name,
            params: { pageSize: 100 }
        })), map(({ data }) => data), map(softwareList => {
            return softwareList.filter(software => {
                return !installedSoftwareNames.includes(software.name);
            });
        }), map(softwareList => this.attachVersions(softwareList)), shareReplay(1));
    }
    getSingleSoftwareWithVersions$(software) {
        return from(this.repository.listRepositoryEntries(RepositoryType.SOFTWARE, {
            query: { name: software.name }
        })).pipe(map(({ data }) => data), map(softwareList => this.attachVersions(softwareList)), shareReplay(1));
    }
    attachVersions(softwareList) {
        softwareList.forEach(software => {
            software.versions = this.repository.listBaseVersions(software);
        });
        return softwareList;
    }
    displaySoftwareSelectModal(initialStateOverrides) {
        const initialState = {
            repositoryType: RepositoryType.SOFTWARE,
            mode: ModalSelectionMode.MULTI,
            icon: 'c8y-tools',
            disableSelected: false,
            selected: this.softwareList,
            ...initialStateOverrides
        };
        const modal = this.bsModal.show(RepositorySelectModalComponent, {
            ignoreBackdropClick: true,
            class: 'modal-sm',
            ariaDescribedby: 'modal-body',
            ariaLabelledBy: 'modal-title',
            initialState
        });
        if (initialStateOverrides.repositoryEntriesWithVersionsFn$) {
            modal.content.repositoryEntriesWithVersions$ =
                initialStateOverrides.repositoryEntriesWithVersionsFn$(modal);
        }
        this.modalSearch = modal.content.search.bind(modal.content);
        modal.content.load.next();
        return {
            resultEmitter: modal.content.resultEmitter,
            choiceEmitter: modal.content.onChoiceUpdated,
            updateInstallableList$: modal.content.updateInstallableList$
        };
    }
    search(filterCriteria) {
        if (this.modalSearch) {
            this.modalSearch(filterCriteria);
        }
    }
    emitSoftwareInstall(items) {
        this.changes.emit(items.map(item => {
            return { ...item, action: 'install' };
        }));
    }
    emitSoftwareRemoval(items) {
        this.changes.emit(items.map(item => {
            return { ...item, action: 'delete' };
        }));
    }
    ngOnDestroy() {
        this.destroyed$.next();
        this.destroyed$.complete();
    }
    isSoftwareInstalledOnDevicePipe(updateInstallableList$) {
        return pipe(tap((item) => updateInstallableList$.next({ object: item, template: this.loadingTemplate })), map(item => ({
            item,
            software: ((item.options || []).find(option => option.obj.id === item.selectedId) || {}).obj
        })), mergeMap(({ item, software }) => from(this.repository.isSoftwareInstalledOnDevice(this.device.id, software)).pipe(map(installed => ({ item, installed })))), tap(({ item }) => updateInstallableList$.next({ object: item })), filter(({ installed }) => !!installed));
    }
}
InstalledSoftwareComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: InstalledSoftwareComponent, deps: [{ token: i1.RepositoryService }, { token: i2.BsModalService }], target: i0.ɵɵFactoryTarget.Component });
InstalledSoftwareComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.7", type: InstalledSoftwareComponent, selector: "c8y-installed-software", inputs: { device: "device", softwareList: "softwareList", deviceSoftwareChanges: "deviceSoftwareChanges", deviceSoftwareChangesOperation: "deviceSoftwareChangesOperation", deviceSoftwareChangesInProgress: "deviceSoftwareChangesInProgress", typesQuery: "typesQuery" }, outputs: { changes: "changes", showSoftwareChanges: "showSoftwareChanges" }, viewQueries: [{ propertyName: "alreadyInstalledWarningTemplate", first: true, predicate: ["alreadyInstalledWarning"], descendants: true, static: true }, { propertyName: "loadingTemplate", first: true, predicate: ["loading"], descendants: true, static: true }, { propertyName: "softwareTypeTemplate", first: true, predicate: ["softwareType"], descendants: true, static: true }], ngImport: i0, template: "<div class=\"d-flex d-col flex-grow\">\n  <div class=\"card-header large-padding separator sticky-top\">\n    <div class=\"card-title\" translate>Installed software</div>\n  </div>\n  <div class=\"flex-grow\">\n    <fieldset\n      id=\"operation-block\"\n      *ngIf=\"deviceSoftwareChangesOperation\"\n      class=\"card-block large-padding bg-level-2 p-0\"\n    >\n      <c8y-operation-details [operation]=\"deviceSoftwareChangesOperation\"></c8y-operation-details>\n    </fieldset>\n    <fieldset class=\"card-block large-padding overflow-visible separator-bottom\" *ngIf=\"showFilter\">\n      <div class=\"row\">\n        <div class=\"col-xs-6\">\n          <div class=\"input-group input-group-search\">\n            <label for=\"filter\" class=\"sr-only\">\n              {{ 'Filter installed software\u2026' | translate }}\n            </label>\n            <input\n              class=\"form-control\"\n              type=\"search\"\n              title=\"{{ 'Filter installed software\u2026' | translate }}\"\n              id=\"filter\"\n              placeholder=\"{{ 'Filter installed software\u2026' | translate }}\"\n              [ngModel]=\"textFilter$ | async\"\n              (ngModelChange)=\"textFilter$.next($event)\"\n            />\n            <span class=\"input-group-addon\">\n              <i c8yIcon=\"search\" *ngIf=\"(textFilter$ | async).length === 0\"></i>\n              <i\n                class=\"text-muted\"\n                c8yIcon=\"times\"\n                *ngIf=\"(textFilter$ | async).length > 0\"\n                (click)=\"textFilter$.next('')\"\n              ></i>\n            </span>\n            <span for=\"filter\" class=\"sr-only\" translate>Filter installed software\u2026</span>\n          </div>\n        </div>\n        <div class=\"col-xs-6\">\n          <c8y-software-type\n            [required]=\"false\"\n            [emitResultsOnly]=\"true\"\n            [showBtnInNotFoundMessage]=\"false\"\n            [allowFreeEntries]=\"false\"\n            [placeholder]=\"'Filter by software type\u2026' | translate\"\n            [showClearSelectionOption]=\"true\"\n            (onSelectSoftware)=\"softwareTypeFilter$.next($event?.softwareType)\"\n          ></c8y-software-type>\n        </div>\n      </div>\n    </fieldset>\n\n    <fieldset\n      id=\"software-list\"\n      class=\"flex-grow inner-scroll\"\n      [disabled]=\"deviceSoftwareChangesInProgress\"\n    >\n      <!-- NOT EMPTY STATE -->\n      <c8y-device-software-list\n        [device]=\"device\"\n        [filterCriteria$]=\"filterCriteria$\"\n        [softwareList]=\"softwareList\"\n        [deviceSoftwareChanges]=\"deviceSoftwareChanges\"\n        (update)=\"updateSoftware($event)\"\n        (remove)=\"removeSoftware($event)\"\n        (onListEmpty)=\"showFilter = !$event\"\n        class=\"d-block p-l-16 p-r-16\"\n        container=\"body\"\n      >\n        <!-- EMPTY STATE -->\n        <div class=\"c8y-empty-state text-center\">\n          <div class=\"h1 c8y-icon c8y-icon-tools c8y-icon-duocolor\"></div>\n          <p>\n            <strong translate>No software installed.</strong>\n            <br />\n            <small translate>Click below to install software into this device.</small>\n          </p>\n        </div>\n        <!-- NO SEARCH RESULTS STATE -->\n        <div class=\"c8y-empty-state c8y-no-results-state text-center\">\n          <div class=\"h1 c8y-icon c8y-icon-tools c8y-icon-duocolor\"></div>\n          <p>\n            <strong translate>No software matches your filter criteria.</strong>\n            <br />\n            <small translate>Try changing your search criteria.</small>\n          </p>\n        </div>\n      </c8y-device-software-list>\n    </fieldset>\n  </div>\n  <!-- INSTALL SOFTWARE-->\n  <div\n    class=\"card-footer large-padding separator sticky-bottom d-flex j-c-between bg-level-0\"\n    [ngClass]=\"{ 'visible-sm visible-xs': !supportsSoftwareOperations }\"\n  >\n    <button\n      *ngIf=\"supportsSoftwareOperations\"\n      class=\"btn btn-default\"\n      title=\"{{ 'Install software' | translate }}\"\n      (click)=\"installSoftware()\"\n      [disabled]=\"deviceSoftwareChangesInProgress\"\n      c8yProductExperience\n      [actionName]=\"PRODUCT_EXPERIENCE.SOFTWARE.EVENTS.DEVICE_TAB\"\n      [actionData]=\"{\n        component: PRODUCT_EXPERIENCE.SOFTWARE.COMPONENTS.DEVICE_SOFTWARE_LIST,\n        action: PRODUCT_EXPERIENCE.SOFTWARE.ACTIONS.OPEN_INSTALL_SOFTWARE\n      }\"\n    >\n      <i c8yIcon=\"plus-circle\"></i>\n      {{ 'Install software' | translate }}\n    </button>\n    <button\n      (click)=\"showSoftwareChanges.emit()\"\n      class=\"btn btn-clean text-primary visible-sm visible-xs\"\n      [title]=\"'Show &quot;Software changes&quot;' | translate\"\n    >\n      <span translate>Show \"Software changes\"</span>\n      <i c8yIcon=\"chevron-right\"></i>\n    </button>\n  </div>\n</div>\n\n<ng-template #alreadyInstalledWarning let-item let-option=\"option\">\n  <i\n    c8yIcon=\"warning\"\n    class=\"text-warning a-s-center\"\n    [tooltip]=\"\n      alreadyInstalledMessage\n        | translate: { name: item.body[0].value, version: option.body[0].value }\n    \"\n  ></i>\n</ng-template>\n\n<ng-template #loading>\n  <div class=\"p-relative d-flex m-l-auto\">\n    <i class=\"icon-spin\" c8yIcon=\"circle-o-notch\"></i>\n  </div>\n</ng-template>\n\n<ng-template #softwareType>\n  <c8y-software-type\n    additionalFilter\n    [required]=\"false\"\n    [placeholder]=\"'Filter by software type\u2026' | translate\"\n    (onSelectSoftware)=\"search({ softwareType: $event?.softwareType })\"\n    [emitResultsOnly]=\"true\"\n    [showBtnInNotFoundMessage]=\"false\"\n    [allowFreeEntries]=\"false\"\n    [showClearSelectionOption]=\"true\"\n  ></c8y-software-type>\n</ng-template>\n", dependencies: [{ kind: "directive", type: i3.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i4.IconDirective, selector: "[c8yIcon]", inputs: ["c8yIcon"] }, { kind: "directive", type: i4.C8yTranslateDirective, selector: "[translate],[ngx-translate]" }, { kind: "directive", type: i5.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i5.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i5.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "directive", type: i4.ProductExperienceDirective, selector: "[c8yProductExperience]", inputs: ["actionName", "actionData", "inherit", "suppressDataOverriding"] }, { kind: "component", type: i1.SoftwareTypeComponent, selector: "c8y-software-type", inputs: ["softwareTypeMO", "disabled", "style", "required", "placeholder", "emitResultsOnly", "showBtnInNotFoundMessage", "allowFreeEntries", "showClearSelectionOption", "clearSelectionOptionLabel"], outputs: ["onSelectSoftware"] }, { kind: "component", type: i6.OperationDetailsComponent, selector: "c8y-operation-details", inputs: ["operation"] }, { kind: "directive", type: i7.TooltipDirective, selector: "[tooltip], [tooltipHtml]", inputs: ["adaptivePosition", "tooltip", "placement", "triggers", "container", "containerClass", "boundariesElement", "isOpen", "isDisabled", "delay", "tooltipHtml", "tooltipPlacement", "tooltipIsOpen", "tooltipEnable", "tooltipAppendToBody", "tooltipAnimation", "tooltipClass", "tooltipContext", "tooltipPopupDelay", "tooltipFadeDuration", "tooltipTrigger"], outputs: ["tooltipChange", "onShown", "onHidden", "tooltipStateChanged"], exportAs: ["bs-tooltip"] }, { kind: "component", type: i8.DeviceSoftwareListComponent, selector: "c8y-device-software-list", inputs: ["softwareList", "device", "deviceSoftwareChanges", "filterCriteria$"], outputs: ["update", "remove", "onListEmpty"] }, { kind: "pipe", type: i3.AsyncPipe, name: "async" }, { kind: "pipe", type: i4.C8yTranslatePipe, name: "translate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: InstalledSoftwareComponent, decorators: [{
            type: Component,
            args: [{ selector: 'c8y-installed-software', template: "<div class=\"d-flex d-col flex-grow\">\n  <div class=\"card-header large-padding separator sticky-top\">\n    <div class=\"card-title\" translate>Installed software</div>\n  </div>\n  <div class=\"flex-grow\">\n    <fieldset\n      id=\"operation-block\"\n      *ngIf=\"deviceSoftwareChangesOperation\"\n      class=\"card-block large-padding bg-level-2 p-0\"\n    >\n      <c8y-operation-details [operation]=\"deviceSoftwareChangesOperation\"></c8y-operation-details>\n    </fieldset>\n    <fieldset class=\"card-block large-padding overflow-visible separator-bottom\" *ngIf=\"showFilter\">\n      <div class=\"row\">\n        <div class=\"col-xs-6\">\n          <div class=\"input-group input-group-search\">\n            <label for=\"filter\" class=\"sr-only\">\n              {{ 'Filter installed software\u2026' | translate }}\n            </label>\n            <input\n              class=\"form-control\"\n              type=\"search\"\n              title=\"{{ 'Filter installed software\u2026' | translate }}\"\n              id=\"filter\"\n              placeholder=\"{{ 'Filter installed software\u2026' | translate }}\"\n              [ngModel]=\"textFilter$ | async\"\n              (ngModelChange)=\"textFilter$.next($event)\"\n            />\n            <span class=\"input-group-addon\">\n              <i c8yIcon=\"search\" *ngIf=\"(textFilter$ | async).length === 0\"></i>\n              <i\n                class=\"text-muted\"\n                c8yIcon=\"times\"\n                *ngIf=\"(textFilter$ | async).length > 0\"\n                (click)=\"textFilter$.next('')\"\n              ></i>\n            </span>\n            <span for=\"filter\" class=\"sr-only\" translate>Filter installed software\u2026</span>\n          </div>\n        </div>\n        <div class=\"col-xs-6\">\n          <c8y-software-type\n            [required]=\"false\"\n            [emitResultsOnly]=\"true\"\n            [showBtnInNotFoundMessage]=\"false\"\n            [allowFreeEntries]=\"false\"\n            [placeholder]=\"'Filter by software type\u2026' | translate\"\n            [showClearSelectionOption]=\"true\"\n            (onSelectSoftware)=\"softwareTypeFilter$.next($event?.softwareType)\"\n          ></c8y-software-type>\n        </div>\n      </div>\n    </fieldset>\n\n    <fieldset\n      id=\"software-list\"\n      class=\"flex-grow inner-scroll\"\n      [disabled]=\"deviceSoftwareChangesInProgress\"\n    >\n      <!-- NOT EMPTY STATE -->\n      <c8y-device-software-list\n        [device]=\"device\"\n        [filterCriteria$]=\"filterCriteria$\"\n        [softwareList]=\"softwareList\"\n        [deviceSoftwareChanges]=\"deviceSoftwareChanges\"\n        (update)=\"updateSoftware($event)\"\n        (remove)=\"removeSoftware($event)\"\n        (onListEmpty)=\"showFilter = !$event\"\n        class=\"d-block p-l-16 p-r-16\"\n        container=\"body\"\n      >\n        <!-- EMPTY STATE -->\n        <div class=\"c8y-empty-state text-center\">\n          <div class=\"h1 c8y-icon c8y-icon-tools c8y-icon-duocolor\"></div>\n          <p>\n            <strong translate>No software installed.</strong>\n            <br />\n            <small translate>Click below to install software into this device.</small>\n          </p>\n        </div>\n        <!-- NO SEARCH RESULTS STATE -->\n        <div class=\"c8y-empty-state c8y-no-results-state text-center\">\n          <div class=\"h1 c8y-icon c8y-icon-tools c8y-icon-duocolor\"></div>\n          <p>\n            <strong translate>No software matches your filter criteria.</strong>\n            <br />\n            <small translate>Try changing your search criteria.</small>\n          </p>\n        </div>\n      </c8y-device-software-list>\n    </fieldset>\n  </div>\n  <!-- INSTALL SOFTWARE-->\n  <div\n    class=\"card-footer large-padding separator sticky-bottom d-flex j-c-between bg-level-0\"\n    [ngClass]=\"{ 'visible-sm visible-xs': !supportsSoftwareOperations }\"\n  >\n    <button\n      *ngIf=\"supportsSoftwareOperations\"\n      class=\"btn btn-default\"\n      title=\"{{ 'Install software' | translate }}\"\n      (click)=\"installSoftware()\"\n      [disabled]=\"deviceSoftwareChangesInProgress\"\n      c8yProductExperience\n      [actionName]=\"PRODUCT_EXPERIENCE.SOFTWARE.EVENTS.DEVICE_TAB\"\n      [actionData]=\"{\n        component: PRODUCT_EXPERIENCE.SOFTWARE.COMPONENTS.DEVICE_SOFTWARE_LIST,\n        action: PRODUCT_EXPERIENCE.SOFTWARE.ACTIONS.OPEN_INSTALL_SOFTWARE\n      }\"\n    >\n      <i c8yIcon=\"plus-circle\"></i>\n      {{ 'Install software' | translate }}\n    </button>\n    <button\n      (click)=\"showSoftwareChanges.emit()\"\n      class=\"btn btn-clean text-primary visible-sm visible-xs\"\n      [title]=\"'Show &quot;Software changes&quot;' | translate\"\n    >\n      <span translate>Show \"Software changes\"</span>\n      <i c8yIcon=\"chevron-right\"></i>\n    </button>\n  </div>\n</div>\n\n<ng-template #alreadyInstalledWarning let-item let-option=\"option\">\n  <i\n    c8yIcon=\"warning\"\n    class=\"text-warning a-s-center\"\n    [tooltip]=\"\n      alreadyInstalledMessage\n        | translate: { name: item.body[0].value, version: option.body[0].value }\n    \"\n  ></i>\n</ng-template>\n\n<ng-template #loading>\n  <div class=\"p-relative d-flex m-l-auto\">\n    <i class=\"icon-spin\" c8yIcon=\"circle-o-notch\"></i>\n  </div>\n</ng-template>\n\n<ng-template #softwareType>\n  <c8y-software-type\n    additionalFilter\n    [required]=\"false\"\n    [placeholder]=\"'Filter by software type\u2026' | translate\"\n    (onSelectSoftware)=\"search({ softwareType: $event?.softwareType })\"\n    [emitResultsOnly]=\"true\"\n    [showBtnInNotFoundMessage]=\"false\"\n    [allowFreeEntries]=\"false\"\n    [showClearSelectionOption]=\"true\"\n  ></c8y-software-type>\n</ng-template>\n" }]
        }], ctorParameters: function () { return [{ type: i1.RepositoryService }, { type: i2.BsModalService }]; }, propDecorators: { device: [{
                type: Input
            }], softwareList: [{
                type: Input
            }], deviceSoftwareChanges: [{
                type: Input
            }], deviceSoftwareChangesOperation: [{
                type: Input
            }], deviceSoftwareChangesInProgress: [{
                type: Input
            }], typesQuery: [{
                type: Input
            }], changes: [{
                type: Output
            }], showSoftwareChanges: [{
                type: Output
            }], alreadyInstalledWarningTemplate: [{
                type: ViewChild,
                args: ['alreadyInstalledWarning', { static: true }]
            }], loadingTemplate: [{
                type: ViewChild,
                args: ['loading', { static: true }]
            }], softwareTypeTemplate: [{
                type: ViewChild,
                args: ['softwareType', { static: true }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5zdGFsbGVkLXNvZnR3YXJlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3JlcG9zaXRvcnkvc29mdHdhcmUvZGV2aWNlLXRhYi9pbnN0YWxsZWQtc29mdHdhcmUuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vcmVwb3NpdG9yeS9zb2Z0d2FyZS9kZXZpY2UtdGFiL2luc3RhbGxlZC1zb2Z0d2FyZS5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULFlBQVksRUFDWixLQUFLLEVBR0wsTUFBTSxFQUNOLFdBQVcsRUFDWCxTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUE4QixXQUFXLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDdEUsT0FBTyxFQUNMLE9BQU8sRUFHUCxrQkFBa0IsRUFDbkIsTUFBTSxxQkFBcUIsQ0FBQztBQUM3QixPQUFPLEVBSUwsa0JBQWtCLEVBQ2xCLDhCQUE4QixFQUM5QixpQkFBaUIsRUFDakIsY0FBYyxFQUNmLE1BQU0sdUNBQXVDLENBQUM7QUFDL0MsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNoQyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDckQsT0FBTyxFQUFFLGVBQWUsRUFBRSxhQUFhLEVBQUUsSUFBSSxFQUFjLEVBQUUsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzNGLE9BQU8sRUFDTCxvQkFBb0IsRUFDcEIsTUFBTSxFQUNOLEdBQUcsRUFDSCxRQUFRLEVBQ1IsV0FBVyxFQUNYLFNBQVMsRUFDVCxTQUFTLEVBQ1QsR0FBRyxFQUNKLE1BQU0sZ0JBQWdCLENBQUM7Ozs7Ozs7Ozs7QUFNeEIsTUFBTSxPQUFPLDBCQUEwQjtJQWtDckMsWUFBb0IsVUFBNkIsRUFBVSxPQUF1QjtRQUE5RCxlQUFV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LElBQUksRUFBRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgRXZlbnRFbWl0dGVyLFxuICBJbnB1dCxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgVGVtcGxhdGVSZWYsXG4gIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IElNYW5hZ2VkT2JqZWN0LCBJT3BlcmF0aW9uLCBRdWVyaWVzVXRpbCB9IGZyb20gJ0BjOHkvY2xpZW50JztcbmltcG9ydCB7XG4gIGdldHRleHQsXG4gIElTZWxlY3RNb2RhbE9iamVjdCxcbiAgSVVwZGF0ZUl0ZW1FdmVudCxcbiAgTW9kYWxTZWxlY3Rpb25Nb2RlXG59IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMnO1xuaW1wb3J0IHtcbiAgRGV2aWNlU29mdHdhcmUsXG4gIERldmljZVNvZnR3YXJlQ2hhbmdlLFxuICBGaWx0ZXJDcml0ZXJpYSxcbiAgUFJPRFVDVF9FWFBFUklFTkNFLFxuICBSZXBvc2l0b3J5U2VsZWN0TW9kYWxDb21wb25lbnQsXG4gIFJlcG9zaXRvcnlTZXJ2aWNlLFxuICBSZXBvc2l0b3J5VHlwZVxufSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzL3JlcG9zaXRvcnkvc2hhcmVkJztcbmltcG9ydCB7IGdldCB9IGZyb20gJ2xvZGFzaC1lcyc7XG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gJ25neC1ib290c3RyYXAvbW9kYWwnO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBjb21iaW5lTGF0ZXN0LCBmcm9tLCBPYnNlcnZhYmxlLCBvZiwgcGlwZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtcbiAgZGlzdGluY3RVbnRpbENoYW5nZWQsXG4gIGZpbHRlcixcbiAgbWFwLFxuICBtZXJnZU1hcCxcbiAgc2hhcmVSZXBsYXksXG4gIHN3aXRjaE1hcCxcbiAgdGFrZVVudGlsLFxuICB0YXBcbn0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjOHktaW5zdGFsbGVkLXNvZnR3YXJlJyxcbiAgdGVtcGxhdGVVcmw6ICdpbnN0YWxsZWQtc29mdHdhcmUuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIEluc3RhbGxlZFNvZnR3YXJlQ29tcG9uZW50IGltcGxlbWVudHMgT25EZXN0cm95LCBPbkluaXQge1xuICBQUk9EVUNUX0VYUEVSSUVOQ0UgPSBQUk9EVUNUX0VYUEVSSUVOQ0U7XG4gIEBJbnB1dCgpIGRldmljZTogSU1hbmFnZWRPYmplY3Q7XG4gIEBJbnB1dCgpIHNvZnR3YXJlTGlzdDogRGV2aWNlU29mdHdhcmVbXTtcbiAgQElucHV0KCkgZGV2aWNlU29mdHdhcmVDaGFuZ2VzOiBEZXZpY2VTb2Z0d2FyZUNoYW5nZVtdO1xuICBASW5wdXQoKSBkZXZpY2VTb2Z0d2FyZUNoYW5nZXNPcGVyYXRpb246IElPcGVyYXRpb247XG4gIEBJbnB1dCgpIGRldmljZVNvZnR3YXJlQ2hhbmdlc0luUHJvZ3Jlc3M6IGJvb2xlYW47XG4gIEBJbnB1dCgpIHR5cGVzUXVlcnk6IG9iamVjdDtcbiAgQE91dHB1dCgpIGNoYW5nZXMgPSBuZXcgRXZlbnRFbWl0dGVyPERldmljZVNvZnR3YXJlQ2hhbmdlW10+KCk7XG4gIEBPdXRwdXQoKSBzaG93U29mdHdhcmVDaGFuZ2VzID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuXG4gIEBWaWV3Q2hpbGQoJ2FscmVhZHlJbnN0YWxsZWRXYXJuaW5nJywgeyBzdGF0aWM6IHRydWUgfSlcbiAgYWxyZWFkeUluc3RhbGxlZFdhcm5pbmdUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcbiAgYWxyZWFkeUluc3RhbGxlZE1lc3NhZ2UgPSBnZXR0ZXh0KFxuICAgICd7eyBuYW1lIH19ICh2LiB7eyB2ZXJzaW9uIH19KSBpcyBhbHJlYWR5IGluc3RhbGxlZCBvbiB0aGlzIGRldmljZSdcbiAgKTtcbiAgQFZpZXdDaGlsZCgnbG9hZGluZycsIHsgc3RhdGljOiB0cnVlIH0pXG4gIGxvYWRpbmdUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcblxuICBAVmlld0NoaWxkKCdzb2Z0d2FyZVR5cGUnLCB7IHN0YXRpYzogdHJ1ZSB9KVxuICBzb2Z0d2FyZVR5cGVUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcblxuICBzaG93RmlsdGVyID0gZmFsc2U7XG4gIHN1cHBvcnRzU29mdHdhcmVPcGVyYXRpb25zID0gZmFsc2U7XG4gIHRleHRGaWx0ZXIkOiBCZWhhdmlvclN1YmplY3Q8c3RyaW5nPiA9IG5ldyBCZWhhdmlvclN1YmplY3QoJycpO1xuICBzb2Z0d2FyZVR5cGVGaWx0ZXIkOiBCZWhhdmlvclN1YmplY3Q8c3RyaW5nPiA9IG5ldyBCZWhhdmlvclN1YmplY3QoJycpO1xuICBmaWx0ZXJDcml0ZXJpYSQ6IE9ic2VydmFibGU8RmlsdGVyQ3JpdGVyaWE+O1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgb3BlcmF0aW9uVHlwZXMgPSBbJ2M4eV9Tb2Z0d2FyZVVwZGF0ZScsICdjOHlfU29mdHdhcmVMaXN0JywgJ2M4eV9Tb2Z0d2FyZSddO1xuXG4gIHByaXZhdGUgcXVlcmllc1V0aWw6IFF1ZXJpZXNVdGlsO1xuICBwcml2YXRlIG1vZGFsU2VhcmNoOiAoZmlsdGVyQ3JpdGVyaWE6IEZpbHRlckNyaXRlcmlhKSA9PiB2b2lkO1xuICBwcml2YXRlIGRlc3Ryb3llZCQ6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdCgpO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVwb3NpdG9yeTogUmVwb3NpdG9yeVNlcnZpY2UsIHByaXZhdGUgYnNNb2RhbDogQnNNb2RhbFNlcnZpY2UpIHtcbiAgICB0aGlzLmZpbHRlckNyaXRlcmlhJCA9IGNvbWJpbmVMYXRlc3QoW3RoaXMudGV4dEZpbHRlciQsIHRoaXMuc29mdHdhcmVUeXBlRmlsdGVyJF0pLnBpcGUoXG4gICAgICBtYXAoKFt0ZXh0RmlsdGVyLCBzb2Z0d2FyZVR5cGVGaWx0ZXJdKSA9PiAoe1xuICAgICAgICBuYW1lOiB0ZXh0RmlsdGVyLFxuICAgICAgICBzb2Z0d2FyZVR5cGU6IHNvZnR3YXJlVHlwZUZpbHRlclxuICAgICAgfSkpLFxuICAgICAgbWFwKGZpbHRlckNyaXRlcmlhID0+XG4gICAgICAgICFmaWx0ZXJDcml0ZXJpYS5uYW1lICYmICFmaWx0ZXJDcml0ZXJpYS5zb2Z0d2FyZVR5cGUgPyBudWxsIDogZmlsdGVyQ3JpdGVyaWFcbiAgICAgIClcbiAgICApO1xuICAgIHRoaXMucXVlcmllc1V0aWwgPSBuZXcgUXVlcmllc1V0aWwoKTtcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIGNvbnN0IHN1cHBvcnRlZE9wZXJhdGlvbnMgPSBnZXQodGhpcy5kZXZpY2UsICdjOHlfU3VwcG9ydGVkT3BlcmF0aW9ucycsIFtdKTtcbiAgICB0aGlzLnN1cHBvcnRzU29mdHdhcmVPcGVyYXRpb25zID0gdGhpcy5vcGVyYXRpb25UeXBlcy5zb21lKFxuICAgICAgb3BlcmF0aW9uVHlwZSA9PiBzdXBwb3J0ZWRPcGVyYXRpb25zLmluZGV4T2Yob3BlcmF0aW9uVHlwZSkgPiAtMVxuICAgICk7XG4gIH1cblxuICBpbnN0YWxsU29mdHdhcmUoKSB7XG4gICAgY29uc3QgeyByZXN1bHRFbWl0dGVyLCBjaG9pY2VFbWl0dGVyLCB1cGRhdGVJbnN0YWxsYWJsZUxpc3QkIH0gPVxuICAgICAgdGhpcy5kaXNwbGF5U29mdHdhcmVTZWxlY3RNb2RhbCh7XG4gICAgICAgIHRpdGxlOiBnZXR0ZXh0KCdJbnN0YWxsIHNvZnR3YXJlJyksXG4gICAgICAgIHN1YlRpdGxlOiBnZXR0ZXh0KCdBdmFpbGFibGUgc29mdHdhcmVzIG1hdGNoaW5nIHRoZSBkZXZpY2UgdHlwZScpLFxuICAgICAgICBsYWJlbHM6IHsgb2s6IGdldHRleHQoJ0luc3RhbGwnKSB9LFxuICAgICAgICBzaG93QWRkaXRpb25hbEZpbHRlcjogdHJ1ZSxcbiAgICAgICAgYWRkaXRpb25hbEZpbHRlclRlbXBsYXRlOiB0aGlzLnNvZnR3YXJlVHlwZVRlbXBsYXRlLFxuICAgICAgICByZXBvc2l0b3J5RW50cmllc1dpdGhWZXJzaW9ucyQ6IG9mKFtdKSxcbiAgICAgICAgcmVwb3NpdG9yeUVudHJpZXNXaXRoVmVyc2lvbnNGbiQ6IG1vZGFsID0+XG4gICAgICAgICAgdGhpcy5nZXRJbnN0YWxsYWJsZVNvZnR3YXJlTGlzdFdpdGhWZXJzaW9ucyQobW9kYWwuY29udGVudC5zZWFyY2hUZXJtKVxuICAgICAgfSk7XG5cbiAgICByZXN1bHRFbWl0dGVyLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveWVkJCkpLnN1YnNjcmliZShzb2Z0d2FyZVRvSW5zdGFsbCA9PiB7XG4gICAgICB0aGlzLmVtaXRTb2Z0d2FyZUluc3RhbGwoc29mdHdhcmVUb0luc3RhbGwpO1xuICAgICAgdGhpcy5zaG93U29mdHdhcmVDaGFuZ2VzLmVtaXQoKTtcbiAgICB9KTtcblxuICAgIGNob2ljZUVtaXR0ZXJcbiAgICAgIC5waXBlKFxuICAgICAgICB0aGlzLmlzU29mdHdhcmVJbnN0YWxsZWRPbkRldmljZVBpcGUodXBkYXRlSW5zdGFsbGFibGVMaXN0JCksXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3llZCQpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCh7IGl0ZW0gfSkgPT5cbiAgICAgICAgdXBkYXRlSW5zdGFsbGFibGVMaXN0JC5uZXh0KHtcbiAgICAgICAgICBvYmplY3Q6IGl0ZW0sXG4gICAgICAgICAgdGVtcGxhdGU6IHRoaXMuYWxyZWFkeUluc3RhbGxlZFdhcm5pbmdUZW1wbGF0ZSxcbiAgICAgICAgICBtYXBwZXI6IG9iamVjdCA9PiB7XG4gICAgICAgICAgICBvYmplY3QuaW5zdGFsbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgKTtcbiAgfVxuXG4gIHVwZGF0ZVNvZnR3YXJlKHNvZnR3YXJlVG9VcGRhdGUpIHtcbiAgICBjb25zdCB7IHJlc3VsdEVtaXR0ZXIsIGNob2ljZUVtaXR0ZXIsIHVwZGF0ZUluc3RhbGxhYmxlTGlzdCQgfSA9XG4gICAgICB0aGlzLmRpc3BsYXlTb2Z0d2FyZVNlbGVjdE1vZGFsKHtcbiAgICAgICAgdGl0bGU6IGdldHRleHQoJ1VwZGF0ZSBzb2Z0d2FyZScpLFxuICAgICAgICBzdWJUaXRsZTogZ2V0dGV4dCgnU2VsZWN0IG9uZSBvZiB0aGUgYXZhaWxhYmxlIHNvZnR3YXJlIHZlcnNpb25zJyksXG4gICAgICAgIGxhYmVsczogeyBvazogZ2V0dGV4dCgnVXBkYXRlJykgfSxcbiAgICAgICAgbm9JdGVtc01lc3NhZ2U6IGdldHRleHQoJ05vIG90aGVyIHNvZnR3YXJlIHZlcnNpb25zIGF2YWlsYWJsZS4nKSxcbiAgICAgICAgc2hvd0ZpbHRlcjogZmFsc2UsXG4gICAgICAgIHJlcG9zaXRvcnlFbnRyaWVzV2l0aFZlcnNpb25zJDogdGhpcy5nZXRTaW5nbGVTb2Z0d2FyZVdpdGhWZXJzaW9ucyQoc29mdHdhcmVUb1VwZGF0ZSlcbiAgICAgIH0pO1xuXG4gICAgcmVzdWx0RW1pdHRlci5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3llZCQpKS5zdWJzY3JpYmUoc29mdHdhcmVUb0luc3RhbGwgPT4ge1xuICAgICAgdGhpcy5lbWl0U29mdHdhcmVJbnN0YWxsKHNvZnR3YXJlVG9JbnN0YWxsKTtcbiAgICAgIHRoaXMuc2hvd1NvZnR3YXJlQ2hhbmdlcy5lbWl0KCk7XG4gICAgfSk7XG5cbiAgICBjaG9pY2VFbWl0dGVyXG4gICAgICAucGlwZShcbiAgICAgICAgdGhpcy5pc1NvZnR3YXJlSW5zdGFsbGVkT25EZXZpY2VQaXBlKHVwZGF0ZUluc3RhbGxhYmxlTGlzdCQpLFxuICAgICAgICB0YWtlVW50aWwodGhpcy5kZXN0cm95ZWQkKVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgoeyBpdGVtIH0pID0+XG4gICAgICAgIHVwZGF0ZUluc3RhbGxhYmxlTGlzdCQubmV4dCh7XG4gICAgICAgICAgb2JqZWN0OiBpdGVtLFxuICAgICAgICAgIHRlbXBsYXRlOiB0aGlzLmFscmVhZHlJbnN0YWxsZWRXYXJuaW5nVGVtcGxhdGUsXG4gICAgICAgICAgbWFwcGVyOiBvYmplY3QgPT4ge1xuICAgICAgICAgICAgb2JqZWN0Lmluc3RhbGxlZCA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICk7XG4gIH1cblxuICByZW1vdmVTb2Z0d2FyZShzb2Z0d2FyZVRvUmVtb3ZlKSB7XG4gICAgdGhpcy5lbWl0U29mdHdhcmVSZW1vdmFsKFtzb2Z0d2FyZVRvUmVtb3ZlXSk7XG4gIH1cblxuICBnZXRJbnN0YWxsYWJsZVNvZnR3YXJlTGlzdFdpdGhWZXJzaW9ucyQoc2VhcmNoVGVybSQ6IEJlaGF2aW9yU3ViamVjdDxGaWx0ZXJDcml0ZXJpYT4pIHtcbiAgICBjb25zdCBpbnN0YWxsZWRTb2Z0d2FyZU5hbWVzID0gKHRoaXMuc29mdHdhcmVMaXN0IHx8IFtdKS5tYXAocyA9PiBzLm5hbWUpO1xuICAgIHJldHVybiBzZWFyY2hUZXJtJC5waXBlKFxuICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKSxcbiAgICAgIHN3aXRjaE1hcChzZWFyY2hUZXJtID0+XG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5saXN0UmVwb3NpdG9yeUVudHJpZXMoUmVwb3NpdG9yeVR5cGUuU09GVFdBUkUsIHtcbiAgICAgICAgICBxdWVyeTogc2VhcmNoVGVybS5zb2Z0d2FyZVR5cGVcbiAgICAgICAgICAgID8gdGhpcy5xdWVyaWVzVXRpbC5hZGRBbmRGaWx0ZXIodGhpcy50eXBlc1F1ZXJ5LCB7XG4gICAgICAgICAgICAgICAgc29mdHdhcmVUeXBlOiBzZWFyY2hUZXJtLnNvZnR3YXJlVHlwZVxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgOiB0aGlzLnR5cGVzUXVlcnksXG4gICAgICAgICAgcGFydGlhbE5hbWU6IHNlYXJjaFRlcm0/Lm5hbWUsXG4gICAgICAgICAgcGFyYW1zOiB7IHBhZ2VTaXplOiAxMDAgfVxuICAgICAgICB9KVxuICAgICAgKSxcbiAgICAgIG1hcCgoeyBkYXRhIH0pID0+IGRhdGEpLFxuICAgICAgbWFwKHNvZnR3YXJlTGlzdCA9PiB7XG4gICAgICAgIHJldHVybiBzb2Z0d2FyZUxpc3QuZmlsdGVyKHNvZnR3YXJlID0+IHtcbiAgICAgICAgICByZXR1cm4gIWluc3RhbGxlZFNvZnR3YXJlTmFtZXMuaW5jbHVkZXMoc29mdHdhcmUubmFtZSk7XG4gICAgICAgIH0pO1xuICAgICAgfSksXG4gICAgICBtYXAoc29mdHdhcmVMaXN0ID0+IHRoaXMuYXR0YWNoVmVyc2lvbnMoc29mdHdhcmVMaXN0KSksXG4gICAgICBzaGFyZVJlcGxheSgxKVxuICAgICk7XG4gIH1cblxuICBnZXRTaW5nbGVTb2Z0d2FyZVdpdGhWZXJzaW9ucyQoc29mdHdhcmU6IERldmljZVNvZnR3YXJlKSB7XG4gICAgcmV0dXJuIGZyb20oXG4gICAgICB0aGlzLnJlcG9zaXRvcnkubGlzdFJlcG9zaXRvcnlFbnRyaWVzKFJlcG9zaXRvcnlUeXBlLlNPRlRXQVJFLCB7XG4gICAgICAgIHF1ZXJ5OiB7IG5hbWU6IHNvZnR3YXJlLm5hbWUgfVxuICAgICAgfSlcbiAgICApLnBpcGUoXG4gICAgICBtYXAoKHsgZGF0YSB9KSA9PiBkYXRhKSxcbiAgICAgIG1hcChzb2Z0d2FyZUxpc3QgPT4gdGhpcy5hdHRhY2hWZXJzaW9ucyhzb2Z0d2FyZUxpc3QpKSxcbiAgICAgIHNoYXJlUmVwbGF5KDEpXG4gICAgKTtcbiAgfVxuXG4gIGF0dGFjaFZlcnNpb25zKHNvZnR3YXJlTGlzdDogSU1hbmFnZWRPYmplY3RbXSkge1xuICAgIHNvZnR3YXJlTGlzdC5mb3JFYWNoKHNvZnR3YXJlID0+IHtcbiAgICAgIHNvZnR3YXJlLnZlcnNpb25zID0gdGhpcy5yZXBvc2l0b3J5Lmxpc3RCYXNlVmVyc2lvbnMoc29mdHdhcmUpO1xuICAgIH0pO1xuICAgIHJldHVybiBzb2Z0d2FyZUxpc3Q7XG4gIH1cblxuICBkaXNwbGF5U29mdHdhcmVTZWxlY3RNb2RhbChpbml0aWFsU3RhdGVPdmVycmlkZXMpIHtcbiAgICBjb25zdCBpbml0aWFsU3RhdGUgPSB7XG4gICAgICByZXBvc2l0b3J5VHlwZTogUmVwb3NpdG9yeVR5cGUuU09GVFdBUkUsXG4gICAgICBtb2RlOiBNb2RhbFNlbGVjdGlvbk1vZGUuTVVMVEksXG4gICAgICBpY29uOiAnYzh5LXRvb2xzJyxcbiAgICAgIGRpc2FibGVTZWxlY3RlZDogZmFsc2UsXG4gICAgICBzZWxlY3RlZDogdGhpcy5zb2Z0d2FyZUxpc3QsXG4gICAgICAuLi5pbml0aWFsU3RhdGVPdmVycmlkZXNcbiAgICB9O1xuICAgIGNvbnN0IG1vZGFsID0gdGhpcy5ic01vZGFsLnNob3coUmVwb3NpdG9yeVNlbGVjdE1vZGFsQ29tcG9uZW50LCB7XG4gICAgICBpZ25vcmVCYWNrZHJvcENsaWNrOiB0cnVlLFxuICAgICAgY2xhc3M6ICdtb2RhbC1zbScsXG4gICAgICBhcmlhRGVzY3JpYmVkYnk6ICdtb2RhbC1ib2R5JyxcbiAgICAgIGFyaWFMYWJlbGxlZEJ5OiAnbW9kYWwtdGl0bGUnLFxuICAgICAgaW5pdGlhbFN0YXRlXG4gICAgfSk7XG5cbiAgICBpZiAoaW5pdGlhbFN0YXRlT3ZlcnJpZGVzLnJlcG9zaXRvcnlFbnRyaWVzV2l0aFZlcnNpb25zRm4kKSB7XG4gICAgICBtb2RhbC5jb250ZW50LnJlcG9zaXRvcnlFbnRyaWVzV2l0aFZlcnNpb25zJCA9XG4gICAgICAgIGluaXRpYWxTdGF0ZU92ZXJyaWRlcy5yZXBvc2l0b3J5RW50cmllc1dpdGhWZXJzaW9uc0ZuJChtb2RhbCk7XG4gICAgfVxuXG4gICAgdGhpcy5tb2RhbFNlYXJjaCA9IG1vZGFsLmNvbnRlbnQuc2VhcmNoLmJpbmQobW9kYWwuY29udGVudCk7XG5cbiAgICBtb2RhbC5jb250ZW50LmxvYWQubmV4dCgpO1xuICAgIHJldHVybiB7XG4gICAgICByZXN1bHRFbWl0dGVyOiBtb2RhbC5jb250ZW50LnJlc3VsdEVtaXR0ZXIsXG4gICAgICBjaG9pY2VFbWl0dGVyOiBtb2RhbC5jb250ZW50Lm9uQ2hvaWNlVXBkYXRlZCxcbiAgICAgIHVwZGF0ZUluc3RhbGxhYmxlTGlzdCQ6IG1vZGFsLmNvbnRlbnQudXBkYXRlSW5zdGFsbGFibGVMaXN0JFxuICAgIH07XG4gIH1cblxuICBzZWFyY2goZmlsdGVyQ3JpdGVyaWE6IEZpbHRlckNyaXRlcmlhKSB7XG4gICAgaWYgKHRoaXMubW9kYWxTZWFyY2gpIHtcbiAgICAgIHRoaXMubW9kYWxTZWFyY2goZmlsdGVyQ3JpdGVyaWEpO1xuICAgIH1cbiAgfVxuXG4gIGVtaXRTb2Z0d2FyZUluc3RhbGwoaXRlbXM6IERldmljZVNvZnR3YXJlW10pIHtcbiAgICB0aGlzLmNoYW5nZXMuZW1pdChcbiAgICAgIGl0ZW1zLm1hcChpdGVtID0+IHtcbiAgICAgICAgcmV0dXJuIHsgLi4uaXRlbSwgYWN0aW9uOiAnaW5zdGFsbCcgfTtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIGVtaXRTb2Z0d2FyZVJlbW92YWwoaXRlbXM6IERldmljZVNvZnR3YXJlW10pIHtcbiAgICB0aGlzLmNoYW5nZXMuZW1pdChcbiAgICAgIGl0ZW1zLm1hcChpdGVtID0+IHtcbiAgICAgICAgcmV0dXJuIHsgLi4uaXRlbSwgYWN0aW9uOiAnZGVsZXRlJyB9O1xuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5kZXN0cm95ZWQkLm5leHQoKTtcbiAgICB0aGlzLmRlc3Ryb3llZCQuY29tcGxldGUoKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNTb2Z0d2FyZUluc3RhbGxlZE9uRGV2aWNlUGlwZSh1cGRhdGVJbnN0YWxsYWJsZUxpc3QkOiBTdWJqZWN0PElVcGRhdGVJdGVtRXZlbnQ8YW55Pj4pIHtcbiAgICByZXR1cm4gcGlwZShcbiAgICAgIHRhcCgoaXRlbTogSVNlbGVjdE1vZGFsT2JqZWN0KSA9PlxuICAgICAgICB1cGRhdGVJbnN0YWxsYWJsZUxpc3QkLm5leHQoeyBvYmplY3Q6IGl0ZW0sIHRlbXBsYXRlOiB0aGlzLmxvYWRpbmdUZW1wbGF0ZSB9KVxuICAgICAgKSxcbiAgICAgIG1hcChpdGVtID0+ICh7XG4gICAgICAgIGl0ZW0sXG4gICAgICAgIHNvZnR3YXJlOiAoXG4gICAgICAgICAgKGl0ZW0ub3B0aW9ucyB8fCBbXSkuZmluZChvcHRpb24gPT4gb3B0aW9uLm9iai5pZCA9PT0gKGl0ZW0gYXMgYW55KS5zZWxlY3RlZElkKSB8fCB7fVxuICAgICAgICApLm9ialxuICAgICAgfSkpLFxuICAgICAgbWVyZ2VNYXAoKHsgaXRlbSwgc29mdHdhcmUgfSkgPT5cbiAgICAgICAgZnJvbShcbiAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuaXNTb2Z0d2FyZUluc3RhbGxlZE9uRGV2aWNlKHRoaXMuZGV2aWNlLmlkLCBzb2Z0d2FyZSBhcyBEZXZpY2VTb2Z0d2FyZSlcbiAgICAgICAgKS5waXBlKG1hcChpbnN0YWxsZWQgPT4gKHsgaXRlbSwgaW5zdGFsbGVkIH0pKSlcbiAgICAgICksXG4gICAgICB0YXAoKHsgaXRlbSB9KSA9PiB1cGRhdGVJbnN0YWxsYWJsZUxpc3QkLm5leHQoeyBvYmplY3Q6IGl0ZW0gfSkpLFxuICAgICAgZmlsdGVyKCh7IGluc3RhbGxlZCB9KSA9PiAhIWluc3RhbGxlZClcbiAgICApO1xuICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwiZC1mbGV4IGQtY29sIGZsZXgtZ3Jvd1wiPlxuICA8ZGl2IGNsYXNzPVwiY2FyZC1oZWFkZXIgbGFyZ2UtcGFkZGluZyBzZXBhcmF0b3Igc3RpY2t5LXRvcFwiPlxuICAgIDxkaXYgY2xhc3M9XCJjYXJkLXRpdGxlXCIgdHJhbnNsYXRlPkluc3RhbGxlZCBzb2Z0d2FyZTwvZGl2PlxuICA8L2Rpdj5cbiAgPGRpdiBjbGFzcz1cImZsZXgtZ3Jvd1wiPlxuICAgIDxmaWVsZHNldFxuICAgICAgaWQ9XCJvcGVyYXRpb24tYmxvY2tcIlxuICAgICAgKm5nSWY9XCJkZXZpY2VTb2Z0d2FyZUNoYW5nZXNPcGVyYXRpb25cIlxuICAgICAgY2xhc3M9XCJjYXJkLWJsb2NrIGxhcmdlLXBhZGRpbmcgYmctbGV2ZWwtMiBwLTBcIlxuICAgID5cbiAgICAgIDxjOHktb3BlcmF0aW9uLWRldGFpbHMgW29wZXJhdGlvbl09XCJkZXZpY2VTb2Z0d2FyZUNoYW5nZXNPcGVyYXRpb25cIj48L2M4eS1vcGVyYXRpb24tZGV0YWlscz5cbiAgICA8L2ZpZWxkc2V0PlxuICAgIDxmaWVsZHNldCBjbGFzcz1cImNhcmQtYmxvY2sgbGFyZ2UtcGFkZGluZyBvdmVyZmxvdy12aXNpYmxlIHNlcGFyYXRvci1ib3R0b21cIiAqbmdJZj1cInNob3dGaWx0ZXJcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJyb3dcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC14cy02XCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImlucHV0LWdyb3VwIGlucHV0LWdyb3VwLXNlYXJjaFwiPlxuICAgICAgICAgICAgPGxhYmVsIGZvcj1cImZpbHRlclwiIGNsYXNzPVwic3Itb25seVwiPlxuICAgICAgICAgICAgICB7eyAnRmlsdGVyIGluc3RhbGxlZCBzb2Z0d2FyZeKApicgfCB0cmFuc2xhdGUgfX1cbiAgICAgICAgICAgIDwvbGFiZWw+XG4gICAgICAgICAgICA8aW5wdXRcbiAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIlxuICAgICAgICAgICAgICB0eXBlPVwic2VhcmNoXCJcbiAgICAgICAgICAgICAgdGl0bGU9XCJ7eyAnRmlsdGVyIGluc3RhbGxlZCBzb2Z0d2FyZeKApicgfCB0cmFuc2xhdGUgfX1cIlxuICAgICAgICAgICAgICBpZD1cImZpbHRlclwiXG4gICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwie3sgJ0ZpbHRlciBpbnN0YWxsZWQgc29mdHdhcmXigKYnIHwgdHJhbnNsYXRlIH19XCJcbiAgICAgICAgICAgICAgW25nTW9kZWxdPVwidGV4dEZpbHRlciQgfCBhc3luY1wiXG4gICAgICAgICAgICAgIChuZ01vZGVsQ2hhbmdlKT1cInRleHRGaWx0ZXIkLm5leHQoJGV2ZW50KVwiXG4gICAgICAgICAgICAvPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJpbnB1dC1ncm91cC1hZGRvblwiPlxuICAgICAgICAgICAgICA8aSBjOHlJY29uPVwic2VhcmNoXCIgKm5nSWY9XCIodGV4dEZpbHRlciQgfCBhc3luYykubGVuZ3RoID09PSAwXCI+PC9pPlxuICAgICAgICAgICAgICA8aVxuICAgICAgICAgICAgICAgIGNsYXNzPVwidGV4dC1tdXRlZFwiXG4gICAgICAgICAgICAgICAgYzh5SWNvbj1cInRpbWVzXCJcbiAgICAgICAgICAgICAgICAqbmdJZj1cIih0ZXh0RmlsdGVyJCB8IGFzeW5jKS5sZW5ndGggPiAwXCJcbiAgICAgICAgICAgICAgICAoY2xpY2spPVwidGV4dEZpbHRlciQubmV4dCgnJylcIlxuICAgICAgICAgICAgICA+PC9pPlxuICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgPHNwYW4gZm9yPVwiZmlsdGVyXCIgY2xhc3M9XCJzci1vbmx5XCIgdHJhbnNsYXRlPkZpbHRlciBpbnN0YWxsZWQgc29mdHdhcmXigKY8L3NwYW4+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXhzLTZcIj5cbiAgICAgICAgICA8Yzh5LXNvZnR3YXJlLXR5cGVcbiAgICAgICAgICAgIFtyZXF1aXJlZF09XCJmYWxzZVwiXG4gICAgICAgICAgICBbZW1pdFJlc3VsdHNPbmx5XT1cInRydWVcIlxuICAgICAgICAgICAgW3Nob3dCdG5Jbk5vdEZvdW5kTWVzc2FnZV09XCJmYWxzZVwiXG4gICAgICAgICAgICBbYWxsb3dGcmVlRW50cmllc109XCJmYWxzZVwiXG4gICAgICAgICAgICBbcGxhY2Vob2xkZXJdPVwiJ0ZpbHRlciBieSBzb2Z0d2FyZSB0eXBl4oCmJyB8IHRyYW5zbGF0ZVwiXG4gICAgICAgICAgICBbc2hvd0NsZWFyU2VsZWN0aW9uT3B0aW9uXT1cInRydWVcIlxuICAgICAgICAgICAgKG9uU2VsZWN0U29mdHdhcmUpPVwic29mdHdhcmVUeXBlRmlsdGVyJC5uZXh0KCRldmVudD8uc29mdHdhcmVUeXBlKVwiXG4gICAgICAgICAgPjwvYzh5LXNvZnR3YXJlLXR5cGU+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9maWVsZHNldD5cblxuICAgIDxmaWVsZHNldFxuICAgICAgaWQ9XCJzb2Z0d2FyZS1saXN0XCJcbiAgICAgIGNsYXNzPVwiZmxleC1ncm93IGlubmVyLXNjcm9sbFwiXG4gICAgICBbZGlzYWJsZWRdPVwiZGV2aWNlU29mdHdhcmVDaGFuZ2VzSW5Qcm9ncmVzc1wiXG4gICAgPlxuICAgICAgPCEtLSBOT1QgRU1QVFkgU1RBVEUgLS0+XG4gICAgICA8Yzh5LWRldmljZS1zb2Z0d2FyZS1saXN0XG4gICAgICAgIFtkZXZpY2VdPVwiZGV2aWNlXCJcbiAgICAgICAgW2ZpbHRlckNyaXRlcmlhJF09XCJmaWx0ZXJDcml0ZXJpYSRcIlxuICAgICAgICBbc29mdHdhcmVMaXN0XT1cInNvZnR3YXJlTGlzdFwiXG4gICAgICAgIFtkZXZpY2VTb2Z0d2FyZUNoYW5nZXNdPVwiZGV2aWNlU29mdHdhcmVDaGFuZ2VzXCJcbiAgICAgICAgKHVwZGF0ZSk9XCJ1cGRhdGVTb2Z0d2FyZSgkZXZlbnQpXCJcbiAgICAgICAgKHJlbW92ZSk9XCJyZW1vdmVTb2Z0d2FyZSgkZXZlbnQpXCJcbiAgICAgICAgKG9uTGlzdEVtcHR5KT1cInNob3dGaWx0ZXIgPSAhJGV2ZW50XCJcbiAgICAgICAgY2xhc3M9XCJkLWJsb2NrIHAtbC0xNiBwLXItMTZcIlxuICAgICAgICBjb250YWluZXI9XCJib2R5XCJcbiAgICAgID5cbiAgICAgICAgPCEtLSBFTVBUWSBTVEFURSAtLT5cbiAgICAgICAgPGRpdiBjbGFzcz1cImM4eS1lbXB0eS1zdGF0ZSB0ZXh0LWNlbnRlclwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJoMSBjOHktaWNvbiBjOHktaWNvbi10b29scyBjOHktaWNvbi1kdW9jb2xvclwiPjwvZGl2PlxuICAgICAgICAgIDxwPlxuICAgICAgICAgICAgPHN0cm9uZyB0cmFuc2xhdGU+Tm8gc29mdHdhcmUgaW5zdGFsbGVkLjwvc3Ryb25nPlxuICAgICAgICAgICAgPGJyIC8+XG4gICAgICAgICAgICA8c21hbGwgdHJhbnNsYXRlPkNsaWNrIGJlbG93IHRvIGluc3RhbGwgc29mdHdhcmUgaW50byB0aGlzIGRldmljZS48L3NtYWxsPlxuICAgICAgICAgIDwvcD5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDwhLS0gTk8gU0VBUkNIIFJFU1VMVFMgU1RBVEUgLS0+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjOHktZW1wdHktc3RhdGUgYzh5LW5vLXJlc3VsdHMtc3RhdGUgdGV4dC1jZW50ZXJcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiaDEgYzh5LWljb24gYzh5LWljb24tdG9vbHMgYzh5LWljb24tZHVvY29sb3JcIj48L2Rpdj5cbiAgICAgICAgICA8cD5cbiAgICAgICAgICAgIDxzdHJvbmcgdHJhbnNsYXRlPk5vIHNvZnR3YXJlIG1hdGNoZXMgeW91ciBmaWx0ZXIgY3JpdGVyaWEuPC9zdHJvbmc+XG4gICAgICAgICAgICA8YnIgLz5cbiAgICAgICAgICAgIDxzbWFsbCB0cmFuc2xhdGU+VHJ5IGNoYW5naW5nIHlvdXIgc2VhcmNoIGNyaXRlcmlhLjwvc21hbGw+XG4gICAgICAgICAgPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvYzh5LWRldmljZS1zb2Z0d2FyZS1saXN0PlxuICAgIDwvZmllbGRzZXQ+XG4gIDwvZGl2PlxuICA8IS0tIElOU1RBTEwgU09GVFdBUkUtLT5cbiAgPGRpdlxuICAgIGNsYXNzPVwiY2FyZC1mb290ZXIgbGFyZ2UtcGFkZGluZyBzZXBhcmF0b3Igc3RpY2t5LWJvdHRvbSBkLWZsZXggai1jLWJldHdlZW4gYmctbGV2ZWwtMFwiXG4gICAgW25nQ2xhc3NdPVwieyAndmlzaWJsZS1zbSB2aXNpYmxlLXhzJzogIXN1cHBvcnRzU29mdHdhcmVPcGVyYXRpb25zIH1cIlxuICA+XG4gICAgPGJ1dHRvblxuICAgICAgKm5nSWY9XCJzdXBwb3J0c1NvZnR3YXJlT3BlcmF0aW9uc1wiXG4gICAgICBjbGFzcz1cImJ0biBidG4tZGVmYXVsdFwiXG4gICAgICB0aXRsZT1cInt7ICdJbnN0YWxsIHNvZnR3YXJlJyB8IHRyYW5zbGF0ZSB9fVwiXG4gICAgICAoY2xpY2spPVwiaW5zdGFsbFNvZnR3YXJlKClcIlxuICAgICAgW2Rpc2FibGVkXT1cImRldmljZVNvZnR3YXJlQ2hhbmdlc0luUHJvZ3Jlc3NcIlxuICAgICAgYzh5UHJvZHVjdEV4cGVyaWVuY2VcbiAgICAgIFthY3Rpb25OYW1lXT1cIlBST0RVQ1RfRVhQRVJJRU5DRS5TT0ZUV0FSRS5FVkVOVFMuREVWSUNFX1RBQlwiXG4gICAgICBbYWN0aW9uRGF0YV09XCJ7XG4gICAgICAgIGNvbXBvbmVudDogUFJPRFVDVF9FWFBFUklFTkNFLlNPRlRXQVJFLkNPTVBPTkVOVFMuREVWSUNFX1NPRlRXQVJFX0xJU1QsXG4gICAgICAgIGFjdGlvbjogUFJPRFVDVF9FWFBFUklFTkNFLlNPRlRXQVJFLkFDVElPTlMuT1BFTl9JTlNUQUxMX1NPRlRXQVJFXG4gICAgICB9XCJcbiAgICA+XG4gICAgICA8aSBjOHlJY29uPVwicGx1cy1jaXJjbGVcIj48L2k+XG4gICAgICB7eyAnSW5zdGFsbCBzb2Z0d2FyZScgfCB0cmFuc2xhdGUgfX1cbiAgICA8L2J1dHRvbj5cbiAgICA8YnV0dG9uXG4gICAgICAoY2xpY2spPVwic2hvd1NvZnR3YXJlQ2hhbmdlcy5lbWl0KClcIlxuICAgICAgY2xhc3M9XCJidG4gYnRuLWNsZWFuIHRleHQtcHJpbWFyeSB2aXNpYmxlLXNtIHZpc2libGUteHNcIlxuICAgICAgW3RpdGxlXT1cIidTaG93ICZxdW90O1NvZnR3YXJlIGNoYW5nZXMmcXVvdDsnIHwgdHJhbnNsYXRlXCJcbiAgICA+XG4gICAgICA8c3BhbiB0cmFuc2xhdGU+U2hvdyBcIlNvZnR3YXJlIGNoYW5nZXNcIjwvc3Bhbj5cbiAgICAgIDxpIGM4eUljb249XCJjaGV2cm9uLXJpZ2h0XCI+PC9pPlxuICAgIDwvYnV0dG9uPlxuICA8L2Rpdj5cbjwvZGl2PlxuXG48bmctdGVtcGxhdGUgI2FscmVhZHlJbnN0YWxsZWRXYXJuaW5nIGxldC1pdGVtIGxldC1vcHRpb249XCJvcHRpb25cIj5cbiAgPGlcbiAgICBjOHlJY29uPVwid2FybmluZ1wiXG4gICAgY2xhc3M9XCJ0ZXh0LXdhcm5pbmcgYS1zLWNlbnRlclwiXG4gICAgW3Rvb2x0aXBdPVwiXG4gICAgICBhbHJlYWR5SW5zdGFsbGVkTWVzc2FnZVxuICAgICAgICB8IHRyYW5zbGF0ZTogeyBuYW1lOiBpdGVtLmJvZHlbMF0udmFsdWUsIHZlcnNpb246IG9wdGlvbi5ib2R5WzBdLnZhbHVlIH1cbiAgICBcIlxuICA+PC9pPlxuPC9uZy10ZW1wbGF0ZT5cblxuPG5nLXRlbXBsYXRlICNsb2FkaW5nPlxuICA8ZGl2IGNsYXNzPVwicC1yZWxhdGl2ZSBkLWZsZXggbS1sLWF1dG9cIj5cbiAgICA8aSBjbGFzcz1cImljb24tc3BpblwiIGM4eUljb249XCJjaXJjbGUtby1ub3RjaFwiPjwvaT5cbiAgPC9kaXY+XG48L25nLXRlbXBsYXRlPlxuXG48bmctdGVtcGxhdGUgI3NvZnR3YXJlVHlwZT5cbiAgPGM4eS1zb2Z0d2FyZS10eXBlXG4gICAgYWRkaXRpb25hbEZpbHRlclxuICAgIFtyZXF1aXJlZF09XCJmYWxzZVwiXG4gICAgW3BsYWNlaG9sZGVyXT1cIidGaWx0ZXIgYnkgc29mdHdhcmUgdHlwZeKApicgfCB0cmFuc2xhdGVcIlxuICAgIChvblNlbGVjdFNvZnR3YXJlKT1cInNlYXJjaCh7IHNvZnR3YXJlVHlwZTogJGV2ZW50Py5zb2Z0d2FyZVR5cGUgfSlcIlxuICAgIFtlbWl0UmVzdWx0c09ubHldPVwidHJ1ZVwiXG4gICAgW3Nob3dCdG5Jbk5vdEZvdW5kTWVzc2FnZV09XCJmYWxzZVwiXG4gICAgW2FsbG93RnJlZUVudHJpZXNdPVwiZmFsc2VcIlxuICAgIFtzaG93Q2xlYXJTZWxlY3Rpb25PcHRpb25dPVwidHJ1ZVwiXG4gID48L2M4eS1zb2Z0d2FyZS10eXBlPlxuPC9uZy10ZW1wbGF0ZT5cbiJdfQ==