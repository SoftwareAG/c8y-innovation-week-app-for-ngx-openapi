import { coerceBooleanProperty } from '@angular/cdk/coercion';
import { Component, EventEmitter, forwardRef, HostBinding, Input, Output } from '@angular/core';
import { PRODUCT_EXPERIENCE_EVENT_SOURCE } from '@c8y/ngx-components';
import { ACTIONS } from '@c8y/ngx-components/operations/product-experience';
import * as i0 from "@angular/core";
import * as i1 from "@c8y/ngx-components";
import * as i2 from "@angular/common";
import * as i3 from "ngx-bootstrap/dropdown";
export class StatusFilterComponent {
    constructor() {
        this.ACTIONS = ACTIONS;
        this.statusOptions = [];
        this.onFilterChanged = new EventEmitter();
        this.isAllButtonSelected = true;
    }
    /** List of filter options to be displayed */
    set options(options) {
        this.statusOptions = (Object.values(options) || []).map(option => ({
            selected: false,
            option
        }));
    }
    /**
     * Allows multiple options to be active simultaneosly.
     */
    set _multiple(multiple) {
        this.multiple = coerceBooleanProperty(multiple);
    }
    /** Display the filter as a small button group */
    set _small(small) {
        this.small = coerceBooleanProperty(small);
    }
    get displaySmall() {
        return this.small;
    }
    changeFilter(option) {
        this.isAllButtonSelected = false;
        let emitNeeded = false;
        if (this.multiple) {
            option.selected = !option.selected;
            emitNeeded = true;
        }
        else if (!option.selected) {
            option.selected = true;
            this.statusOptions.filter(op => op !== option).forEach(op => (op.selected = false));
            emitNeeded = true;
        }
        if (emitNeeded) {
            this.emitSelectedOptions();
        }
    }
    removeFilter() {
        this.isAllButtonSelected = true;
        this.statusOptions.forEach(op => (op.selected = false));
        this.emitSelectedOptions();
    }
    /**
     * Allows the filter to be initalliy displayed with some preset filters.
     *
     * @param filters An `StatusOption` array defining filter options to be preset.
     * @param emit  (optional) If `true` component will emit `onFilterChanged` event.
     */
    preset(filters, emit = true) {
        let firstSelected = false;
        this.statusOptions.forEach(option => (option.selected = false));
        this.statusOptions
            .filter(option => (filters || []).map(o => o.label).includes(option.option.label))
            .filter(() => {
            // only first option passed will be set in single selection mode
            const include = this.multiple || !firstSelected;
            if (include) {
                firstSelected = true;
            }
            return include;
        })
            .forEach(option => (option.selected = true));
        this.isAllButtonSelected = !(filters && filters.length);
        if (emit) {
            this.emitSelectedOptions();
        }
    }
    reset() {
        this.removeFilter();
    }
    activeFilters() {
        return this.statusOptions.filter(option => option.selected).map(option => option.option);
    }
    isFilterApplied() {
        return this.statusOptions.some(option => option.selected);
    }
    emitSelectedOptions() {
        this.onFilterChanged.emit(this.statusOptions.filter(option => option.selected).map(option => option.option));
    }
}
StatusFilterComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: StatusFilterComponent, deps: [], target: i0.ɵɵFactoryTarget.Component });
StatusFilterComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.7", type: StatusFilterComponent, selector: "c8y-status-filter", inputs: { options: "options", _multiple: ["multiple", "_multiple"], _small: ["small", "_small"] }, outputs: { onFilterChanged: "onFilterChanged" }, host: { properties: { "class.btn-group-sm": "this.displaySmall" } }, providers: [
        {
            provide: PRODUCT_EXPERIENCE_EVENT_SOURCE,
            useExisting: forwardRef(() => StatusFilterComponent)
        }
    ], ngImport: i0, template: "<div dropdown placement=\"bottom left\" class=\"dropdown c8y-child-assets-selector\">\n  <button\n    class=\"btn dropdown-toggle d-flex a-i-center c8y-dropdown\"\n    type=\"button\"\n    title=\"{{ 'Status filter' | translate }}\"\n    dropdownToggle\n  >\n    <span *ngFor=\"let option of statusOptions\" class=\"d-contents\">\n      <span class=\"text-truncate\" *ngIf=\"option.selected\">\n        <i [c8yIcon]=\"option.option.icon\" [ngClass]=\"option.option.styleClass\"></i>\n        <span class=\"m-l-4\">{{ option.option.label | translate }}</span>\n      </span>\n    </span>\n    <span class=\"text-truncate\" *ngIf=\"isAllButtonSelected\">\n      <i c8yIcon=\"c8y-energy\" class=\"m-r-4 text-info\"></i>\n      {{ 'All statuses' | translate }}\n    </span>\n  </button>\n  <ul\n    id=\"dropdown-status-filter\"\n    *dropdownMenu\n    class=\"dropdown-menu\"\n    role=\"menu\"\n    aria-labelledby=\"status-filter\"\n  >\n    <li *ngFor=\"let option of statusOptions\" [ngClass]=\"{ active: option.selected }\">\n      <button\n        type=\"button\"\n        [title]=\"option.option.label | translate\"\n        (click)=\"changeFilter(option)\"\n        c8yProductExperience\n        inherit\n        [actionData]=\"{\n          action: ACTIONS.FILTER,\n          filterBy: 'status',\n          filterValue: option.option.label\n        }\"\n      >\n        <i [c8yIcon]=\"option.option.icon\" [ngClass]=\"option.option.styleClass\"></i>\n        <span class=\"m-l-4\">{{ option.option.label | translate }}</span>\n      </button>\n    </li>\n    <li [ngClass]=\"{ active: isAllButtonSelected }\">\n      <button\n        type=\"button\"\n        title=\"{{ 'All statuses' | translate }}\"\n        (click)=\"removeFilter()\"\n        c8yProductExperience\n        inherit\n        [actionData]=\"{\n          action: ACTIONS.FILTER,\n          filterBy: 'status'\n        }\"\n      >\n        <i c8yIcon=\"c8y-energy\" class=\"m-r-4 text-info\"></i>\n        {{ 'All statuses' | translate }}\n      </button>\n    </li>\n  </ul>\n</div>\n", dependencies: [{ kind: "directive", type: i1.IconDirective, selector: "[c8yIcon]", inputs: ["c8yIcon"] }, { kind: "directive", type: i2.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i1.ProductExperienceDirective, selector: "[c8yProductExperience]", inputs: ["actionName", "actionData", "inherit", "suppressDataOverriding"] }, { kind: "directive", type: i3.BsDropdownMenuDirective, selector: "[bsDropdownMenu],[dropdownMenu]", exportAs: ["bs-dropdown-menu"] }, { kind: "directive", type: i3.BsDropdownToggleDirective, selector: "[bsDropdownToggle],[dropdownToggle]", exportAs: ["bs-dropdown-toggle"] }, { kind: "directive", type: i3.BsDropdownDirective, selector: "[bsDropdown], [dropdown]", inputs: ["placement", "triggers", "container", "dropup", "autoClose", "isAnimated", "insideClick", "isDisabled", "isOpen"], outputs: ["isOpenChange", "onShown", "onHidden"], exportAs: ["bs-dropdown"] }, { kind: "pipe", type: i1.C8yTranslatePipe, name: "translate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: StatusFilterComponent, decorators: [{
            type: Component,
            args: [{ selector: 'c8y-status-filter', providers: [
                        {
                            provide: PRODUCT_EXPERIENCE_EVENT_SOURCE,
                            useExisting: forwardRef(() => StatusFilterComponent)
                        }
                    ], template: "<div dropdown placement=\"bottom left\" class=\"dropdown c8y-child-assets-selector\">\n  <button\n    class=\"btn dropdown-toggle d-flex a-i-center c8y-dropdown\"\n    type=\"button\"\n    title=\"{{ 'Status filter' | translate }}\"\n    dropdownToggle\n  >\n    <span *ngFor=\"let option of statusOptions\" class=\"d-contents\">\n      <span class=\"text-truncate\" *ngIf=\"option.selected\">\n        <i [c8yIcon]=\"option.option.icon\" [ngClass]=\"option.option.styleClass\"></i>\n        <span class=\"m-l-4\">{{ option.option.label | translate }}</span>\n      </span>\n    </span>\n    <span class=\"text-truncate\" *ngIf=\"isAllButtonSelected\">\n      <i c8yIcon=\"c8y-energy\" class=\"m-r-4 text-info\"></i>\n      {{ 'All statuses' | translate }}\n    </span>\n  </button>\n  <ul\n    id=\"dropdown-status-filter\"\n    *dropdownMenu\n    class=\"dropdown-menu\"\n    role=\"menu\"\n    aria-labelledby=\"status-filter\"\n  >\n    <li *ngFor=\"let option of statusOptions\" [ngClass]=\"{ active: option.selected }\">\n      <button\n        type=\"button\"\n        [title]=\"option.option.label | translate\"\n        (click)=\"changeFilter(option)\"\n        c8yProductExperience\n        inherit\n        [actionData]=\"{\n          action: ACTIONS.FILTER,\n          filterBy: 'status',\n          filterValue: option.option.label\n        }\"\n      >\n        <i [c8yIcon]=\"option.option.icon\" [ngClass]=\"option.option.styleClass\"></i>\n        <span class=\"m-l-4\">{{ option.option.label | translate }}</span>\n      </button>\n    </li>\n    <li [ngClass]=\"{ active: isAllButtonSelected }\">\n      <button\n        type=\"button\"\n        title=\"{{ 'All statuses' | translate }}\"\n        (click)=\"removeFilter()\"\n        c8yProductExperience\n        inherit\n        [actionData]=\"{\n          action: ACTIONS.FILTER,\n          filterBy: 'status'\n        }\"\n      >\n        <i c8yIcon=\"c8y-energy\" class=\"m-r-4 text-info\"></i>\n        {{ 'All statuses' | translate }}\n      </button>\n    </li>\n  </ul>\n</div>\n" }]
        }], propDecorators: { options: [{
                type: Input
            }], _multiple: [{
                type: Input,
                args: ['multiple']
            }], _small: [{
                type: Input,
                args: ['small']
            }], displaySmall: [{
                type: HostBinding,
                args: ['class.btn-group-sm']
            }], onFilterChanged: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdHVzLWZpbHRlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9vcGVyYXRpb25zL3N0YXR1cy1maWx0ZXIvc3RhdHVzLWZpbHRlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9vcGVyYXRpb25zL3N0YXR1cy1maWx0ZXIvc3RhdHVzLWZpbHRlci5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUM5RCxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDaEcsT0FBTyxFQUdMLCtCQUErQixFQUNoQyxNQUFNLHFCQUFxQixDQUFDO0FBQzdCLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxtREFBbUQsQ0FBQzs7Ozs7QUFhNUUsTUFBTSxPQUFPLHFCQUFxQjtJQVZsQztRQVdFLFlBQU8sR0FBRyxPQUFPLENBQUM7UUFFbEIsa0JBQWEsR0FBdUQsRUFBRSxDQUFDO1FBMEI3RCxvQkFBZSxHQUFpQyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRTdFLHdCQUFtQixHQUFHLElBQUksQ0FBQztLQThFNUI7SUF4R0MsNkNBQTZDO0lBQzdDLElBQWEsT0FBTyxDQUFDLE9BQWtDO1FBQ3JELElBQUksQ0FBQyxhQUFhLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDakUsUUFBUSxFQUFFLEtBQUs7WUFDZixNQUFNO1NBQ1AsQ0FBQyxDQUFDLENBQUM7SUFDTixDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUF1QixTQUFTLENBQUMsUUFBaUI7UUFDaEQsSUFBSSxDQUFDLFFBQVEsR0FBRyxx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ICdAYW5ndWxhci9jZGsvY29lcmNpb24nO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIGZvcndhcmRSZWYsIEhvc3RCaW5kaW5nLCBJbnB1dCwgT3V0cHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICBQcm9kdWN0RXhwZXJpZW5jZUV2ZW50LFxuICBQcm9kdWN0RXhwZXJpZW5jZUV2ZW50U291cmNlLFxuICBQUk9EVUNUX0VYUEVSSUVOQ0VfRVZFTlRfU09VUkNFXG59IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMnO1xuaW1wb3J0IHsgQUNUSU9OUyB9IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMvb3BlcmF0aW9ucy9wcm9kdWN0LWV4cGVyaWVuY2UnO1xuaW1wb3J0IHsgT3BlcmF0aW9uU3RhdHVzT3B0aW9uc01hcCwgU3RhdHVzT3B0aW9uIH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cy9vcGVyYXRpb25zL3NoYXJlZCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS1zdGF0dXMtZmlsdGVyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3N0YXR1cy1maWx0ZXIuY29tcG9uZW50Lmh0bWwnLFxuICBwcm92aWRlcnM6IFtcbiAgICB7XG4gICAgICBwcm92aWRlOiBQUk9EVUNUX0VYUEVSSUVOQ0VfRVZFTlRfU09VUkNFLFxuICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gU3RhdHVzRmlsdGVyQ29tcG9uZW50KVxuICAgIH1cbiAgXVxufSlcbmV4cG9ydCBjbGFzcyBTdGF0dXNGaWx0ZXJDb21wb25lbnQgaW1wbGVtZW50cyBQcm9kdWN0RXhwZXJpZW5jZUV2ZW50U291cmNlIHtcbiAgQUNUSU9OUyA9IEFDVElPTlM7XG4gIHByb2R1Y3RFeHBlcmllbmNlRXZlbnQ6IFByb2R1Y3RFeHBlcmllbmNlRXZlbnQ7XG4gIHN0YXR1c09wdGlvbnM6IEFycmF5PHsgc2VsZWN0ZWQ6IGJvb2xlYW47IG9wdGlvbjogU3RhdHVzT3B0aW9uIH0+ID0gW107XG5cbiAgLyoqIExpc3Qgb2YgZmlsdGVyIG9wdGlvbnMgdG8gYmUgZGlzcGxheWVkICovXG4gIEBJbnB1dCgpIHNldCBvcHRpb25zKG9wdGlvbnM6IE9wZXJhdGlvblN0YXR1c09wdGlvbnNNYXApIHtcbiAgICB0aGlzLnN0YXR1c09wdGlvbnMgPSAoT2JqZWN0LnZhbHVlcyhvcHRpb25zKSB8fCBbXSkubWFwKG9wdGlvbiA9PiAoe1xuICAgICAgc2VsZWN0ZWQ6IGZhbHNlLFxuICAgICAgb3B0aW9uXG4gICAgfSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFsbG93cyBtdWx0aXBsZSBvcHRpb25zIHRvIGJlIGFjdGl2ZSBzaW11bHRhbmVvc2x5LlxuICAgKi9cbiAgQElucHV0KCdtdWx0aXBsZScpIHNldCBfbXVsdGlwbGUobXVsdGlwbGU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLm11bHRpcGxlID0gY29lcmNlQm9vbGVhblByb3BlcnR5KG11bHRpcGxlKTtcbiAgfVxuXG4gIC8qKiBEaXNwbGF5IHRoZSBmaWx0ZXIgYXMgYSBzbWFsbCBidXR0b24gZ3JvdXAgKi9cbiAgQElucHV0KCdzbWFsbCcpIHNldCBfc21hbGwoc21hbGw6IGJvb2xlYW4pIHtcbiAgICB0aGlzLnNtYWxsID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHNtYWxsKTtcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnY2xhc3MuYnRuLWdyb3VwLXNtJykgZ2V0IGRpc3BsYXlTbWFsbCgpIHtcbiAgICByZXR1cm4gdGhpcy5zbWFsbDtcbiAgfVxuXG4gIEBPdXRwdXQoKSBvbkZpbHRlckNoYW5nZWQ6IEV2ZW50RW1pdHRlcjxTdGF0dXNPcHRpb25bXT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgaXNBbGxCdXR0b25TZWxlY3RlZCA9IHRydWU7XG5cbiAgcHJpdmF0ZSBtdWx0aXBsZTogYm9vbGVhbjtcbiAgcHJpdmF0ZSBzbWFsbDogYm9vbGVhbjtcblxuICBjaGFuZ2VGaWx0ZXIob3B0aW9uOiB7IHNlbGVjdGVkOiBib29sZWFuOyBvcHRpb246IFN0YXR1c09wdGlvbiB9KSB7XG4gICAgdGhpcy5pc0FsbEJ1dHRvblNlbGVjdGVkID0gZmFsc2U7XG4gICAgbGV0IGVtaXROZWVkZWQgPSBmYWxzZTtcblxuICAgIGlmICh0aGlzLm11bHRpcGxlKSB7XG4gICAgICBvcHRpb24uc2VsZWN0ZWQgPSAhb3B0aW9uLnNlbGVjdGVkO1xuICAgICAgZW1pdE5lZWRlZCA9IHRydWU7XG4gICAgfSBlbHNlIGlmICghb3B0aW9uLnNlbGVjdGVkKSB7XG4gICAgICBvcHRpb24uc2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgdGhpcy5zdGF0dXNPcHRpb25zLmZpbHRlcihvcCA9PiBvcCAhPT0gb3B0aW9uKS5mb3JFYWNoKG9wID0+IChvcC5zZWxlY3RlZCA9IGZhbHNlKSk7XG4gICAgICBlbWl0TmVlZGVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAoZW1pdE5lZWRlZCkge1xuICAgICAgdGhpcy5lbWl0U2VsZWN0ZWRPcHRpb25zKCk7XG4gICAgfVxuICB9XG5cbiAgcmVtb3ZlRmlsdGVyKCkge1xuICAgIHRoaXMuaXNBbGxCdXR0b25TZWxlY3RlZCA9IHRydWU7XG4gICAgdGhpcy5zdGF0dXNPcHRpb25zLmZvckVhY2gob3AgPT4gKG9wLnNlbGVjdGVkID0gZmFsc2UpKTtcblxuICAgIHRoaXMuZW1pdFNlbGVjdGVkT3B0aW9ucygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFsbG93cyB0aGUgZmlsdGVyIHRvIGJlIGluaXRhbGxpeSBkaXNwbGF5ZWQgd2l0aCBzb21lIHByZXNldCBmaWx0ZXJzLlxuICAgKlxuICAgKiBAcGFyYW0gZmlsdGVycyBBbiBgU3RhdHVzT3B0aW9uYCBhcnJheSBkZWZpbmluZyBmaWx0ZXIgb3B0aW9ucyB0byBiZSBwcmVzZXQuXG4gICAqIEBwYXJhbSBlbWl0ICAob3B0aW9uYWwpIElmIGB0cnVlYCBjb21wb25lbnQgd2lsbCBlbWl0IGBvbkZpbHRlckNoYW5nZWRgIGV2ZW50LlxuICAgKi9cbiAgcHJlc2V0KGZpbHRlcnM6IFN0YXR1c09wdGlvbltdLCBlbWl0ID0gdHJ1ZSkge1xuICAgIGxldCBmaXJzdFNlbGVjdGVkID0gZmFsc2U7XG5cbiAgICB0aGlzLnN0YXR1c09wdGlvbnMuZm9yRWFjaChvcHRpb24gPT4gKG9wdGlvbi5zZWxlY3RlZCA9IGZhbHNlKSk7XG5cbiAgICB0aGlzLnN0YXR1c09wdGlvbnNcbiAgICAgIC5maWx0ZXIob3B0aW9uID0+IChmaWx0ZXJzIHx8IFtdKS5tYXAobyA9PiBvLmxhYmVsKS5pbmNsdWRlcyhvcHRpb24ub3B0aW9uLmxhYmVsKSlcbiAgICAgIC5maWx0ZXIoKCkgPT4ge1xuICAgICAgICAvLyBvbmx5IGZpcnN0IG9wdGlvbiBwYXNzZWQgd2lsbCBiZSBzZXQgaW4gc2luZ2xlIHNlbGVjdGlvbiBtb2RlXG4gICAgICAgIGNvbnN0IGluY2x1ZGU6IGJvb2xlYW4gPSB0aGlzLm11bHRpcGxlIHx8ICFmaXJzdFNlbGVjdGVkO1xuICAgICAgICBpZiAoaW5jbHVkZSkge1xuICAgICAgICAgIGZpcnN0U2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGluY2x1ZGU7XG4gICAgICB9KVxuICAgICAgLmZvckVhY2gob3B0aW9uID0+IChvcHRpb24uc2VsZWN0ZWQgPSB0cnVlKSk7XG5cbiAgICB0aGlzLmlzQWxsQnV0dG9uU2VsZWN0ZWQgPSAhKGZpbHRlcnMgJiYgZmlsdGVycy5sZW5ndGgpO1xuXG4gICAgaWYgKGVtaXQpIHtcbiAgICAgIHRoaXMuZW1pdFNlbGVjdGVkT3B0aW9ucygpO1xuICAgIH1cbiAgfVxuXG4gIHJlc2V0KCkge1xuICAgIHRoaXMucmVtb3ZlRmlsdGVyKCk7XG4gIH1cblxuICBhY3RpdmVGaWx0ZXJzKCk6IFN0YXR1c09wdGlvbltdIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0dXNPcHRpb25zLmZpbHRlcihvcHRpb24gPT4gb3B0aW9uLnNlbGVjdGVkKS5tYXAob3B0aW9uID0+IG9wdGlvbi5vcHRpb24pO1xuICB9XG5cbiAgaXNGaWx0ZXJBcHBsaWVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnN0YXR1c09wdGlvbnMuc29tZShvcHRpb24gPT4gb3B0aW9uLnNlbGVjdGVkKTtcbiAgfVxuXG4gIHByaXZhdGUgZW1pdFNlbGVjdGVkT3B0aW9ucygpIHtcbiAgICB0aGlzLm9uRmlsdGVyQ2hhbmdlZC5lbWl0KFxuICAgICAgdGhpcy5zdGF0dXNPcHRpb25zLmZpbHRlcihvcHRpb24gPT4gb3B0aW9uLnNlbGVjdGVkKS5tYXAob3B0aW9uID0+IG9wdGlvbi5vcHRpb24pXG4gICAgKTtcbiAgfVxufVxuIiwiPGRpdiBkcm9wZG93biBwbGFjZW1lbnQ9XCJib3R0b20gbGVmdFwiIGNsYXNzPVwiZHJvcGRvd24gYzh5LWNoaWxkLWFzc2V0cy1zZWxlY3RvclwiPlxuICA8YnV0dG9uXG4gICAgY2xhc3M9XCJidG4gZHJvcGRvd24tdG9nZ2xlIGQtZmxleCBhLWktY2VudGVyIGM4eS1kcm9wZG93blwiXG4gICAgdHlwZT1cImJ1dHRvblwiXG4gICAgdGl0bGU9XCJ7eyAnU3RhdHVzIGZpbHRlcicgfCB0cmFuc2xhdGUgfX1cIlxuICAgIGRyb3Bkb3duVG9nZ2xlXG4gID5cbiAgICA8c3BhbiAqbmdGb3I9XCJsZXQgb3B0aW9uIG9mIHN0YXR1c09wdGlvbnNcIiBjbGFzcz1cImQtY29udGVudHNcIj5cbiAgICAgIDxzcGFuIGNsYXNzPVwidGV4dC10cnVuY2F0ZVwiICpuZ0lmPVwib3B0aW9uLnNlbGVjdGVkXCI+XG4gICAgICAgIDxpIFtjOHlJY29uXT1cIm9wdGlvbi5vcHRpb24uaWNvblwiIFtuZ0NsYXNzXT1cIm9wdGlvbi5vcHRpb24uc3R5bGVDbGFzc1wiPjwvaT5cbiAgICAgICAgPHNwYW4gY2xhc3M9XCJtLWwtNFwiPnt7IG9wdGlvbi5vcHRpb24ubGFiZWwgfCB0cmFuc2xhdGUgfX08L3NwYW4+XG4gICAgICA8L3NwYW4+XG4gICAgPC9zcGFuPlxuICAgIDxzcGFuIGNsYXNzPVwidGV4dC10cnVuY2F0ZVwiICpuZ0lmPVwiaXNBbGxCdXR0b25TZWxlY3RlZFwiPlxuICAgICAgPGkgYzh5SWNvbj1cImM4eS1lbmVyZ3lcIiBjbGFzcz1cIm0tci00IHRleHQtaW5mb1wiPjwvaT5cbiAgICAgIHt7ICdBbGwgc3RhdHVzZXMnIHwgdHJhbnNsYXRlIH19XG4gICAgPC9zcGFuPlxuICA8L2J1dHRvbj5cbiAgPHVsXG4gICAgaWQ9XCJkcm9wZG93bi1zdGF0dXMtZmlsdGVyXCJcbiAgICAqZHJvcGRvd25NZW51XG4gICAgY2xhc3M9XCJkcm9wZG93bi1tZW51XCJcbiAgICByb2xlPVwibWVudVwiXG4gICAgYXJpYS1sYWJlbGxlZGJ5PVwic3RhdHVzLWZpbHRlclwiXG4gID5cbiAgICA8bGkgKm5nRm9yPVwibGV0IG9wdGlvbiBvZiBzdGF0dXNPcHRpb25zXCIgW25nQ2xhc3NdPVwieyBhY3RpdmU6IG9wdGlvbi5zZWxlY3RlZCB9XCI+XG4gICAgICA8YnV0dG9uXG4gICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICBbdGl0bGVdPVwib3B0aW9uLm9wdGlvbi5sYWJlbCB8IHRyYW5zbGF0ZVwiXG4gICAgICAgIChjbGljayk9XCJjaGFuZ2VGaWx0ZXIob3B0aW9uKVwiXG4gICAgICAgIGM4eVByb2R1Y3RFeHBlcmllbmNlXG4gICAgICAgIGluaGVyaXRcbiAgICAgICAgW2FjdGlvbkRhdGFdPVwie1xuICAgICAgICAgIGFjdGlvbjogQUNUSU9OUy5GSUxURVIsXG4gICAgICAgICAgZmlsdGVyQnk6ICdzdGF0dXMnLFxuICAgICAgICAgIGZpbHRlclZhbHVlOiBvcHRpb24ub3B0aW9uLmxhYmVsXG4gICAgICAgIH1cIlxuICAgICAgPlxuICAgICAgICA8aSBbYzh5SWNvbl09XCJvcHRpb24ub3B0aW9uLmljb25cIiBbbmdDbGFzc109XCJvcHRpb24ub3B0aW9uLnN0eWxlQ2xhc3NcIj48L2k+XG4gICAgICAgIDxzcGFuIGNsYXNzPVwibS1sLTRcIj57eyBvcHRpb24ub3B0aW9uLmxhYmVsIHwgdHJhbnNsYXRlIH19PC9zcGFuPlxuICAgICAgPC9idXR0b24+XG4gICAgPC9saT5cbiAgICA8bGkgW25nQ2xhc3NdPVwieyBhY3RpdmU6IGlzQWxsQnV0dG9uU2VsZWN0ZWQgfVwiPlxuICAgICAgPGJ1dHRvblxuICAgICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgdGl0bGU9XCJ7eyAnQWxsIHN0YXR1c2VzJyB8IHRyYW5zbGF0ZSB9fVwiXG4gICAgICAgIChjbGljayk9XCJyZW1vdmVGaWx0ZXIoKVwiXG4gICAgICAgIGM4eVByb2R1Y3RFeHBlcmllbmNlXG4gICAgICAgIGluaGVyaXRcbiAgICAgICAgW2FjdGlvbkRhdGFdPVwie1xuICAgICAgICAgIGFjdGlvbjogQUNUSU9OUy5GSUxURVIsXG4gICAgICAgICAgZmlsdGVyQnk6ICdzdGF0dXMnXG4gICAgICAgIH1cIlxuICAgICAgPlxuICAgICAgICA8aSBjOHlJY29uPVwiYzh5LWVuZXJneVwiIGNsYXNzPVwibS1yLTQgdGV4dC1pbmZvXCI+PC9pPlxuICAgICAgICB7eyAnQWxsIHN0YXR1c2VzJyB8IHRyYW5zbGF0ZSB9fVxuICAgICAgPC9idXR0b24+XG4gICAgPC9saT5cbiAgPC91bD5cbjwvZGl2PlxuIl19