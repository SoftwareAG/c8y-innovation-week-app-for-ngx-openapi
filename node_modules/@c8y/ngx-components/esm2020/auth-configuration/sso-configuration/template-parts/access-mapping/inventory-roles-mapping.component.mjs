import { Component, Output, Input, EventEmitter } from '@angular/core';
import { ControlContainer, NgForm } from '@angular/forms';
import { BsModalService } from 'ngx-bootstrap/modal';
import { InventoryRolesModalComponent } from './inventory-roles-modal.component';
import { take } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "ngx-bootstrap/modal";
import * as i2 from "@c8y/ngx-components";
import * as i3 from "@angular/common";
import * as i4 from "ngx-bootstrap/tooltip";
import * as i5 from "./child-predicates.component";
export class InventoryRolesMappingComponent {
    constructor(bsModal) {
        this.bsModal = bsModal;
        this.inventoryRoles = [];
        this.selectedInventoryRoles = [];
        this.onRemoveInventoryMapping = new EventEmitter();
    }
    ngOnChanges() {
        this.setSelectedInventoryRoles();
    }
    onRemoveAllChildPredicates() {
        this.onRemoveInventoryMapping.emit(this.inventoryMapping);
    }
    getIds(selectedItems) {
        return selectedItems.map(item => item.id);
    }
    removeInventoryRole(inventoryRole) {
        this.inventoryMapping.thenInventoryRoles = this.inventoryMapping.thenInventoryRoles.filter(value => value.managedObject !== inventoryRole.managedObject);
        delete this.selectedInventoryRoles[inventoryRole.managedObject];
    }
    addInventoryRoles() {
        const currentlySelectedGroups = this.inventoryMapping.thenInventoryRoles.map(inventoryRole => ({ id: inventoryRole.managedObject }));
        const modal = this.bsModal.show(InventoryRolesModalComponent, {
            ignoreBackdropClick: true,
            class: 'modal-sm',
            ariaDescribedby: 'modal-body',
            ariaLabelledBy: 'modal-title',
            initialState: {
                selectedGroups: currentlySelectedGroups
            }
        });
        modal.content.resultEmitter.pipe(take(1)).subscribe(selectedGroups => {
            const newSelectedGroups = selectedGroups.filter(group => !currentlySelectedGroups.some(({ id }) => id === group.id));
            const newInventoryRoles = newSelectedGroups.map(group => ({ managedObject: group.id, roleIds: [] }));
            this.inventoryMapping.thenInventoryRoles =
                this.inventoryMapping.thenInventoryRoles.concat(newInventoryRoles);
        });
    }
    setSelectedInventoryRoles() {
        if (this.inventoryMapping && this.inventoryMapping.thenInventoryRoles && this.inventoryRoles) {
            this.inventoryMapping.thenInventoryRoles.forEach(inventoryRole => {
                this.selectedInventoryRoles[inventoryRole.managedObject] = this.inventoryRoles.filter(item => inventoryRole.roleIds.includes(+item.id));
            });
        }
    }
}
InventoryRolesMappingComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: InventoryRolesMappingComponent, deps: [{ token: i1.BsModalService }], target: i0.ɵɵFactoryTarget.Component });
InventoryRolesMappingComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.7", type: InventoryRolesMappingComponent, selector: "c8y-sso-inventory-roles-mapping", inputs: { inventoryMapping: "inventoryMapping", inventoryMappingIndex: "inventoryMappingIndex", inventoryRoles: "inventoryRoles" }, outputs: { onRemoveInventoryMapping: "onRemoveInventoryMapping" }, usesOnChanges: true, ngImport: i0, template: "<fieldset class=\"c8y-fieldset p-t-8 p-b-8 p-l-16 p-r-16\">\n  <div *ngIf=\"inventoryMapping.when.childPredicates.length !== 0\">\n    <c8y-sso-child-predicates\n      [childPredicates]=\"inventoryMapping.when.childPredicates\"\n      [accessMappingIndex]=\"'irm' + inventoryMappingIndex\"\n      (onRemoveAllChildPredicates)=\"onRemoveAllChildPredicates()\"\n    ></c8y-sso-child-predicates>\n    <fieldset class=\"c8y-fieldset p-16\">\n      <legend>\n        {{ 'Provide inventory roles' | translate }}\n      </legend>\n      <div\n        *ngIf=\"inventoryMapping.thenInventoryRoles.length !== 0\"\n        class=\"p-l-8 p-r-8\"\n      >\n        <div class=\"tight-grid p-b-8 separator-bottom hidden-sm hidden-xs\">\n          <div class=\"col-md-5\">\n            <label translate>Groups</label>\n          </div>\n          <div class=\"col-md-6\">\n            <label translate>Inventory roles</label>\n          </div>\n        </div>\n        <div\n          class=\"tight-grid d-flex-md a-i-center p-t-8 p-b-8 separator-bottom\"\n          *ngFor=\"let inventoryRole of inventoryMapping.thenInventoryRoles; index as idx\"\n        >\n          <div class=\"col-md-5\">\n            <div class=\"d-flex a-i-center\">\n              <!-- TODO:\n                We need to retrive the icon here, for groups there are 3 possible icons:\n                \u2022 Regular group\n                \u2022 Remote group\n                \u2022 Smartgroup\n                Besides groups, there's also Assets from DTM, in which each asset has a different icon\n              -->\n              <i\n                c8yIcon=\"c8y-group\"\n                class=\"m-r-8 text-16\"\n              ></i>\n              <span\n                class=\"text-truncate\"\n                title=\"{{ inventoryRole.managedObject | moName | async }}\"\n              >\n                {{ inventoryRole.managedObject | moName | async }}\n              </span>\n            </div>\n          </div>\n          <div class=\"col-md-6\">\n            <div\n              title=\"{{ 'Inventory roles' | translate }}\"\n              class=\"form-group m-b-0\"\n            >\n              <c8y-select\n                [id]=\"'ir' + idx + accessMappingIndex\"\n                [items]=\"inventoryRoles\"\n                [selected]=\"selectedInventoryRoles[inventoryRole.managedObject]\"\n                [disableApplyOnNoSelection]=\"true\"\n                (onChange)=\"\n                  selectedInventoryRoles[inventoryRole.managedObject] = $event;\n                  inventoryRole.roleIds = getIds($event)\n                \"\n              ></c8y-select>\n            </div>\n          </div>\n          <div class=\"col-md-1\">\n            <button\n              name=\"removeButton\"\n              class=\"btn btn-dot btn-dot--danger hidden-xs hidden-sm\"\n              (click)=\"removeInventoryRole(inventoryRole)\"\n              tooltip=\"{{ 'Remove' | translate }}\"\n              [attr.aria-label]=\"'Remove' | translate\"\n              [delay]=\"300\"\n              type=\"button\"\n            >\n              <i c8yIcon=\"minus-circle\"></i>\n            </button>\n            <button\n              name=\"removeButton\"\n              class=\"btn btn-danger btn-block btn-sm visible-xs visible-sm\"\n              (click)=\"removeInventoryRole(inventoryRole)\"\n              title=\"{{ 'Remove' | translate }}\"\n              type=\"button\"\n            >\n              <i c8yIcon=\"minus-circle\"></i>\n              <span translate>Remove</span>\n            </button>\n          </div>\n        </div>\n      </div>\n\n      <button\n        id=\"add-inventory-roles-button\"\n        class=\"btn btn-default m-t-16\"\n        type=\"button\"\n        title=\"{{ 'Add inventory roles' | translate }}\"\n        (click)=\"addInventoryRoles()\"\n      >\n        <i\n          c8yIcon=\"plus-circle\"\n          class=\"m-r-4\"\n        ></i>\n        {{ 'Add inventory roles' | translate }}\n      </button>\n    </fieldset>\n  </div>\n</fieldset>\n", dependencies: [{ kind: "directive", type: i2.IconDirective, selector: "[c8yIcon]", inputs: ["c8yIcon"] }, { kind: "directive", type: i2.C8yTranslateDirective, selector: "[translate],[ngx-translate]" }, { kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i2.SelectComponent, selector: "c8y-select", inputs: ["placeholder", "selectedLabel", "applyLabel", "items", "selected", "updateItems", "disableApplyOnNoSelection"], outputs: ["onChange"] }, { kind: "directive", type: i4.TooltipDirective, selector: "[tooltip], [tooltipHtml]", inputs: ["adaptivePosition", "tooltip", "placement", "triggers", "container", "containerClass", "boundariesElement", "isOpen", "isDisabled", "delay", "tooltipHtml", "tooltipPlacement", "tooltipIsOpen", "tooltipEnable", "tooltipAppendToBody", "tooltipAnimation", "tooltipClass", "tooltipContext", "tooltipPopupDelay", "tooltipFadeDuration", "tooltipTrigger"], outputs: ["tooltipChange", "onShown", "onHidden", "tooltipStateChanged"], exportAs: ["bs-tooltip"] }, { kind: "component", type: i5.ChildPredicatesComponent, selector: "c8y-sso-child-predicates", inputs: ["childPredicates", "accessMappingIndex"], outputs: ["onRemoveAllChildPredicates"] }, { kind: "pipe", type: i2.C8yTranslatePipe, name: "translate" }, { kind: "pipe", type: i3.AsyncPipe, name: "async" }, { kind: "pipe", type: i2.MoNamePipe, name: "moName" }], viewProviders: [{ provide: ControlContainer, useExisting: NgForm }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: InventoryRolesMappingComponent, decorators: [{
            type: Component,
            args: [{ selector: 'c8y-sso-inventory-roles-mapping', viewProviders: [{ provide: ControlContainer, useExisting: NgForm }], template: "<fieldset class=\"c8y-fieldset p-t-8 p-b-8 p-l-16 p-r-16\">\n  <div *ngIf=\"inventoryMapping.when.childPredicates.length !== 0\">\n    <c8y-sso-child-predicates\n      [childPredicates]=\"inventoryMapping.when.childPredicates\"\n      [accessMappingIndex]=\"'irm' + inventoryMappingIndex\"\n      (onRemoveAllChildPredicates)=\"onRemoveAllChildPredicates()\"\n    ></c8y-sso-child-predicates>\n    <fieldset class=\"c8y-fieldset p-16\">\n      <legend>\n        {{ 'Provide inventory roles' | translate }}\n      </legend>\n      <div\n        *ngIf=\"inventoryMapping.thenInventoryRoles.length !== 0\"\n        class=\"p-l-8 p-r-8\"\n      >\n        <div class=\"tight-grid p-b-8 separator-bottom hidden-sm hidden-xs\">\n          <div class=\"col-md-5\">\n            <label translate>Groups</label>\n          </div>\n          <div class=\"col-md-6\">\n            <label translate>Inventory roles</label>\n          </div>\n        </div>\n        <div\n          class=\"tight-grid d-flex-md a-i-center p-t-8 p-b-8 separator-bottom\"\n          *ngFor=\"let inventoryRole of inventoryMapping.thenInventoryRoles; index as idx\"\n        >\n          <div class=\"col-md-5\">\n            <div class=\"d-flex a-i-center\">\n              <!-- TODO:\n                We need to retrive the icon here, for groups there are 3 possible icons:\n                \u2022 Regular group\n                \u2022 Remote group\n                \u2022 Smartgroup\n                Besides groups, there's also Assets from DTM, in which each asset has a different icon\n              -->\n              <i\n                c8yIcon=\"c8y-group\"\n                class=\"m-r-8 text-16\"\n              ></i>\n              <span\n                class=\"text-truncate\"\n                title=\"{{ inventoryRole.managedObject | moName | async }}\"\n              >\n                {{ inventoryRole.managedObject | moName | async }}\n              </span>\n            </div>\n          </div>\n          <div class=\"col-md-6\">\n            <div\n              title=\"{{ 'Inventory roles' | translate }}\"\n              class=\"form-group m-b-0\"\n            >\n              <c8y-select\n                [id]=\"'ir' + idx + accessMappingIndex\"\n                [items]=\"inventoryRoles\"\n                [selected]=\"selectedInventoryRoles[inventoryRole.managedObject]\"\n                [disableApplyOnNoSelection]=\"true\"\n                (onChange)=\"\n                  selectedInventoryRoles[inventoryRole.managedObject] = $event;\n                  inventoryRole.roleIds = getIds($event)\n                \"\n              ></c8y-select>\n            </div>\n          </div>\n          <div class=\"col-md-1\">\n            <button\n              name=\"removeButton\"\n              class=\"btn btn-dot btn-dot--danger hidden-xs hidden-sm\"\n              (click)=\"removeInventoryRole(inventoryRole)\"\n              tooltip=\"{{ 'Remove' | translate }}\"\n              [attr.aria-label]=\"'Remove' | translate\"\n              [delay]=\"300\"\n              type=\"button\"\n            >\n              <i c8yIcon=\"minus-circle\"></i>\n            </button>\n            <button\n              name=\"removeButton\"\n              class=\"btn btn-danger btn-block btn-sm visible-xs visible-sm\"\n              (click)=\"removeInventoryRole(inventoryRole)\"\n              title=\"{{ 'Remove' | translate }}\"\n              type=\"button\"\n            >\n              <i c8yIcon=\"minus-circle\"></i>\n              <span translate>Remove</span>\n            </button>\n          </div>\n        </div>\n      </div>\n\n      <button\n        id=\"add-inventory-roles-button\"\n        class=\"btn btn-default m-t-16\"\n        type=\"button\"\n        title=\"{{ 'Add inventory roles' | translate }}\"\n        (click)=\"addInventoryRoles()\"\n      >\n        <i\n          c8yIcon=\"plus-circle\"\n          class=\"m-r-4\"\n        ></i>\n        {{ 'Add inventory roles' | translate }}\n      </button>\n    </fieldset>\n  </div>\n</fieldset>\n" }]
        }], ctorParameters: function () { return [{ type: i1.BsModalService }]; }, propDecorators: { inventoryMapping: [{
                type: Input
            }], inventoryMappingIndex: [{
                type: Input
            }], inventoryRoles: [{
                type: Input
            }], onRemoveInventoryMapping: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW52ZW50b3J5LXJvbGVzLW1hcHBpbmcuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vYXV0aC1jb25maWd1cmF0aW9uL3Nzby1jb25maWd1cmF0aW9uL3RlbXBsYXRlLXBhcnRzL2FjY2Vzcy1tYXBwaW5nL2ludmVudG9yeS1yb2xlcy1tYXBwaW5nLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL2F1dGgtY29uZmlndXJhdGlvbi9zc28tY29uZmlndXJhdGlvbi90ZW1wbGF0ZS1wYXJ0cy9hY2Nlc3MtbWFwcGluZy9pbnZlbnRvcnktcm9sZXMtbWFwcGluZy5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUUxRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDckQsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDakYsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7Ozs7O0FBUXRDLE1BQU0sT0FBTyw4QkFBOEI7SUFTekMsWUFBb0IsT0FBdUI7UUFBdkIsWUFBTyxHQUFQLE9BQU8sQ0FBZ0I7UUFMbEMsbUJBQWMsR0FBa0IsRUFBRSxDQUFDO1FBQzVDLDJCQUFzQixHQUFrQixFQUFFLENBQUM7UUFFakMsNkJBQXdCLEdBQW1DLElBQUksWUFBWSxFQUFFLENBQUM7SUFFMUMsQ0FBQztJQUUvQyxXQUFXO1FBQ1QsSUFBSSxDQUFDLHlCQUF5QixFQUFFLENBQUM7SUFDbkMsQ0FBQztJQUVELDBCQUEwQjtRQUN4QixJQUFJLENBQUMsd0JBQXdCLENBQUMsSUFBSSxDQUFD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UzsrQkFDRSxpQ0FBaUMsaUJBRTVCLENBQUMsRUFBRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxDQUFDO3FHQUcxRCxnQkFBZ0I7c0JBQXhCLEtBQUs7Z0JBQ0cscUJBQXFCO3NCQUE3QixLQUFLO2dCQUVHLGNBQWM7c0JBQXRCLEtBQUs7Z0JBR0ksd0JBQXdCO3NCQUFqQyxNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPdXRwdXQsIElucHV0LCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbnRyb2xDb250YWluZXIsIE5nRm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IEludmVudG9yeU1hcHBpbmcsIEludmVudG9yeVJvbGUgfSBmcm9tICcuLi8uLi9zc28tY29uZmlndXJhdGlvbi5tb2RlbCc7XG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gJ25neC1ib290c3RyYXAvbW9kYWwnO1xuaW1wb3J0IHsgSW52ZW50b3J5Um9sZXNNb2RhbENvbXBvbmVudCB9IGZyb20gJy4vaW52ZW50b3J5LXJvbGVzLW1vZGFsLmNvbXBvbmVudCc7XG5pbXBvcnQgeyB0YWtlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgSUlkZW50aWZpZWQgfSBmcm9tICdAYzh5L2NsaWVudCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS1zc28taW52ZW50b3J5LXJvbGVzLW1hcHBpbmcnLFxuICB0ZW1wbGF0ZVVybDogJy4vaW52ZW50b3J5LXJvbGVzLW1hcHBpbmcuY29tcG9uZW50Lmh0bWwnLFxuICB2aWV3UHJvdmlkZXJzOiBbeyBwcm92aWRlOiBDb250cm9sQ29udGFpbmVyLCB1c2VFeGlzdGluZzogTmdGb3JtIH1dXG59KVxuZXhwb3J0IGNsYXNzIEludmVudG9yeVJvbGVzTWFwcGluZ0NvbXBvbmVudCB7XG4gIEBJbnB1dCgpIGludmVudG9yeU1hcHBpbmc6IEludmVudG9yeU1hcHBpbmc7XG4gIEBJbnB1dCgpIGludmVudG9yeU1hcHBpbmdJbmRleDogbnVtYmVyO1xuXG4gIEBJbnB1dCgpIGludmVudG9yeVJvbGVzOiBJSWRlbnRpZmllZFtdID0gW107XG4gIHNlbGVjdGVkSW52ZW50b3J5Um9sZXM6IElJZGVudGlmaWVkW10gPSBbXTtcblxuICBAT3V0cHV0KCkgb25SZW1vdmVJbnZlbnRvcnlNYXBwaW5nOiBFdmVudEVtaXR0ZXI8SW52ZW50b3J5TWFwcGluZz4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBic01vZGFsOiBCc01vZGFsU2VydmljZSkge31cblxuICBuZ09uQ2hhbmdlcygpOiB2b2lkIHtcbiAgICB0aGlzLnNldFNlbGVjdGVkSW52ZW50b3J5Um9sZXMoKTtcbiAgfVxuXG4gIG9uUmVtb3ZlQWxsQ2hpbGRQcmVkaWNhdGVzKCkge1xuICAgIHRoaXMub25SZW1vdmVJbnZlbnRvcnlNYXBwaW5nLmVtaXQodGhpcy5pbnZlbnRvcnlNYXBwaW5nKTtcbiAgfVxuXG4gIGdldElkcyhzZWxlY3RlZEl0ZW1zOiBJSWRlbnRpZmllZFtdKSB7XG4gICAgcmV0dXJuIHNlbGVjdGVkSXRlbXMubWFwKGl0ZW0gPT4gaXRlbS5pZCk7XG4gIH1cblxuICByZW1vdmVJbnZlbnRvcnlSb2xlKGludmVudG9yeVJvbGU6IEludmVudG9yeVJvbGUpIHtcbiAgICB0aGlzLmludmVudG9yeU1hcHBpbmcudGhlbkludmVudG9yeVJvbGVzID0gdGhpcy5pbnZlbnRvcnlNYXBwaW5nLnRoZW5JbnZlbnRvcnlSb2xlcy5maWx0ZXIoXG4gICAgICB2YWx1ZSA9PiB2YWx1ZS5tYW5hZ2VkT2JqZWN0ICE9PSBpbnZlbnRvcnlSb2xlLm1hbmFnZWRPYmplY3RcbiAgICApO1xuICAgIGRlbGV0ZSB0aGlzLnNlbGVjdGVkSW52ZW50b3J5Um9sZXNbaW52ZW50b3J5Um9sZS5tYW5hZ2VkT2JqZWN0XTtcbiAgfVxuXG4gIGFkZEludmVudG9yeVJvbGVzKCkge1xuICAgIGNvbnN0IGN1cnJlbnRseVNlbGVjdGVkR3JvdXBzOiBJSWRlbnRpZmllZFtdID0gdGhpcy5pbnZlbnRvcnlNYXBwaW5nLnRoZW5JbnZlbnRvcnlSb2xlcy5tYXAoXG4gICAgICBpbnZlbnRvcnlSb2xlID0+ICh7IGlkOiBpbnZlbnRvcnlSb2xlLm1hbmFnZWRPYmplY3QgfSlcbiAgICApO1xuICAgIGNvbnN0IG1vZGFsID0gdGhpcy5ic01vZGFsLnNob3coSW52ZW50b3J5Um9sZXNNb2RhbENvbXBvbmVudCwge1xuICAgICAgaWdub3JlQmFja2Ryb3BDbGljazogdHJ1ZSxcbiAgICAgIGNsYXNzOiAnbW9kYWwtc20nLFxuICAgICAgYXJpYURlc2NyaWJlZGJ5OiAnbW9kYWwtYm9keScsXG4gICAgICBhcmlhTGFiZWxsZWRCeTogJ21vZGFsLXRpdGxlJyxcbiAgICAgIGluaXRpYWxTdGF0ZToge1xuICAgICAgICBzZWxlY3RlZEdyb3VwczogY3VycmVudGx5U2VsZWN0ZWRHcm91cHNcbiAgICAgIH1cbiAgICB9KTtcbiAgICBtb2RhbC5jb250ZW50LnJlc3VsdEVtaXR0ZXIucGlwZSh0YWtlKDEpKS5zdWJzY3JpYmUoc2VsZWN0ZWRHcm91cHMgPT4ge1xuICAgICAgY29uc3QgbmV3U2VsZWN0ZWRHcm91cHMgPSBzZWxlY3RlZEdyb3Vwcy5maWx0ZXIoXG4gICAgICAgIGdyb3VwID0+ICFjdXJyZW50bHlTZWxlY3RlZEdyb3Vwcy5zb21lKCh7IGlkIH0pID0+IGlkID09PSBncm91cC5pZClcbiAgICAgICk7XG4gICAgICBjb25zdCBuZXdJbnZlbnRvcnlSb2xlczogSW52ZW50b3J5Um9sZVtdID0gbmV3U2VsZWN0ZWRHcm91cHMubWFwKFxuICAgICAgICBncm91cCA9PiAoeyBtYW5hZ2VkT2JqZWN0OiBncm91cC5pZCwgcm9sZUlkczogW10gfSBhcyBJbnZlbnRvcnlSb2xlKVxuICAgICAgKTtcbiAgICAgIHRoaXMuaW52ZW50b3J5TWFwcGluZy50aGVuSW52ZW50b3J5Um9sZXMgPVxuICAgICAgICB0aGlzLmludmVudG9yeU1hcHBpbmcudGhlbkludmVudG9yeVJvbGVzLmNvbmNhdChuZXdJbnZlbnRvcnlSb2xlcyk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHNldFNlbGVjdGVkSW52ZW50b3J5Um9sZXMoKSB7XG4gICAgaWYgKHRoaXMuaW52ZW50b3J5TWFwcGluZyAmJiB0aGlzLmludmVudG9yeU1hcHBpbmcudGhlbkludmVudG9yeVJvbGVzICYmIHRoaXMuaW52ZW50b3J5Um9sZXMpIHtcbiAgICAgIHRoaXMuaW52ZW50b3J5TWFwcGluZy50aGVuSW52ZW50b3J5Um9sZXMuZm9yRWFjaChpbnZlbnRvcnlSb2xlID0+IHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEludmVudG9yeVJvbGVzW2ludmVudG9yeVJvbGUubWFuYWdlZE9iamVjdF0gPSB0aGlzLmludmVudG9yeVJvbGVzLmZpbHRlcihcbiAgICAgICAgICBpdGVtID0+IGludmVudG9yeVJvbGUucm9sZUlkcy5pbmNsdWRlcygraXRlbS5pZClcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuIiwiPGZpZWxkc2V0IGNsYXNzPVwiYzh5LWZpZWxkc2V0IHAtdC04IHAtYi04IHAtbC0xNiBwLXItMTZcIj5cbiAgPGRpdiAqbmdJZj1cImludmVudG9yeU1hcHBpbmcud2hlbi5jaGlsZFByZWRpY2F0ZXMubGVuZ3RoICE9PSAwXCI+XG4gICAgPGM4eS1zc28tY2hpbGQtcHJlZGljYXRlc1xuICAgICAgW2NoaWxkUHJlZGljYXRlc109XCJpbnZlbnRvcnlNYXBwaW5nLndoZW4uY2hpbGRQcmVkaWNhdGVzXCJcbiAgICAgIFthY2Nlc3NNYXBwaW5nSW5kZXhdPVwiJ2lybScgKyBpbnZlbnRvcnlNYXBwaW5nSW5kZXhcIlxuICAgICAgKG9uUmVtb3ZlQWxsQ2hpbGRQcmVkaWNhdGVzKT1cIm9uUmVtb3ZlQWxsQ2hpbGRQcmVkaWNhdGVzKClcIlxuICAgID48L2M4eS1zc28tY2hpbGQtcHJlZGljYXRlcz5cbiAgICA8ZmllbGRzZXQgY2xhc3M9XCJjOHktZmllbGRzZXQgcC0xNlwiPlxuICAgICAgPGxlZ2VuZD5cbiAgICAgICAge3sgJ1Byb3ZpZGUgaW52ZW50b3J5IHJvbGVzJyB8IHRyYW5zbGF0ZSB9fVxuICAgICAgPC9sZWdlbmQ+XG4gICAgICA8ZGl2XG4gICAgICAgICpuZ0lmPVwiaW52ZW50b3J5TWFwcGluZy50aGVuSW52ZW50b3J5Um9sZXMubGVuZ3RoICE9PSAwXCJcbiAgICAgICAgY2xhc3M9XCJwLWwtOCBwLXItOFwiXG4gICAgICA+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJ0aWdodC1ncmlkIHAtYi04IHNlcGFyYXRvci1ib3R0b20gaGlkZGVuLXNtIGhpZGRlbi14c1wiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtbWQtNVwiPlxuICAgICAgICAgICAgPGxhYmVsIHRyYW5zbGF0ZT5Hcm91cHM8L2xhYmVsPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtbWQtNlwiPlxuICAgICAgICAgICAgPGxhYmVsIHRyYW5zbGF0ZT5JbnZlbnRvcnkgcm9sZXM8L2xhYmVsPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdlxuICAgICAgICAgIGNsYXNzPVwidGlnaHQtZ3JpZCBkLWZsZXgtbWQgYS1pLWNlbnRlciBwLXQtOCBwLWItOCBzZXBhcmF0b3ItYm90dG9tXCJcbiAgICAgICAgICAqbmdGb3I9XCJsZXQgaW52ZW50b3J5Um9sZSBvZiBpbnZlbnRvcnlNYXBwaW5nLnRoZW5JbnZlbnRvcnlSb2xlczsgaW5kZXggYXMgaWR4XCJcbiAgICAgICAgPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtbWQtNVwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImQtZmxleCBhLWktY2VudGVyXCI+XG4gICAgICAgICAgICAgIDwhLS0gVE9ETzpcbiAgICAgICAgICAgICAgICBXZSBuZWVkIHRvIHJldHJpdmUgdGhlIGljb24gaGVyZSwgZm9yIGdyb3VwcyB0aGVyZSBhcmUgMyBwb3NzaWJsZSBpY29uczpcbiAgICAgICAgICAgICAgICDigKIgUmVndWxhciBncm91cFxuICAgICAgICAgICAgICAgIOKAoiBSZW1vdGUgZ3JvdXBcbiAgICAgICAgICAgICAgICDigKIgU21hcnRncm91cFxuICAgICAgICAgICAgICAgIEJlc2lkZXMgZ3JvdXBzLCB0aGVyZSdzIGFsc28gQXNzZXRzIGZyb20gRFRNLCBpbiB3aGljaCBlYWNoIGFzc2V0IGhhcyBhIGRpZmZlcmVudCBpY29uXG4gICAgICAgICAgICAgIC0tPlxuICAgICAgICAgICAgICA8aVxuICAgICAgICAgICAgICAgIGM4eUljb249XCJjOHktZ3JvdXBcIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwibS1yLTggdGV4dC0xNlwiXG4gICAgICAgICAgICAgID48L2k+XG4gICAgICAgICAgICAgIDxzcGFuXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJ0ZXh0LXRydW5jYXRlXCJcbiAgICAgICAgICAgICAgICB0aXRsZT1cInt7IGludmVudG9yeVJvbGUubWFuYWdlZE9iamVjdCB8IG1vTmFtZSB8IGFzeW5jIH19XCJcbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIHt7IGludmVudG9yeVJvbGUubWFuYWdlZE9iamVjdCB8IG1vTmFtZSB8IGFzeW5jIH19XG4gICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtbWQtNlwiPlxuICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICB0aXRsZT1cInt7ICdJbnZlbnRvcnkgcm9sZXMnIHwgdHJhbnNsYXRlIH19XCJcbiAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWdyb3VwIG0tYi0wXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPGM4eS1zZWxlY3RcbiAgICAgICAgICAgICAgICBbaWRdPVwiJ2lyJyArIGlkeCArIGFjY2Vzc01hcHBpbmdJbmRleFwiXG4gICAgICAgICAgICAgICAgW2l0ZW1zXT1cImludmVudG9yeVJvbGVzXCJcbiAgICAgICAgICAgICAgICBbc2VsZWN0ZWRdPVwic2VsZWN0ZWRJbnZlbnRvcnlSb2xlc1tpbnZlbnRvcnlSb2xlLm1hbmFnZWRPYmplY3RdXCJcbiAgICAgICAgICAgICAgICBbZGlzYWJsZUFwcGx5T25Ob1NlbGVjdGlvbl09XCJ0cnVlXCJcbiAgICAgICAgICAgICAgICAob25DaGFuZ2UpPVwiXG4gICAgICAgICAgICAgICAgICBzZWxlY3RlZEludmVudG9yeVJvbGVzW2ludmVudG9yeVJvbGUubWFuYWdlZE9iamVjdF0gPSAkZXZlbnQ7XG4gICAgICAgICAgICAgICAgICBpbnZlbnRvcnlSb2xlLnJvbGVJZHMgPSBnZXRJZHMoJGV2ZW50KVxuICAgICAgICAgICAgICAgIFwiXG4gICAgICAgICAgICAgID48L2M4eS1zZWxlY3Q+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLTFcIj5cbiAgICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgICAgbmFtZT1cInJlbW92ZUJ1dHRvblwiXG4gICAgICAgICAgICAgIGNsYXNzPVwiYnRuIGJ0bi1kb3QgYnRuLWRvdC0tZGFuZ2VyIGhpZGRlbi14cyBoaWRkZW4tc21cIlxuICAgICAgICAgICAgICAoY2xpY2spPVwicmVtb3ZlSW52ZW50b3J5Um9sZShpbnZlbnRvcnlSb2xlKVwiXG4gICAgICAgICAgICAgIHRvb2x0aXA9XCJ7eyAnUmVtb3ZlJyB8IHRyYW5zbGF0ZSB9fVwiXG4gICAgICAgICAgICAgIFthdHRyLmFyaWEtbGFiZWxdPVwiJ1JlbW92ZScgfCB0cmFuc2xhdGVcIlxuICAgICAgICAgICAgICBbZGVsYXldPVwiMzAwXCJcbiAgICAgICAgICAgICAgdHlwZT1cImJ1dHRvblwiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxpIGM4eUljb249XCJtaW51cy1jaXJjbGVcIj48L2k+XG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgICAgbmFtZT1cInJlbW92ZUJ1dHRvblwiXG4gICAgICAgICAgICAgIGNsYXNzPVwiYnRuIGJ0bi1kYW5nZXIgYnRuLWJsb2NrIGJ0bi1zbSB2aXNpYmxlLXhzIHZpc2libGUtc21cIlxuICAgICAgICAgICAgICAoY2xpY2spPVwicmVtb3ZlSW52ZW50b3J5Um9sZShpbnZlbnRvcnlSb2xlKVwiXG4gICAgICAgICAgICAgIHRpdGxlPVwie3sgJ1JlbW92ZScgfCB0cmFuc2xhdGUgfX1cIlxuICAgICAgICAgICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPGkgYzh5SWNvbj1cIm1pbnVzLWNpcmNsZVwiPjwvaT5cbiAgICAgICAgICAgICAgPHNwYW4gdHJhbnNsYXRlPlJlbW92ZTwvc3Bhbj5cbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8YnV0dG9uXG4gICAgICAgIGlkPVwiYWRkLWludmVudG9yeS1yb2xlcy1idXR0b25cIlxuICAgICAgICBjbGFzcz1cImJ0biBidG4tZGVmYXVsdCBtLXQtMTZcIlxuICAgICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgdGl0bGU9XCJ7eyAnQWRkIGludmVudG9yeSByb2xlcycgfCB0cmFuc2xhdGUgfX1cIlxuICAgICAgICAoY2xpY2spPVwiYWRkSW52ZW50b3J5Um9sZXMoKVwiXG4gICAgICA+XG4gICAgICAgIDxpXG4gICAgICAgICAgYzh5SWNvbj1cInBsdXMtY2lyY2xlXCJcbiAgICAgICAgICBjbGFzcz1cIm0tci00XCJcbiAgICAgICAgPjwvaT5cbiAgICAgICAge3sgJ0FkZCBpbnZlbnRvcnkgcm9sZXMnIHwgdHJhbnNsYXRlIH19XG4gICAgICA8L2J1dHRvbj5cbiAgICA8L2ZpZWxkc2V0PlxuICA8L2Rpdj5cbjwvZmllbGRzZXQ+XG4iXX0=