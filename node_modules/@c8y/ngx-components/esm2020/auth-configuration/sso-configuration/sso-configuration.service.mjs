import { Injectable } from '@angular/core';
import { GrantType, TenantLoginOptionsService, TenantLoginOptionType, UserManagementSource } from '@c8y/client';
import { TemplateType } from './sso-configuration.model';
import { defer, of, throwError } from 'rxjs';
import { catchError, map, publishReplay, refCount, take } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@c8y/client";
export class SsoConfigurationService {
    constructor(loginOptionsService) {
        this.loginOptionsService = loginOptionsService;
        this.ssoConfiguration$ = defer(() => this.loginOptionsService.detail(TenantLoginOptionType.OAUTH2)).pipe(map(res => res.data), catchError(({ res }) => {
            if (res.status === 403 /* HttpStatusCode.Forbidden */)
                return throwError(new Error());
            else
                return of(this.defaultConfiguration);
        }), publishReplay(1, 1000), refCount(), take(1));
        this.defaultConfiguration = {
            authorizationRequest: {
                body: '',
                headers: {},
                method: 'GET',
                operation: 'REDIRECT',
                requestParams: {
                    response_type: 'code',
                    client_id: '${clientId}',
                    redirect_uri: '${redirectUri}',
                    scope: ''
                }
            },
            tokenRequest: {
                body: 'grant_type=authorization_code&code=${code}&redirect_uri=${redirectUri}&client_id=${clientId}',
                headers: {},
                method: 'POST',
                operation: 'EXECUTE',
                requestParams: {
                    response_type: 'code',
                    client_id: '${clientId}',
                    redirect_uri: '${redirectUri}',
                    scope: ''
                }
            },
            refreshRequest: {
                body: 'grant_type=refresh_token&refresh_token=${refreshToken}&client_id=${clientId}',
                headers: {
                    Authorization: ''
                },
                method: 'POST',
                operation: 'EXECUTE',
                requestParams: {
                    response_type: 'refresh',
                    client_id: '${clientId}'
                }
            },
            logoutRequest: {
                headers: {},
                method: 'POST',
                operation: 'REDIRECT',
                requestParams: {}
            },
            type: TenantLoginOptionType.OAUTH2,
            grantType: GrantType.AUTHORIZATION_CODE,
            userManagementSource: UserManagementSource.REMOTE,
            onNewUser: {
                dynamicMapping: {
                    mappings: [],
                    inventoryMappings: [],
                    configuration: {
                        mapRolesOnlyForNewUser: false,
                        manageRolesOnlyFromAccessMapping: false
                    }
                }
            },
            userIdConfig: {
                jwtField: '',
                useConstantValue: true
            },
            signatureVerificationConfig: {
                manual: {
                    certIdFromField: false
                }
            },
            template: TemplateType.CUSTOM,
            clientId: '',
            audience: '',
            issuer: '',
            buttonName: '',
            redirectToPlatform: '',
            providerName: '',
            visibleOnLoginPage: true,
            accessTokenToUserDataMappings: {},
            externalTokenConfig: {
                enabled: false
            }
        };
    }
    getSsoConfiguration$() {
        return this.ssoConfiguration$;
    }
    save(ssoConfiguration) {
        return this.loginOptionsService.save(ssoConfiguration);
    }
}
SsoConfigurationService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: SsoConfigurationService, deps: [{ token: i1.TenantLoginOptionsService }], target: i0.ɵɵFactoryTarget.Injectable });
SsoConfigurationService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: SsoConfigurationService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: SsoConfigurationService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: i1.TenantLoginOptionsService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3NvLWNvbmZpZ3VyYXRpb24uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2F1dGgtY29uZmlndXJhdGlvbi9zc28tY29uZmlndXJhdGlvbi9zc28tY29uZmlndXJhdGlvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUNMLFNBQVMsRUFFVCx5QkFBeUIsRUFDekIscUJBQXFCLEVBQ3JCLG9CQUFvQixFQUNyQixNQUFNLGFBQWEsQ0FBQztBQUNyQixPQUFPLEVBQW9CLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQzNFLE9BQU8sRUFBRSxLQUFLLEVBQWMsRUFBRSxFQUFFLFVBQVUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN6RCxPQUFPLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxhQUFhLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7QUFNaEYsTUFBTSxPQUFPLHVCQUF1QjtJQTZGbEMsWUFBb0IsbUJBQThDO1FBQTlDLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBMkI7UUE1RjFELHNCQUFpQixHQUFtQyxLQUFLLENBQUMsR0FBRyxFQUFFLENBQ3JFLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLENBQUMscUJBQXFCLENBQUMsTUFBTSxDQUFDLENBQzlELENBQUMsSUFBSSxDQUNKLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFDcEIsVUFBVSxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFO1lBQ3JCLElBQUksR0FBRyxDQUFDLE1BQU0sdUNBQTZCO2dCQUFFLE9BQU8sVUFBVSxDQUFDLElBQUksS0FBSyxFQUFFLENBQUMsQ0FBQzs7Z0JBQ3ZFLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxvQkFB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aW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgR3JhbnRUeXBlLFxuICBJVGVuYW50TG9naW5PcHRpb24sXG4gIFRlbmFudExvZ2luT3B0aW9uc1NlcnZpY2UsXG4gIFRlbmFudExvZ2luT3B0aW9uVHlwZSxcbiAgVXNlck1hbmFnZW1lbnRTb3VyY2Vcbn0gZnJvbSAnQGM4eS9jbGllbnQnO1xuaW1wb3J0IHsgU3NvQ29uZmlndXJhdGlvbiwgVGVtcGxhdGVUeXBlIH0gZnJvbSAnLi9zc28tY29uZmlndXJhdGlvbi5tb2RlbCc7XG5pbXBvcnQgeyBkZWZlciwgT2JzZXJ2YWJsZSwgb2YsIHRocm93RXJyb3IgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGNhdGNoRXJyb3IsIG1hcCwgcHVibGlzaFJlcGxheSwgcmVmQ291bnQsIHRha2UgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBIdHRwU3RhdHVzQ29kZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgU3NvQ29uZmlndXJhdGlvblNlcnZpY2Uge1xuICBwcml2YXRlIHNzb0NvbmZpZ3VyYXRpb24kOiBPYnNlcnZhYmxlPElUZW5hbnRMb2dpbk9wdGlvbj4gPSBkZWZlcigoKSA9PlxuICAgIHRoaXMubG9naW5PcHRpb25zU2VydmljZS5kZXRhaWwoVGVuYW50TG9naW5PcHRpb25UeXBlLk9BVVRIMilcbiAgKS5waXBlKFxuICAgIG1hcChyZXMgPT4gcmVzLmRhdGEpLFxuICAgIGNhdGNoRXJyb3IoKHsgcmVzIH0pID0+IHtcbiAgICAgIGlmIChyZXMuc3RhdHVzID09PSBIdHRwU3RhdHVzQ29kZS5Gb3JiaWRkZW4pIHJldHVybiB0aHJvd0Vycm9yKG5ldyBFcnJvcigpKTtcbiAgICAgIGVsc2UgcmV0dXJuIG9mKHRoaXMuZGVmYXVsdENvbmZpZ3VyYXRpb24pO1xuICAgIH0pLFxuICAgIHB1Ymxpc2hSZXBsYXkoMSwgMTAwMCksXG4gICAgcmVmQ291bnQoKSxcbiAgICB0YWtlKDEpXG4gICk7XG5cbiAgcHJpdmF0ZSBkZWZhdWx0Q29uZmlndXJhdGlvbjogU3NvQ29uZmlndXJhdGlvbiA9IHtcbiAgICBhdXRob3JpemF0aW9uUmVxdWVzdDoge1xuICAgICAgYm9keTogJycsXG4gICAgICBoZWFkZXJzOiB7fSxcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICBvcGVyYXRpb246ICdSRURJUkVDVCcsXG4gICAgICByZXF1ZXN0UGFyYW1zOiB7XG4gICAgICAgIHJlc3BvbnNlX3R5cGU6ICdjb2RlJyxcbiAgICAgICAgY2xpZW50X2lkOiAnJHtjbGllbnRJZH0nLFxuICAgICAgICByZWRpcmVjdF91cmk6ICcke3JlZGlyZWN0VXJpfScsXG4gICAgICAgIHNjb3BlOiAnJ1xuICAgICAgfVxuICAgIH0sXG4gICAgdG9rZW5SZXF1ZXN0OiB7XG4gICAgICBib2R5OiAnZ3JhbnRfdHlwZT1hdXRob3JpemF0aW9uX2NvZGUmY29kZT0ke2NvZGV9JnJlZGlyZWN0X3VyaT0ke3JlZGlyZWN0VXJpfSZjbGllbnRfaWQ9JHtjbGllbnRJZH0nLFxuICAgICAgaGVhZGVyczoge30sXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIG9wZXJhdGlvbjogJ0VYRUNVVEUnLFxuICAgICAgcmVxdWVzdFBhcmFtczoge1xuICAgICAgICByZXNwb25zZV90eXBlOiAnY29kZScsXG4gICAgICAgIGNsaWVudF9pZDogJyR7Y2xpZW50SWR9JyxcbiAgICAgICAgcmVkaXJlY3RfdXJpOiAnJHtyZWRpcmVjdFVyaX0nLFxuICAgICAgICBzY29wZTogJydcbiAgICAgIH1cbiAgICB9LFxuICAgIHJlZnJlc2hSZXF1ZXN0OiB7XG4gICAgICBib2R5OiAnZ3JhbnRfdHlwZT1yZWZyZXNoX3Rva2VuJnJlZnJlc2hfdG9rZW49JHtyZWZyZXNoVG9rZW59JmNsaWVudF9pZD0ke2NsaWVudElkfScsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIEF1dGhvcml6YXRpb246ICcnXG4gICAgICB9LFxuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBvcGVyYXRpb246ICdFWEVDVVRFJyxcbiAgICAgIHJlcXVlc3RQYXJhbXM6IHtcbiAgICAgICAgcmVzcG9uc2VfdHlwZTogJ3JlZnJlc2gnLFxuICAgICAgICBjbGllbnRfaWQ6ICcke2NsaWVudElkfSdcbiAgICAgIH1cbiAgICB9LFxuICAgIGxvZ291dFJlcXVlc3Q6IHtcbiAgICAgIGhlYWRlcnM6IHt9LFxuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBvcGVyYXRpb246ICdSRURJUkVDVCcsXG4gICAgICByZXF1ZXN0UGFyYW1zOiB7fVxuICAgIH0sXG4gICAgdHlwZTogVGVuYW50TG9naW5PcHRpb25UeXBlLk9BVVRIMixcbiAgICBncmFudFR5cGU6IEdyYW50VHlwZS5BVVRIT1JJWkFUSU9OX0NPREUsXG4gICAgdXNlck1hbmFnZW1lbnRTb3VyY2U6IFVzZXJNYW5hZ2VtZW50U291cmNlLlJFTU9URSxcbiAgICBvbk5ld1VzZXI6IHtcbiAgICAgIGR5bmFtaWNNYXBwaW5nOiB7XG4gICAgICAgIG1hcHBpbmdzOiBbXSxcbiAgICAgICAgaW52ZW50b3J5TWFwcGluZ3M6IFtdLFxuICAgICAgICBjb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgbWFwUm9sZXNPbmx5Rm9yTmV3VXNlcjogZmFsc2UsXG4gICAgICAgICAgbWFuYWdlUm9sZXNPbmx5RnJvbUFjY2Vzc01hcHBpbmc6IGZhbHNlXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIHVzZXJJZENvbmZpZzoge1xuICAgICAgand0RmllbGQ6ICcnLFxuICAgICAgdXNlQ29uc3RhbnRWYWx1ZTogdHJ1ZVxuICAgIH0sXG4gICAgc2lnbmF0dXJlVmVyaWZpY2F0aW9uQ29uZmlnOiB7XG4gICAgICBtYW51YWw6IHtcbiAgICAgICAgY2VydElkRnJvbUZpZWxkOiBmYWxzZVxuICAgICAgfVxuICAgIH0sXG4gICAgdGVtcGxhdGU6IFRlbXBsYXRlVHlwZS5DVVNUT00sXG4gICAgY2xpZW50SWQ6ICcnLFxuICAgIGF1ZGllbmNlOiAnJyxcbiAgICBpc3N1ZXI6ICcnLFxuICAgIGJ1dHRvbk5hbWU6ICcnLFxuICAgIHJlZGlyZWN0VG9QbGF0Zm9ybTogJycsXG4gICAgcHJvdmlkZXJOYW1lOiAnJyxcbiAgICB2aXNpYmxlT25Mb2dpblBhZ2U6IHRydWUsXG4gICAgYWNjZXNzVG9rZW5Ub1VzZXJEYXRhTWFwcGluZ3M6IHt9LFxuICAgIGV4dGVybmFsVG9rZW5Db25maWc6IHtcbiAgICAgIGVuYWJsZWQ6IGZhbHNlXG4gICAgfVxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbG9naW5PcHRpb25zU2VydmljZTogVGVuYW50TG9naW5PcHRpb25zU2VydmljZSkge31cblxuICBnZXRTc29Db25maWd1cmF0aW9uJCgpOiBPYnNlcnZhYmxlPElUZW5hbnRMb2dpbk9wdGlvbj4ge1xuICAgIHJldHVybiB0aGlzLnNzb0NvbmZpZ3VyYXRpb24kO1xuICB9XG5cbiAgc2F2ZShzc29Db25maWd1cmF0aW9uOiBTc29Db25maWd1cmF0aW9uKSB7XG4gICAgcmV0dXJuIHRoaXMubG9naW5PcHRpb25zU2VydmljZS5zYXZlKHNzb0NvbmZpZ3VyYXRpb24pO1xuICB9XG59XG4iXX0=