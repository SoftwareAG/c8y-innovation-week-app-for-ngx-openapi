import { FormGroup } from '@angular/forms';
import { BaseColumn, gettext, PushStatus, SendStatus } from '@c8y/ngx-components';
import { StatusCellRendererComponent } from './status.cell-renderer.component';
export class StatusDeviceGridColumn extends BaseColumn {
    constructor() {
        super();
        const responseIntervalPath = 'c8y_RequiredAvailability.responseInterval';
        const responseIntervalLessThanOrEqualTo0 = { [responseIntervalPath]: { __le: 0 } };
        const responseIntervalNotDefined = { __not: { __has: responseIntervalPath } };
        const availabilityStatusPath = 'c8y_Availability.status';
        const availabilityStatusAvailable = { [availabilityStatusPath]: SendStatus.AVAILABLE };
        const availabilityStatusUnavailable = { [availabilityStatusPath]: SendStatus.UNAVAILABLE };
        const availabilityStatusMaintenance = { [availabilityStatusPath]: SendStatus.MAINTENANCE };
        const availabilityStatusNotDefined = { __not: { __has: availabilityStatusPath } };
        const connectionStatusPath = 'c8y_Connection.status';
        const connectionStatusConnected = { [connectionStatusPath]: PushStatus.CONNECTED };
        const connectionStatusDisconnected = { [connectionStatusPath]: PushStatus.DISCONNECTED };
        const connectionStatusMaintenance = { [connectionStatusPath]: PushStatus.MAINTENANCE };
        const deviceUnderMaintenance = {
            __or: [
                responseIntervalLessThanOrEqualTo0,
                availabilityStatusMaintenance,
                connectionStatusMaintenance
            ]
        };
        const deviceNotUnderMaintenance = {
            // using __and of __nots because backend does not support __not with __ors
            __and: [
                { __not: responseIntervalLessThanOrEqualTo0 },
                { __not: availabilityStatusMaintenance },
                { __not: connectionStatusMaintenance }
            ]
        };
        this.name = 'status';
        this.header = gettext('Status');
        this.dataType = "icon" /* ColumnDataType.Icon */;
        this.cellRendererComponent = StatusCellRendererComponent;
        this.resizable = false;
        this.filterable = true;
        this.filteringConfig = {
            schema: {
                type: 'object',
                properties: {
                    sendStatus: {
                        title: gettext('Show devices with send status'),
                        type: 'object',
                        properties: {
                            sendOnline: {
                                type: 'switch',
                                title: gettext('Online')
                            },
                            sendOffline: {
                                type: 'switch',
                                title: gettext('Offline')
                            },
                            sendUnknown: {
                                type: 'switch',
                                title: gettext('Unknown')
                            },
                            sendNotMonitored: {
                                type: 'switch',
                                title: gettext('Not monitored')
                            }
                        }
                    },
                    pushStatus: {
                        title: gettext('Show devices with push status'),
                        type: 'object',
                        properties: {
                            pushOnline: {
                                type: 'switch',
                                title: gettext('Online')
                            },
                            pushOffline: {
                                type: 'switch',
                                title: gettext('Offline')
                            },
                            pushNotMonitored: {
                                type: 'switch',
                                title: gettext('Not monitored')
                            }
                        }
                    },
                    maintenanceStatus: {
                        title: gettext('Show devices with maintenance status'),
                        type: 'object',
                        properties: {
                            maintenance: {
                                type: 'switch',
                                title: gettext('Device is under maintenance')
                            }
                        }
                    }
                }
            },
            formGroup: new FormGroup({}),
            getFilter(model) {
                const filter = {};
                const ors = [];
                if (model?.sendStatus?.sendOnline) {
                    ors.push({
                        __and: [deviceNotUnderMaintenance, availabilityStatusAvailable]
                    });
                }
                if (model?.sendStatus?.sendOffline) {
                    ors.push({
                        __and: [deviceNotUnderMaintenance, availabilityStatusUnavailable]
                    });
                }
                if (model?.sendStatus?.sendUnknown) {
                    ors.push({
                        __and: [deviceNotUnderMaintenance, availabilityStatusNotDefined]
                    });
                }
                if (model?.sendStatus?.sendNotMonitored || model?.pushStatus?.pushNotMonitored) {
                    ors.push(responseIntervalNotDefined);
                }
                if (model?.pushStatus?.pushOnline) {
                    ors.push({
                        __and: [deviceNotUnderMaintenance, connectionStatusConnected]
                    });
                }
                if (model?.pushStatus?.pushOffline) {
                    ors.push({
                        __and: [deviceNotUnderMaintenance, connectionStatusDisconnected]
                    });
                }
                if (model?.maintenanceStatus?.maintenance) {
                    ors.push(deviceUnderMaintenance);
                }
                if (ors.length) {
                    filter.__or = ors;
                }
                return filter;
            }
        };
        this.sortable = true;
        this.sortingConfig = {
            pathSortingConfigs: [{ path: availabilityStatusPath }]
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdHVzLmRldmljZS1ncmlkLWNvbHVtbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2RldmljZS1ncmlkL2NvbHVtbnMvc3RhdHVzLmRldmljZS1ncmlkLWNvbHVtbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFFLFVBQVUsRUFBa0IsT0FBTyxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNsRyxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUUvRSxNQUFNLE9BQU8sc0JBQXVCLFNBQVEsVUFBVTtJQUNwRDtRQUNFLEtBQUssRUFBRSxDQUFDO1FBRVIsTUFBTSxvQkFBb0IsR0FBRywyQ0FBMkMsQ0FBQztRQUN6RSxNQUFNLGtDQUFrQyxHQUFHLEVBQUUsQ0FBQyxvQkFBb0IsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDbkYsTUFBTSwwQkFBMEIsR0FBRyxFQUFFLEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxvQkFBb0IsRUFBRSxFQUFFLENBQUM7UUFFOUUsTUFBTSxzQkFBc0IsR0FBRyx5QkFBeUIsQ0FBQztRQUN6RCxNQUFNLDJCQUEyQixHQUFHLEVBQUUsQ0FBQyxzQkFBc0IsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUN2RixNQUFNLDZCQUE2QixHQUFHLEVBQUUsQ0FBQyxzQkFBc0IsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMzRixNQUFNLDZCQUE2QixHQUFHLEVBQUUsQ0FBQyxzQkFBc0IsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMzRixNQUFNLDRCQUE0QixHQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUUsS0FBSyxFQUFFLHNCQUFzQixF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Q0FBQyx5QkFBeUIsRUFBRSw0QkFBNEIsQ0FBQztxQkFDakUsQ0FBQyxDQUFDO2lCQUNKO2dCQUVELElBQUksS0FBSyxFQUFFLGlCQUFpQixFQUFFLFdBQVcsRUFBRTtvQkFDekMsR0FBRyxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO2lCQUNsQztnQkFFRCxJQUFJLEdBQUcsQ0FBQyxNQUFNLEVBQUU7b0JBQ2QsTUFBTSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7aUJBQ25CO2dCQUVELE9BQU8sTUFBTSxDQUFDO1lBQ2hCLENBQUM7U0FDRixDQUFDO1FBRUYsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFDckIsSUFBSSxDQUFDLGFBQWEsR0FBRztZQUNuQixrQkFBa0IsRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLHNCQUFzQixFQUFFLENBQUM7U0FDdkQsQ0FBQztJQUNKLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZvcm1Hcm91cCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IEJhc2VDb2x1bW4sIENvbHVtbkRhdGFUeXBlLCBnZXR0ZXh0LCBQdXNoU3RhdHVzLCBTZW5kU3RhdHVzIH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cyc7XG5pbXBvcnQgeyBTdGF0dXNDZWxsUmVuZGVyZXJDb21wb25lbnQgfSBmcm9tICcuL3N0YXR1cy5jZWxsLXJlbmRlcmVyLmNvbXBvbmVudCc7XG5cbmV4cG9ydCBjbGFzcyBTdGF0dXNEZXZpY2VHcmlkQ29sdW1uIGV4dGVuZHMgQmFzZUNvbHVtbiB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG5cbiAgICBjb25zdCByZXNwb25zZUludGVydmFsUGF0aCA9ICdjOHlfUmVxdWlyZWRBdmFpbGFiaWxpdHkucmVzcG9uc2VJbnRlcnZhbCc7XG4gICAgY29uc3QgcmVzcG9uc2VJbnRlcnZhbExlc3NUaGFuT3JFcXVhbFRvMCA9IHsgW3Jlc3BvbnNlSW50ZXJ2YWxQYXRoXTogeyBfX2xlOiAwIH0gfTtcbiAgICBjb25zdCByZXNwb25zZUludGVydmFsTm90RGVmaW5lZCA9IHsgX19ub3Q6IHsgX19oYXM6IHJlc3BvbnNlSW50ZXJ2YWxQYXRoIH0gfTtcblxuICAgIGNvbnN0IGF2YWlsYWJpbGl0eVN0YXR1c1BhdGggPSAnYzh5X0F2YWlsYWJpbGl0eS5zdGF0dXMnO1xuICAgIGNvbnN0IGF2YWlsYWJpbGl0eVN0YXR1c0F2YWlsYWJsZSA9IHsgW2F2YWlsYWJpbGl0eVN0YXR1c1BhdGhdOiBTZW5kU3RhdHVzLkFWQUlMQUJMRSB9O1xuICAgIGNvbnN0IGF2YWlsYWJpbGl0eVN0YXR1c1VuYXZhaWxhYmxlID0geyBbYXZhaWxhYmlsaXR5U3RhdHVzUGF0aF06IFNlbmRTdGF0dXMuVU5BVkFJTEFCTEUgfTtcbiAgICBjb25zdCBhdmFpbGFiaWxpdHlTdGF0dXNNYWludGVuYW5jZSA9IHsgW2F2YWlsYWJpbGl0eVN0YXR1c1BhdGhdOiBTZW5kU3RhdHVzLk1BSU5URU5BTkNFIH07XG4gICAgY29uc3QgYXZhaWxhYmlsaXR5U3RhdHVzTm90RGVmaW5lZCA9IHsgX19ub3Q6IHsgX19oYXM6IGF2YWlsYWJpbGl0eVN0YXR1c1BhdGggfSB9O1xuXG4gICAgY29uc3QgY29ubmVjdGlvblN0YXR1c1BhdGggPSAnYzh5X0Nvbm5lY3Rpb24uc3RhdHVzJztcbiAgICBjb25zdCBjb25uZWN0aW9uU3RhdHVzQ29ubmVjdGVkID0geyBbY29ubmVjdGlvblN0YXR1c1BhdGhdOiBQdXNoU3RhdHVzLkNPTk5FQ1RFRCB9O1xuICAgIGNvbnN0IGNvbm5lY3Rpb25TdGF0dXNEaXNjb25uZWN0ZWQgPSB7IFtjb25uZWN0aW9uU3RhdHVzUGF0aF06IFB1c2hTdGF0dXMuRElTQ09OTkVDVEVEIH07XG4gICAgY29uc3QgY29ubmVjdGlvblN0YXR1c01haW50ZW5hbmNlID0geyBbY29ubmVjdGlvblN0YXR1c1BhdGhdOiBQdXNoU3RhdHVzLk1BSU5URU5BTkNFIH07XG5cbiAgICBjb25zdCBkZXZpY2VVbmRlck1haW50ZW5hbmNlID0ge1xuICAgICAgX19vcjogW1xuICAgICAgICByZXNwb25zZUludGVydmFsTGVzc1RoYW5PckVxdWFsVG8wLFxuICAgICAgICBhdmFpbGFiaWxpdHlTdGF0dXNNYWludGVuYW5jZSxcbiAgICAgICAgY29ubmVjdGlvblN0YXR1c01haW50ZW5hbmNlXG4gICAgICBdXG4gICAgfTtcbiAgICBjb25zdCBkZXZpY2VOb3RVbmRlck1haW50ZW5hbmNlID0ge1xuICAgICAgLy8gdXNpbmcgX19hbmQgb2YgX19ub3RzIGJlY2F1c2UgYmFja2VuZCBkb2VzIG5vdCBzdXBwb3J0IF9fbm90IHdpdGggX19vcnNcbiAgICAgIF9fYW5kOiBbXG4gICAgICAgIHsgX19ub3Q6IHJlc3BvbnNlSW50ZXJ2YWxMZXNzVGhhbk9yRXF1YWxUbzAgfSxcbiAgICAgICAgeyBfX25vdDogYXZhaWxhYmlsaXR5U3RhdHVzTWFpbnRlbmFuY2UgfSxcbiAgICAgICAgeyBfX25vdDogY29ubmVjdGlvblN0YXR1c01haW50ZW5hbmNlIH1cbiAgICAgIF1cbiAgICB9O1xuXG4gICAgdGhpcy5uYW1lID0gJ3N0YXR1cyc7XG4gICAgdGhpcy5oZWFkZXIgPSBnZXR0ZXh0KCdTdGF0dXMnKTtcbiAgICB0aGlzLmRhdGFUeXBlID0gQ29sdW1uRGF0YVR5cGUuSWNvbjtcbiAgICB0aGlzLmNlbGxSZW5kZXJlckNvbXBvbmVudCA9IFN0YXR1c0NlbGxSZW5kZXJlckNvbXBvbmVudDtcbiAgICB0aGlzLnJlc2l6YWJsZSA9IGZhbHNlO1xuXG4gICAgdGhpcy5maWx0ZXJhYmxlID0gdHJ1ZTtcbiAgICB0aGlzLmZpbHRlcmluZ0NvbmZpZyA9IHtcbiAgICAgIHNjaGVtYToge1xuICAgICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgIHNlbmRTdGF0dXM6IHtcbiAgICAgICAgICAgIHRpdGxlOiBnZXR0ZXh0KCdTaG93IGRldmljZXMgd2l0aCBzZW5kIHN0YXR1cycpLFxuICAgICAgICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgIHNlbmRPbmxpbmU6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnc3dpdGNoJyxcbiAgICAgICAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnT25saW5lJylcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgc2VuZE9mZmxpbmU6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnc3dpdGNoJyxcbiAgICAgICAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnT2ZmbGluZScpXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHNlbmRVbmtub3duOiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3N3aXRjaCcsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGdldHRleHQoJ1Vua25vd24nKVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBzZW5kTm90TW9uaXRvcmVkOiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3N3aXRjaCcsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGdldHRleHQoJ05vdCBtb25pdG9yZWQnKVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwdXNoU3RhdHVzOiB7XG4gICAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnU2hvdyBkZXZpY2VzIHdpdGggcHVzaCBzdGF0dXMnKSxcbiAgICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICBwdXNoT25saW5lOiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3N3aXRjaCcsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGdldHRleHQoJ09ubGluZScpXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHB1c2hPZmZsaW5lOiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3N3aXRjaCcsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGdldHRleHQoJ09mZmxpbmUnKVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBwdXNoTm90TW9uaXRvcmVkOiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3N3aXRjaCcsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGdldHRleHQoJ05vdCBtb25pdG9yZWQnKVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBtYWludGVuYW5jZVN0YXR1czoge1xuICAgICAgICAgICAgdGl0bGU6IGdldHRleHQoJ1Nob3cgZGV2aWNlcyB3aXRoIG1haW50ZW5hbmNlIHN0YXR1cycpLFxuICAgICAgICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgIG1haW50ZW5hbmNlOiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3N3aXRjaCcsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGdldHRleHQoJ0RldmljZSBpcyB1bmRlciBtYWludGVuYW5jZScpXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBmb3JtR3JvdXA6IG5ldyBGb3JtR3JvdXAoe30pLFxuICAgICAgZ2V0RmlsdGVyKG1vZGVsKSB7XG4gICAgICAgIGNvbnN0IGZpbHRlcjogYW55ID0ge307XG4gICAgICAgIGNvbnN0IG9ycyA9IFtdO1xuXG4gICAgICAgIGlmIChtb2RlbD8uc2VuZFN0YXR1cz8uc2VuZE9ubGluZSkge1xuICAgICAgICAgIG9ycy5wdXNoKHtcbiAgICAgICAgICAgIF9fYW5kOiBbZGV2aWNlTm90VW5kZXJNYWludGVuYW5jZSwgYXZhaWxhYmlsaXR5U3RhdHVzQXZhaWxhYmxlXVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG1vZGVsPy5zZW5kU3RhdHVzPy5zZW5kT2ZmbGluZSkge1xuICAgICAgICAgIG9ycy5wdXNoKHtcbiAgICAgICAgICAgIF9fYW5kOiBbZGV2aWNlTm90VW5kZXJNYWludGVuYW5jZSwgYXZhaWxhYmlsaXR5U3RhdHVzVW5hdmFpbGFibGVdXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobW9kZWw/LnNlbmRTdGF0dXM/LnNlbmRVbmtub3duKSB7XG4gICAgICAgICAgb3JzLnB1c2goe1xuICAgICAgICAgICAgX19hbmQ6IFtkZXZpY2VOb3RVbmRlck1haW50ZW5hbmNlLCBhdmFpbGFiaWxpdHlTdGF0dXNOb3REZWZpbmVkXVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG1vZGVsPy5zZW5kU3RhdHVzPy5zZW5kTm90TW9uaXRvcmVkIHx8IG1vZGVsPy5wdXNoU3RhdHVzPy5wdXNoTm90TW9uaXRvcmVkKSB7XG4gICAgICAgICAgb3JzLnB1c2gocmVzcG9uc2VJbnRlcnZhbE5vdERlZmluZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG1vZGVsPy5wdXNoU3RhdHVzPy5wdXNoT25saW5lKSB7XG4gICAgICAgICAgb3JzLnB1c2goe1xuICAgICAgICAgICAgX19hbmQ6IFtkZXZpY2VOb3RVbmRlck1haW50ZW5hbmNlLCBjb25uZWN0aW9uU3RhdHVzQ29ubmVjdGVkXVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG1vZGVsPy5wdXNoU3RhdHVzPy5wdXNoT2ZmbGluZSkge1xuICAgICAgICAgIG9ycy5wdXNoKHtcbiAgICAgICAgICAgIF9fYW5kOiBbZGV2aWNlTm90VW5kZXJNYWludGVuYW5jZSwgY29ubmVjdGlvblN0YXR1c0Rpc2Nvbm5lY3RlZF1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtb2RlbD8ubWFpbnRlbmFuY2VTdGF0dXM/Lm1haW50ZW5hbmNlKSB7XG4gICAgICAgICAgb3JzLnB1c2goZGV2aWNlVW5kZXJNYWludGVuYW5jZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3JzLmxlbmd0aCkge1xuICAgICAgICAgIGZpbHRlci5fX29yID0gb3JzO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZpbHRlcjtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5zb3J0YWJsZSA9IHRydWU7XG4gICAgdGhpcy5zb3J0aW5nQ29uZmlnID0ge1xuICAgICAgcGF0aFNvcnRpbmdDb25maWdzOiBbeyBwYXRoOiBhdmFpbGFiaWxpdHlTdGF0dXNQYXRoIH1dXG4gICAgfTtcbiAgfVxufVxuIl19