import { Component, Input, ViewChild } from '@angular/core';
import { C8yStepper, GainsightService, gettext } from '@c8y/ngx-components';
import { FormGroup } from '@angular/forms';
import { BsModalRef } from 'ngx-bootstrap/modal';
import { ExtensibleDeviceRegistrationService } from './extensible-device-registration.service';
import { RegisterDeviceService } from '../../register-device.service';
import { STEP_STATE } from '@angular/cdk/stepper';
import { PRODUCT_EXPERIENCE } from '../base-device-registration.model';
import * as i0 from "@angular/core";
import * as i1 from "./extensible-device-registration.service";
import * as i2 from "../../register-device.service";
import * as i3 from "ngx-bootstrap/modal";
import * as i4 from "@c8y/ngx-components";
import * as i5 from "@angular/common";
import * as i6 from "@angular/cdk/stepper";
import * as i7 from "@ngx-formly/core";
export class ExtensibleDeviceRegistrationStepperComponent {
    constructor(customProviderService, registerDeviceService, bsModalRef, gainsightService) {
        this.customProviderService = customProviderService;
        this.registerDeviceService = registerDeviceService;
        this.bsModalRef = bsModalRef;
        this.gainsightService = gainsightService;
        this.pendingStatus = false;
        this.forms = [];
        this.model = {};
        this.SERVER_ERROR = gettext('Cannot register your device.');
        this.SUCCESSFUL_REGISTRATION = gettext('Your device was successfully registered.');
        this.NO_CONNECTION = gettext('Unable to reach the microservice.');
    }
    ngOnInit() {
        this.steps.forEach(() => this.forms.push(new FormGroup({})));
    }
    async save() {
        this.pendingStatus = true;
        this.errorMessage = null;
        const { res, data } = await this.customProviderService
            .registerDevice(this.contextPath, this.model)
            .catch(() => {
            return {
                res: undefined,
                data: undefined
            };
        })
            .finally(() => {
            this.pendingStatus = false;
            this.stepper.next();
        });
        if (res && data) {
            if (res.status >= 400 && res.status < 500) {
                this.handleError(data.message || this.SERVER_ERROR);
            }
            else if (res.status >= 500) {
                this.handleError(this.SERVER_ERROR);
            }
            else {
                this.gainsightService.triggerEvent(PRODUCT_EXPERIENCE.EVENT, {
                    result: PRODUCT_EXPERIENCE.RESULT.SUCCESS,
                    component: PRODUCT_EXPERIENCE.COMPONENT.EXTENSIBLE_SINGLE
                });
                this.message = this.SUCCESSFUL_REGISTRATION;
            }
        }
        else {
            this.handleError(this.NO_CONNECTION);
        }
    }
    close() {
        this.bsModalRef.hide();
    }
    complete() {
        this.registerDeviceService.list();
        this.bsModalRef.hide();
    }
    goToFirstStep() {
        this.stepper.selectedIndex = 0;
    }
    isRegistrationStep() {
        return this.stepper.selectedIndex === this.steps.length - 1;
    }
    finalStepStatus() {
        if (this.stepper.selectedIndex === this.steps.length) {
            if (this.errorMessage) {
                return STEP_STATE.ERROR;
            }
            else {
                return STEP_STATE.DONE;
            }
        }
        else {
            return STEP_STATE.NUMBER;
        }
    }
    handleError(message) {
        this.gainsightService.triggerEvent(PRODUCT_EXPERIENCE.EVENT, {
            result: PRODUCT_EXPERIENCE.RESULT.FAILURE,
            component: PRODUCT_EXPERIENCE.COMPONENT.EXTENSIBLE_SINGLE
        });
        this.errorMessage = message;
    }
}
ExtensibleDeviceRegistrationStepperComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: ExtensibleDeviceRegistrationStepperComponent, deps: [{ token: i1.ExtensibleDeviceRegistrationService }, { token: i2.RegisterDeviceService }, { token: i3.BsModalRef }, { token: i4.GainsightService }], target: i0.ɵɵFactoryTarget.Component });
ExtensibleDeviceRegistrationStepperComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.7", type: ExtensibleDeviceRegistrationStepperComponent, selector: "c8y-extensible-device-registration-stepper", inputs: { contextPath: "contextPath", labels: "labels", steps: "steps" }, viewQueries: [{ propertyName: "stepper", first: true, predicate: C8yStepper, descendants: true, static: true }], ngImport: i0, template: "<c8y-stepper\n  [disableProgressButtons]=\"true\"\n  [disableDefaultIcons]=\"{ edit: true, done: false }\"\n  [customClasses]=\"['m-40', 'm-t-8', 'm-b-16']\"\n>\n  <cdk-step *ngFor=\"let step of steps; let i = index\" [stepControl]=\"forms[i]\" [label]=\"labels[i]\">\n    <c8y-form-group class=\"form-group p-24 p-b-0 p-t-16\">\n      <formly-form [form]=\"forms[i]\" [fields]=\"step\" [model]=\"model\"></formly-form>\n    </c8y-form-group>\n    <c8y-stepper-buttons\n      class=\"sticky-bottom d-block modal-footer separator-top bg-component\"\n      *ngIf=\"isRegistrationStep()\"\n      [showButtons]=\"{ cancel: true, back: true, next: true }\"\n      [labels]=\"{ next: 'Register' }\"\n      (onCancel)=\"close()\"\n      (onNext)=\"save()\"\n      [pending]=\"pendingStatus\"\n      [disabled]=\"forms[i].invalid\"\n    ></c8y-stepper-buttons>\n    <c8y-stepper-buttons\n      class=\"sticky-bottom d-block modal-footer separator-top bg-component\"\n      *ngIf=\"!isRegistrationStep()\"\n      [showButtons]=\"{ cancel: true, back: i !== 0, next: true }\"\n      [disabled]=\"forms[i].invalid\"\n      (onCancel)=\"close()\"\n    ></c8y-stepper-buttons>\n  </cdk-step>\n  <cdk-step [state]=\"finalStepStatus()\" label=\"{{ 'Summary' | translate }}\">\n    <c8y-operation-result\n      *ngIf=\"!errorMessage; else errorInfo\"\n      text=\"{{ message | translate }}\"\n      [size]=\"84\"\n      [vertical]=\"true\"\n      type=\"success\"\n      class=\"lead\"\n      data-cy=\"success\"\n    ></c8y-operation-result>\n    <ng-template #errorInfo>\n      <c8y-operation-result\n        text=\"{{ errorMessage | translate }}\"\n        [size]=\"84\"\n        [vertical]=\"true\"\n        type=\"error\"\n        class=\"lead\"\n        data-cy=\"error\"\n      ></c8y-operation-result>\n    </ng-template>\n    <c8y-stepper-buttons\n      class=\"sticky-bottom d-block modal-footer separator-top bg-component\"\n      [showButtons]=\"{ cancel: errorMessage, back: errorMessage, next: !errorMessage }\"\n      [labels]=\"{ back: 'Fix issue', next: 'Close' }\"\n      (onCancel)=\"close()\"\n      (onNext)=\"complete()\"\n      (onBack)=\"goToFirstStep()\"\n    ></c8y-stepper-buttons>\n  </cdk-step>\n</c8y-stepper>\n", dependencies: [{ kind: "directive", type: i5.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i5.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i4.OperationResultComponent, selector: "c8y-operation-result", inputs: ["text", "vertical", "size", "type"] }, { kind: "component", type: i4.FormGroupComponent, selector: "c8y-form-group", inputs: ["hasError", "hasWarning", "hasSuccess", "novalidation", "status"] }, { kind: "component", type: i4.C8yStepper, selector: "c8y-stepper", inputs: ["disableDefaultIcons", "disableProgressButtons", "customClasses", "hideStepProgress", "useStepLabelsAsTitlesOnly"], outputs: ["onStepChange"] }, { kind: "component", type: i6.CdkStep, selector: "cdk-step", inputs: ["stepControl", "label", "errorMessage", "aria-label", "aria-labelledby", "state", "editable", "optional", "completed", "hasError"], outputs: ["interacted"], exportAs: ["cdkStep"] }, { kind: "component", type: i4.C8yStepperButtons, selector: "c8y-stepper-buttons", inputs: ["labels", "pending", "disabled", "showButtons"], outputs: ["onCancel", "onNext", "onBack", "onCustom"] }, { kind: "component", type: i7.FormlyForm, selector: "formly-form", inputs: ["form", "model", "fields", "options"], outputs: ["modelChange"] }, { kind: "pipe", type: i4.C8yTranslatePipe, name: "translate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: ExtensibleDeviceRegistrationStepperComponent, decorators: [{
            type: Component,
            args: [{ selector: 'c8y-extensible-device-registration-stepper', template: "<c8y-stepper\n  [disableProgressButtons]=\"true\"\n  [disableDefaultIcons]=\"{ edit: true, done: false }\"\n  [customClasses]=\"['m-40', 'm-t-8', 'm-b-16']\"\n>\n  <cdk-step *ngFor=\"let step of steps; let i = index\" [stepControl]=\"forms[i]\" [label]=\"labels[i]\">\n    <c8y-form-group class=\"form-group p-24 p-b-0 p-t-16\">\n      <formly-form [form]=\"forms[i]\" [fields]=\"step\" [model]=\"model\"></formly-form>\n    </c8y-form-group>\n    <c8y-stepper-buttons\n      class=\"sticky-bottom d-block modal-footer separator-top bg-component\"\n      *ngIf=\"isRegistrationStep()\"\n      [showButtons]=\"{ cancel: true, back: true, next: true }\"\n      [labels]=\"{ next: 'Register' }\"\n      (onCancel)=\"close()\"\n      (onNext)=\"save()\"\n      [pending]=\"pendingStatus\"\n      [disabled]=\"forms[i].invalid\"\n    ></c8y-stepper-buttons>\n    <c8y-stepper-buttons\n      class=\"sticky-bottom d-block modal-footer separator-top bg-component\"\n      *ngIf=\"!isRegistrationStep()\"\n      [showButtons]=\"{ cancel: true, back: i !== 0, next: true }\"\n      [disabled]=\"forms[i].invalid\"\n      (onCancel)=\"close()\"\n    ></c8y-stepper-buttons>\n  </cdk-step>\n  <cdk-step [state]=\"finalStepStatus()\" label=\"{{ 'Summary' | translate }}\">\n    <c8y-operation-result\n      *ngIf=\"!errorMessage; else errorInfo\"\n      text=\"{{ message | translate }}\"\n      [size]=\"84\"\n      [vertical]=\"true\"\n      type=\"success\"\n      class=\"lead\"\n      data-cy=\"success\"\n    ></c8y-operation-result>\n    <ng-template #errorInfo>\n      <c8y-operation-result\n        text=\"{{ errorMessage | translate }}\"\n        [size]=\"84\"\n        [vertical]=\"true\"\n        type=\"error\"\n        class=\"lead\"\n        data-cy=\"error\"\n      ></c8y-operation-result>\n    </ng-template>\n    <c8y-stepper-buttons\n      class=\"sticky-bottom d-block modal-footer separator-top bg-component\"\n      [showButtons]=\"{ cancel: errorMessage, back: errorMessage, next: !errorMessage }\"\n      [labels]=\"{ back: 'Fix issue', next: 'Close' }\"\n      (onCancel)=\"close()\"\n      (onNext)=\"complete()\"\n      (onBack)=\"goToFirstStep()\"\n    ></c8y-stepper-buttons>\n  </cdk-step>\n</c8y-stepper>\n" }]
        }], ctorParameters: function () { return [{ type: i1.ExtensibleDeviceRegistrationService }, { type: i2.RegisterDeviceService }, { type: i3.BsModalRef }, { type: i4.GainsightService }]; }, propDecorators: { stepper: [{
                type: ViewChild,
                args: [C8yStepper, { static: true }]
            }], contextPath: [{
                type: Input
            }], labels: [{
                type: Input
            }], steps: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXh0ZW5zaWJsZS1kZXZpY2UtcmVnaXN0cmF0aW9uLXN0ZXBwZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcmVnaXN0ZXItZGV2aWNlL2V4dGVuc2libGUvc2luZ2xlL2V4dGVuc2libGUtZGV2aWNlLXJlZ2lzdHJhdGlvbi1zdGVwcGVyLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uL3JlZ2lzdGVyLWRldmljZS9leHRlbnNpYmxlL3NpbmdsZS9leHRlbnNpYmxlLWRldmljZS1yZWdpc3RyYXRpb24tc3RlcHBlci5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBVSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDcEUsT0FBTyxFQUFFLFVBQVUsRUFBRSxnQkFBZ0IsRUFBRSxPQUFPLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM1RSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxtQ0FBbUMsRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBQy9GLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBRXRFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQzs7Ozs7Ozs7O0FBTXZFLE1BQU0sT0FBTyw0Q0FBNEM7SUFpQnZELFlBQ1UscUJBQTBELEVBQzFELHFCQUE0QyxFQUM1QyxVQUFzQixFQUN0QixnQkFBa0M7UUFIbEMsMEJBQXFCLEdBQXJCLHFCQUFxQixDQUFxQztRQUMxRCwwQkFBcUIsR0FBckIscUJBQXFCLENBQXVCO1FBQzVDLGVBQVUsR0FBVixVQUFVLENBQVk7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QUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFO1lBQ3BELElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTtnQkFDckIsT0FBTyxVQUFVLENBQUMsS0FBSyxDQUFDO2FBQ3pCO2lCQUFNO2dCQUNMLE9BQU8sVUFBVSxDQUFDLElBQUksQ0FBQzthQUN4QjtTQUNGO2FBQU07WUFDTCxPQUFPLFVBQVUsQ0FBQyxNQUFNLENBQUM7U0FDMUI7SUFDSCxDQUFDO0lBRU8sV0FBVyxDQUFDLE9BQWU7UUFDakMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLEVBQUU7WUFDM0QsTUFBTSxFQUFFLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxPQUFPO1lBQ3pDLFNBQVMsRUFBRSxrQkFBa0IsQ0FBQyxTQUFTLENBQUMsaUJBQWlCO1NBQzFELENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxZQUFZLEdBQUcsT0FBTyxDQUFDO0lBQzlCLENBQUM7O3lJQWhHVSw0Q0FBNEM7NkhBQTVDLDRDQUE0QyxxTUFNNUMsVUFBVSw4RENwQnZCLG9yRUF5REE7MkZEM0NhLDRDQUE0QztrQkFKeEQsU0FBUzsrQkFDRSw0Q0FBNEM7c05BVXRELE9BQU87c0JBRE4sU0FBUzt1QkFBQyxVQUFVLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO2dCQUc5QixXQUFXO3NCQUFuQixLQUFLO2dCQUNHLE1BQU07c0JBQWQsS0FBSztnQkFDRyxLQUFLO3NCQUFiLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQzh5U3RlcHBlciwgR2FpbnNpZ2h0U2VydmljZSwgZ2V0dGV4dCB9IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMnO1xuaW1wb3J0IHsgRm9ybUdyb3VwIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgQnNNb2RhbFJlZiB9IGZyb20gJ25neC1ib290c3RyYXAvbW9kYWwnO1xuaW1wb3J0IHsgRXh0ZW5zaWJsZURldmljZVJlZ2lzdHJhdGlvblNlcnZpY2UgfSBmcm9tICcuL2V4dGVuc2libGUtZGV2aWNlLXJlZ2lzdHJhdGlvbi5zZXJ2aWNlJztcbmltcG9ydCB7IFJlZ2lzdGVyRGV2aWNlU2VydmljZSB9IGZyb20gJy4uLy4uL3JlZ2lzdGVyLWRldmljZS5zZXJ2aWNlJztcbmltcG9ydCB7IEZvcm1seUZpZWxkQ29uZmlnIH0gZnJvbSAnQG5neC1mb3JtbHkvY29yZSc7XG5pbXBvcnQgeyBTVEVQX1NUQVRFIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL3N0ZXBwZXInO1xuaW1wb3J0IHsgUFJPRFVDVF9FWFBFUklFTkNFIH0gZnJvbSAnLi4vYmFzZS1kZXZpY2UtcmVnaXN0cmF0aW9uLm1vZGVsJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYzh5LWV4dGVuc2libGUtZGV2aWNlLXJlZ2lzdHJhdGlvbi1zdGVwcGVyJyxcbiAgdGVtcGxhdGVVcmw6ICdleHRlbnNpYmxlLWRldmljZS1yZWdpc3RyYXRpb24tc3RlcHBlci5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgRXh0ZW5zaWJsZURldmljZVJlZ2lzdHJhdGlvblN0ZXBwZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBtZXNzYWdlOiBzdHJpbmc7XG4gIGVycm9yTWVzc2FnZTogc3RyaW5nO1xuICBwZW5kaW5nU3RhdHVzID0gZmFsc2U7XG4gIGZvcm1zOiBGb3JtR3JvdXBbXSA9IFtdO1xuICBtb2RlbDogYW55ID0ge307XG4gIEBWaWV3Q2hpbGQoQzh5U3RlcHBlciwgeyBzdGF0aWM6IHRydWUgfSlcbiAgc3RlcHBlcjogQzh5U3RlcHBlcjtcblxuICBASW5wdXQoKSBjb250ZXh0UGF0aDogc3RyaW5nO1xuICBASW5wdXQoKSBsYWJlbHM6IHN0cmluZ1tdO1xuICBASW5wdXQoKSBzdGVwczogRm9ybWx5RmllbGRDb25maWdbXVtdO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgU0VSVkVSX0VSUk9SID0gZ2V0dGV4dCgnQ2Fubm90IHJlZ2lzdGVyIHlvdXIgZGV2aWNlLicpO1xuICBwcml2YXRlIHJlYWRvbmx5IFNVQ0NFU1NGVUxfUkVHSVNUUkFUSU9OID0gZ2V0dGV4dCgnWW91ciBkZXZpY2Ugd2FzIHN1Y2Nlc3NmdWxseSByZWdpc3RlcmVkLicpO1xuICBwcml2YXRlIHJlYWRvbmx5IE5PX0NPTk5FQ1RJT04gPSBnZXR0ZXh0KCdVbmFibGUgdG8gcmVhY2ggdGhlIG1pY3Jvc2VydmljZS4nKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGN1c3RvbVByb3ZpZGVyU2VydmljZTogRXh0ZW5zaWJsZURldmljZVJlZ2lzdHJhdGlvblNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWdpc3RlckRldmljZVNlcnZpY2U6IFJlZ2lzdGVyRGV2aWNlU2VydmljZSxcbiAgICBwcml2YXRlIGJzTW9kYWxSZWY6IEJzTW9kYWxSZWYsXG4gICAgcHJpdmF0ZSBnYWluc2lnaHRTZXJ2aWNlOiBHYWluc2lnaHRTZXJ2aWNlXG4gICkge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLnN0ZXBzLmZvckVhY2goKCkgPT4gdGhpcy5mb3Jtcy5wdXNoKG5ldyBGb3JtR3JvdXAoe30pKSk7XG4gIH1cblxuICBhc3luYyBzYXZlKCkge1xuICAgIHRoaXMucGVuZGluZ1N0YXR1cyA9IHRydWU7XG4gICAgdGhpcy5lcnJvck1lc3NhZ2UgPSBudWxsO1xuICAgIGNvbnN0IHsgcmVzLCBkYXRhIH0gPSBhd2FpdCB0aGlzLmN1c3RvbVByb3ZpZGVyU2VydmljZVxuICAgICAgLnJlZ2lzdGVyRGV2aWNlKHRoaXMuY29udGV4dFBhdGgsIHRoaXMubW9kZWwpXG4gICAgICAuY2F0Y2goKCkgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHJlczogdW5kZWZpbmVkLFxuICAgICAgICAgIGRhdGE6IHVuZGVmaW5lZFxuICAgICAgICB9O1xuICAgICAgfSlcbiAgICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgdGhpcy5wZW5kaW5nU3RhdHVzID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3RlcHBlci5uZXh0KCk7XG4gICAgICB9KTtcblxuICAgIGlmIChyZXMgJiYgZGF0YSkge1xuICAgICAgaWYgKHJlcy5zdGF0dXMgPj0gNDAwICYmIHJlcy5zdGF0dXMgPCA1MDApIHtcbiAgICAgICAgdGhpcy5oYW5kbGVFcnJvcihkYXRhLm1lc3NhZ2UgfHwgdGhpcy5TRVJWRVJfRVJST1IpO1xuICAgICAgfSBlbHNlIGlmIChyZXMuc3RhdHVzID49IDUwMCkge1xuICAgICAgICB0aGlzLmhhbmRsZUVycm9yKHRoaXMuU0VSVkVSX0VSUk9SKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZ2FpbnNpZ2h0U2VydmljZS50cmlnZ2VyRXZlbnQoUFJPRFVDVF9FWFBFUklFTkNFLkVWRU5ULCB7XG4gICAgICAgICAgcmVzdWx0OiBQUk9EVUNUX0VYUEVSSUVOQ0UuUkVTVUxULlNVQ0NFU1MsXG4gICAgICAgICAgY29tcG9uZW50OiBQUk9EVUNUX0VYUEVSSUVOQ0UuQ09NUE9ORU5ULkVYVEVOU0lCTEVfU0lOR0xFXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLm1lc3NhZ2UgPSB0aGlzLlNVQ0NFU1NGVUxfUkVHSVNUUkFUSU9OO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmhhbmRsZUVycm9yKHRoaXMuTk9fQ09OTkVDVElPTik7XG4gICAgfVxuICB9XG5cbiAgY2xvc2UoKSB7XG4gICAgdGhpcy5ic01vZGFsUmVmLmhpZGUoKTtcbiAgfVxuXG4gIGNvbXBsZXRlKCkge1xuICAgIHRoaXMucmVnaXN0ZXJEZXZpY2VTZXJ2aWNlLmxpc3QoKTtcbiAgICB0aGlzLmJzTW9kYWxSZWYuaGlkZSgpO1xuICB9XG5cbiAgZ29Ub0ZpcnN0U3RlcCgpIHtcbiAgICB0aGlzLnN0ZXBwZXIuc2VsZWN0ZWRJbmRleCA9IDA7XG4gIH1cblxuICBpc1JlZ2lzdHJhdGlvblN0ZXAoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RlcHBlci5zZWxlY3RlZEluZGV4ID09PSB0aGlzLnN0ZXBzLmxlbmd0aCAtIDE7XG4gIH1cblxuICBmaW5hbFN0ZXBTdGF0dXMoKSB7XG4gICAgaWYgKHRoaXMuc3RlcHBlci5zZWxlY3RlZEluZGV4ID09PSB0aGlzLnN0ZXBzLmxlbmd0aCkge1xuICAgICAgaWYgKHRoaXMuZXJyb3JNZXNzYWdlKSB7XG4gICAgICAgIHJldHVybiBTVEVQX1NUQVRFLkVSUk9SO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFNURVBfU1RBVEUuRE9ORTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFNURVBfU1RBVEUuTlVNQkVSO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlRXJyb3IobWVzc2FnZTogc3RyaW5nKSB7XG4gICAgdGhpcy5nYWluc2lnaHRTZXJ2aWNlLnRyaWdnZXJFdmVudChQUk9EVUNUX0VYUEVSSUVOQ0UuRVZFTlQsIHtcbiAgICAgIHJlc3VsdDogUFJPRFVDVF9FWFBFUklFTkNFLlJFU1VMVC5GQUlMVVJFLFxuICAgICAgY29tcG9uZW50OiBQUk9EVUNUX0VYUEVSSUVOQ0UuQ09NUE9ORU5ULkVYVEVOU0lCTEVfU0lOR0xFXG4gICAgfSk7XG4gICAgdGhpcy5lcnJvck1lc3NhZ2UgPSBtZXNzYWdlO1xuICB9XG59XG4iLCI8Yzh5LXN0ZXBwZXJcbiAgW2Rpc2FibGVQcm9ncmVzc0J1dHRvbnNdPVwidHJ1ZVwiXG4gIFtkaXNhYmxlRGVmYXVsdEljb25zXT1cInsgZWRpdDogdHJ1ZSwgZG9uZTogZmFsc2UgfVwiXG4gIFtjdXN0b21DbGFzc2VzXT1cIlsnbS00MCcsICdtLXQtOCcsICdtLWItMTYnXVwiXG4+XG4gIDxjZGstc3RlcCAqbmdGb3I9XCJsZXQgc3RlcCBvZiBzdGVwczsgbGV0IGkgPSBpbmRleFwiIFtzdGVwQ29udHJvbF09XCJmb3Jtc1tpXVwiIFtsYWJlbF09XCJsYWJlbHNbaV1cIj5cbiAgICA8Yzh5LWZvcm0tZ3JvdXAgY2xhc3M9XCJmb3JtLWdyb3VwIHAtMjQgcC1iLTAgcC10LTE2XCI+XG4gICAgICA8Zm9ybWx5LWZvcm0gW2Zvcm1dPVwiZm9ybXNbaV1cIiBbZmllbGRzXT1cInN0ZXBcIiBbbW9kZWxdPVwibW9kZWxcIj48L2Zvcm1seS1mb3JtPlxuICAgIDwvYzh5LWZvcm0tZ3JvdXA+XG4gICAgPGM4eS1zdGVwcGVyLWJ1dHRvbnNcbiAgICAgIGNsYXNzPVwic3RpY2t5LWJvdHRvbSBkLWJsb2NrIG1vZGFsLWZvb3RlciBzZXBhcmF0b3ItdG9wIGJnLWNvbXBvbmVudFwiXG4gICAgICAqbmdJZj1cImlzUmVnaXN0cmF0aW9uU3RlcCgpXCJcbiAgICAgIFtzaG93QnV0dG9uc109XCJ7IGNhbmNlbDogdHJ1ZSwgYmFjazogdHJ1ZSwgbmV4dDogdHJ1ZSB9XCJcbiAgICAgIFtsYWJlbHNdPVwieyBuZXh0OiAnUmVnaXN0ZXInIH1cIlxuICAgICAgKG9uQ2FuY2VsKT1cImNsb3NlKClcIlxuICAgICAgKG9uTmV4dCk9XCJzYXZlKClcIlxuICAgICAgW3BlbmRpbmddPVwicGVuZGluZ1N0YXR1c1wiXG4gICAgICBbZGlzYWJsZWRdPVwiZm9ybXNbaV0uaW52YWxpZFwiXG4gICAgPjwvYzh5LXN0ZXBwZXItYnV0dG9ucz5cbiAgICA8Yzh5LXN0ZXBwZXItYnV0dG9uc1xuICAgICAgY2xhc3M9XCJzdGlja3ktYm90dG9tIGQtYmxvY2sgbW9kYWwtZm9vdGVyIHNlcGFyYXRvci10b3AgYmctY29tcG9uZW50XCJcbiAgICAgICpuZ0lmPVwiIWlzUmVnaXN0cmF0aW9uU3RlcCgpXCJcbiAgICAgIFtzaG93QnV0dG9uc109XCJ7IGNhbmNlbDogdHJ1ZSwgYmFjazogaSAhPT0gMCwgbmV4dDogdHJ1ZSB9XCJcbiAgICAgIFtkaXNhYmxlZF09XCJmb3Jtc1tpXS5pbnZhbGlkXCJcbiAgICAgIChvbkNhbmNlbCk9XCJjbG9zZSgpXCJcbiAgICA+PC9jOHktc3RlcHBlci1idXR0b25zPlxuICA8L2Nkay1zdGVwPlxuICA8Y2RrLXN0ZXAgW3N0YXRlXT1cImZpbmFsU3RlcFN0YXR1cygpXCIgbGFiZWw9XCJ7eyAnU3VtbWFyeScgfCB0cmFuc2xhdGUgfX1cIj5cbiAgICA8Yzh5LW9wZXJhdGlvbi1yZXN1bHRcbiAgICAgICpuZ0lmPVwiIWVycm9yTWVzc2FnZTsgZWxzZSBlcnJvckluZm9cIlxuICAgICAgdGV4dD1cInt7IG1lc3NhZ2UgfCB0cmFuc2xhdGUgfX1cIlxuICAgICAgW3NpemVdPVwiODRcIlxuICAgICAgW3ZlcnRpY2FsXT1cInRydWVcIlxuICAgICAgdHlwZT1cInN1Y2Nlc3NcIlxuICAgICAgY2xhc3M9XCJsZWFkXCJcbiAgICAgIGRhdGEtY3k9XCJzdWNjZXNzXCJcbiAgICA+PC9jOHktb3BlcmF0aW9uLXJlc3VsdD5cbiAgICA8bmctdGVtcGxhdGUgI2Vycm9ySW5mbz5cbiAgICAgIDxjOHktb3BlcmF0aW9uLXJlc3VsdFxuICAgICAgICB0ZXh0PVwie3sgZXJyb3JNZXNzYWdlIHwgdHJhbnNsYXRlIH19XCJcbiAgICAgICAgW3NpemVdPVwiODRcIlxuICAgICAgICBbdmVydGljYWxdPVwidHJ1ZVwiXG4gICAgICAgIHR5cGU9XCJlcnJvclwiXG4gICAgICAgIGNsYXNzPVwibGVhZFwiXG4gICAgICAgIGRhdGEtY3k9XCJlcnJvclwiXG4gICAgICA+PC9jOHktb3BlcmF0aW9uLXJlc3VsdD5cbiAgICA8L25nLXRlbXBsYXRlPlxuICAgIDxjOHktc3RlcHBlci1idXR0b25zXG4gICAgICBjbGFzcz1cInN0aWNreS1ib3R0b20gZC1ibG9jayBtb2RhbC1mb290ZXIgc2VwYXJhdG9yLXRvcCBiZy1jb21wb25lbnRcIlxuICAgICAgW3Nob3dCdXR0b25zXT1cInsgY2FuY2VsOiBlcnJvck1lc3NhZ2UsIGJhY2s6IGVycm9yTWVzc2FnZSwgbmV4dDogIWVycm9yTWVzc2FnZSB9XCJcbiAgICAgIFtsYWJlbHNdPVwieyBiYWNrOiAnRml4IGlzc3VlJywgbmV4dDogJ0Nsb3NlJyB9XCJcbiAgICAgIChvbkNhbmNlbCk9XCJjbG9zZSgpXCJcbiAgICAgIChvbk5leHQpPVwiY29tcGxldGUoKVwiXG4gICAgICAob25CYWNrKT1cImdvVG9GaXJzdFN0ZXAoKVwiXG4gICAgPjwvYzh5LXN0ZXBwZXItYnV0dG9ucz5cbiAgPC9jZGstc3RlcD5cbjwvYzh5LXN0ZXBwZXI+XG4iXX0=