import { Component, EventEmitter, Output } from '@angular/core';
import { gettext, SearchFilters } from '@c8y/ngx-components';
import { AssetSearchService } from './search.service';
import * as i0 from "@angular/core";
import * as i1 from "./search.service";
import * as i2 from "@angular/common";
import * as i3 from "@c8y/ngx-components";
export class SearchCustomFiltersComponent {
    constructor(assetSearchService) {
        this.assetSearchService = assetSearchService;
        this.customDataQuery = new EventEmitter();
        this.refresh = new EventEmitter();
        this.checkboxesState = [
            {
                label: gettext('All'),
                name: SearchFilters.ALL_FILTERS,
                value: true,
                indeterminate: false,
                isDisabled: true
            },
            { label: gettext('Show only devices'), name: SearchFilters.ONLY_DEVICES, value: true },
            {
                label: gettext('Show only groups and assets'),
                name: SearchFilters.ONLY_GROUPS_AND_ASSETS,
                value: true
            }
        ];
    }
    ngOnInit() {
        this.customDataQuery.next(this.assetSearchService.getGlobalSearchData);
    }
    onCheckboxChange(event, checkbox) {
        const { checked } = event.target;
        if (checked == undefined) {
            return;
        }
        switch (checkbox.name) {
            case SearchFilters.ALL_FILTERS:
                this.onSelectAll(checkbox, checked);
                break;
            case SearchFilters.ONLY_DEVICES:
                this.onAllDevices(checkbox, checked);
                break;
            case SearchFilters.ONLY_GROUPS_AND_ASSETS:
                this.onGroupsAndAssets(checkbox, checked);
                break;
        }
        // Handle allFilters checkbox when ONLY_GROUPS_AND_ASSETS and ONLY_DEVICES are selected
        if (this.getCheckbox(SearchFilters.ONLY_DEVICES).value &&
            this.getCheckbox(SearchFilters.ONLY_GROUPS_AND_ASSETS).value) {
            Object.assign(this.getCheckbox(SearchFilters.ALL_FILTERS), {
                indeterminate: false,
                isDisabled: true,
                value: true
            });
        }
        this.assetSearchService.appliedFilters$.next({
            [SearchFilters.ALL_FILTERS]: this.getCheckbox(SearchFilters.ALL_FILTERS).value,
            [SearchFilters.ONLY_DEVICES]: this.getCheckbox(SearchFilters.ONLY_DEVICES).value,
            [SearchFilters.ONLY_GROUPS_AND_ASSETS]: this.getCheckbox(SearchFilters.ONLY_GROUPS_AND_ASSETS)
                .value
        });
        this.refresh.next(null);
    }
    saveCheckboxValue(checkbox, value) {
        checkbox.value = value;
    }
    onSelectAll(currentCheckbox, checked) {
        // Block unchecked state
        if (checked) {
            this.saveCheckboxValue(currentCheckbox, checked);
        }
        this.getCheckbox(SearchFilters.ALL_FILTERS).isDisabled = true;
        this.getCheckbox(SearchFilters.ONLY_DEVICES).value = true;
        this.getCheckbox(SearchFilters.ONLY_GROUPS_AND_ASSETS).value = true;
    }
    onAllDevices(currentCheckbox, checked) {
        this.saveCheckboxValue(currentCheckbox, checked);
        Object.assign(this.getCheckbox(SearchFilters.ALL_FILTERS), {
            indeterminate: true,
            isDisabled: false,
            value: null
        });
        this.getCheckbox(SearchFilters.ONLY_GROUPS_AND_ASSETS).value = true;
    }
    onGroupsAndAssets(currentCheckbox, checked) {
        this.saveCheckboxValue(currentCheckbox, checked);
        Object.assign(this.getCheckbox(SearchFilters.ALL_FILTERS), {
            indeterminate: true,
            isDisabled: false,
            value: null
        });
        this.getCheckbox(SearchFilters.ONLY_DEVICES).value = true;
    }
    getCheckbox(checkboxName) {
        return this.checkboxesState.find(checkbox => checkbox.name === checkboxName);
    }
}
SearchCustomFiltersComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: SearchCustomFiltersComponent, deps: [{ token: i1.AssetSearchService }], target: i0.ɵɵFactoryTarget.Component });
SearchCustomFiltersComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.7", type: SearchCustomFiltersComponent, selector: "c8y-search-custom-filters", outputs: { customDataQuery: "customDataQuery", refresh: "refresh" }, ngImport: i0, template: "<label class=\"c8y-checkbox\" *ngFor=\"let checkbox of checkboxesState\">\n  <input\n    type=\"checkbox\"\n    [checked]=\"checkbox.value\"\n    [indeterminate]=\"checkbox.indeterminate\"\n    (click)=\"onCheckboxChange($event, checkbox)\"\n    [attr.disabled]=\"checkbox.isDisabled ? true : null\"\n  />\n  <span></span>\n  <span>{{ checkbox.label | translate }}</span>\n</label>\n", dependencies: [{ kind: "directive", type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "pipe", type: i3.C8yTranslatePipe, name: "translate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: SearchCustomFiltersComponent, decorators: [{
            type: Component,
            args: [{ selector: 'c8y-search-custom-filters', template: "<label class=\"c8y-checkbox\" *ngFor=\"let checkbox of checkboxesState\">\n  <input\n    type=\"checkbox\"\n    [checked]=\"checkbox.value\"\n    [indeterminate]=\"checkbox.indeterminate\"\n    (click)=\"onCheckboxChange($event, checkbox)\"\n    [attr.disabled]=\"checkbox.isDisabled ? true : null\"\n  />\n  <span></span>\n  <span>{{ checkbox.label | translate }}</span>\n</label>\n" }]
        }], ctorParameters: function () { return [{ type: i1.AssetSearchService }]; }, propDecorators: { customDataQuery: [{
                type: Output
            }], refresh: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLWN1c3RvbS1maWx0ZXJzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NlYXJjaC9zZWFyY2gtY3VzdG9tLWZpbHRlcnMuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vc2VhcmNoL3NlYXJjaC1jdXN0b20tZmlsdGVycy5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBVSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDeEUsT0FBTyxFQUFFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQzs7Ozs7QUFjdEQsTUFBTSxPQUFPLDRCQUE0QjtJQW1CdkMsWUFBb0Isa0JBQXNDO1FBQXRDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7UUFsQmhELG9CQUFlLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNyQyxZQUFPLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUV2QyxvQkFBZSxHQUFvQjtZQUNqQztnQkFDRSxLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUssQ0FBQztnQkFDckIsSUFBSSxFQUFFLGFBQWEsQ0FBQyxXQUFXO2dCQUMvQixLQUFLLEVBQUUsSUFBSTtnQkFDWCxhQUFhLEVBQUUsS0FBSztnQkFDcEIsVUFBVSxFQUFFLElBQUk7YUFDakI7WUFDRCxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsbUJBQW1CLENBQUMsRUFBRSxJQUFJLEVBQUUsYUFBYSxDQUFDLFlBQVksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFO1lBQ3RGO2dCQUNFLEtBQUssRUFBRSxPQUFPLENBQUMsNkJBQTZCLENBQUM7Z0JBQzdDLElBQUksRUFBRSxhQUFhLENBQUMsc0JBQXNCO2dCQUMxQyxLQUFLLEVBQUUsSUFBSTthQUNaO1NBQ0YsQ0FB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VyxDQUFDLEVBQUU7WUFDekQsYUFBYSxFQUFFLElBQUk7WUFDbkIsVUFBVSxFQUFFLEtBQUs7WUFDakIsS0FBSyxFQUFFLElBQUk7U0FDWixDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7SUFDdEUsQ0FBQztJQUVPLGlCQUFpQixDQUFDLGVBQXlCLEVBQUUsT0FBZ0I7UUFDbkUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGVBQWUsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUVqRCxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxFQUFFO1lBQ3pELGFBQWEsRUFBRSxJQUFJO1lBQ25CLFVBQVUsRUFBRSxLQUFLO1lBQ2pCLEtBQUssRUFBRSxJQUFJO1NBQ1osQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztJQUM1RCxDQUFDO0lBRU8sV0FBVyxDQUFDLFlBQTJCO1FBQzdDLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxLQUFLLFlBQVksQ0FBQyxDQUFDO0lBQy9FLENBQUM7O3lIQXpHVSw0QkFBNEI7NkdBQTVCLDRCQUE0QixzSUNoQnpDLGlZQVdBOzJGREthLDRCQUE0QjtrQkFKeEMsU0FBUzsrQkFDRSwyQkFBMkI7eUdBSTNCLGVBQWU7c0JBQXhCLE1BQU07Z0JBQ0csT0FBTztzQkFBaEIsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBPbkluaXQsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgZ2V0dGV4dCwgU2VhcmNoRmlsdGVycyB9IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMnO1xuaW1wb3J0IHsgQXNzZXRTZWFyY2hTZXJ2aWNlIH0gZnJvbSAnLi9zZWFyY2guc2VydmljZSc7XG5cbmV4cG9ydCB0eXBlIENoZWNrYm94ID0ge1xuICBsYWJlbDogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIHZhbHVlOiBib29sZWFuO1xuICBpbmRldGVybWluYXRlPzogYm9vbGVhbjtcbiAgaXNEaXNhYmxlZD86IGJvb2xlYW47XG59O1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjOHktc2VhcmNoLWN1c3RvbS1maWx0ZXJzJyxcbiAgdGVtcGxhdGVVcmw6ICdzZWFyY2gtY3VzdG9tLWZpbHRlcnMuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFNlYXJjaEN1c3RvbUZpbHRlcnNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBAT3V0cHV0KCkgY3VzdG9tRGF0YVF1ZXJ5ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgcmVmcmVzaCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBjaGVja2JveGVzU3RhdGU6IEFycmF5PENoZWNrYm94PiA9IFtcbiAgICB7XG4gICAgICBsYWJlbDogZ2V0dGV4dCgnQWxsJyksXG4gICAgICBuYW1lOiBTZWFyY2hGaWx0ZXJzLkFMTF9GSUxURVJTLFxuICAgICAgdmFsdWU6IHRydWUsXG4gICAgICBpbmRldGVybWluYXRlOiBmYWxzZSxcbiAgICAgIGlzRGlzYWJsZWQ6IHRydWVcbiAgICB9LFxuICAgIHsgbGFiZWw6IGdldHRleHQoJ1Nob3cgb25seSBkZXZpY2VzJyksIG5hbWU6IFNlYXJjaEZpbHRlcnMuT05MWV9ERVZJQ0VTLCB2YWx1ZTogdHJ1ZSB9LFxuICAgIHtcbiAgICAgIGxhYmVsOiBnZXR0ZXh0KCdTaG93IG9ubHkgZ3JvdXBzIGFuZCBhc3NldHMnKSxcbiAgICAgIG5hbWU6IFNlYXJjaEZpbHRlcnMuT05MWV9HUk9VUFNfQU5EX0FTU0VUUyxcbiAgICAgIHZhbHVlOiB0cnVlXG4gICAgfVxuICBdO1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGFzc2V0U2VhcmNoU2VydmljZTogQXNzZXRTZWFyY2hTZXJ2aWNlKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuY3VzdG9tRGF0YVF1ZXJ5Lm5leHQodGhpcy5hc3NldFNlYXJjaFNlcnZpY2UuZ2V0R2xvYmFsU2VhcmNoRGF0YSk7XG4gIH1cblxuICBvbkNoZWNrYm94Q2hhbmdlKGV2ZW50OiBFdmVudCwgY2hlY2tib3g6IENoZWNrYm94KTogdm9pZCB7XG4gICAgY29uc3QgeyBjaGVja2VkIH0gPSBldmVudC50YXJnZXQgYXMgSFRNTElucHV0RWxlbWVudDtcblxuICAgIGlmIChjaGVja2VkID09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHN3aXRjaCAoY2hlY2tib3gubmFtZSkge1xuICAgICAgY2FzZSBTZWFyY2hGaWx0ZXJzLkFMTF9GSUxURVJTOlxuICAgICAgICB0aGlzLm9uU2VsZWN0QWxsKGNoZWNrYm94LCBjaGVja2VkKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFNlYXJjaEZpbHRlcnMuT05MWV9ERVZJQ0VTOlxuICAgICAgICB0aGlzLm9uQWxsRGV2aWNlcyhjaGVja2JveCwgY2hlY2tlZCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBTZWFyY2hGaWx0ZXJzLk9OTFlfR1JPVVBTX0FORF9BU1NFVFM6XG4gICAgICAgIHRoaXMub25Hcm91cHNBbmRBc3NldHMoY2hlY2tib3gsIGNoZWNrZWQpO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICAvLyBIYW5kbGUgYWxsRmlsdGVycyBjaGVja2JveCB3aGVuIE9OTFlfR1JPVVBTX0FORF9BU1NFVFMgYW5kIE9OTFlfREVWSUNFUyBhcmUgc2VsZWN0ZWRcbiAgICBpZiAoXG4gICAgICB0aGlzLmdldENoZWNrYm94KFNlYXJjaEZpbHRlcnMuT05MWV9ERVZJQ0VTKS52YWx1ZSAmJlxuICAgICAgdGhpcy5nZXRDaGVja2JveChTZWFyY2hGaWx0ZXJzLk9OTFlfR1JPVVBTX0FORF9BU1NFVFMpLnZhbHVlXG4gICAgKSB7XG4gICAgICBPYmplY3QuYXNzaWduKHRoaXMuZ2V0Q2hlY2tib3goU2VhcmNoRmlsdGVycy5BTExfRklMVEVSUyksIHtcbiAgICAgICAgaW5kZXRlcm1pbmF0ZTogZmFsc2UsXG4gICAgICAgIGlzRGlzYWJsZWQ6IHRydWUsXG4gICAgICAgIHZhbHVlOiB0cnVlXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB0aGlzLmFzc2V0U2VhcmNoU2VydmljZS5hcHBsaWVkRmlsdGVycyQubmV4dCh7XG4gICAgICBbU2VhcmNoRmlsdGVycy5BTExfRklMVEVSU106IHRoaXMuZ2V0Q2hlY2tib3goU2VhcmNoRmlsdGVycy5BTExfRklMVEVSUykudmFsdWUsXG4gICAgICBbU2VhcmNoRmlsdGVycy5PTkxZX0RFVklDRVNdOiB0aGlzLmdldENoZWNrYm94KFNlYXJjaEZpbHRlcnMuT05MWV9ERVZJQ0VTKS52YWx1ZSxcbiAgICAgIFtTZWFyY2hGaWx0ZXJzLk9OTFlfR1JPVVBTX0FORF9BU1NFVFNdOiB0aGlzLmdldENoZWNrYm94KFNlYXJjaEZpbHRlcnMuT05MWV9HUk9VUFNfQU5EX0FTU0VUUylcbiAgICAgICAgLnZhbHVlXG4gICAgfSk7XG4gICAgdGhpcy5yZWZyZXNoLm5leHQobnVsbCk7XG4gIH1cblxuICBwcml2YXRlIHNhdmVDaGVja2JveFZhbHVlKGNoZWNrYm94LCB2YWx1ZSkge1xuICAgIGNoZWNrYm94LnZhbHVlID0gdmFsdWU7XG4gIH1cblxuICBwcml2YXRlIG9uU2VsZWN0QWxsKGN1cnJlbnRDaGVja2JveDogQ2hlY2tib3gsIGNoZWNrZWQ6IGJvb2xlYW4pIHtcbiAgICAvLyBCbG9jayB1bmNoZWNrZWQgc3RhdGVcbiAgICBpZiAoY2hlY2tlZCkge1xuICAgICAgdGhpcy5zYXZlQ2hlY2tib3hWYWx1ZShjdXJyZW50Q2hlY2tib3gsIGNoZWNrZWQpO1xuICAgIH1cbiAgICB0aGlzLmdldENoZWNrYm94KFNlYXJjaEZpbHRlcnMuQUxMX0ZJTFRFUlMpLmlzRGlzYWJsZWQgPSB0cnVlO1xuICAgIHRoaXMuZ2V0Q2hlY2tib3goU2VhcmNoRmlsdGVycy5PTkxZX0RFVklDRVMpLnZhbHVlID0gdHJ1ZTtcbiAgICB0aGlzLmdldENoZWNrYm94KFNlYXJjaEZpbHRlcnMuT05MWV9HUk9VUFNfQU5EX0FTU0VUUykudmFsdWUgPSB0cnVlO1xuICB9XG5cbiAgcHJpdmF0ZSBvbkFsbERldmljZXMoY3VycmVudENoZWNrYm94OiBDaGVja2JveCwgY2hlY2tlZDogYm9vbGVhbikge1xuICAgIHRoaXMuc2F2ZUNoZWNrYm94VmFsdWUoY3VycmVudENoZWNrYm94LCBjaGVja2VkKTtcblxuICAgIE9iamVjdC5hc3NpZ24odGhpcy5nZXRDaGVja2JveChTZWFyY2hGaWx0ZXJzLkFMTF9GSUxURVJTKSwge1xuICAgICAgaW5kZXRlcm1pbmF0ZTogdHJ1ZSxcbiAgICAgIGlzRGlzYWJsZWQ6IGZhbHNlLFxuICAgICAgdmFsdWU6IG51bGxcbiAgICB9KTtcblxuICAgIHRoaXMuZ2V0Q2hlY2tib3goU2VhcmNoRmlsdGVycy5PTkxZX0dST1VQU19BTkRfQVNTRVRTKS52YWx1ZSA9IHRydWU7XG4gIH1cblxuICBwcml2YXRlIG9uR3JvdXBzQW5kQXNzZXRzKGN1cnJlbnRDaGVja2JveDogQ2hlY2tib3gsIGNoZWNrZWQ6IGJvb2xlYW4pIHtcbiAgICB0aGlzLnNhdmVDaGVja2JveFZhbHVlKGN1cnJlbnRDaGVja2JveCwgY2hlY2tlZCk7XG5cbiAgICBPYmplY3QuYXNzaWduKHRoaXMuZ2V0Q2hlY2tib3goU2VhcmNoRmlsdGVycy5BTExfRklMVEVSUyksIHtcbiAgICAgIGluZGV0ZXJtaW5hdGU6IHRydWUsXG4gICAgICBpc0Rpc2FibGVkOiBmYWxzZSxcbiAgICAgIHZhbHVlOiBudWxsXG4gICAgfSk7XG5cbiAgICB0aGlzLmdldENoZWNrYm94KFNlYXJjaEZpbHRlcnMuT05MWV9ERVZJQ0VTKS52YWx1ZSA9IHRydWU7XG4gIH1cblxuICBwcml2YXRlIGdldENoZWNrYm94KGNoZWNrYm94TmFtZTogU2VhcmNoRmlsdGVycyk6IENoZWNrYm94IHtcbiAgICByZXR1cm4gdGhpcy5jaGVja2JveGVzU3RhdGUuZmluZChjaGVja2JveCA9PiBjaGVja2JveC5uYW1lID09PSBjaGVja2JveE5hbWUpO1xuICB9XG59XG4iLCI8bGFiZWwgY2xhc3M9XCJjOHktY2hlY2tib3hcIiAqbmdGb3I9XCJsZXQgY2hlY2tib3ggb2YgY2hlY2tib3hlc1N0YXRlXCI+XG4gIDxpbnB1dFxuICAgIHR5cGU9XCJjaGVja2JveFwiXG4gICAgW2NoZWNrZWRdPVwiY2hlY2tib3gudmFsdWVcIlxuICAgIFtpbmRldGVybWluYXRlXT1cImNoZWNrYm94LmluZGV0ZXJtaW5hdGVcIlxuICAgIChjbGljayk9XCJvbkNoZWNrYm94Q2hhbmdlKCRldmVudCwgY2hlY2tib3gpXCJcbiAgICBbYXR0ci5kaXNhYmxlZF09XCJjaGVja2JveC5pc0Rpc2FibGVkID8gdHJ1ZSA6IG51bGxcIlxuICAvPlxuICA8c3Bhbj48L3NwYW4+XG4gIDxzcGFuPnt7IGNoZWNrYm94LmxhYmVsIHwgdHJhbnNsYXRlIH19PC9zcGFuPlxuPC9sYWJlbD5cbiJdfQ==