import { Component } from '@angular/core';
import { ActivatedRoute } from '@angular/router';
import { OperationService } from '@c8y/client';
import { AlertService, gettext, ManagedObjectRealtimeService, OperationRealtimeService } from '@c8y/ngx-components';
import { includes, isEmpty } from 'lodash-es';
import { BsModalService } from 'ngx-bootstrap/modal';
import { BehaviorSubject, of, pipe, Subject } from 'rxjs';
import { filter, map, startWith, takeUntil } from 'rxjs/operators';
import { CommandTemplatesComponent } from '../command-templates';
import { CommandDeliveryType, DeviceShellService } from '../shared';
import * as i0 from "@angular/core";
import * as i1 from "../shared";
import * as i2 from "@c8y/ngx-components";
import * as i3 from "@c8y/client";
import * as i4 from "@angular/router";
import * as i5 from "ngx-bootstrap/modal";
import * as i6 from "@angular/common";
import * as i7 from "@angular/forms";
import * as i8 from "@c8y/ngx-components/operations/operations-timeline";
export class DeviceShellComponent {
    constructor(service, operationRealtime, moRealtime, operationService, route, modalService, alertService) {
        this.service = service;
        this.operationRealtime = operationRealtime;
        this.moRealtime = moRealtime;
        this.operationService = operationService;
        this.route = route;
        this.modalService = modalService;
        this.alertService = alertService;
        this.device = this.route.snapshot.parent.data.contextData;
        this.device$ = of({});
        this.deliveryTypes = (this.service.getDeliveryTypes() || []).map(deliveryType => ({ ...deliveryType, isSupportedByCommand: true }));
        this.command = {};
        this.smsEnabled = false;
        this.sendingCommand$ = new BehaviorSubject(false);
        this.filterPipe = pipe(map((operations) => (operations || []).filter((operation) => !!operation.c8y_Command)));
        this.executeViaLabel = gettext('Execute via ({{deliveryType}})');
        this.destroyed$ = new Subject();
    }
    async ngOnInit() {
        this.smsEnabled = await this.service.canSendCommandsViaSMS();
        this.device$ = this.moRealtime.onUpdate$(this.device.id).pipe(startWith(this.device));
        this.operations = await this.operationService.list({
            deviceId: this.device.id,
            fragmentType: 'c8y_Command',
            dateFrom: new Date(0).toISOString(),
            dateTo: new Date().toISOString(),
            pageSize: 50,
            withTotalPages: true,
            revert: true
        });
        this.operationRealtime
            .onCreate$(this.device.id)
            .pipe(takeUntil(this.destroyed$))
            .subscribe(() => this.alertService.success(gettext('Command sent.')));
        this.operationRealtime
            .onUpdate$(this.device.id)
            .pipe(filter(op => op.failureReason !== 'Operation cancelled by user.'), // avoid duplicate alerts
        takeUntil(this.destroyed$))
            .subscribe(() => this.alertService.success(gettext('Command status updated.')));
    }
    getPredefinedCommand() {
        const modal = this.modalService.show(CommandTemplatesComponent, {
            ariaDescribedby: 'modal-body',
            ariaLabelledBy: 'modal-title'
        });
        modal.content.onTemplateSelected.pipe(takeUntil(this.destroyed$)).subscribe(result => {
            this.command = { ...result.commandTemplate };
            this.deliveryTypes = this.deliveryTypes.map(deliveryType => ({
                ...deliveryType,
                isSupportedByCommand: isEmpty(this.command.deliveryTypes) ||
                    includes(this.command.deliveryTypes, deliveryType.name)
            }));
        });
    }
    resetSupportedDeliveryTypes() {
        this.deliveryTypes = (this.service.getDeliveryTypes() || []).map(deliveryType => ({
            ...deliveryType,
            isSupportedByCommand: true
        }));
    }
    async execute(commandDeliveryType) {
        const useSMS = commandDeliveryType === CommandDeliveryType.SMS;
        if (useSMS && !this.smsEnabled) {
            this.alertService.warning(gettext('SMS transport is not configured.'));
            return;
        }
        this.sendingCommand$.next(true);
        await this.service.createCommandOperation(this.device.id, this.command, commandDeliveryType);
        this.command.text = '';
        this.command.name = '';
        this.resetSupportedDeliveryTypes();
        this.sendingCommand$.next(false);
    }
    ngOnDestroy() {
        this.destroyed$.next();
        this.destroyed$.complete();
    }
}
DeviceShellComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: DeviceShellComponent, deps: [{ token: i1.DeviceShellService }, { token: i2.OperationRealtimeService }, { token: i2.ManagedObjectRealtimeService }, { token: i3.OperationService }, { token: i4.ActivatedRoute }, { token: i5.BsModalService }, { token: i2.AlertService }], target: i0.ɵɵFactoryTarget.Component });
DeviceShellComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.7", type: DeviceShellComponent, selector: "c8y-device-shell", providers: [OperationRealtimeService, ManagedObjectRealtimeService], ngImport: i0, template: "<c8y-action-bar-item [placement]=\"'right'\">\n  <c8y-realtime-btn [service]=\"operationRealtime\"></c8y-realtime-btn>\n</c8y-action-bar-item>\n\n<div class=\"card content-fullpage d-grid grid__col--6-6--md\">\n  <div class=\"inner-scroll d-flex d-col bg-level-0\">\n    <div class=\"card-header large-padding separator sticky-top\">\n      <div class=\"card-title\">\n        {{ 'Command' | translate }}\n      </div>\n    </div>\n\n    <div class=\"card-block d-flex d-col flex-grow large-padding\">\n      <div class=\"d-flex p-b-16\">\n        <button\n          class=\"btn btn-default btn-sm\"\n          type=\"button\"\n          (click)=\"getPredefinedCommand()\"\n          [title]=\"'Display a list of predefined commands' | translate\"\n          data-cy=\"shell--predefined-commands\"\n        >\n          {{ 'Predefined commands' | translate }}\n        </button>\n\n        <div class=\"m-l-auto\">\n          <device-status [mo]=\"device$ | async\"></device-status>\n        </div>\n      </div>\n      <textarea\n        [attr.aria-label]=\"'Commands' | translate\"\n        class=\"form-control inner-scroll flex-grow bg-level-2 text-monospace\"\n        [(ngModel)]=\"command.text\"\n        data-cy=\"shell-component--commands\"\n        (ngModelChange)=\"$event || resetSupportedDeliveryTypes()\"\n        placeholder=\"{{ 'Add commands or use predefined commands above.' | translate }}\"\n      ></textarea>\n    </div>\n\n    <div class=\"card-footer large-padding separator\">\n      <ng-container *ngFor=\"let deliveryType of deliveryTypes\">\n        <button\n          class=\"btn btn-primary\"\n          type=\"button\"\n          *ngIf=\"deliveryType.isSupportedByCommand\"\n          [disabled]=\"!command?.text || (sendingCommand$ | async)\"\n          (click)=\"execute(deliveryType.name)\"\n        >\n          <span\n            [title]=\"\n              deliveryType.default\n                ? ('Execute' | translate)\n                : (executeViaLabel | translate: { deliveryType: deliveryType.name })\n            \"\n          >\n            {{\n              deliveryType.default\n                ? ('Execute' | translate)\n                : (executeViaLabel | translate: { deliveryType: deliveryType.name })\n            }}\n          </span>\n        </button>\n      </ng-container>\n    </div>\n  </div>\n  <div class=\"inner-scroll bg-level-1\">\n    <div class=\"card-header large-padding separator sticky-top\">\n      <div class=\"card-title\">\n        {{ 'Operations' | translate }}\n      </div>\n    </div>\n    <div class=\"card-block large-padding\">\n      <c8y-operations-timeline\n        [operations]=\"operations\"\n        [sourceId]=\"device.id\"\n        [filterPipe]=\"filterPipe\"\n        [bodyTemplate]=\"timelineItemBody\"\n        [footerTemplates]=\"[timelineItemFooter]\"\n        [propertiesToHide]=\"['c8y_Command']\"\n      ></c8y-operations-timeline>\n      <ng-template #timelineItemBody let-operation>\n        <small>{{ operation.c8y_Command?.text || operation.description }}</small>\n      </ng-template>\n      <ng-template #timelineItemFooter let-operation>\n        <div *ngIf=\"operation.c8y_Command?.text\">\n          <div class=\"legend form-block\" translate>Command</div>\n          <pre class=\"p-8 text-pre-normal\">\n              <code>{{operation.c8y_Command.text}}</code>\n          </pre>\n        </div>\n        <div *ngIf=\"operation.c8y_Command?.result\">\n          <div class=\"legend form-block\" translate>Response</div>\n          <pre class=\"p-8 text-pre-normal\">\n              <code>{{operation.c8y_Command.result}}</code>\n          </pre>\n        </div>\n      </ng-template>\n    </div>\n  </div>\n</div>\n", dependencies: [{ kind: "directive", type: i6.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i6.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i2.ActionBarItemComponent, selector: "c8y-action-bar-item", inputs: ["placement", "priority", "itemClass", "injector", "groupId"] }, { kind: "directive", type: i2.C8yTranslateDirective, selector: "[translate],[ngx-translate]" }, { kind: "directive", type: i7.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i7.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i7.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "component", type: i2.DeviceStatusComponent, selector: "device-status", inputs: ["mo"] }, { kind: "component", type: i2.RealtimeButtonComponent, selector: "c8y-realtime-btn", inputs: ["service", "label", "title"] }, { kind: "component", type: i8.OperationsTimelineComponent, selector: "c8y-operations-timeline", inputs: ["operations", "sourceId", "filterPipe", "bodyTemplate", "footerTemplates", "propertiesToHide"] }, { kind: "pipe", type: i6.AsyncPipe, name: "async" }, { kind: "pipe", type: i2.C8yTranslatePipe, name: "translate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: DeviceShellComponent, decorators: [{
            type: Component,
            args: [{ selector: 'c8y-device-shell', providers: [OperationRealtimeService, ManagedObjectRealtimeService], template: "<c8y-action-bar-item [placement]=\"'right'\">\n  <c8y-realtime-btn [service]=\"operationRealtime\"></c8y-realtime-btn>\n</c8y-action-bar-item>\n\n<div class=\"card content-fullpage d-grid grid__col--6-6--md\">\n  <div class=\"inner-scroll d-flex d-col bg-level-0\">\n    <div class=\"card-header large-padding separator sticky-top\">\n      <div class=\"card-title\">\n        {{ 'Command' | translate }}\n      </div>\n    </div>\n\n    <div class=\"card-block d-flex d-col flex-grow large-padding\">\n      <div class=\"d-flex p-b-16\">\n        <button\n          class=\"btn btn-default btn-sm\"\n          type=\"button\"\n          (click)=\"getPredefinedCommand()\"\n          [title]=\"'Display a list of predefined commands' | translate\"\n          data-cy=\"shell--predefined-commands\"\n        >\n          {{ 'Predefined commands' | translate }}\n        </button>\n\n        <div class=\"m-l-auto\">\n          <device-status [mo]=\"device$ | async\"></device-status>\n        </div>\n      </div>\n      <textarea\n        [attr.aria-label]=\"'Commands' | translate\"\n        class=\"form-control inner-scroll flex-grow bg-level-2 text-monospace\"\n        [(ngModel)]=\"command.text\"\n        data-cy=\"shell-component--commands\"\n        (ngModelChange)=\"$event || resetSupportedDeliveryTypes()\"\n        placeholder=\"{{ 'Add commands or use predefined commands above.' | translate }}\"\n      ></textarea>\n    </div>\n\n    <div class=\"card-footer large-padding separator\">\n      <ng-container *ngFor=\"let deliveryType of deliveryTypes\">\n        <button\n          class=\"btn btn-primary\"\n          type=\"button\"\n          *ngIf=\"deliveryType.isSupportedByCommand\"\n          [disabled]=\"!command?.text || (sendingCommand$ | async)\"\n          (click)=\"execute(deliveryType.name)\"\n        >\n          <span\n            [title]=\"\n              deliveryType.default\n                ? ('Execute' | translate)\n                : (executeViaLabel | translate: { deliveryType: deliveryType.name })\n            \"\n          >\n            {{\n              deliveryType.default\n                ? ('Execute' | translate)\n                : (executeViaLabel | translate: { deliveryType: deliveryType.name })\n            }}\n          </span>\n        </button>\n      </ng-container>\n    </div>\n  </div>\n  <div class=\"inner-scroll bg-level-1\">\n    <div class=\"card-header large-padding separator sticky-top\">\n      <div class=\"card-title\">\n        {{ 'Operations' | translate }}\n      </div>\n    </div>\n    <div class=\"card-block large-padding\">\n      <c8y-operations-timeline\n        [operations]=\"operations\"\n        [sourceId]=\"device.id\"\n        [filterPipe]=\"filterPipe\"\n        [bodyTemplate]=\"timelineItemBody\"\n        [footerTemplates]=\"[timelineItemFooter]\"\n        [propertiesToHide]=\"['c8y_Command']\"\n      ></c8y-operations-timeline>\n      <ng-template #timelineItemBody let-operation>\n        <small>{{ operation.c8y_Command?.text || operation.description }}</small>\n      </ng-template>\n      <ng-template #timelineItemFooter let-operation>\n        <div *ngIf=\"operation.c8y_Command?.text\">\n          <div class=\"legend form-block\" translate>Command</div>\n          <pre class=\"p-8 text-pre-normal\">\n              <code>{{operation.c8y_Command.text}}</code>\n          </pre>\n        </div>\n        <div *ngIf=\"operation.c8y_Command?.result\">\n          <div class=\"legend form-block\" translate>Response</div>\n          <pre class=\"p-8 text-pre-normal\">\n              <code>{{operation.c8y_Command.result}}</code>\n          </pre>\n        </div>\n      </ng-template>\n    </div>\n  </div>\n</div>\n" }]
        }], ctorParameters: function () { return [{ type: i1.DeviceShellService }, { type: i2.OperationRealtimeService }, { type: i2.ManagedObjectRealtimeService }, { type: i3.OperationService }, { type: i4.ActivatedRoute }, { type: i5.BsModalService }, { type: i2.AlertService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hlbGwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vZGV2aWNlLXNoZWxsL3NoZWxsL3NoZWxsLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uL2RldmljZS1zaGVsbC9zaGVsbC9zaGVsbC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFxQixNQUFNLGVBQWUsQ0FBQztBQUM3RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDakQsT0FBTyxFQUEyQyxnQkFBZ0IsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUN4RixPQUFPLEVBQ0wsWUFBWSxFQUNaLE9BQU8sRUFDUCw0QkFBNEIsRUFDNUIsd0JBQXdCLEVBQ3pCLE1BQU0scUJBQXFCLENBQUM7QUFDN0IsT0FBTyxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDOUMsT0FBTyxFQUFjLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxlQUFlLEVBQWMsRUFBRSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdEUsT0FBTyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ25FLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2pFLE9BQU8sRUFBVyxtQkFBbUIsRUFBZ0Isa0JBQWtCLEVBQUUsTUFBTSxXQUFXLENBQUM7Ozs7Ozs7Ozs7QUFPM0YsTUFBTSxPQUFPLG9CQUFvQjtJQW9CL0IsWUFDUyxPQUEyQixFQUMzQixpQkFBMkMsRUFDMUMsVUFBd0MsRUFDeEMsZ0JBQWtDLEVBQ2xDLEtBQXFCLEVBQ3JCLFlBQTRCLEVBQzVCLFlBQTBCO1FBTjNCLFlBQU8sR0FBUCxPQUFPLENBQW9CO1FBQzNC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QUFNLE1BQU0sR0FBRyxtQkFBbUIsS0FBSyxtQkFBbUIsQ0FBQyxHQUFHLENBQUM7UUFDL0QsSUFBSSxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQzlCLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDLENBQUM7WUFDdkUsT0FBTztTQUNSO1FBQ0QsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFaEMsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztRQUU3RixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksR0FBRyxFQUFFLENBQUM7UUFDdkIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ3ZCLElBQUksQ0FBQywyQkFBMkIsRUFBRSxDQUFDO1FBQ25DLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ25DLENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUN2QixJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQzdCLENBQUM7O2lIQXhHVSxvQkFBb0I7cUdBQXBCLG9CQUFvQiwyQ0FGcEIsQ0FBQyx3QkFBd0IsRUFBRSw0QkFBNEIsQ0FBQywwQkNuQnJFLDJvSEFtR0E7MkZEOUVhLG9CQUFvQjtrQkFMaEMsU0FBUzsrQkFDRSxrQkFBa0IsYUFFakIsQ0FBQyx3QkFBd0IsRUFBRSw0QkFBNEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25EZXN0cm95LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IElNYW5hZ2VkT2JqZWN0LCBJT3BlcmF0aW9uLCBJUmVzdWx0TGlzdCwgT3BlcmF0aW9uU2VydmljZSB9IGZyb20gJ0BjOHkvY2xpZW50JztcbmltcG9ydCB7XG4gIEFsZXJ0U2VydmljZSxcbiAgZ2V0dGV4dCxcbiAgTWFuYWdlZE9iamVjdFJlYWx0aW1lU2VydmljZSxcbiAgT3BlcmF0aW9uUmVhbHRpbWVTZXJ2aWNlXG59IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMnO1xuaW1wb3J0IHsgaW5jbHVkZXMsIGlzRW1wdHkgfSBmcm9tICdsb2Rhc2gtZXMnO1xuaW1wb3J0IHsgQnNNb2RhbFJlZiwgQnNNb2RhbFNlcnZpY2UgfSBmcm9tICduZ3gtYm9vdHN0cmFwL21vZGFsJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZSwgb2YsIHBpcGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGZpbHRlciwgbWFwLCBzdGFydFdpdGgsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IENvbW1hbmRUZW1wbGF0ZXNDb21wb25lbnQgfSBmcm9tICcuLi9jb21tYW5kLXRlbXBsYXRlcyc7XG5pbXBvcnQgeyBDb21tYW5kLCBDb21tYW5kRGVsaXZlcnlUeXBlLCBEZWxpdmVyeVR5cGUsIERldmljZVNoZWxsU2VydmljZSB9IGZyb20gJy4uL3NoYXJlZCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS1kZXZpY2Utc2hlbGwnLFxuICB0ZW1wbGF0ZVVybDogJ3NoZWxsLmNvbXBvbmVudC5odG1sJyxcbiAgcHJvdmlkZXJzOiBbT3BlcmF0aW9uUmVhbHRpbWVTZXJ2aWNlLCBNYW5hZ2VkT2JqZWN0UmVhbHRpbWVTZXJ2aWNlXVxufSlcbmV4cG9ydCBjbGFzcyBEZXZpY2VTaGVsbENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgZGV2aWNlOiBJTWFuYWdlZE9iamVjdCA9IHRoaXMucm91dGUuc25hcHNob3QucGFyZW50LmRhdGEuY29udGV4dERhdGE7XG4gIGRldmljZSQ6IE9ic2VydmFibGU8SU1hbmFnZWRPYmplY3Q+ID0gb2Yoe30gYXMgYW55KTtcbiAgZGVsaXZlcnlUeXBlczogQXJyYXk8RGVsaXZlcnlUeXBlICYgeyBpc1N1cHBvcnRlZEJ5Q29tbWFuZD86IGJvb2xlYW4gfT4gPSAoXG4gICAgdGhpcy5zZXJ2aWNlLmdldERlbGl2ZXJ5VHlwZXMoKSB8fCBbXVxuICApLm1hcChkZWxpdmVyeVR5cGUgPT4gKHsgLi4uZGVsaXZlcnlUeXBlLCBpc1N1cHBvcnRlZEJ5Q29tbWFuZDogdHJ1ZSB9KSk7XG4gIGNvbW1hbmQ6IENvbW1hbmQgPSB7fSBhcyBDb21tYW5kO1xuICBzbXNFbmFibGVkID0gZmFsc2U7XG4gIHNlbmRpbmdDb21tYW5kJDogQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+ID0gbmV3IEJlaGF2aW9yU3ViamVjdChmYWxzZSk7XG4gIG9wZXJhdGlvbnM6IElSZXN1bHRMaXN0PElPcGVyYXRpb24+O1xuICBmaWx0ZXJQaXBlID0gcGlwZShcbiAgICBtYXAoKG9wZXJhdGlvbnM6IElPcGVyYXRpb25bXSkgPT5cbiAgICAgIChvcGVyYXRpb25zIHx8IFtdKS5maWx0ZXIoKG9wZXJhdGlvbjogSU9wZXJhdGlvbikgPT4gISFvcGVyYXRpb24uYzh5X0NvbW1hbmQpXG4gICAgKVxuICApO1xuXG4gIGV4ZWN1dGVWaWFMYWJlbCA9IGdldHRleHQoJ0V4ZWN1dGUgdmlhICh7e2RlbGl2ZXJ5VHlwZX19KScpO1xuXG4gIHByaXZhdGUgZGVzdHJveWVkJDogU3ViamVjdDx2b2lkPiA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIHNlcnZpY2U6IERldmljZVNoZWxsU2VydmljZSxcbiAgICBwdWJsaWMgb3BlcmF0aW9uUmVhbHRpbWU6IE9wZXJhdGlvblJlYWx0aW1lU2VydmljZSxcbiAgICBwcml2YXRlIG1vUmVhbHRpbWU6IE1hbmFnZWRPYmplY3RSZWFsdGltZVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBvcGVyYXRpb25TZXJ2aWNlOiBPcGVyYXRpb25TZXJ2aWNlLFxuICAgIHByaXZhdGUgcm91dGU6IEFjdGl2YXRlZFJvdXRlLFxuICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcbiAgICBwcml2YXRlIGFsZXJ0U2VydmljZTogQWxlcnRTZXJ2aWNlXG4gICkge31cblxuICBhc3luYyBuZ09uSW5pdCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLnNtc0VuYWJsZWQgPSBhd2FpdCB0aGlzLnNlcnZpY2UuY2FuU2VuZENvbW1hbmRzVmlhU01TKCk7XG5cbiAgICB0aGlzLmRldmljZSQgPSB0aGlzLm1vUmVhbHRpbWUub25VcGRhdGUkKHRoaXMuZGV2aWNlLmlkKS5waXBlKHN0YXJ0V2l0aCh0aGlzLmRldmljZSkpO1xuXG4gICAgdGhpcy5vcGVyYXRpb25zID0gYXdhaXQgdGhpcy5vcGVyYXRpb25TZXJ2aWNlLmxpc3Qoe1xuICAgICAgZGV2aWNlSWQ6IHRoaXMuZGV2aWNlLmlkLFxuICAgICAgZnJhZ21lbnRUeXBlOiAnYzh5X0NvbW1hbmQnLFxuICAgICAgZGF0ZUZyb206IG5ldyBEYXRlKDApLnRvSVNPU3RyaW5nKCksXG4gICAgICBkYXRlVG86IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIHBhZ2VTaXplOiA1MCxcbiAgICAgIHdpdGhUb3RhbFBhZ2VzOiB0cnVlLFxuICAgICAgcmV2ZXJ0OiB0cnVlXG4gICAgfSk7XG5cbiAgICB0aGlzLm9wZXJhdGlvblJlYWx0aW1lXG4gICAgICAub25DcmVhdGUkKHRoaXMuZGV2aWNlLmlkKVxuICAgICAgLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveWVkJCkpXG4gICAgICAuc3Vic2NyaWJlKCgpID0+IHRoaXMuYWxlcnRTZXJ2aWNlLnN1Y2Nlc3MoZ2V0dGV4dCgnQ29tbWFuZCBzZW50LicpKSk7XG5cbiAgICB0aGlzLm9wZXJhdGlvblJlYWx0aW1lXG4gICAgICAub25VcGRhdGUkKHRoaXMuZGV2aWNlLmlkKVxuICAgICAgLnBpcGUoXG4gICAgICAgIGZpbHRlcihvcCA9PiBvcC5mYWlsdXJlUmVhc29uICE9PSAnT3BlcmF0aW9uIGNhbmNlbGxlZCBieSB1c2VyLicpLCAvLyBhdm9pZCBkdXBsaWNhdGUgYWxlcnRzXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3llZCQpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCgpID0+IHRoaXMuYWxlcnRTZXJ2aWNlLnN1Y2Nlc3MoZ2V0dGV4dCgnQ29tbWFuZCBzdGF0dXMgdXBkYXRlZC4nKSkpO1xuICB9XG5cbiAgZ2V0UHJlZGVmaW5lZENvbW1hbmQoKSB7XG4gICAgY29uc3QgbW9kYWw6IEJzTW9kYWxSZWY8Q29tbWFuZFRlbXBsYXRlc0NvbXBvbmVudD4gPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KFxuICAgICAgQ29tbWFuZFRlbXBsYXRlc0NvbXBvbmVudCxcbiAgICAgIHtcbiAgICAgICAgYXJpYURlc2NyaWJlZGJ5OiAnbW9kYWwtYm9keScsXG4gICAgICAgIGFyaWFMYWJlbGxlZEJ5OiAnbW9kYWwtdGl0bGUnXG4gICAgICB9XG4gICAgKTtcbiAgICBtb2RhbC5jb250ZW50Lm9uVGVtcGxhdGVTZWxlY3RlZC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3llZCQpKS5zdWJzY3JpYmUocmVzdWx0ID0+IHtcbiAgICAgIHRoaXMuY29tbWFuZCA9IHsgLi4uKHJlc3VsdCBhcyBhbnkpLmNvbW1hbmRUZW1wbGF0ZSB9IGFzIENvbW1hbmQ7XG4gICAgICB0aGlzLmRlbGl2ZXJ5VHlwZXMgPSB0aGlzLmRlbGl2ZXJ5VHlwZXMubWFwKGRlbGl2ZXJ5VHlwZSA9PiAoe1xuICAgICAgICAuLi5kZWxpdmVyeVR5cGUsXG4gICAgICAgIGlzU3VwcG9ydGVkQnlDb21tYW5kOlxuICAgICAgICAgIGlzRW1wdHkodGhpcy5jb21tYW5kLmRlbGl2ZXJ5VHlwZXMpIHx8XG4gICAgICAgICAgaW5jbHVkZXModGhpcy5jb21tYW5kLmRlbGl2ZXJ5VHlwZXMsIGRlbGl2ZXJ5VHlwZS5uYW1lKVxuICAgICAgfSkpO1xuICAgIH0pO1xuICB9XG5cbiAgcmVzZXRTdXBwb3J0ZWREZWxpdmVyeVR5cGVzKCk6IHZvaWQge1xuICAgIHRoaXMuZGVsaXZlcnlUeXBlcyA9ICh0aGlzLnNlcnZpY2UuZ2V0RGVsaXZlcnlUeXBlcygpIHx8IFtdKS5tYXAoZGVsaXZlcnlUeXBlID0+ICh7XG4gICAgICAuLi5kZWxpdmVyeVR5cGUsXG4gICAgICBpc1N1cHBvcnRlZEJ5Q29tbWFuZDogdHJ1ZVxuICAgIH0pKTtcbiAgfVxuXG4gIGFzeW5jIGV4ZWN1dGUoY29tbWFuZERlbGl2ZXJ5VHlwZSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHVzZVNNUyA9IGNvbW1hbmREZWxpdmVyeVR5cGUgPT09IENvbW1hbmREZWxpdmVyeVR5cGUuU01TO1xuICAgIGlmICh1c2VTTVMgJiYgIXRoaXMuc21zRW5hYmxlZCkge1xuICAgICAgdGhpcy5hbGVydFNlcnZpY2Uud2FybmluZyhnZXR0ZXh0KCdTTVMgdHJhbnNwb3J0IGlzIG5vdCBjb25maWd1cmVkLicpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5zZW5kaW5nQ29tbWFuZCQubmV4dCh0cnVlKTtcblxuICAgIGF3YWl0IHRoaXMuc2VydmljZS5jcmVhdGVDb21tYW5kT3BlcmF0aW9uKHRoaXMuZGV2aWNlLmlkLCB0aGlzLmNvbW1hbmQsIGNvbW1hbmREZWxpdmVyeVR5cGUpO1xuXG4gICAgdGhpcy5jb21tYW5kLnRleHQgPSAnJztcbiAgICB0aGlzLmNvbW1hbmQubmFtZSA9ICcnO1xuICAgIHRoaXMucmVzZXRTdXBwb3J0ZWREZWxpdmVyeVR5cGVzKCk7XG4gICAgdGhpcy5zZW5kaW5nQ29tbWFuZCQubmV4dChmYWxzZSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLmRlc3Ryb3llZCQubmV4dCgpO1xuICAgIHRoaXMuZGVzdHJveWVkJC5jb21wbGV0ZSgpO1xuICB9XG59XG4iLCI8Yzh5LWFjdGlvbi1iYXItaXRlbSBbcGxhY2VtZW50XT1cIidyaWdodCdcIj5cbiAgPGM4eS1yZWFsdGltZS1idG4gW3NlcnZpY2VdPVwib3BlcmF0aW9uUmVhbHRpbWVcIj48L2M4eS1yZWFsdGltZS1idG4+XG48L2M4eS1hY3Rpb24tYmFyLWl0ZW0+XG5cbjxkaXYgY2xhc3M9XCJjYXJkIGNvbnRlbnQtZnVsbHBhZ2UgZC1ncmlkIGdyaWRfX2NvbC0tNi02LS1tZFwiPlxuICA8ZGl2IGNsYXNzPVwiaW5uZXItc2Nyb2xsIGQtZmxleCBkLWNvbCBiZy1sZXZlbC0wXCI+XG4gICAgPGRpdiBjbGFzcz1cImNhcmQtaGVhZGVyIGxhcmdlLXBhZGRpbmcgc2VwYXJhdG9yIHN0aWNreS10b3BcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJjYXJkLXRpdGxlXCI+XG4gICAgICAgIHt7ICdDb21tYW5kJyB8IHRyYW5zbGF0ZSB9fVxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG5cbiAgICA8ZGl2IGNsYXNzPVwiY2FyZC1ibG9jayBkLWZsZXggZC1jb2wgZmxleC1ncm93IGxhcmdlLXBhZGRpbmdcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJkLWZsZXggcC1iLTE2XCI+XG4gICAgICAgIDxidXR0b25cbiAgICAgICAgICBjbGFzcz1cImJ0biBidG4tZGVmYXVsdCBidG4tc21cIlxuICAgICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICAgIChjbGljayk9XCJnZXRQcmVkZWZpbmVkQ29tbWFuZCgpXCJcbiAgICAgICAgICBbdGl0bGVdPVwiJ0Rpc3BsYXkgYSBsaXN0IG9mIHByZWRlZmluZWQgY29tbWFuZHMnIHwgdHJhbnNsYXRlXCJcbiAgICAgICAgICBkYXRhLWN5PVwic2hlbGwtLXByZWRlZmluZWQtY29tbWFuZHNcIlxuICAgICAgICA+XG4gICAgICAgICAge3sgJ1ByZWRlZmluZWQgY29tbWFuZHMnIHwgdHJhbnNsYXRlIH19XG4gICAgICAgIDwvYnV0dG9uPlxuXG4gICAgICAgIDxkaXYgY2xhc3M9XCJtLWwtYXV0b1wiPlxuICAgICAgICAgIDxkZXZpY2Utc3RhdHVzIFttb109XCJkZXZpY2UkIHwgYXN5bmNcIj48L2RldmljZS1zdGF0dXM+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgICA8dGV4dGFyZWFcbiAgICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCInQ29tbWFuZHMnIHwgdHJhbnNsYXRlXCJcbiAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2wgaW5uZXItc2Nyb2xsIGZsZXgtZ3JvdyBiZy1sZXZlbC0yIHRleHQtbW9ub3NwYWNlXCJcbiAgICAgICAgWyhuZ01vZGVsKV09XCJjb21tYW5kLnRleHRcIlxuICAgICAgICBkYXRhLWN5PVwic2hlbGwtY29tcG9uZW50LS1jb21tYW5kc1wiXG4gICAgICAgIChuZ01vZGVsQ2hhbmdlKT1cIiRldmVudCB8fCByZXNldFN1cHBvcnRlZERlbGl2ZXJ5VHlwZXMoKVwiXG4gICAgICAgIHBsYWNlaG9sZGVyPVwie3sgJ0FkZCBjb21tYW5kcyBvciB1c2UgcHJlZGVmaW5lZCBjb21tYW5kcyBhYm92ZS4nIHwgdHJhbnNsYXRlIH19XCJcbiAgICAgID48L3RleHRhcmVhPlxuICAgIDwvZGl2PlxuXG4gICAgPGRpdiBjbGFzcz1cImNhcmQtZm9vdGVyIGxhcmdlLXBhZGRpbmcgc2VwYXJhdG9yXCI+XG4gICAgICA8bmctY29udGFpbmVyICpuZ0Zvcj1cImxldCBkZWxpdmVyeVR5cGUgb2YgZGVsaXZlcnlUeXBlc1wiPlxuICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgY2xhc3M9XCJidG4gYnRuLXByaW1hcnlcIlxuICAgICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICAgICpuZ0lmPVwiZGVsaXZlcnlUeXBlLmlzU3VwcG9ydGVkQnlDb21tYW5kXCJcbiAgICAgICAgICBbZGlzYWJsZWRdPVwiIWNvbW1hbmQ/LnRleHQgfHwgKHNlbmRpbmdDb21tYW5kJCB8IGFzeW5jKVwiXG4gICAgICAgICAgKGNsaWNrKT1cImV4ZWN1dGUoZGVsaXZlcnlUeXBlLm5hbWUpXCJcbiAgICAgICAgPlxuICAgICAgICAgIDxzcGFuXG4gICAgICAgICAgICBbdGl0bGVdPVwiXG4gICAgICAgICAgICAgIGRlbGl2ZXJ5VHlwZS5kZWZhdWx0XG4gICAgICAgICAgICAgICAgPyAoJ0V4ZWN1dGUnIHwgdHJhbnNsYXRlKVxuICAgICAgICAgICAgICAgIDogKGV4ZWN1dGVWaWFMYWJlbCB8IHRyYW5zbGF0ZTogeyBkZWxpdmVyeVR5cGU6IGRlbGl2ZXJ5VHlwZS5uYW1lIH0pXG4gICAgICAgICAgICBcIlxuICAgICAgICAgID5cbiAgICAgICAgICAgIHt7XG4gICAgICAgICAgICAgIGRlbGl2ZXJ5VHlwZS5kZWZhdWx0XG4gICAgICAgICAgICAgICAgPyAoJ0V4ZWN1dGUnIHwgdHJhbnNsYXRlKVxuICAgICAgICAgICAgICAgIDogKGV4ZWN1dGVWaWFMYWJlbCB8IHRyYW5zbGF0ZTogeyBkZWxpdmVyeVR5cGU6IGRlbGl2ZXJ5VHlwZS5uYW1lIH0pXG4gICAgICAgICAgICB9fVxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgPC9idXR0b24+XG4gICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG4gIDxkaXYgY2xhc3M9XCJpbm5lci1zY3JvbGwgYmctbGV2ZWwtMVwiPlxuICAgIDxkaXYgY2xhc3M9XCJjYXJkLWhlYWRlciBsYXJnZS1wYWRkaW5nIHNlcGFyYXRvciBzdGlja3ktdG9wXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwiY2FyZC10aXRsZVwiPlxuICAgICAgICB7eyAnT3BlcmF0aW9ucycgfCB0cmFuc2xhdGUgfX1cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJjYXJkLWJsb2NrIGxhcmdlLXBhZGRpbmdcIj5cbiAgICAgIDxjOHktb3BlcmF0aW9ucy10aW1lbGluZVxuICAgICAgICBbb3BlcmF0aW9uc109XCJvcGVyYXRpb25zXCJcbiAgICAgICAgW3NvdXJjZUlkXT1cImRldmljZS5pZFwiXG4gICAgICAgIFtmaWx0ZXJQaXBlXT1cImZpbHRlclBpcGVcIlxuICAgICAgICBbYm9keVRlbXBsYXRlXT1cInRpbWVsaW5lSXRlbUJvZHlcIlxuICAgICAgICBbZm9vdGVyVGVtcGxhdGVzXT1cIlt0aW1lbGluZUl0ZW1Gb290ZXJdXCJcbiAgICAgICAgW3Byb3BlcnRpZXNUb0hpZGVdPVwiWydjOHlfQ29tbWFuZCddXCJcbiAgICAgID48L2M4eS1vcGVyYXRpb25zLXRpbWVsaW5lPlxuICAgICAgPG5nLXRlbXBsYXRlICN0aW1lbGluZUl0ZW1Cb2R5IGxldC1vcGVyYXRpb24+XG4gICAgICAgIDxzbWFsbD57eyBvcGVyYXRpb24uYzh5X0NvbW1hbmQ/LnRleHQgfHwgb3BlcmF0aW9uLmRlc2NyaXB0aW9uIH19PC9zbWFsbD5cbiAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgICA8bmctdGVtcGxhdGUgI3RpbWVsaW5lSXRlbUZvb3RlciBsZXQtb3BlcmF0aW9uPlxuICAgICAgICA8ZGl2ICpuZ0lmPVwib3BlcmF0aW9uLmM4eV9Db21tYW5kPy50ZXh0XCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImxlZ2VuZCBmb3JtLWJsb2NrXCIgdHJhbnNsYXRlPkNvbW1hbmQ8L2Rpdj5cbiAgICAgICAgICA8cHJlIGNsYXNzPVwicC04IHRleHQtcHJlLW5vcm1hbFwiPlxuICAgICAgICAgICAgICA8Y29kZT57e29wZXJhdGlvbi5jOHlfQ29tbWFuZC50ZXh0fX08L2NvZGU+XG4gICAgICAgICAgPC9wcmU+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2ICpuZ0lmPVwib3BlcmF0aW9uLmM4eV9Db21tYW5kPy5yZXN1bHRcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwibGVnZW5kIGZvcm0tYmxvY2tcIiB0cmFuc2xhdGU+UmVzcG9uc2U8L2Rpdj5cbiAgICAgICAgICA8cHJlIGNsYXNzPVwicC04IHRleHQtcHJlLW5vcm1hbFwiPlxuICAgICAgICAgICAgICA8Y29kZT57e29wZXJhdGlvbi5jOHlfQ29tbWFuZC5yZXN1bHR9fTwvY29kZT5cbiAgICAgICAgICA8L3ByZT5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L25nLXRlbXBsYXRlPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvZGl2PlxuIl19