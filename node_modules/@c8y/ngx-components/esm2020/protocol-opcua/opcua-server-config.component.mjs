import { Component, Input, Output, EventEmitter, ViewChild } from '@angular/core';
import { gettext, DropAreaComponent } from '@c8y/ngx-components';
import { cloneDeep, has } from 'lodash-es';
import { OpcuaService } from './opcuaService';
import * as i0 from "@angular/core";
import * as i1 from "./opcuaService";
import * as i2 from "@c8y/ngx-components";
import * as i3 from "@angular/common";
import * as i4 from "@angular/forms";
import * as i5 from "ngx-bootstrap/buttons";
export class OpcuaServerConfigComponent {
    set server(server) {
        this._server = cloneDeep(server);
        if (server) {
            this.model = cloneDeep(server);
            this.fileName = this.model.config.keystoreFilename;
            if (server.id && server.id === 'new') {
                // enabled connection state
                this.targetConnectionState = '1';
                this.model.config.targetConnectionState = 'enabled';
            }
            else {
                this.targetConnectionState =
                    this.model.config.targetConnectionState === 'enabled' ? '1' : '0';
            }
            this.updateConnectionStatusLabel(this._server);
            this.setNewPassword();
        }
    }
    get server() {
        return this._server;
    }
    constructor(opcuaService) {
        this.fileName = '';
        this.targetConnectionState = '1';
        this.minIntervalNumber = 1;
        this.connectionStatusLabel = '';
        this.canceled = new EventEmitter();
        this.removed = new EventEmitter();
        this.saved = new EventEmitter();
        this.changePassword = false;
        this.initialPasswordRequired = true;
        this.NONE = 'NONE';
        this.SIGN = 'SIGN';
        this.SIGN_ENC = 'SIGN_ENCRYPT';
        this.securityPolicies = {
            sign: [`BASIC256_${this.SIGN}`, `BASIC128RSA15_${this.SIGN}`, `BASIC256SHA256_${this.SIGN}`],
            sign_enc: [
                `BASIC256_${this.SIGN_ENC}`,
                `BASIC128RSA15_${this.SIGN_ENC}`,
                `BASIC256SHA256_${this.SIGN_ENC}`
            ]
        };
        this.ANONYM = {
            id: 1,
            value: gettext('Anonymous')
        };
        this.USER_PASSWORD = {
            id: 2,
            value: gettext('Username/Password')
        };
        this.KEY_BASED = {
            id: 3,
            value: gettext('Key-based Authentication')
        };
        this.initialKeystore = {
            lastModified: 0,
            name: '',
            type: '',
            slice: null,
            size: 0
        };
        this.keystore = this.initialKeystore;
        this.authSwitch = false;
        this.opcuaService = opcuaService;
    }
    async ngOnInit() {
        this.authSwitch = false;
        this.securityModes = [this.NONE, this.SIGN, this.SIGN_ENC];
        this.authenticationModes = [this.ANONYM, this.USER_PASSWORD, this.KEY_BASED];
        this.setCurrentAuthenticationMode();
        this.setCurrentSecurityMode();
    }
    ngOnChanges() {
        this.setCurrentSecurityMode();
        this.setCurrentAuthenticationMode();
    }
    cancel() {
        this.canceled.emit(this.model);
        this._server = null;
    }
    async remove() {
        await this.removeKeystore(this.model);
        this.removed.emit(this.model);
        this._server = null;
    }
    async save() {
        if (this.keystore &&
            this.keystore.size > 0 &&
            this.keystore.name &&
            this.keystore.name.length > 0) {
            const response = await this.uploadKeystore(this.model.config.keystoreBinaryId);
            if (response && response.data && response.data.id) {
                this.model.config.keystoreBinaryId = response.data.id;
            }
            // if the keystore was uploaded successful we can remove
            // the local keystore. This will prevent another request to binary api
            // when the user will edit other inputs in the form and hit save again.
            this.keystore = this.initialKeystore;
        }
        // will remove keystore (binary) when the user switched
        // authentication settings from key-based to anonymous or username/password
        if (this.authSwitch) {
            this.removeKeystore(this.server);
        }
        // when the user sets a new password, make sure to mark it as
        // "not encrypted" by setting passwordEncrypted to false
        const userPassword = this.getModelConfig('userPassword');
        if (userPassword && userPassword.length > 0) {
            this.model.config.passwordEncrypted = false;
        }
        this.saved.emit(this.model);
    }
    uploadFile(droppedFiles) {
        if (droppedFiles.length === 1) {
            this.keystore = droppedFiles[0].file;
            this.fileName = this.keystore.name;
        }
        else {
            // dropped more than one file
            console.warn('Tried to import... Import aborted.');
        }
    }
    setPolicy(data) {
        if (data === this.NONE) {
            this.model.config.securityMode = this.NONE;
        }
        else if (data === this.SIGN) {
            this.model.config.securityMode = this.securityPolicies.sign[0];
        }
        else if (data === this.SIGN_ENC) {
            this.model.config.securityMode = this.securityPolicies.sign_enc[0];
        }
    }
    setServerConnection(data) {
        this.model.config.targetConnectionState = data !== '0' ? 'enabled' : 'disabled';
    }
    updateAuthentication(data) {
        if (data && data.id) {
            switch (data.id) {
                // Anonymous
                case 1:
                    this.resetUserAuthentication();
                    this.resetKeyBasedAuthentication();
                    break;
                // User/Password
                case 2:
                    this.resetKeyBasedAuthentication();
                    this.restoreUserData();
                    this.setNewPassword();
                    break;
                // Key-based
                case 3:
                    this.resetUserAuthentication();
                    this.restoreKeyBasedData();
                    break;
                default:
                    console.warn('Invalid authentication id', data.id);
                    break;
            }
        }
    }
    updateConnectionStatusLabel(server) {
        const connected = server.c8y_Connection && server.c8y_Connection.status === 'CONNECTED';
        const label = connected ? gettext('Connected') : gettext('Disconnected');
        this.connectionStatusLabel = label;
    }
    setNewPassword() {
        const username = this.getModelConfig('userName');
        if (username && username.length > 0) {
            // userName is given, NO need to change the password because it is already set
            this.changePassword = false;
            this.initialPasswordRequired = false;
        }
        else {
            // no userName in response, so require the user to set the initial pw
            this.changePassword = true;
            this.initialPasswordRequired = true;
        }
    }
    toggleChangePassword() {
        this.changePassword = !this.changePassword;
        // When the user hides the pw-input field but has entered a
        // string to it before, we need to discard the changes reflected in the model
        // otherwise we PUT it with the model when user hits the save button
        if (!this.changePassword) {
            if (this.getModelConfig('userPassword')) {
                delete this.model.config.userPassword;
            }
        }
    }
    uploadKeystore(binaryId) {
        if (!binaryId) {
            return this.opcuaService.uploadKeystore(this.keystore);
        }
        else if (binaryId && binaryId.length > 0) {
            // update existing binary
            return this.opcuaService.updateKeystore(binaryId, this.keystore);
        }
    }
    removeKeystore(server) {
        if (server &&
            server.config &&
            server.config.keystoreBinaryId &&
            server.config.keystoreBinaryId.length > 0) {
            this.authSwitch = false;
            return this.opcuaService.removeKeystore(this.server.config.keystoreBinaryId);
        }
    }
    resetUserAuthentication() {
        this.model.config.userName = null;
        this.model.config.userPassword = null;
        this.model.config.userIdentityMode = 'none';
    }
    resetKeyBasedAuthentication() {
        this.authSwitch = true;
        this.model.config.keystorePass = null;
        this.model.config.certificatePass = null;
        this.model.config.keystoreBinaryId = '';
        this.model.config.keystoreFilename = '';
        this.model.config.userIdentityMode = 'none';
    }
    restoreUserData() {
        this.model.config.userName = this._server.config.userName;
        this.model.config.userIdentityMode = 'userAndPassword';
    }
    restoreKeyBasedData() {
        this.authSwitch = false;
        this.model.config.keystorePass = this._server.config.keystorePass;
        this.model.config.certificatePass = this._server.config.certificatePass;
        this.model.config.keystoreBinaryId = this._server.config.keystoreBinaryId;
        this.model.config.keystoreFilename = this._server.config.keystoreFilename;
        this.model.config.userIdentityMode = 'certificate';
    }
    getServerConfig() {
        let cfg = {
            securityMode: this.NONE,
            userIdentityMode: 'none'
        };
        if (this.server && this.server.config) {
            cfg = this.server.config;
        }
        return cfg;
    }
    setCurrentSecurityMode() {
        const { securityMode } = this.getServerConfig();
        if (securityMode) {
            const foundInSign = this.securityPolicies.sign.find(el => el === securityMode);
            if (foundInSign) {
                this.currentSecMode = this.SIGN;
            }
            else {
                const foundInSignEncrypt = this.securityPolicies.sign_enc.find(el => el === securityMode);
                foundInSignEncrypt
                    ? (this.currentSecMode = this.SIGN_ENC)
                    : (this.currentSecMode = this.NONE);
            }
        }
    }
    setCurrentAuthenticationMode() {
        const { userIdentityMode } = this.getServerConfig();
        switch (userIdentityMode) {
            case 'certificate':
                this.authenticationMode = this.KEY_BASED;
                break;
            case 'userAndPassword':
                this.authenticationMode = this.USER_PASSWORD;
                break;
            case 'Anonymous':
                this.authenticationMode = this.ANONYM;
                break;
            case 'UserName':
                this.authenticationMode = this.USER_PASSWORD;
                break;
            case 'Certificate':
                this.authenticationMode = this.KEY_BASED;
                break;
            default:
                this.authenticationMode = this.ANONYM;
                break;
        }
    }
    getModelConfig(fragment) {
        if (this.model && this.model.config) {
            if (fragment && fragment.length > 0) {
                return has(this.model.config, fragment) ? this.model.config[`${fragment}`] : undefined;
            }
        }
        return undefined;
    }
}
OpcuaServerConfigComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: OpcuaServerConfigComponent, deps: [{ token: i1.OpcuaService }], target: i0.ɵɵFactoryTarget.Component });
OpcuaServerConfigComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.7", type: OpcuaServerConfigComponent, selector: "opcua-server-config", inputs: { server: "server" }, outputs: { canceled: "canceled", removed: "removed", saved: "saved" }, viewQueries: [{ propertyName: "opcuaConfigForm", first: true, predicate: ["opcuaConfigForm"], descendants: true }, { propertyName: "dropArea", first: true, predicate: DropAreaComponent, descendants: true }], usesOnChanges: true, ngImport: i0, template: "<div class=\"c8y-empty-state m-t-4\" *ngIf=\"!server\">\n  <h1 class=\"c8y-icon c8y-icon-duocolor\" c8yIcon=\"server\"></h1>\n  <div>\n    <p class=\"text-medium\">{{ 'No server to display.' | translate }}</p>\n    <p>{{ 'Add or select a server.' | translate }}</p>\n  </div>\n</div>\n\n<form #opcuaConfigForm=\"ngForm\" class=\"d-contents\" *ngIf=\"server\">\n  <div class=\"card-header large-padding separator sticky-top visible-sm visible-xs\">\n    <button\n      class=\"btn btn-clean text-primary visible-sm visible-xs\"\n      title=\"{{ 'Back' | translate }}\"\n      (click)=\"cancel()\"\n    >\n      <i c8yIcon=\"chevron-left\"></i>\n      {{ 'Back' | translate }}\n    </button>\n  </div>\n  <div class=\"flex-grow\">\n    <div class=\"card-block large-padding\">\n      <!-- SERVER NAME -->\n      <c8y-form-group class=\"m-b-8\">\n        <label>\n          {{ 'Server name' | translate }}\n        </label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          placeholder=\"{{ 'e.g. My server' | translate }}\"\n          id=\"name\"\n          name=\"name\"\n          [(ngModel)]=\"model.name\"\n          required\n        />\n        <c8y-messages>\n          <c8y-message\n            name=\"required\"\n            text=\"{{ 'Server name is required' | translate }}\"\n          ></c8y-message>\n        </c8y-messages>\n      </c8y-form-group>\n    </div>\n\n    <div class=\"card-block large-padding bg-level-2\">\n      <div class=\"tight-grid\">\n        <div class=\"col-sm-6\">\n          <label class=\"fit-w\" translate>Server connection</label>\n          <button\n            type=\"button\"\n            class=\"btn m-t-4\"\n            name=\"serverConnection\"\n            [(ngModel)]=\"targetConnectionState\"\n            (ngModelChange)=\"setServerConnection($event)\"\n            btnCheckbox\n            btnCheckboxTrue=\"1\"\n            btnCheckboxFalse=\"0\"\n          >\n            <span title=\"{{ 'Enabled' | translate }}\" [hidden]=\"targetConnectionState !== '1'\">\n              {{ 'Enabled' | translate }}\n            </span>\n            <span title=\"{{ 'Disabled' | translate }}\" [hidden]=\"targetConnectionState !== '0'\">\n              {{ 'Disabled' | translate }}\n            </span>\n          </button>\n        </div>\n        <div class=\"col-sm-6\">\n          <label translate>Connection status</label>\n          <div class=\"form-control-static\">\n            <device-status class=\"p-r-8\" [mo]=\"server\"></device-status>\n            <span>{{ connectionStatusLabel | translate }}</span>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"card-block large-padding\">\n      <!-- SERVER URL-->\n      <c8y-form-group>\n        <label for=\"configServerUrl\" translate>Server URL</label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          id=\"configServerUrl\"\n          name=\"serverUrl\"\n          [(ngModel)]=\"model.config.serverUrl\"\n          c8yDefaultValidation=\"opcuaBrowsePath\"\n          required\n        />\n      </c8y-form-group>\n\n      <!-- TIMEOUT & STATUS-CHECK-INTERVAL-->\n      <div class=\"content-flex-32\">\n        <div class=\"col-6\">\n          <c8y-form-group>\n            <label for=\"config.timeout\" translate>Timeout</label>\n            <div class=\"input-group\">\n              <input\n                type=\"number\"\n                class=\"form-control\"\n                id=\"config.timeout\"\n                name=\"timeout\"\n                [min]=\"minIntervalNumber\"\n                placeholder=\"{{ 'e.g.' | translate }} 30\"\n                [(ngModel)]=\"model.config.timeout\"\n                required\n              />\n              <span class=\"input-group-addon units\" translate>seconds</span>\n            </div>\n          </c8y-form-group>\n        </div>\n        <div class=\"col-6\">\n          <c8y-form-group>\n            <label for=\"config.statusCheckInterval\" translate>Status check interval</label>\n            <div class=\"input-group\">\n              <input\n                type=\"number\"\n                class=\"form-control\"\n                id=\"config.statusCheckInterval\"\n                name=\"statusCheckInterval\"\n                [min]=\"minIntervalNumber\"\n                placeholder=\"{{ 'e.g.' | translate }} 40\"\n                [(ngModel)]=\"model.config.statusCheckInterval\"\n                required\n              />\n              <span class=\"input-group-addon units\" translate>seconds</span>\n            </div>\n          </c8y-form-group>\n        </div>\n      </div>\n\n      <!-- SECURITY MODE -->\n      <div class=\"tight-grid\">\n        <div class=\"col-md-6\">\n          <div class=\"form-group\">\n            <!-- NONE, SIGN, SIGN & ENCRYPT-->\n            <label for=\"config.securityMode\" translate>Security mode</label>\n            <div class=\"c8y-select-wrapper\">\n              <select\n                class=\"form-control\"\n                id=\"config.securityMode\"\n                [(ngModel)]=\"currentSecMode\"\n                (ngModelChange)=\"setPolicy($event)\"\n                name=\"securityMode\"\n                required\n              >\n                <option *ngFor=\"let mode of securityModes\" [ngValue]=\"mode\">{{ mode }}</option>\n              </select>\n              <span></span>\n            </div>\n          </div>\n        </div>\n        <div *ngIf=\"currentSecMode === NONE\" class=\"col-md-6\">\n          <div class=\"form-group\">\n            <label for=\"config.securityPolicy\" translate>Security policy</label>\n            <input\n              type=\"text\"\n              class=\"form-control\"\n              id=\"config.securityPolicy\"\n              name=\"securityPolicy\"\n              [readonly]=\"true\"\n              [(ngModel)]=\"model.config.securityMode\"\n              required\n            />\n          </div>\n        </div>\n        <div *ngIf=\"currentSecMode !== NONE\" class=\"col-md-6\">\n          <div class=\"form-group\">\n            <label for=\"config.securityPolicy\" translate>Security policy</label>\n            <div class=\"c8y-select-wrapper\">\n              <select\n                *ngIf=\"currentSecMode === SIGN\"\n                class=\"form-control\"\n                id=\"config.securityPolicy\"\n                [(ngModel)]=\"model.config.securityMode\"\n                name=\"securityPolicy\"\n                required\n              >\n                <option *ngFor=\"let policy of securityPolicies.sign\" [ngValue]=\"policy\">\n                  {{ policy }}\n                </option>\n              </select>\n              <select\n                *ngIf=\"currentSecMode === SIGN_ENC\"\n                class=\"form-control\"\n                id=\"config.securityPolicy\"\n                [(ngModel)]=\"model.config.securityMode\"\n                name=\"securityPolicy\"\n                required\n              >\n                <option *ngFor=\"let policy of securityPolicies.sign_enc\" [ngValue]=\"policy\">\n                  {{ policy }}\n                </option>\n              </select>\n              <span></span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- AUTHENTICATION -->\n      <div class=\"form-group\">\n        <label for=\"config.authenticationMode\" translate>Authentication</label>\n        <div class=\"c8y-select-wrapper\">\n          <select\n            class=\"form-control\"\n            id=\"config.authenticationMode\"\n            [(ngModel)]=\"authenticationMode\"\n            name=\"authenticationMode\"\n            (ngModelChange)=\"updateAuthentication($event)\"\n            required\n          >\n            <option *ngFor=\"let auth of authenticationModes\" [ngValue]=\"auth\">\n              {{ auth.value | translate }}\n            </option>\n          </select>\n          <span></span>\n        </div>\n      </div>\n\n      <!-- User/Pw-->\n      <div *ngIf=\"authenticationMode.id === 2\" class=\"tight-grid\">\n        <div class=\"col-md-12\">\n          <div class=\"form-group\">\n            <label for=\"config.userName\" translate>Username</label>\n            <input\n              type=\"text\"\n              class=\"form-control\"\n              id=\"config.userName\"\n              name=\"userName\"\n              placeholder=\"{{ 'e.g. joe.doe`LOCALIZE`' | translate }}\"\n              [(ngModel)]=\"model.config.userName\"\n              autocomplete=\"new-password\"\n              required\n            />\n          </div>\n        </div>\n        <!-- change password section BEGINS-->\n        <div class=\"col-md-6\">\n          <div class=\"form-group\" *ngIf=\"!initialPasswordRequired\">\n            <button type=\"button\" class=\"btn btn-default\" (click)=\"toggleChangePassword()\">\n              <ng-container *ngIf=\"!changePassword\">\n                {{ 'Change password' | translate }}\n              </ng-container>\n              <ng-container *ngIf=\"changePassword\">\n                {{ 'Cancel password change' | translate }}\n              </ng-container>\n            </button>\n          </div>\n\n          <div class=\"form-group\">\n            <div *ngIf=\"changePassword\">\n              <label for=\"config.password\" translate>Password</label>\n              <input\n                type=\"password\"\n                class=\"form-control\"\n                id=\"config.userPassword\"\n                name=\"password\"\n                [(ngModel)]=\"model.config.userPassword\"\n                autocomplete=\"new-password\"\n                required\n              />\n            </div>\n          </div>\n        </div>\n        <!-- change password section ENDS-->\n      </div>\n      <!-- Key-based -->\n      <div *ngIf=\"authenticationMode.id === 3\" class=\"tight-grid\">\n        <!-- KEYSTORE PASSWORD -->\n        <div class=\"col-md-6\">\n          <div class=\"form-group\">\n            <label for=\"config.keystorePass\" translate>Keystore password</label>\n            <input\n              type=\"password\"\n              class=\"form-control\"\n              id=\"config.keystorePass\"\n              name=\"keystorePass\"\n              [(ngModel)]=\"model.config.keystorePass\"\n              required\n            />\n          </div>\n        </div>\n        <div class=\"col-md-6\">\n          <div class=\"form-group\">\n            <label for=\"config.certificatePass\" translate>Certificate password</label>\n            <input\n              type=\"password\"\n              class=\"form-control\"\n              id=\"config.certificatePass\"\n              name=\"keystorePass\"\n              [(ngModel)]=\"model.config.certificatePass\"\n              required\n            />\n          </div>\n        </div>\n        <!-- UPLOAD KEYSTORE -->\n        <div class=\"col-md-12\">\n          <div class=\"form-group\">\n            <label for=\"certificateUpload\" translate>Upload keystore</label>\n            <input\n              type=\"text\"\n              [readonly]=\"true\"\n              name=\"certificateUpload\"\n              class=\"form-control m-b-8\"\n              [ngModel]=\"fileName\"\n              placeholder=\"{{ 'e.g.' | translate }} yourKeystore.jks\"\n              required\n            />\n            <c8y-drop-area\n              (dropped)=\"uploadFile($event)\"\n              [loadingMessage]=\"'Importing, please wait.' | translate\"\n              [title]=\"'Import keystore with jks file extension' | translate\"\n            ></c8y-drop-area>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class=\"card-footer large-padding separator sticky-bottom\">\n    <button\n      title=\"{{ 'Cancel' | translate }}\"\n      type=\"button\"\n      class=\"btn btn-default\"\n      (click)=\"cancel()\"\n    >\n      {{ 'Cancel' | translate }}\n    </button>\n    <button\n      title=\"{{ 'Remove' | translate }}\"\n      type=\"button\"\n      class=\"btn btn-danger\"\n      (click)=\"remove()\"\n    >\n      {{ 'Remove' | translate }}\n    </button>\n    <button\n      title=\"{{ 'Save' | translate }}\"\n      type=\"submit\"\n      class=\"btn btn-primary\"\n      (click)=\"save()\"\n      [disabled]=\"!opcuaConfigForm.valid\"\n    >\n      {{ 'Save' | translate }}\n    </button>\n  </div>\n</form>\n", dependencies: [{ kind: "directive", type: i2.IconDirective, selector: "[c8yIcon]", inputs: ["c8yIcon"] }, { kind: "directive", type: i2.C8yTranslateDirective, selector: "[translate],[ngx-translate]" }, { kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i2.DropAreaComponent, selector: "c8y-drop-area", inputs: ["formControl", "title", "message", "icon", "loadingMessage", "forceHideList", "alwaysShow", "clickToOpen", "loading", "progress", "maxAllowedFiles", "files", "maxFileSizeInMegaBytes", "accept"], outputs: ["dropped"] }, { kind: "directive", type: i2.DefaultValidationDirective, selector: "[c8yDefaultValidation]", inputs: ["c8yDefaultValidation"] }, { kind: "directive", type: i2.MinValidationDirective, selector: "[min]", inputs: ["min"] }, { kind: "directive", type: i4.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { kind: "directive", type: i4.NgSelectOption, selector: "option", inputs: ["ngValue", "value"] }, { kind: "directive", type: i4.ɵNgSelectMultipleOption, selector: "option", inputs: ["ngValue", "value"] }, { kind: "directive", type: i4.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i4.NumberValueAccessor, selector: "input[type=number][formControlName],input[type=number][formControl],input[type=number][ngModel]" }, { kind: "directive", type: i4.SelectControlValueAccessor, selector: "select:not([multiple])[formControlName],select:not([multiple])[formControl],select:not([multiple])[ngModel]", inputs: ["compareWith"] }, { kind: "directive", type: i4.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i4.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { kind: "directive", type: i4.RequiredValidator, selector: ":not([type=checkbox])[required][formControlName],:not([type=checkbox])[required][formControl],:not([type=checkbox])[required][ngModel]", inputs: ["required"] }, { kind: "directive", type: i4.MinValidator, selector: "input[type=number][min][formControlName],input[type=number][min][formControl],input[type=number][min][ngModel]", inputs: ["min"] }, { kind: "directive", type: i4.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "directive", type: i4.NgForm, selector: "form:not([ngNoForm]):not([formGroup]),ng-form,[ngForm]", inputs: ["ngFormOptions"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { kind: "component", type: i2.FormGroupComponent, selector: "c8y-form-group", inputs: ["hasError", "hasWarning", "hasSuccess", "novalidation", "status"] }, { kind: "directive", type: i2.MessageDirective, selector: "c8y-message", inputs: ["name", "text"] }, { kind: "component", type: i2.MessagesComponent, selector: "c8y-messages", inputs: ["show", "defaults"] }, { kind: "directive", type: i2.RequiredInputPlaceholderDirective, selector: "input[required], input[formControlName]" }, { kind: "component", type: i2.DeviceStatusComponent, selector: "device-status", inputs: ["mo"] }, { kind: "directive", type: i5.ButtonCheckboxDirective, selector: "[btnCheckbox]", inputs: ["btnCheckboxTrue", "btnCheckboxFalse"] }, { kind: "pipe", type: i2.C8yTranslatePipe, name: "translate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: OpcuaServerConfigComponent, decorators: [{
            type: Component,
            args: [{ selector: 'opcua-server-config', template: "<div class=\"c8y-empty-state m-t-4\" *ngIf=\"!server\">\n  <h1 class=\"c8y-icon c8y-icon-duocolor\" c8yIcon=\"server\"></h1>\n  <div>\n    <p class=\"text-medium\">{{ 'No server to display.' | translate }}</p>\n    <p>{{ 'Add or select a server.' | translate }}</p>\n  </div>\n</div>\n\n<form #opcuaConfigForm=\"ngForm\" class=\"d-contents\" *ngIf=\"server\">\n  <div class=\"card-header large-padding separator sticky-top visible-sm visible-xs\">\n    <button\n      class=\"btn btn-clean text-primary visible-sm visible-xs\"\n      title=\"{{ 'Back' | translate }}\"\n      (click)=\"cancel()\"\n    >\n      <i c8yIcon=\"chevron-left\"></i>\n      {{ 'Back' | translate }}\n    </button>\n  </div>\n  <div class=\"flex-grow\">\n    <div class=\"card-block large-padding\">\n      <!-- SERVER NAME -->\n      <c8y-form-group class=\"m-b-8\">\n        <label>\n          {{ 'Server name' | translate }}\n        </label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          placeholder=\"{{ 'e.g. My server' | translate }}\"\n          id=\"name\"\n          name=\"name\"\n          [(ngModel)]=\"model.name\"\n          required\n        />\n        <c8y-messages>\n          <c8y-message\n            name=\"required\"\n            text=\"{{ 'Server name is required' | translate }}\"\n          ></c8y-message>\n        </c8y-messages>\n      </c8y-form-group>\n    </div>\n\n    <div class=\"card-block large-padding bg-level-2\">\n      <div class=\"tight-grid\">\n        <div class=\"col-sm-6\">\n          <label class=\"fit-w\" translate>Server connection</label>\n          <button\n            type=\"button\"\n            class=\"btn m-t-4\"\n            name=\"serverConnection\"\n            [(ngModel)]=\"targetConnectionState\"\n            (ngModelChange)=\"setServerConnection($event)\"\n            btnCheckbox\n            btnCheckboxTrue=\"1\"\n            btnCheckboxFalse=\"0\"\n          >\n            <span title=\"{{ 'Enabled' | translate }}\" [hidden]=\"targetConnectionState !== '1'\">\n              {{ 'Enabled' | translate }}\n            </span>\n            <span title=\"{{ 'Disabled' | translate }}\" [hidden]=\"targetConnectionState !== '0'\">\n              {{ 'Disabled' | translate }}\n            </span>\n          </button>\n        </div>\n        <div class=\"col-sm-6\">\n          <label translate>Connection status</label>\n          <div class=\"form-control-static\">\n            <device-status class=\"p-r-8\" [mo]=\"server\"></device-status>\n            <span>{{ connectionStatusLabel | translate }}</span>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"card-block large-padding\">\n      <!-- SERVER URL-->\n      <c8y-form-group>\n        <label for=\"configServerUrl\" translate>Server URL</label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          id=\"configServerUrl\"\n          name=\"serverUrl\"\n          [(ngModel)]=\"model.config.serverUrl\"\n          c8yDefaultValidation=\"opcuaBrowsePath\"\n          required\n        />\n      </c8y-form-group>\n\n      <!-- TIMEOUT & STATUS-CHECK-INTERVAL-->\n      <div class=\"content-flex-32\">\n        <div class=\"col-6\">\n          <c8y-form-group>\n            <label for=\"config.timeout\" translate>Timeout</label>\n            <div class=\"input-group\">\n              <input\n                type=\"number\"\n                class=\"form-control\"\n                id=\"config.timeout\"\n                name=\"timeout\"\n                [min]=\"minIntervalNumber\"\n                placeholder=\"{{ 'e.g.' | translate }} 30\"\n                [(ngModel)]=\"model.config.timeout\"\n                required\n              />\n              <span class=\"input-group-addon units\" translate>seconds</span>\n            </div>\n          </c8y-form-group>\n        </div>\n        <div class=\"col-6\">\n          <c8y-form-group>\n            <label for=\"config.statusCheckInterval\" translate>Status check interval</label>\n            <div class=\"input-group\">\n              <input\n                type=\"number\"\n                class=\"form-control\"\n                id=\"config.statusCheckInterval\"\n                name=\"statusCheckInterval\"\n                [min]=\"minIntervalNumber\"\n                placeholder=\"{{ 'e.g.' | translate }} 40\"\n                [(ngModel)]=\"model.config.statusCheckInterval\"\n                required\n              />\n              <span class=\"input-group-addon units\" translate>seconds</span>\n            </div>\n          </c8y-form-group>\n        </div>\n      </div>\n\n      <!-- SECURITY MODE -->\n      <div class=\"tight-grid\">\n        <div class=\"col-md-6\">\n          <div class=\"form-group\">\n            <!-- NONE, SIGN, SIGN & ENCRYPT-->\n            <label for=\"config.securityMode\" translate>Security mode</label>\n            <div class=\"c8y-select-wrapper\">\n              <select\n                class=\"form-control\"\n                id=\"config.securityMode\"\n                [(ngModel)]=\"currentSecMode\"\n                (ngModelChange)=\"setPolicy($event)\"\n                name=\"securityMode\"\n                required\n              >\n                <option *ngFor=\"let mode of securityModes\" [ngValue]=\"mode\">{{ mode }}</option>\n              </select>\n              <span></span>\n            </div>\n          </div>\n        </div>\n        <div *ngIf=\"currentSecMode === NONE\" class=\"col-md-6\">\n          <div class=\"form-group\">\n            <label for=\"config.securityPolicy\" translate>Security policy</label>\n            <input\n              type=\"text\"\n              class=\"form-control\"\n              id=\"config.securityPolicy\"\n              name=\"securityPolicy\"\n              [readonly]=\"true\"\n              [(ngModel)]=\"model.config.securityMode\"\n              required\n            />\n          </div>\n        </div>\n        <div *ngIf=\"currentSecMode !== NONE\" class=\"col-md-6\">\n          <div class=\"form-group\">\n            <label for=\"config.securityPolicy\" translate>Security policy</label>\n            <div class=\"c8y-select-wrapper\">\n              <select\n                *ngIf=\"currentSecMode === SIGN\"\n                class=\"form-control\"\n                id=\"config.securityPolicy\"\n                [(ngModel)]=\"model.config.securityMode\"\n                name=\"securityPolicy\"\n                required\n              >\n                <option *ngFor=\"let policy of securityPolicies.sign\" [ngValue]=\"policy\">\n                  {{ policy }}\n                </option>\n              </select>\n              <select\n                *ngIf=\"currentSecMode === SIGN_ENC\"\n                class=\"form-control\"\n                id=\"config.securityPolicy\"\n                [(ngModel)]=\"model.config.securityMode\"\n                name=\"securityPolicy\"\n                required\n              >\n                <option *ngFor=\"let policy of securityPolicies.sign_enc\" [ngValue]=\"policy\">\n                  {{ policy }}\n                </option>\n              </select>\n              <span></span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- AUTHENTICATION -->\n      <div class=\"form-group\">\n        <label for=\"config.authenticationMode\" translate>Authentication</label>\n        <div class=\"c8y-select-wrapper\">\n          <select\n            class=\"form-control\"\n            id=\"config.authenticationMode\"\n            [(ngModel)]=\"authenticationMode\"\n            name=\"authenticationMode\"\n            (ngModelChange)=\"updateAuthentication($event)\"\n            required\n          >\n            <option *ngFor=\"let auth of authenticationModes\" [ngValue]=\"auth\">\n              {{ auth.value | translate }}\n            </option>\n          </select>\n          <span></span>\n        </div>\n      </div>\n\n      <!-- User/Pw-->\n      <div *ngIf=\"authenticationMode.id === 2\" class=\"tight-grid\">\n        <div class=\"col-md-12\">\n          <div class=\"form-group\">\n            <label for=\"config.userName\" translate>Username</label>\n            <input\n              type=\"text\"\n              class=\"form-control\"\n              id=\"config.userName\"\n              name=\"userName\"\n              placeholder=\"{{ 'e.g. joe.doe`LOCALIZE`' | translate }}\"\n              [(ngModel)]=\"model.config.userName\"\n              autocomplete=\"new-password\"\n              required\n            />\n          </div>\n        </div>\n        <!-- change password section BEGINS-->\n        <div class=\"col-md-6\">\n          <div class=\"form-group\" *ngIf=\"!initialPasswordRequired\">\n            <button type=\"button\" class=\"btn btn-default\" (click)=\"toggleChangePassword()\">\n              <ng-container *ngIf=\"!changePassword\">\n                {{ 'Change password' | translate }}\n              </ng-container>\n              <ng-container *ngIf=\"changePassword\">\n                {{ 'Cancel password change' | translate }}\n              </ng-container>\n            </button>\n          </div>\n\n          <div class=\"form-group\">\n            <div *ngIf=\"changePassword\">\n              <label for=\"config.password\" translate>Password</label>\n              <input\n                type=\"password\"\n                class=\"form-control\"\n                id=\"config.userPassword\"\n                name=\"password\"\n                [(ngModel)]=\"model.config.userPassword\"\n                autocomplete=\"new-password\"\n                required\n              />\n            </div>\n          </div>\n        </div>\n        <!-- change password section ENDS-->\n      </div>\n      <!-- Key-based -->\n      <div *ngIf=\"authenticationMode.id === 3\" class=\"tight-grid\">\n        <!-- KEYSTORE PASSWORD -->\n        <div class=\"col-md-6\">\n          <div class=\"form-group\">\n            <label for=\"config.keystorePass\" translate>Keystore password</label>\n            <input\n              type=\"password\"\n              class=\"form-control\"\n              id=\"config.keystorePass\"\n              name=\"keystorePass\"\n              [(ngModel)]=\"model.config.keystorePass\"\n              required\n            />\n          </div>\n        </div>\n        <div class=\"col-md-6\">\n          <div class=\"form-group\">\n            <label for=\"config.certificatePass\" translate>Certificate password</label>\n            <input\n              type=\"password\"\n              class=\"form-control\"\n              id=\"config.certificatePass\"\n              name=\"keystorePass\"\n              [(ngModel)]=\"model.config.certificatePass\"\n              required\n            />\n          </div>\n        </div>\n        <!-- UPLOAD KEYSTORE -->\n        <div class=\"col-md-12\">\n          <div class=\"form-group\">\n            <label for=\"certificateUpload\" translate>Upload keystore</label>\n            <input\n              type=\"text\"\n              [readonly]=\"true\"\n              name=\"certificateUpload\"\n              class=\"form-control m-b-8\"\n              [ngModel]=\"fileName\"\n              placeholder=\"{{ 'e.g.' | translate }} yourKeystore.jks\"\n              required\n            />\n            <c8y-drop-area\n              (dropped)=\"uploadFile($event)\"\n              [loadingMessage]=\"'Importing, please wait.' | translate\"\n              [title]=\"'Import keystore with jks file extension' | translate\"\n            ></c8y-drop-area>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class=\"card-footer large-padding separator sticky-bottom\">\n    <button\n      title=\"{{ 'Cancel' | translate }}\"\n      type=\"button\"\n      class=\"btn btn-default\"\n      (click)=\"cancel()\"\n    >\n      {{ 'Cancel' | translate }}\n    </button>\n    <button\n      title=\"{{ 'Remove' | translate }}\"\n      type=\"button\"\n      class=\"btn btn-danger\"\n      (click)=\"remove()\"\n    >\n      {{ 'Remove' | translate }}\n    </button>\n    <button\n      title=\"{{ 'Save' | translate }}\"\n      type=\"submit\"\n      class=\"btn btn-primary\"\n      (click)=\"save()\"\n      [disabled]=\"!opcuaConfigForm.valid\"\n    >\n      {{ 'Save' | translate }}\n    </button>\n  </div>\n</form>\n" }]
        }], ctorParameters: function () { return [{ type: i1.OpcuaService }]; }, propDecorators: { opcuaConfigForm: [{
                type: ViewChild,
                args: ['opcuaConfigForm', { static: false }]
            }], dropArea: [{
                type: ViewChild,
                args: [DropAreaComponent, { static: false }]
            }], canceled: [{
                type: Output
            }], removed: [{
                type: Output
            }], saved: [{
                type: Output
            }], server: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3BjdWEtc2VydmVyLWNvbmZpZy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9wcm90b2NvbC1vcGN1YS9vcGN1YS1zZXJ2ZXItY29uZmlnLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uL3Byb3RvY29sLW9wY3VhL29wY3VhLXNlcnZlci1jb25maWcuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBRUwsTUFBTSxFQUNOLFlBQVksRUFFWixTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLE9BQU8sRUFBZSxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRTlFLE9BQU8sRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQzNDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7OztBQU05QyxNQUFNLE9BQU8sMEJBQTBCO0lBV3JDLElBQWEsTUFBTSxDQUFDLE1BQW1CO1FBQ3JDLElBQUksQ0FBQyxPQUFPLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2pDLElBQUksTUFBTSxFQUFFO1lBQ1YsSUFBSSxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDL0IsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztZQUVuRCxJQUFJLE1BQU0sQ0FBQyxFQUFFLElBQUksTUFBTSxDQUFDLEVBQUUsS0FBSyxLQUFLLEVBQUU7Z0JBQ3BDLDJCQUEyQjtnQkFDM0IsSUFBSSxDQUFDLHFCQUFxQixHQUFHLEdBQUcsQ0FBQztnQkFDakMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMscUJBQXFCLEdBQUcsU0FBUyxDQUFDO2FBQ3JEO2lCQUFNO2dCQUNMLElBQUksQ0FB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QUFNO1lBRVIsS0FBSyxhQUFhO2dCQUNoQixJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQztnQkFDekMsTUFBTTtZQUVSO2dCQUNFLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO2dCQUN0QyxNQUFNO1NBQ1Q7SUFDSCxDQUFDO0lBRU8sY0FBYyxDQUFDLFFBQWdCO1FBQ3JDLElBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRTtZQUNuQyxJQUFJLFFBQVEsSUFBSSxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtnQkFDbkMsT0FBTyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO2FBQ3hGO1NBQ0Y7UUFDRCxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDOzt1SEFuVlUsMEJBQTBCOzJHQUExQiwwQkFBMEIsK1NBTzFCLGlCQUFpQixxRUN6QjlCLG9xWUEwVkE7MkZEeFVhLDBCQUEwQjtrQkFKdEMsU0FBUzsrQkFDRSxxQkFBcUI7bUdBU2tCLGVBQWU7c0JBQS9ELFNBQVM7dUJBQUMsaUJBQWlCLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFO2dCQUNFLFFBQVE7c0JBQXhELFNBQVM7dUJBQUMsaUJBQWlCLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFO2dCQUNyQyxRQUFRO3NCQUFqQixNQUFNO2dCQUNHLE9BQU87c0JBQWhCLE1BQU07Z0JBQ0csS0FBSztzQkFBZCxNQUFNO2dCQUNNLE1BQU07c0JBQWxCLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIElucHV0LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBPbkNoYW5nZXMsXG4gIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGdldHRleHQsIERyb3BwZWRGaWxlLCBEcm9wQXJlYUNvbXBvbmVudCB9IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMnO1xuaW1wb3J0IHsgT3BjdWFTZXJ2ZXIsIE9wY3VhU2VydmVyQ29uZmlnIH0gZnJvbSAnLi9vcGN1YS1zZXJ2ZXIuaW50ZXJmYWNlJztcbmltcG9ydCB7IGNsb25lRGVlcCwgaGFzIH0gZnJvbSAnbG9kYXNoLWVzJztcbmltcG9ydCB7IE9wY3VhU2VydmljZSB9IGZyb20gJy4vb3BjdWFTZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnb3BjdWEtc2VydmVyLWNvbmZpZycsXG4gIHRlbXBsYXRlVXJsOiAnLi9vcGN1YS1zZXJ2ZXItY29uZmlnLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBPcGN1YVNlcnZlckNvbmZpZ0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcbiAgY3VycmVudFNlY01vZGU6IHN0cmluZztcbiAgZmlsZU5hbWUgPSAnJztcbiAgdGFyZ2V0Q29ubmVjdGlvblN0YXRlID0gJzEnO1xuICBtaW5JbnRlcnZhbE51bWJlciA9IDE7XG4gIGNvbm5lY3Rpb25TdGF0dXNMYWJlbCA9ICcnO1xuICBAVmlld0NoaWxkKCdvcGN1YUNvbmZpZ0Zvcm0nLCB7IHN0YXRpYzogZmFsc2UgfSkgb3BjdWFDb25maWdGb3JtOiBhbnk7XG4gIEBWaWV3Q2hpbGQoRHJvcEFyZWFDb21wb25lbnQsIHsgc3RhdGljOiBmYWxzZSB9KSBkcm9wQXJlYTogRHJvcEFyZWFDb21wb25lbnQ7XG4gIEBPdXRwdXQoKSBjYW5jZWxlZCA9IG5ldyBFdmVudEVtaXR0ZXI8T3BjdWFTZXJ2ZXI+KCk7XG4gIEBPdXRwdXQoKSByZW1vdmVkID0gbmV3IEV2ZW50RW1pdHRlcjxPcGN1YVNlcnZlcj4oKTtcbiAgQE91dHB1dCgpIHNhdmVkID0gbmV3IEV2ZW50RW1pdHRlcjxPcGN1YVNlcnZlcj4oKTtcbiAgQElucHV0KCkgc2V0IHNlcnZlcihzZXJ2ZXI6IE9wY3VhU2VydmVyKSB7XG4gICAgdGhpcy5fc2VydmVyID0gY2xvbmVEZWVwKHNlcnZlcik7XG4gICAgaWYgKHNlcnZlcikge1xuICAgICAgdGhpcy5tb2RlbCA9IGNsb25lRGVlcChzZXJ2ZXIpO1xuICAgICAgdGhpcy5maWxlTmFtZSA9IHRoaXMubW9kZWwuY29uZmlnLmtleXN0b3JlRmlsZW5hbWU7XG5cbiAgICAgIGlmIChzZXJ2ZXIuaWQgJiYgc2VydmVyLmlkID09PSAnbmV3Jykge1xuICAgICAgICAvLyBlbmFibGVkIGNvbm5lY3Rpb24gc3RhdGVcbiAgICAgICAgdGhpcy50YXJnZXRDb25uZWN0aW9uU3RhdGUgPSAnMSc7XG4gICAgICAgIHRoaXMubW9kZWwuY29uZmlnLnRhcmdldENvbm5lY3Rpb25TdGF0ZSA9ICdlbmFibGVkJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMudGFyZ2V0Q29ubmVjdGlvblN0YXRlID1cbiAgICAgICAgICB0aGlzLm1vZGVsLmNvbmZpZy50YXJnZXRDb25uZWN0aW9uU3RhdGUgPT09ICdlbmFibGVkJyA/ICcxJyA6ICcwJztcbiAgICAgIH1cbiAgICAgIHRoaXMudXBkYXRlQ29ubmVjdGlvblN0YXR1c0xhYmVsKHRoaXMuX3NlcnZlcik7XG4gICAgICB0aGlzLnNldE5ld1Bhc3N3b3JkKCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IHNlcnZlcigpOiBPcGN1YVNlcnZlciB7XG4gICAgcmV0dXJuIHRoaXMuX3NlcnZlcjtcbiAgfVxuXG4gIG1vZGVsOiBPcGN1YVNlcnZlcjtcbiAgY2hhbmdlUGFzc3dvcmQgPSBmYWxzZTtcbiAgaW5pdGlhbFBhc3N3b3JkUmVxdWlyZWQgPSB0cnVlO1xuICBzZWN1cml0eU1vZGVzOiBzdHJpbmdbXTtcbiAgYXV0aGVudGljYXRpb25Nb2RlOiBhbnk7XG4gIGF1dGhlbnRpY2F0aW9uTW9kZXM6IGFueVtdO1xuICBOT05FID0gJ05PTkUnO1xuICBTSUdOID0gJ1NJR04nO1xuICBTSUdOX0VOQyA9ICdTSUdOX0VOQ1JZUFQnO1xuICBzZWN1cml0eVBvbGljaWVzOiBhbnkgPSB7XG4gICAgc2lnbjogW2BCQVNJQzI1Nl8ke3RoaXMuU0lHTn1gLCBgQkFTSUMxMjhSU0ExNV8ke3RoaXMuU0lHTn1gLCBgQkFTSUMyNTZTSEEyNTZfJHt0aGlzLlNJR059YF0sXG4gICAgc2lnbl9lbmM6IFtcbiAgICAgIGBCQVNJQzI1Nl8ke3RoaXMuU0lHTl9FTkN9YCxcbiAgICAgIGBCQVNJQzEyOFJTQTE1XyR7dGhpcy5TSUdOX0VOQ31gLFxuICAgICAgYEJBU0lDMjU2U0hBMjU2XyR7dGhpcy5TSUdOX0VOQ31gXG4gICAgXVxuICB9O1xuICBwcml2YXRlIEFOT05ZTSA9IHtcbiAgICBpZDogMSxcbiAgICB2YWx1ZTogZ2V0dGV4dCgnQW5vbnltb3VzJylcbiAgfTtcbiAgcHJpdmF0ZSBVU0VSX1BBU1NXT1JEID0ge1xuICAgIGlkOiAyLFxuICAgIHZhbHVlOiBnZXR0ZXh0KCdVc2VybmFtZS9QYXNzd29yZCcpXG4gIH07XG4gIHByaXZhdGUgS0VZX0JBU0VEID0ge1xuICAgIGlkOiAzLFxuICAgIHZhbHVlOiBnZXR0ZXh0KCdLZXktYmFzZWQgQXV0aGVudGljYXRpb24nKVxuICB9O1xuICBwcml2YXRlIF9zZXJ2ZXI6IE9wY3VhU2VydmVyO1xuICBwcml2YXRlIG9wY3VhU2VydmljZTogT3BjdWFTZXJ2aWNlO1xuICBwcml2YXRlIGluaXRpYWxLZXlzdG9yZSA9IHtcbiAgICBsYXN0TW9kaWZpZWQ6IDAsXG4gICAgbmFtZTogJycsXG4gICAgdHlwZTogJycsXG4gICAgc2xpY2U6IG51bGwsXG4gICAgc2l6ZTogMFxuICB9IGFzIEZpbGU7XG4gIHByaXZhdGUga2V5c3RvcmU6IEZpbGUgPSB0aGlzLmluaXRpYWxLZXlzdG9yZTtcbiAgcHJpdmF0ZSBhdXRoU3dpdGNoID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3Iob3BjdWFTZXJ2aWNlOiBPcGN1YVNlcnZpY2UpIHtcbiAgICB0aGlzLm9wY3VhU2VydmljZSA9IG9wY3VhU2VydmljZTtcbiAgfVxuXG4gIGFzeW5jIG5nT25Jbml0KCkge1xuICAgIHRoaXMuYXV0aFN3aXRjaCA9IGZhbHNlO1xuXG4gICAgdGhpcy5zZWN1cml0eU1vZGVzID0gW3RoaXMuTk9ORSwgdGhpcy5TSUdOLCB0aGlzLlNJR05fRU5DXTtcblxuICAgIHRoaXMuYXV0aGVudGljYXRpb25Nb2RlcyA9IFt0aGlzLkFOT05ZTSwgdGhpcy5VU0VSX1BBU1NXT1JELCB0aGlzLktFWV9CQVNFRF07XG5cbiAgICB0aGlzLnNldEN1cnJlbnRBdXRoZW50aWNhdGlvbk1vZGUoKTtcbiAgICB0aGlzLnNldEN1cnJlbnRTZWN1cml0eU1vZGUoKTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKCkge1xuICAgIHRoaXMuc2V0Q3VycmVudFNlY3VyaXR5TW9kZSgpO1xuICAgIHRoaXMuc2V0Q3VycmVudEF1dGhlbnRpY2F0aW9uTW9kZSgpO1xuICB9XG5cbiAgY2FuY2VsKCkge1xuICAgIHRoaXMuY2FuY2VsZWQuZW1pdCh0aGlzLm1vZGVsKTtcbiAgICB0aGlzLl9zZXJ2ZXIgPSBudWxsO1xuICB9XG5cbiAgYXN5bmMgcmVtb3ZlKCkge1xuICAgIGF3YWl0IHRoaXMucmVtb3ZlS2V5c3RvcmUodGhpcy5tb2RlbCk7XG4gICAgdGhpcy5yZW1vdmVkLmVtaXQodGhpcy5tb2RlbCk7XG4gICAgdGhpcy5fc2VydmVyID0gbnVsbDtcbiAgfVxuXG4gIGFzeW5jIHNhdmUoKSB7XG4gICAgaWYgKFxuICAgICAgdGhpcy5rZXlzdG9yZSAmJlxuICAgICAgdGhpcy5rZXlzdG9yZS5zaXplID4gMCAmJlxuICAgICAgdGhpcy5rZXlzdG9yZS5uYW1lICYmXG4gICAgICB0aGlzLmtleXN0b3JlLm5hbWUubGVuZ3RoID4gMFxuICAgICkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLnVwbG9hZEtleXN0b3JlKHRoaXMubW9kZWwuY29uZmlnLmtleXN0b3JlQmluYXJ5SWQpO1xuXG4gICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLmlkKSB7XG4gICAgICAgIHRoaXMubW9kZWwuY29uZmlnLmtleXN0b3JlQmluYXJ5SWQgPSByZXNwb25zZS5kYXRhLmlkO1xuICAgICAgfVxuXG4gICAgICAvLyBpZiB0aGUga2V5c3RvcmUgd2FzIHVwbG9hZGVkIHN1Y2Nlc3NmdWwgd2UgY2FuIHJlbW92ZVxuICAgICAgLy8gdGhlIGxvY2FsIGtleXN0b3JlLiBUaGlzIHdpbGwgcHJldmVudCBhbm90aGVyIHJlcXVlc3QgdG8gYmluYXJ5IGFwaVxuICAgICAgLy8gd2hlbiB0aGUgdXNlciB3aWxsIGVkaXQgb3RoZXIgaW5wdXRzIGluIHRoZSBmb3JtIGFuZCBoaXQgc2F2ZSBhZ2Fpbi5cbiAgICAgIHRoaXMua2V5c3RvcmUgPSB0aGlzLmluaXRpYWxLZXlzdG9yZTtcbiAgICB9XG5cbiAgICAvLyB3aWxsIHJlbW92ZSBrZXlzdG9yZSAoYmluYXJ5KSB3aGVuIHRoZSB1c2VyIHN3aXRjaGVkXG4gICAgLy8gYXV0aGVudGljYXRpb24gc2V0dGluZ3MgZnJvbSBrZXktYmFzZWQgdG8gYW5vbnltb3VzIG9yIHVzZXJuYW1lL3Bhc3N3b3JkXG4gICAgaWYgKHRoaXMuYXV0aFN3aXRjaCkge1xuICAgICAgdGhpcy5yZW1vdmVLZXlzdG9yZSh0aGlzLnNlcnZlcik7XG4gICAgfVxuXG4gICAgLy8gd2hlbiB0aGUgdXNlciBzZXRzIGEgbmV3IHBhc3N3b3JkLCBtYWtlIHN1cmUgdG8gbWFyayBpdCBhc1xuICAgIC8vIFwibm90IGVuY3J5cHRlZFwiIGJ5IHNldHRpbmcgcGFzc3dvcmRFbmNyeXB0ZWQgdG8gZmFsc2VcbiAgICBjb25zdCB1c2VyUGFzc3dvcmQ6IHN0cmluZyA9IHRoaXMuZ2V0TW9kZWxDb25maWcoJ3VzZXJQYXNzd29yZCcpO1xuICAgIGlmICh1c2VyUGFzc3dvcmQgJiYgdXNlclBhc3N3b3JkLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMubW9kZWwuY29uZmlnLnBhc3N3b3JkRW5jcnlwdGVkID0gZmFsc2U7XG4gICAgfVxuXG4gICAgdGhpcy5zYXZlZC5lbWl0KHRoaXMubW9kZWwpO1xuICB9XG5cbiAgdXBsb2FkRmlsZShkcm9wcGVkRmlsZXM6IERyb3BwZWRGaWxlW10pIHtcbiAgICBpZiAoZHJvcHBlZEZpbGVzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgdGhpcy5rZXlzdG9yZSA9IGRyb3BwZWRGaWxlc1swXS5maWxlO1xuICAgICAgdGhpcy5maWxlTmFtZSA9IHRoaXMua2V5c3RvcmUubmFtZTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gZHJvcHBlZCBtb3JlIHRoYW4gb25lIGZpbGVcbiAgICAgIGNvbnNvbGUud2FybignVHJpZWQgdG8gaW1wb3J0Li4uIEltcG9ydCBhYm9ydGVkLicpO1xuICAgIH1cbiAgfVxuXG4gIHNldFBvbGljeShkYXRhOiBhbnkpIHtcbiAgICBpZiAoZGF0YSA9PT0gdGhpcy5OT05FKSB7XG4gICAgICB0aGlzLm1vZGVsLmNvbmZpZy5zZWN1cml0eU1vZGUgPSB0aGlzLk5PTkU7XG4gICAgfSBlbHNlIGlmIChkYXRhID09PSB0aGlzLlNJR04pIHtcbiAgICAgIHRoaXMubW9kZWwuY29uZmlnLnNlY3VyaXR5TW9kZSA9IHRoaXMuc2VjdXJpdHlQb2xpY2llcy5zaWduWzBdO1xuICAgIH0gZWxzZSBpZiAoZGF0YSA9PT0gdGhpcy5TSUdOX0VOQykge1xuICAgICAgdGhpcy5tb2RlbC5jb25maWcuc2VjdXJpdHlNb2RlID0gdGhpcy5zZWN1cml0eVBvbGljaWVzLnNpZ25fZW5jWzBdO1xuICAgIH1cbiAgfVxuXG4gIHNldFNlcnZlckNvbm5lY3Rpb24oZGF0YTogc3RyaW5nKSB7XG4gICAgdGhpcy5tb2RlbC5jb25maWcudGFyZ2V0Q29ubmVjdGlvblN0YXRlID0gZGF0YSAhPT0gJzAnID8gJ2VuYWJsZWQnIDogJ2Rpc2FibGVkJztcbiAgfVxuXG4gIHVwZGF0ZUF1dGhlbnRpY2F0aW9uKGRhdGE6IGFueSkge1xuICAgIGlmIChkYXRhICYmIGRhdGEuaWQpIHtcbiAgICAgIHN3aXRjaCAoZGF0YS5pZCkge1xuICAgICAgICAvLyBBbm9ueW1vdXNcbiAgICAgICAgY2FzZSAxOlxuICAgICAgICAgIHRoaXMucmVzZXRVc2VyQXV0aGVudGljYXRpb24oKTtcbiAgICAgICAgICB0aGlzLnJlc2V0S2V5QmFzZWRBdXRoZW50aWNhdGlvbigpO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIC8vIFVzZXIvUGFzc3dvcmRcbiAgICAgICAgY2FzZSAyOlxuICAgICAgICAgIHRoaXMucmVzZXRLZXlCYXNlZEF1dGhlbnRpY2F0aW9uKCk7XG4gICAgICAgICAgdGhpcy5yZXN0b3JlVXNlckRhdGEoKTtcbiAgICAgICAgICB0aGlzLnNldE5ld1Bhc3N3b3JkKCk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgLy8gS2V5LWJhc2VkXG4gICAgICAgIGNhc2UgMzpcbiAgICAgICAgICB0aGlzLnJlc2V0VXNlckF1dGhlbnRpY2F0aW9uKCk7XG4gICAgICAgICAgdGhpcy5yZXN0b3JlS2V5QmFzZWREYXRhKCk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ0ludmFsaWQgYXV0aGVudGljYXRpb24gaWQnLCBkYXRhLmlkKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICB1cGRhdGVDb25uZWN0aW9uU3RhdHVzTGFiZWwoc2VydmVyKSB7XG4gICAgY29uc3QgY29ubmVjdGVkID0gc2VydmVyLmM4eV9Db25uZWN0aW9uICYmIHNlcnZlci5jOHlfQ29ubmVjdGlvbi5zdGF0dXMgPT09ICdDT05ORUNURUQnO1xuICAgIGNvbnN0IGxhYmVsID0gY29ubmVjdGVkID8gZ2V0dGV4dCgnQ29ubmVjdGVkJykgOiBnZXR0ZXh0KCdEaXNjb25uZWN0ZWQnKTtcbiAgICB0aGlzLmNvbm5lY3Rpb25TdGF0dXNMYWJlbCA9IGxhYmVsO1xuICB9XG5cbiAgc2V0TmV3UGFzc3dvcmQoKSB7XG4gICAgY29uc3QgdXNlcm5hbWU6IHN0cmluZyA9IHRoaXMuZ2V0TW9kZWxDb25maWcoJ3VzZXJOYW1lJyk7XG4gICAgaWYgKHVzZXJuYW1lICYmIHVzZXJuYW1lLmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIHVzZXJOYW1lIGlzIGdpdmVuLCBOTyBuZWVkIHRvIGNoYW5nZSB0aGUgcGFzc3dvcmQgYmVjYXVzZSBpdCBpcyBhbHJlYWR5IHNldFxuICAgICAgdGhpcy5jaGFuZ2VQYXNzd29yZCA9IGZhbHNlO1xuICAgICAgdGhpcy5pbml0aWFsUGFzc3dvcmRSZXF1aXJlZCA9IGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBubyB1c2VyTmFtZSBpbiByZXNwb25zZSwgc28gcmVxdWlyZSB0aGUgdXNlciB0byBzZXQgdGhlIGluaXRpYWwgcHdcbiAgICAgIHRoaXMuY2hhbmdlUGFzc3dvcmQgPSB0cnVlO1xuICAgICAgdGhpcy5pbml0aWFsUGFzc3dvcmRSZXF1aXJlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgdG9nZ2xlQ2hhbmdlUGFzc3dvcmQoKSB7XG4gICAgdGhpcy5jaGFuZ2VQYXNzd29yZCA9ICF0aGlzLmNoYW5nZVBhc3N3b3JkO1xuICAgIC8vIFdoZW4gdGhlIHVzZXIgaGlkZXMgdGhlIHB3LWlucHV0IGZpZWxkIGJ1dCBoYXMgZW50ZXJlZCBhXG4gICAgLy8gc3RyaW5nIHRvIGl0IGJlZm9yZSwgd2UgbmVlZCB0byBkaXNjYXJkIHRoZSBjaGFuZ2VzIHJlZmxlY3RlZCBpbiB0aGUgbW9kZWxcbiAgICAvLyBvdGhlcndpc2Ugd2UgUFVUIGl0IHdpdGggdGhlIG1vZGVsIHdoZW4gdXNlciBoaXRzIHRoZSBzYXZlIGJ1dHRvblxuICAgIGlmICghdGhpcy5jaGFuZ2VQYXNzd29yZCkge1xuICAgICAgaWYgKHRoaXMuZ2V0TW9kZWxDb25maWcoJ3VzZXJQYXNzd29yZCcpKSB7XG4gICAgICAgIGRlbGV0ZSB0aGlzLm1vZGVsLmNvbmZpZy51c2VyUGFzc3dvcmQ7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB1cGxvYWRLZXlzdG9yZShiaW5hcnlJZD86IHN0cmluZykge1xuICAgIGlmICghYmluYXJ5SWQpIHtcbiAgICAgIHJldHVybiB0aGlzLm9wY3VhU2VydmljZS51cGxvYWRLZXlzdG9yZSh0aGlzLmtleXN0b3JlKTtcbiAgICB9IGVsc2UgaWYgKGJpbmFyeUlkICYmIGJpbmFyeUlkLmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIHVwZGF0ZSBleGlzdGluZyBiaW5hcnlcbiAgICAgIHJldHVybiB0aGlzLm9wY3VhU2VydmljZS51cGRhdGVLZXlzdG9yZShiaW5hcnlJZCwgdGhpcy5rZXlzdG9yZSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVLZXlzdG9yZShzZXJ2ZXI6IE9wY3VhU2VydmVyKSB7XG4gICAgaWYgKFxuICAgICAgc2VydmVyICYmXG4gICAgICBzZXJ2ZXIuY29uZmlnICYmXG4gICAgICBzZXJ2ZXIuY29uZmlnLmtleXN0b3JlQmluYXJ5SWQgJiZcbiAgICAgIHNlcnZlci5jb25maWcua2V5c3RvcmVCaW5hcnlJZC5sZW5ndGggPiAwXG4gICAgKSB7XG4gICAgICB0aGlzLmF1dGhTd2l0Y2ggPSBmYWxzZTtcbiAgICAgIHJldHVybiB0aGlzLm9wY3VhU2VydmljZS5yZW1vdmVLZXlzdG9yZSh0aGlzLnNlcnZlci5jb25maWcua2V5c3RvcmVCaW5hcnlJZCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZXNldFVzZXJBdXRoZW50aWNhdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmNvbmZpZy51c2VyTmFtZSA9IG51bGw7XG4gICAgdGhpcy5tb2RlbC5jb25maWcudXNlclBhc3N3b3JkID0gbnVsbDtcbiAgICB0aGlzLm1vZGVsLmNvbmZpZy51c2VySWRlbnRpdHlNb2RlID0gJ25vbmUnO1xuICB9XG5cbiAgcHJpdmF0ZSByZXNldEtleUJhc2VkQXV0aGVudGljYXRpb24oKSB7XG4gICAgdGhpcy5hdXRoU3dpdGNoID0gdHJ1ZTtcblxuICAgIHRoaXMubW9kZWwuY29uZmlnLmtleXN0b3JlUGFzcyA9IG51bGw7XG4gICAgdGhpcy5tb2RlbC5jb25maWcuY2VydGlmaWNhdGVQYXNzID0gbnVsbDtcbiAgICB0aGlzLm1vZGVsLmNvbmZpZy5rZXlzdG9yZUJpbmFyeUlkID0gJyc7XG4gICAgdGhpcy5tb2RlbC5jb25maWcua2V5c3RvcmVGaWxlbmFtZSA9ICcnO1xuICAgIHRoaXMubW9kZWwuY29uZmlnLnVzZXJJZGVudGl0eU1vZGUgPSAnbm9uZSc7XG4gIH1cblxuICBwcml2YXRlIHJlc3RvcmVVc2VyRGF0YSgpIHtcbiAgICB0aGlzLm1vZGVsLmNvbmZpZy51c2VyTmFtZSA9IHRoaXMuX3NlcnZlci5jb25maWcudXNlck5hbWU7XG4gICAgdGhpcy5tb2RlbC5jb25maWcudXNlcklkZW50aXR5TW9kZSA9ICd1c2VyQW5kUGFzc3dvcmQnO1xuICB9XG5cbiAgcHJpdmF0ZSByZXN0b3JlS2V5QmFzZWREYXRhKCkge1xuICAgIHRoaXMuYXV0aFN3aXRjaCA9IGZhbHNlO1xuICAgIHRoaXMubW9kZWwuY29uZmlnLmtleXN0b3JlUGFzcyA9IHRoaXMuX3NlcnZlci5jb25maWcua2V5c3RvcmVQYXNzO1xuICAgIHRoaXMubW9kZWwuY29uZmlnLmNlcnRpZmljYXRlUGFzcyA9IHRoaXMuX3NlcnZlci5jb25maWcuY2VydGlmaWNhdGVQYXNzO1xuICAgIHRoaXMubW9kZWwuY29uZmlnLmtleXN0b3JlQmluYXJ5SWQgPSB0aGlzLl9zZXJ2ZXIuY29uZmlnLmtleXN0b3JlQmluYXJ5SWQ7XG4gICAgdGhpcy5tb2RlbC5jb25maWcua2V5c3RvcmVGaWxlbmFtZSA9IHRoaXMuX3NlcnZlci5jb25maWcua2V5c3RvcmVGaWxlbmFtZTtcbiAgICB0aGlzLm1vZGVsLmNvbmZpZy51c2VySWRlbnRpdHlNb2RlID0gJ2NlcnRpZmljYXRlJztcbiAgfVxuXG4gIHByaXZhdGUgZ2V0U2VydmVyQ29uZmlnKCk6IE9wY3VhU2VydmVyQ29uZmlnIHtcbiAgICBsZXQgY2ZnOiBPcGN1YVNlcnZlckNvbmZpZyA9IHtcbiAgICAgIHNlY3VyaXR5TW9kZTogdGhpcy5OT05FLFxuICAgICAgdXNlcklkZW50aXR5TW9kZTogJ25vbmUnXG4gICAgfTtcbiAgICBpZiAodGhpcy5zZXJ2ZXIgJiYgdGhpcy5zZXJ2ZXIuY29uZmlnKSB7XG4gICAgICBjZmcgPSB0aGlzLnNlcnZlci5jb25maWc7XG4gICAgfVxuICAgIHJldHVybiBjZmc7XG4gIH1cblxuICBwcml2YXRlIHNldEN1cnJlbnRTZWN1cml0eU1vZGUoKSB7XG4gICAgY29uc3QgeyBzZWN1cml0eU1vZGUgfSA9IHRoaXMuZ2V0U2VydmVyQ29uZmlnKCk7XG4gICAgaWYgKHNlY3VyaXR5TW9kZSkge1xuICAgICAgY29uc3QgZm91bmRJblNpZ24gPSB0aGlzLnNlY3VyaXR5UG9saWNpZXMuc2lnbi5maW5kKGVsID0+IGVsID09PSBzZWN1cml0eU1vZGUpO1xuICAgICAgaWYgKGZvdW5kSW5TaWduKSB7XG4gICAgICAgIHRoaXMuY3VycmVudFNlY01vZGUgPSB0aGlzLlNJR047XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBmb3VuZEluU2lnbkVuY3J5cHQgPSB0aGlzLnNlY3VyaXR5UG9saWNpZXMuc2lnbl9lbmMuZmluZChlbCA9PiBlbCA9PT0gc2VjdXJpdHlNb2RlKTtcbiAgICAgICAgZm91bmRJblNpZ25FbmNyeXB0XG4gICAgICAgICAgPyAodGhpcy5jdXJyZW50U2VjTW9kZSA9IHRoaXMuU0lHTl9FTkMpXG4gICAgICAgICAgOiAodGhpcy5jdXJyZW50U2VjTW9kZSA9IHRoaXMuTk9ORSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRDdXJyZW50QXV0aGVudGljYXRpb25Nb2RlKCkge1xuICAgIGNvbnN0IHsgdXNlcklkZW50aXR5TW9kZSB9ID0gdGhpcy5nZXRTZXJ2ZXJDb25maWcoKTtcblxuICAgIHN3aXRjaCAodXNlcklkZW50aXR5TW9kZSkge1xuICAgICAgY2FzZSAnY2VydGlmaWNhdGUnOlxuICAgICAgICB0aGlzLmF1dGhlbnRpY2F0aW9uTW9kZSA9IHRoaXMuS0VZX0JBU0VEO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAndXNlckFuZFBhc3N3b3JkJzpcbiAgICAgICAgdGhpcy5hdXRoZW50aWNhdGlvbk1vZGUgPSB0aGlzLlVTRVJfUEFTU1dPUkQ7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdBbm9ueW1vdXMnOlxuICAgICAgICB0aGlzLmF1dGhlbnRpY2F0aW9uTW9kZSA9IHRoaXMuQU5PTllNO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnVXNlck5hbWUnOlxuICAgICAgICB0aGlzLmF1dGhlbnRpY2F0aW9uTW9kZSA9IHRoaXMuVVNFUl9QQVNTV09SRDtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ0NlcnRpZmljYXRlJzpcbiAgICAgICAgdGhpcy5hdXRoZW50aWNhdGlvbk1vZGUgPSB0aGlzLktFWV9CQVNFRDtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRoaXMuYXV0aGVudGljYXRpb25Nb2RlID0gdGhpcy5BTk9OWU07XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0TW9kZWxDb25maWcoZnJhZ21lbnQ6IHN0cmluZykge1xuICAgIGlmICh0aGlzLm1vZGVsICYmIHRoaXMubW9kZWwuY29uZmlnKSB7XG4gICAgICBpZiAoZnJhZ21lbnQgJiYgZnJhZ21lbnQubGVuZ3RoID4gMCkge1xuICAgICAgICByZXR1cm4gaGFzKHRoaXMubW9kZWwuY29uZmlnLCBmcmFnbWVudCkgPyB0aGlzLm1vZGVsLmNvbmZpZ1tgJHtmcmFnbWVudH1gXSA6IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxufVxuIiwiPGRpdiBjbGFzcz1cImM4eS1lbXB0eS1zdGF0ZSBtLXQtNFwiICpuZ0lmPVwiIXNlcnZlclwiPlxuICA8aDEgY2xhc3M9XCJjOHktaWNvbiBjOHktaWNvbi1kdW9jb2xvclwiIGM4eUljb249XCJzZXJ2ZXJcIj48L2gxPlxuICA8ZGl2PlxuICAgIDxwIGNsYXNzPVwidGV4dC1tZWRpdW1cIj57eyAnTm8gc2VydmVyIHRvIGRpc3BsYXkuJyB8IHRyYW5zbGF0ZSB9fTwvcD5cbiAgICA8cD57eyAnQWRkIG9yIHNlbGVjdCBhIHNlcnZlci4nIHwgdHJhbnNsYXRlIH19PC9wPlxuICA8L2Rpdj5cbjwvZGl2PlxuXG48Zm9ybSAjb3BjdWFDb25maWdGb3JtPVwibmdGb3JtXCIgY2xhc3M9XCJkLWNvbnRlbnRzXCIgKm5nSWY9XCJzZXJ2ZXJcIj5cbiAgPGRpdiBjbGFzcz1cImNhcmQtaGVhZGVyIGxhcmdlLXBhZGRpbmcgc2VwYXJhdG9yIHN0aWNreS10b3AgdmlzaWJsZS1zbSB2aXNpYmxlLXhzXCI+XG4gICAgPGJ1dHRvblxuICAgICAgY2xhc3M9XCJidG4gYnRuLWNsZWFuIHRleHQtcHJpbWFyeSB2aXNpYmxlLXNtIHZpc2libGUteHNcIlxuICAgICAgdGl0bGU9XCJ7eyAnQmFjaycgfCB0cmFuc2xhdGUgfX1cIlxuICAgICAgKGNsaWNrKT1cImNhbmNlbCgpXCJcbiAgICA+XG4gICAgICA8aSBjOHlJY29uPVwiY2hldnJvbi1sZWZ0XCI+PC9pPlxuICAgICAge3sgJ0JhY2snIHwgdHJhbnNsYXRlIH19XG4gICAgPC9idXR0b24+XG4gIDwvZGl2PlxuICA8ZGl2IGNsYXNzPVwiZmxleC1ncm93XCI+XG4gICAgPGRpdiBjbGFzcz1cImNhcmQtYmxvY2sgbGFyZ2UtcGFkZGluZ1wiPlxuICAgICAgPCEtLSBTRVJWRVIgTkFNRSAtLT5cbiAgICAgIDxjOHktZm9ybS1ncm91cCBjbGFzcz1cIm0tYi04XCI+XG4gICAgICAgIDxsYWJlbD5cbiAgICAgICAgICB7eyAnU2VydmVyIG5hbWUnIHwgdHJhbnNsYXRlIH19XG4gICAgICAgIDwvbGFiZWw+XG4gICAgICAgIDxpbnB1dFxuICAgICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICBjbGFzcz1cImZvcm0tY29udHJvbFwiXG4gICAgICAgICAgcGxhY2Vob2xkZXI9XCJ7eyAnZS5nLiBNeSBzZXJ2ZXInIHwgdHJhbnNsYXRlIH19XCJcbiAgICAgICAgICBpZD1cIm5hbWVcIlxuICAgICAgICAgIG5hbWU9XCJuYW1lXCJcbiAgICAgICAgICBbKG5nTW9kZWwpXT1cIm1vZGVsLm5hbWVcIlxuICAgICAgICAgIHJlcXVpcmVkXG4gICAgICAgIC8+XG4gICAgICAgIDxjOHktbWVzc2FnZXM+XG4gICAgICAgICAgPGM4eS1tZXNzYWdlXG4gICAgICAgICAgICBuYW1lPVwicmVxdWlyZWRcIlxuICAgICAgICAgICAgdGV4dD1cInt7ICdTZXJ2ZXIgbmFtZSBpcyByZXF1aXJlZCcgfCB0cmFuc2xhdGUgfX1cIlxuICAgICAgICAgID48L2M4eS1tZXNzYWdlPlxuICAgICAgICA8L2M4eS1tZXNzYWdlcz5cbiAgICAgIDwvYzh5LWZvcm0tZ3JvdXA+XG4gICAgPC9kaXY+XG5cbiAgICA8ZGl2IGNsYXNzPVwiY2FyZC1ibG9jayBsYXJnZS1wYWRkaW5nIGJnLWxldmVsLTJcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJ0aWdodC1ncmlkXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtc20tNlwiPlxuICAgICAgICAgIDxsYWJlbCBjbGFzcz1cImZpdC13XCIgdHJhbnNsYXRlPlNlcnZlciBjb25uZWN0aW9uPC9sYWJlbD5cbiAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgICAgIGNsYXNzPVwiYnRuIG0tdC00XCJcbiAgICAgICAgICAgIG5hbWU9XCJzZXJ2ZXJDb25uZWN0aW9uXCJcbiAgICAgICAgICAgIFsobmdNb2RlbCldPVwidGFyZ2V0Q29ubmVjdGlvblN0YXRlXCJcbiAgICAgICAgICAgIChuZ01vZGVsQ2hhbmdlKT1cInNldFNlcnZlckNvbm5lY3Rpb24oJGV2ZW50KVwiXG4gICAgICAgICAgICBidG5DaGVja2JveFxuICAgICAgICAgICAgYnRuQ2hlY2tib3hUcnVlPVwiMVwiXG4gICAgICAgICAgICBidG5DaGVja2JveEZhbHNlPVwiMFwiXG4gICAgICAgICAgPlxuICAgICAgICAgICAgPHNwYW4gdGl0bGU9XCJ7eyAnRW5hYmxlZCcgfCB0cmFuc2xhdGUgfX1cIiBbaGlkZGVuXT1cInRhcmdldENvbm5lY3Rpb25TdGF0ZSAhPT0gJzEnXCI+XG4gICAgICAgICAgICAgIHt7ICdFbmFibGVkJyB8IHRyYW5zbGF0ZSB9fVxuICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgPHNwYW4gdGl0bGU9XCJ7eyAnRGlzYWJsZWQnIHwgdHJhbnNsYXRlIH19XCIgW2hpZGRlbl09XCJ0YXJnZXRDb25uZWN0aW9uU3RhdGUgIT09ICcwJ1wiPlxuICAgICAgICAgICAgICB7eyAnRGlzYWJsZWQnIHwgdHJhbnNsYXRlIH19XG4gICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXNtLTZcIj5cbiAgICAgICAgICA8bGFiZWwgdHJhbnNsYXRlPkNvbm5lY3Rpb24gc3RhdHVzPC9sYWJlbD5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1jb250cm9sLXN0YXRpY1wiPlxuICAgICAgICAgICAgPGRldmljZS1zdGF0dXMgY2xhc3M9XCJwLXItOFwiIFttb109XCJzZXJ2ZXJcIj48L2RldmljZS1zdGF0dXM+XG4gICAgICAgICAgICA8c3Bhbj57eyBjb25uZWN0aW9uU3RhdHVzTGFiZWwgfCB0cmFuc2xhdGUgfX08L3NwYW4+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cImNhcmQtYmxvY2sgbGFyZ2UtcGFkZGluZ1wiPlxuICAgICAgPCEtLSBTRVJWRVIgVVJMLS0+XG4gICAgICA8Yzh5LWZvcm0tZ3JvdXA+XG4gICAgICAgIDxsYWJlbCBmb3I9XCJjb25maWdTZXJ2ZXJVcmxcIiB0cmFuc2xhdGU+U2VydmVyIFVSTDwvbGFiZWw+XG4gICAgICAgIDxpbnB1dFxuICAgICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICBjbGFzcz1cImZvcm0tY29udHJvbFwiXG4gICAgICAgICAgaWQ9XCJjb25maWdTZXJ2ZXJVcmxcIlxuICAgICAgICAgIG5hbWU9XCJzZXJ2ZXJVcmxcIlxuICAgICAgICAgIFsobmdNb2RlbCldPVwibW9kZWwuY29uZmlnLnNlcnZlclVybFwiXG4gICAgICAgICAgYzh5RGVmYXVsdFZhbGlkYXRpb249XCJvcGN1YUJyb3dzZVBhdGhcIlxuICAgICAgICAgIHJlcXVpcmVkXG4gICAgICAgIC8+XG4gICAgICA8L2M4eS1mb3JtLWdyb3VwPlxuXG4gICAgICA8IS0tIFRJTUVPVVQgJiBTVEFUVVMtQ0hFQ0stSU5URVJWQUwtLT5cbiAgICAgIDxkaXYgY2xhc3M9XCJjb250ZW50LWZsZXgtMzJcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC02XCI+XG4gICAgICAgICAgPGM4eS1mb3JtLWdyb3VwPlxuICAgICAgICAgICAgPGxhYmVsIGZvcj1cImNvbmZpZy50aW1lb3V0XCIgdHJhbnNsYXRlPlRpbWVvdXQ8L2xhYmVsPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImlucHV0LWdyb3VwXCI+XG4gICAgICAgICAgICAgIDxpbnB1dFxuICAgICAgICAgICAgICAgIHR5cGU9XCJudW1iZXJcIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCJcbiAgICAgICAgICAgICAgICBpZD1cImNvbmZpZy50aW1lb3V0XCJcbiAgICAgICAgICAgICAgICBuYW1lPVwidGltZW91dFwiXG4gICAgICAgICAgICAgICAgW21pbl09XCJtaW5JbnRlcnZhbE51bWJlclwiXG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJ7eyAnZS5nLicgfCB0cmFuc2xhdGUgfX0gMzBcIlxuICAgICAgICAgICAgICAgIFsobmdNb2RlbCldPVwibW9kZWwuY29uZmlnLnRpbWVvdXRcIlxuICAgICAgICAgICAgICAgIHJlcXVpcmVkXG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiaW5wdXQtZ3JvdXAtYWRkb24gdW5pdHNcIiB0cmFuc2xhdGU+c2Vjb25kczwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvYzh5LWZvcm0tZ3JvdXA+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLTZcIj5cbiAgICAgICAgICA8Yzh5LWZvcm0tZ3JvdXA+XG4gICAgICAgICAgICA8bGFiZWwgZm9yPVwiY29uZmlnLnN0YXR1c0NoZWNrSW50ZXJ2YWxcIiB0cmFuc2xhdGU+U3RhdHVzIGNoZWNrIGludGVydmFsPC9sYWJlbD5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJpbnB1dC1ncm91cFwiPlxuICAgICAgICAgICAgICA8aW5wdXRcbiAgICAgICAgICAgICAgICB0eXBlPVwibnVtYmVyXCJcbiAgICAgICAgICAgICAgICBjbGFzcz1cImZvcm0tY29udHJvbFwiXG4gICAgICAgICAgICAgICAgaWQ9XCJjb25maWcuc3RhdHVzQ2hlY2tJbnRlcnZhbFwiXG4gICAgICAgICAgICAgICAgbmFtZT1cInN0YXR1c0NoZWNrSW50ZXJ2YWxcIlxuICAgICAgICAgICAgICAgIFttaW5dPVwibWluSW50ZXJ2YWxOdW1iZXJcIlxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwie3sgJ2UuZy4nIHwgdHJhbnNsYXRlIH19IDQwXCJcbiAgICAgICAgICAgICAgICBbKG5nTW9kZWwpXT1cIm1vZGVsLmNvbmZpZy5zdGF0dXNDaGVja0ludGVydmFsXCJcbiAgICAgICAgICAgICAgICByZXF1aXJlZFxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cImlucHV0LWdyb3VwLWFkZG9uIHVuaXRzXCIgdHJhbnNsYXRlPnNlY29uZHM8L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2M4eS1mb3JtLWdyb3VwPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8IS0tIFNFQ1VSSVRZIE1PREUgLS0+XG4gICAgICA8ZGl2IGNsYXNzPVwidGlnaHQtZ3JpZFwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLTZcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICAgICAgPCEtLSBOT05FLCBTSUdOLCBTSUdOICYgRU5DUllQVC0tPlxuICAgICAgICAgICAgPGxhYmVsIGZvcj1cImNvbmZpZy5zZWN1cml0eU1vZGVcIiB0cmFuc2xhdGU+U2VjdXJpdHkgbW9kZTwvbGFiZWw+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYzh5LXNlbGVjdC13cmFwcGVyXCI+XG4gICAgICAgICAgICAgIDxzZWxlY3RcbiAgICAgICAgICAgICAgICBjbGFzcz1cImZvcm0tY29udHJvbFwiXG4gICAgICAgICAgICAgICAgaWQ9XCJjb25maWcuc2VjdXJpdHlNb2RlXCJcbiAgICAgICAgICAgICAgICBbKG5nTW9kZWwpXT1cImN1cnJlbnRTZWNNb2RlXCJcbiAgICAgICAgICAgICAgICAobmdNb2RlbENoYW5nZSk9XCJzZXRQb2xpY3koJGV2ZW50KVwiXG4gICAgICAgICAgICAgICAgbmFtZT1cInNlY3VyaXR5TW9kZVwiXG4gICAgICAgICAgICAgICAgcmVxdWlyZWRcbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxvcHRpb24gKm5nRm9yPVwibGV0IG1vZGUgb2Ygc2VjdXJpdHlNb2Rlc1wiIFtuZ1ZhbHVlXT1cIm1vZGVcIj57eyBtb2RlIH19PC9vcHRpb24+XG4gICAgICAgICAgICAgIDwvc2VsZWN0PlxuICAgICAgICAgICAgICA8c3Bhbj48L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgKm5nSWY9XCJjdXJyZW50U2VjTW9kZSA9PT0gTk9ORVwiIGNsYXNzPVwiY29sLW1kLTZcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICAgICAgPGxhYmVsIGZvcj1cImNvbmZpZy5zZWN1cml0eVBvbGljeVwiIHRyYW5zbGF0ZT5TZWN1cml0eSBwb2xpY3k8L2xhYmVsPlxuICAgICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIlxuICAgICAgICAgICAgICBpZD1cImNvbmZpZy5zZWN1cml0eVBvbGljeVwiXG4gICAgICAgICAgICAgIG5hbWU9XCJzZWN1cml0eVBvbGljeVwiXG4gICAgICAgICAgICAgIFtyZWFkb25seV09XCJ0cnVlXCJcbiAgICAgICAgICAgICAgWyhuZ01vZGVsKV09XCJtb2RlbC5jb25maWcuc2VjdXJpdHlNb2RlXCJcbiAgICAgICAgICAgICAgcmVxdWlyZWRcbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2ICpuZ0lmPVwiY3VycmVudFNlY01vZGUgIT09IE5PTkVcIiBjbGFzcz1cImNvbC1tZC02XCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cbiAgICAgICAgICAgIDxsYWJlbCBmb3I9XCJjb25maWcuc2VjdXJpdHlQb2xpY3lcIiB0cmFuc2xhdGU+U2VjdXJpdHkgcG9saWN5PC9sYWJlbD5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjOHktc2VsZWN0LXdyYXBwZXJcIj5cbiAgICAgICAgICAgICAgPHNlbGVjdFxuICAgICAgICAgICAgICAgICpuZ0lmPVwiY3VycmVudFNlY01vZGUgPT09IFNJR05cIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCJcbiAgICAgICAgICAgICAgICBpZD1cImNvbmZpZy5zZWN1cml0eVBvbGljeVwiXG4gICAgICAgICAgICAgICAgWyhuZ01vZGVsKV09XCJtb2RlbC5jb25maWcuc2VjdXJpdHlNb2RlXCJcbiAgICAgICAgICAgICAgICBuYW1lPVwic2VjdXJpdHlQb2xpY3lcIlxuICAgICAgICAgICAgICAgIHJlcXVpcmVkXG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8b3B0aW9uICpuZ0Zvcj1cImxldCBwb2xpY3kgb2Ygc2VjdXJpdHlQb2xpY2llcy5zaWduXCIgW25nVmFsdWVdPVwicG9saWN5XCI+XG4gICAgICAgICAgICAgICAgICB7eyBwb2xpY3kgfX1cbiAgICAgICAgICAgICAgICA8L29wdGlvbj5cbiAgICAgICAgICAgICAgPC9zZWxlY3Q+XG4gICAgICAgICAgICAgIDxzZWxlY3RcbiAgICAgICAgICAgICAgICAqbmdJZj1cImN1cnJlbnRTZWNNb2RlID09PSBTSUdOX0VOQ1wiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIlxuICAgICAgICAgICAgICAgIGlkPVwiY29uZmlnLnNlY3VyaXR5UG9saWN5XCJcbiAgICAgICAgICAgICAgICBbKG5nTW9kZWwpXT1cIm1vZGVsLmNvbmZpZy5zZWN1cml0eU1vZGVcIlxuICAgICAgICAgICAgICAgIG5hbWU9XCJzZWN1cml0eVBvbGljeVwiXG4gICAgICAgICAgICAgICAgcmVxdWlyZWRcbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxvcHRpb24gKm5nRm9yPVwibGV0IHBvbGljeSBvZiBzZWN1cml0eVBvbGljaWVzLnNpZ25fZW5jXCIgW25nVmFsdWVdPVwicG9saWN5XCI+XG4gICAgICAgICAgICAgICAgICB7eyBwb2xpY3kgfX1cbiAgICAgICAgICAgICAgICA8L29wdGlvbj5cbiAgICAgICAgICAgICAgPC9zZWxlY3Q+XG4gICAgICAgICAgICAgIDxzcGFuPjwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8IS0tIEFVVEhFTlRJQ0FUSU9OIC0tPlxuICAgICAgPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cbiAgICAgICAgPGxhYmVsIGZvcj1cImNvbmZpZy5hdXRoZW50aWNhdGlvbk1vZGVcIiB0cmFuc2xhdGU+QXV0aGVudGljYXRpb248L2xhYmVsPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiYzh5LXNlbGVjdC13cmFwcGVyXCI+XG4gICAgICAgICAgPHNlbGVjdFxuICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIlxuICAgICAgICAgICAgaWQ9XCJjb25maWcuYXV0aGVudGljYXRpb25Nb2RlXCJcbiAgICAgICAgICAgIFsobmdNb2RlbCldPVwiYXV0aGVudGljYXRpb25Nb2RlXCJcbiAgICAgICAgICAgIG5hbWU9XCJhdXRoZW50aWNhdGlvbk1vZGVcIlxuICAgICAgICAgICAgKG5nTW9kZWxDaGFuZ2UpPVwidXBkYXRlQXV0aGVudGljYXRpb24oJGV2ZW50KVwiXG4gICAgICAgICAgICByZXF1aXJlZFxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxvcHRpb24gKm5nRm9yPVwibGV0IGF1dGggb2YgYXV0aGVudGljYXRpb25Nb2Rlc1wiIFtuZ1ZhbHVlXT1cImF1dGhcIj5cbiAgICAgICAgICAgICAge3sgYXV0aC52YWx1ZSB8IHRyYW5zbGF0ZSB9fVxuICAgICAgICAgICAgPC9vcHRpb24+XG4gICAgICAgICAgPC9zZWxlY3Q+XG4gICAgICAgICAgPHNwYW4+PC9zcGFuPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8IS0tIFVzZXIvUHctLT5cbiAgICAgIDxkaXYgKm5nSWY9XCJhdXRoZW50aWNhdGlvbk1vZGUuaWQgPT09IDJcIiBjbGFzcz1cInRpZ2h0LWdyaWRcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1tZC0xMlwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XG4gICAgICAgICAgICA8bGFiZWwgZm9yPVwiY29uZmlnLnVzZXJOYW1lXCIgdHJhbnNsYXRlPlVzZXJuYW1lPC9sYWJlbD5cbiAgICAgICAgICAgIDxpbnB1dFxuICAgICAgICAgICAgICB0eXBlPVwidGV4dFwiXG4gICAgICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCJcbiAgICAgICAgICAgICAgaWQ9XCJjb25maWcudXNlck5hbWVcIlxuICAgICAgICAgICAgICBuYW1lPVwidXNlck5hbWVcIlxuICAgICAgICAgICAgICBwbGFjZWhvbGRlcj1cInt7ICdlLmcuIGpvZS5kb2VgTE9DQUxJWkVgJyB8IHRyYW5zbGF0ZSB9fVwiXG4gICAgICAgICAgICAgIFsobmdNb2RlbCldPVwibW9kZWwuY29uZmlnLnVzZXJOYW1lXCJcbiAgICAgICAgICAgICAgYXV0b2NvbXBsZXRlPVwibmV3LXBhc3N3b3JkXCJcbiAgICAgICAgICAgICAgcmVxdWlyZWRcbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8IS0tIGNoYW5nZSBwYXNzd29yZCBzZWN0aW9uIEJFR0lOUy0tPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLTZcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiICpuZ0lmPVwiIWluaXRpYWxQYXNzd29yZFJlcXVpcmVkXCI+XG4gICAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImJ0biBidG4tZGVmYXVsdFwiIChjbGljayk9XCJ0b2dnbGVDaGFuZ2VQYXNzd29yZCgpXCI+XG4gICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCIhY2hhbmdlUGFzc3dvcmRcIj5cbiAgICAgICAgICAgICAgICB7eyAnQ2hhbmdlIHBhc3N3b3JkJyB8IHRyYW5zbGF0ZSB9fVxuICAgICAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImNoYW5nZVBhc3N3b3JkXCI+XG4gICAgICAgICAgICAgICAge3sgJ0NhbmNlbCBwYXNzd29yZCBjaGFuZ2UnIHwgdHJhbnNsYXRlIH19XG4gICAgICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICAgICAgPGRpdiAqbmdJZj1cImNoYW5nZVBhc3N3b3JkXCI+XG4gICAgICAgICAgICAgIDxsYWJlbCBmb3I9XCJjb25maWcucGFzc3dvcmRcIiB0cmFuc2xhdGU+UGFzc3dvcmQ8L2xhYmVsPlxuICAgICAgICAgICAgICA8aW5wdXRcbiAgICAgICAgICAgICAgICB0eXBlPVwicGFzc3dvcmRcIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCJcbiAgICAgICAgICAgICAgICBpZD1cImNvbmZpZy51c2VyUGFzc3dvcmRcIlxuICAgICAgICAgICAgICAgIG5hbWU9XCJwYXNzd29yZFwiXG4gICAgICAgICAgICAgICAgWyhuZ01vZGVsKV09XCJtb2RlbC5jb25maWcudXNlclBhc3N3b3JkXCJcbiAgICAgICAgICAgICAgICBhdXRvY29tcGxldGU9XCJuZXctcGFzc3dvcmRcIlxuICAgICAgICAgICAgICAgIHJlcXVpcmVkXG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDwhLS0gY2hhbmdlIHBhc3N3b3JkIHNlY3Rpb24gRU5EUy0tPlxuICAgICAgPC9kaXY+XG4gICAgICA8IS0tIEtleS1iYXNlZCAtLT5cbiAgICAgIDxkaXYgKm5nSWY9XCJhdXRoZW50aWNhdGlvbk1vZGUuaWQgPT09IDNcIiBjbGFzcz1cInRpZ2h0LWdyaWRcIj5cbiAgICAgICAgPCEtLSBLRVlTVE9SRSBQQVNTV09SRCAtLT5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1tZC02XCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cbiAgICAgICAgICAgIDxsYWJlbCBmb3I9XCJjb25maWcua2V5c3RvcmVQYXNzXCIgdHJhbnNsYXRlPktleXN0b3JlIHBhc3N3b3JkPC9sYWJlbD5cbiAgICAgICAgICAgIDxpbnB1dFxuICAgICAgICAgICAgICB0eXBlPVwicGFzc3dvcmRcIlxuICAgICAgICAgICAgICBjbGFzcz1cImZvcm0tY29udHJvbFwiXG4gICAgICAgICAgICAgIGlkPVwiY29uZmlnLmtleXN0b3JlUGFzc1wiXG4gICAgICAgICAgICAgIG5hbWU9XCJrZXlzdG9yZVBhc3NcIlxuICAgICAgICAgICAgICBbKG5nTW9kZWwpXT1cIm1vZGVsLmNvbmZpZy5rZXlzdG9yZVBhc3NcIlxuICAgICAgICAgICAgICByZXF1aXJlZFxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtbWQtNlwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XG4gICAgICAgICAgICA8bGFiZWwgZm9yPVwiY29uZmlnLmNlcnRpZmljYXRlUGFzc1wiIHRyYW5zbGF0ZT5DZXJ0aWZpY2F0ZSBwYXNzd29yZDwvbGFiZWw+XG4gICAgICAgICAgICA8aW5wdXRcbiAgICAgICAgICAgICAgdHlwZT1cInBhc3N3b3JkXCJcbiAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIlxuICAgICAgICAgICAgICBpZD1cImNvbmZpZy5jZXJ0aWZpY2F0ZVBhc3NcIlxuICAgICAgICAgICAgICBuYW1lPVwia2V5c3RvcmVQYXNzXCJcbiAgICAgICAgICAgICAgWyhuZ01vZGVsKV09XCJtb2RlbC5jb25maWcuY2VydGlmaWNhdGVQYXNzXCJcbiAgICAgICAgICAgICAgcmVxdWlyZWRcbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8IS0tIFVQTE9BRCBLRVlTVE9SRSAtLT5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1tZC0xMlwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XG4gICAgICAgICAgICA8bGFiZWwgZm9yPVwiY2VydGlmaWNhdGVVcGxvYWRcIiB0cmFuc2xhdGU+VXBsb2FkIGtleXN0b3JlPC9sYWJlbD5cbiAgICAgICAgICAgIDxpbnB1dFxuICAgICAgICAgICAgICB0eXBlPVwidGV4dFwiXG4gICAgICAgICAgICAgIFtyZWFkb25seV09XCJ0cnVlXCJcbiAgICAgICAgICAgICAgbmFtZT1cImNlcnRpZmljYXRlVXBsb2FkXCJcbiAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2wgbS1iLThcIlxuICAgICAgICAgICAgICBbbmdNb2RlbF09XCJmaWxlTmFtZVwiXG4gICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwie3sgJ2UuZy4nIHwgdHJhbnNsYXRlIH19IHlvdXJLZXlzdG9yZS5qa3NcIlxuICAgICAgICAgICAgICByZXF1aXJlZFxuICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDxjOHktZHJvcC1hcmVhXG4gICAgICAgICAgICAgIChkcm9wcGVkKT1cInVwbG9hZEZpbGUoJGV2ZW50KVwiXG4gICAgICAgICAgICAgIFtsb2FkaW5nTWVzc2FnZV09XCInSW1wb3J0aW5nLCBwbGVhc2Ugd2FpdC4nIHwgdHJhbnNsYXRlXCJcbiAgICAgICAgICAgICAgW3RpdGxlXT1cIidJbXBvcnQga2V5c3RvcmUgd2l0aCBqa3MgZmlsZSBleHRlbnNpb24nIHwgdHJhbnNsYXRlXCJcbiAgICAgICAgICAgID48L2M4eS1kcm9wLWFyZWE+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuICA8ZGl2IGNsYXNzPVwiY2FyZC1mb290ZXIgbGFyZ2UtcGFkZGluZyBzZXBhcmF0b3Igc3RpY2t5LWJvdHRvbVwiPlxuICAgIDxidXR0b25cbiAgICAgIHRpdGxlPVwie3sgJ0NhbmNlbCcgfCB0cmFuc2xhdGUgfX1cIlxuICAgICAgdHlwZT1cImJ1dHRvblwiXG4gICAgICBjbGFzcz1cImJ0biBidG4tZGVmYXVsdFwiXG4gICAgICAoY2xpY2spPVwiY2FuY2VsKClcIlxuICAgID5cbiAgICAgIHt7ICdDYW5jZWwnIHwgdHJhbnNsYXRlIH19XG4gICAgPC9idXR0b24+XG4gICAgPGJ1dHRvblxuICAgICAgdGl0bGU9XCJ7eyAnUmVtb3ZlJyB8IHRyYW5zbGF0ZSB9fVwiXG4gICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgIGNsYXNzPVwiYnRuIGJ0bi1kYW5nZXJcIlxuICAgICAgKGNsaWNrKT1cInJlbW92ZSgpXCJcbiAgICA+XG4gICAgICB7eyAnUmVtb3ZlJyB8IHRyYW5zbGF0ZSB9fVxuICAgIDwvYnV0dG9uPlxuICAgIDxidXR0b25cbiAgICAgIHRpdGxlPVwie3sgJ1NhdmUnIHwgdHJhbnNsYXRlIH19XCJcbiAgICAgIHR5cGU9XCJzdWJtaXRcIlxuICAgICAgY2xhc3M9XCJidG4gYnRuLXByaW1hcnlcIlxuICAgICAgKGNsaWNrKT1cInNhdmUoKVwiXG4gICAgICBbZGlzYWJsZWRdPVwiIW9wY3VhQ29uZmlnRm9ybS52YWxpZFwiXG4gICAgPlxuICAgICAge3sgJ1NhdmUnIHwgdHJhbnNsYXRlIH19XG4gICAgPC9idXR0b24+XG4gIDwvZGl2PlxuPC9mb3JtPlxuIl19