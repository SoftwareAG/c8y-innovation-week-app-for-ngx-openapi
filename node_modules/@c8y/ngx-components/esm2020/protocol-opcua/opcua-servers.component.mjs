import { Component, Optional } from '@angular/core';
import { AlertService, ContextRouteComponent, gettext } from '@c8y/ngx-components';
import { TranslateService } from '@ngx-translate/core';
import { OpcuaService } from './opcuaService';
import * as i0 from "@angular/core";
import * as i1 from "./opcuaService";
import * as i2 from "@c8y/ngx-components";
import * as i3 from "@ngx-translate/core";
import * as i4 from "@angular/common";
import * as i5 from "ngx-bootstrap/popover";
import * as i6 from "./opcua-server-list.component";
import * as i7 from "./opcua-server-config.component";
export class OpcuaServersComponent {
    constructor(opcuaService, alertService, translateService, context) {
        this.opcuaService = opcuaService;
        this.alertService = alertService;
        this.translateService = translateService;
        this.context = context;
        this.serverObjectList = [];
        this.initialServerObject = {
            id: '',
            name: 'New Server',
            config: {
                securityMode: 'NONE',
                keystorePass: null,
                keystoreBinaryId: null,
                keystoreFilename: '',
                certificatePass: null,
                serverUrl: '',
                userName: '',
                userPassword: '',
                rescanCron: null,
                timeout: null,
                autoReconnect: true,
                statusCheckInterval: null,
                valid: true
            },
            quickInfo: {
                padlock: 'unlock',
                padlockMsg: ''
            },
            active: true
        };
        this.active = false;
        this.moId = '';
        this.NEW_SERVER_ID = 'new';
        this.initialServerObject.id = this.NEW_SERVER_ID;
    }
    async ngOnInit() {
        this.moId = this.opcuaService.getMoId();
        if (this.moId && this.moId.length > 0) {
            const res = await this.opcuaService.getServers(this.moId);
            if (res && res.status !== 200) {
                const data = res.json ? await res.json() : undefined;
                this.alertService.addServerFailure({ data, res });
            }
            else {
                this.serverObjectList = (await res.json());
                this.serverObjectList.map(server => this.setQuickInfo(server));
            }
        }
    }
    localServerObjectExist() {
        return !!this.serverObjectList.find(server => server.id === this.NEW_SERVER_ID);
    }
    addServer() {
        const server = this.initialServerObject;
        this.serverObjectList.push(server);
        this.onPresent(server);
    }
    onSaved(server) {
        if (server && server.id) {
            server.gatewayId = this.moId;
            if (server.id === this.NEW_SERVER_ID) {
                this.createServer(server);
            }
            else {
                this.updateServer(server);
            }
        }
    }
    reloadTabs() {
        if (this.context) {
            this.context.refreshTabs();
        }
    }
    onCanceled(server) {
        if (server && server.id && server.id === this.NEW_SERVER_ID) {
            this.removeServerObjectListById(server.id);
        }
        else {
            // update activity status for UI
            this.serverObjectList.forEach(item => {
                if (item.id === server.id) {
                    item.active = false;
                }
            });
            // When server id is not 'new' we just close the details
            delete this.server;
        }
    }
    onRemoved(server) {
        if (server.id === this.NEW_SERVER_ID) {
            this.onCanceled(server);
        }
        else {
            this.removeServer(server);
        }
    }
    async getKeystore(binaryId) {
        const { data } = await this.opcuaService.getKeystore(binaryId);
        return data;
    }
    async onPresent(server) {
        if (server &&
            server.id !== this.NEW_SERVER_ID &&
            server.config &&
            server.config.keystoreBinaryId) {
            try {
                const mo = await this.getKeystore(server.config.keystoreBinaryId);
                server.config.keystoreFilename = mo.name;
            }
            catch (ex) {
                this.server = Object.assign({}, server);
                console.log('Could not get existing keystore:', ex);
            }
        }
        if (this.serverObjectList.length > 0) {
            this.serverObjectList.forEach(item => {
                item.active = false;
                if (item.id === server.id) {
                    item.active = true;
                    server.active = item.active;
                }
            });
            this.setQuickInfo(server);
            this.server = Object.assign({}, server);
        }
    }
    async createServer(server) {
        const response = await this.opcuaService.createServer(server);
        const svr = (await response.json());
        this.updateServerObjectListById(this.NEW_SERVER_ID, svr);
        this.reloadTabs();
    }
    async updateServer(server) {
        const updatedServer = (await this.opcuaService.updateServer(server));
        if (updatedServer) {
            this.updateServerObjectListById(updatedServer.id, updatedServer);
        }
    }
    async removeServer(server) {
        try {
            await this.opcuaService.removeServer(server);
            this.removeServerObjectListById(server.id);
            this.reloadTabs();
        }
        catch (ex) {
            console.log('Could not remove OPC UA server:', ex);
        }
    }
    removeServerObjectListById(id) {
        this.serverObjectList.forEach((item, index) => {
            if (item.id === id) {
                this.serverObjectList.splice(index, 1);
                delete this.server;
            }
        });
    }
    updateServerObjectListById(id, server) {
        const idx = this.serverObjectList.findIndex(item => item.id === id);
        if (idx > -1) {
            this.setQuickInfo(server);
            this.serverObjectList[idx] = server;
        }
        delete this.server;
    }
    setQuickInfo(server) {
        server.quickInfo = {
            padlock: 'unlock',
            padlockMsg: ''
        };
        if (server && server.config) {
            if (server.config.securityMode) {
                server.quickInfo.padlock = server.config.securityMode !== 'NONE' ? 'lock' : 'unlock';
                server.quickInfo.padlockMsg = this.translateService.instant(gettext('The security policy is set to {{param}}.'), { param: server.config.securityMode });
            }
        }
    }
}
OpcuaServersComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: OpcuaServersComponent, deps: [{ token: i1.OpcuaService }, { token: i2.AlertService }, { token: i3.TranslateService }, { token: i2.ContextRouteComponent, optional: true }], target: i0.ɵɵFactoryTarget.Component });
OpcuaServersComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.7", type: OpcuaServersComponent, selector: "opcua-servers", ngImport: i0, template: "<div class=\"card content-fullpage split-view--5-7\">\n  <div class=\"card-header grid__col--fullspan separator\">\n    <div class=\"h4 card-title\">OPC UA servers</div>\n    <button\n      class=\"btn-help\"\n      type=\"button\"\n      [attr.aria-label]=\"'Help' | translate\"\n      popover=\"{{\n        'Below you can configure one or more OPC UA servers. The OPC UA agent will connect to these servers if they are enabled and the connection state is set to connected.'\n          | translate\n      }}\"\n      placement=\"right\"\n      triggers=\"focus\"\n    ></button>\n  </div>\n  <div class=\"inner-scroll split-view__list\">\n    <div class=\"bg-level-1 flex-grow\">\n      <div class=\"c8y-nav-stacked\">\n        <opcua-server-list\n          [serverList]=\"serverObjectList\"\n          (present)=\"onPresent($event)\"\n        ></opcua-server-list>\n      </div>\n    </div>\n    <div class=\"card-footer separator sticky-bottom\">\n      <button\n        class=\"btn btn-default\"\n        title=\"{{ 'Add server' | translate }}\"\n        type=\"button\"\n        [disabled]=\"localServerObjectExist()\"\n        (click)=\"addServer()\"\n      >\n        <i [c8yIcon]=\"'plus-circle'\"></i>\n        {{ 'Add server' | translate }}\n      </button>\n    </div>\n  </div>\n\n  <opcua-server-config\n    class=\"inner-scroll split-view__detail\"\n    [ngClass]=\"{ 'split-view__detail--selected': server }\"\n    (canceled)=\"onCanceled($event)\"\n    (removed)=\"onRemoved($event)\"\n    (saved)=\"onSaved($event)\"\n    [server]=\"server\"\n  ></opcua-server-config>\n</div>\n", dependencies: [{ kind: "directive", type: i2.IconDirective, selector: "[c8yIcon]", inputs: ["c8yIcon"] }, { kind: "directive", type: i4.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i5.PopoverDirective, selector: "[popover]", inputs: ["adaptivePosition", "boundariesElement", "popover", "popoverContext", "popoverTitle", "placement", "outsideClick", "triggers", "container", "containerClass", "isOpen", "delay"], outputs: ["onShown", "onHidden"], exportAs: ["bs-popover"] }, { kind: "component", type: i6.OpcuaServerListComponent, selector: "opcua-server-list", inputs: ["serverList"], outputs: ["present"] }, { kind: "component", type: i7.OpcuaServerConfigComponent, selector: "opcua-server-config", inputs: ["server"], outputs: ["canceled", "removed", "saved"] }, { kind: "pipe", type: i2.C8yTranslatePipe, name: "translate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: OpcuaServersComponent, decorators: [{
            type: Component,
            args: [{ selector: 'opcua-servers', template: "<div class=\"card content-fullpage split-view--5-7\">\n  <div class=\"card-header grid__col--fullspan separator\">\n    <div class=\"h4 card-title\">OPC UA servers</div>\n    <button\n      class=\"btn-help\"\n      type=\"button\"\n      [attr.aria-label]=\"'Help' | translate\"\n      popover=\"{{\n        'Below you can configure one or more OPC UA servers. The OPC UA agent will connect to these servers if they are enabled and the connection state is set to connected.'\n          | translate\n      }}\"\n      placement=\"right\"\n      triggers=\"focus\"\n    ></button>\n  </div>\n  <div class=\"inner-scroll split-view__list\">\n    <div class=\"bg-level-1 flex-grow\">\n      <div class=\"c8y-nav-stacked\">\n        <opcua-server-list\n          [serverList]=\"serverObjectList\"\n          (present)=\"onPresent($event)\"\n        ></opcua-server-list>\n      </div>\n    </div>\n    <div class=\"card-footer separator sticky-bottom\">\n      <button\n        class=\"btn btn-default\"\n        title=\"{{ 'Add server' | translate }}\"\n        type=\"button\"\n        [disabled]=\"localServerObjectExist()\"\n        (click)=\"addServer()\"\n      >\n        <i [c8yIcon]=\"'plus-circle'\"></i>\n        {{ 'Add server' | translate }}\n      </button>\n    </div>\n  </div>\n\n  <opcua-server-config\n    class=\"inner-scroll split-view__detail\"\n    [ngClass]=\"{ 'split-view__detail--selected': server }\"\n    (canceled)=\"onCanceled($event)\"\n    (removed)=\"onRemoved($event)\"\n    (saved)=\"onSaved($event)\"\n    [server]=\"server\"\n  ></opcua-server-config>\n</div>\n" }]
        }], ctorParameters: function () { return [{ type: i1.OpcuaService }, { type: i2.AlertService }, { type: i3.TranslateService }, { type: i2.ContextRouteComponent, decorators: [{
                    type: Optional
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3BjdWEtc2VydmVycy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9wcm90b2NvbC1vcGN1YS9vcGN1YS1zZXJ2ZXJzLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uL3Byb3RvY29sLW9wY3VhL29wY3VhLXNlcnZlcnMuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDNUQsT0FBTyxFQUFFLFlBQVksRUFBRSxxQkFBcUIsRUFBRSxPQUFPLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNuRixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUV2RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7Ozs7Ozs7OztBQU05QyxNQUFNLE9BQU8scUJBQXFCO0lBK0JoQyxZQUNVLFlBQTBCLEVBQzFCLFlBQTBCLEVBQzFCLGdCQUFrQyxFQUN0QixPQUE4QjtRQUgxQyxpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUMxQixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUMxQixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ3RCLFlBQU8sR0FBUCxPQUFPLENBQXVCO1FBbENwRCxxQkFBZ0IsR0FBa0IsRUFBRSxDQUFDO1FBQ3JDLHdCQUFtQixHQUFnQjtZQUNqQyxFQUFFLEVBQUUsRUFBRTtZQUNOLElBQUksRUFBRSxZQUFZO1lBQ2xCLE1BQU0sRUFBRTtnQkFDTixZQUFZLEVBQUUsTUFBTTtnQkFDcEIsWUFBWSxFQUFFLElBQUk7Z0JBQ2xCLGdCQUFnQixFQUFFLElBQUk7Z0JBQ3RCLGdCQUFnQixFQUFFLEVBQUU7Z0JBQ3BCLGVBQWUsRUFBRSxJQUFJO2dCQUNyQixTQUFTLEVBQUUsRUFBRTtnQkFDYixRQUFRLEVBQUUsRUFBRTtnQkFDWixZQUFZLEVBQUUsRUFBRTtnQkFDaEIs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Q0FBQyxDQUFDLEVBQUU7WUFDWixJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzFCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsR0FBRyxNQUFNLENBQUM7U0FDckM7UUFDRCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDckIsQ0FBQztJQUVPLFlBQVksQ0FBQyxNQUFtQjtRQUN0QyxNQUFNLENBQUMsU0FBUyxHQUFHO1lBQ2pCLE9BQU8sRUFBRSxRQUFRO1lBQ2pCLFVBQVUsRUFBRSxFQUFFO1NBQ2YsQ0FBQztRQUVGLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLEVBQUU7WUFDM0IsSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDLFlBQVksRUFBRTtnQkFDOUIsTUFBTSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLEtBQUssTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQztnQkFDckYsTUFBTSxDQUFDLFNBQVMsQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FDekQsT0FBTyxDQUFDLDBDQUEwQyxDQUFDLEVBQ25ELEVBQUUsS0FBSyxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQ3RDLENBQUM7YUFDSDtTQUNGO0lBQ0gsQ0FBQzs7a0hBck1VLHFCQUFxQjtzR0FBckIscUJBQXFCLHFEQ1ZsQyw2akRBK0NBOzJGRHJDYSxxQkFBcUI7a0JBSmpDLFNBQVM7K0JBQ0UsZUFBZTs7MEJBc0N0QixRQUFRIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBbGVydFNlcnZpY2UsIENvbnRleHRSb3V0ZUNvbXBvbmVudCwgZ2V0dGV4dCB9IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMnO1xuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSB9IGZyb20gJ0BuZ3gtdHJhbnNsYXRlL2NvcmUnO1xuaW1wb3J0IHsgT3BjdWFTZXJ2ZXIgfSBmcm9tICcuL29wY3VhLXNlcnZlci5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgT3BjdWFTZXJ2aWNlIH0gZnJvbSAnLi9vcGN1YVNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdvcGN1YS1zZXJ2ZXJzJyxcbiAgdGVtcGxhdGVVcmw6ICcuL29wY3VhLXNlcnZlcnMuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIE9wY3VhU2VydmVyc0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIHNlcnZlck9iamVjdExpc3Q6IE9wY3VhU2VydmVyW10gPSBbXTtcbiAgaW5pdGlhbFNlcnZlck9iamVjdDogT3BjdWFTZXJ2ZXIgPSB7XG4gICAgaWQ6ICcnLFxuICAgIG5hbWU6ICdOZXcgU2VydmVyJyxcbiAgICBjb25maWc6IHtcbiAgICAgIHNlY3VyaXR5TW9kZTogJ05PTkUnLFxuICAgICAga2V5c3RvcmVQYXNzOiBudWxsLFxuICAgICAga2V5c3RvcmVCaW5hcnlJZDogbnVsbCxcbiAgICAgIGtleXN0b3JlRmlsZW5hbWU6ICcnLFxuICAgICAgY2VydGlmaWNhdGVQYXNzOiBudWxsLFxuICAgICAgc2VydmVyVXJsOiAnJyxcbiAgICAgIHVzZXJOYW1lOiAnJyxcbiAgICAgIHVzZXJQYXNzd29yZDogJycsXG4gICAgICByZXNjYW5Dcm9uOiBudWxsLFxuICAgICAgdGltZW91dDogbnVsbCxcbiAgICAgIGF1dG9SZWNvbm5lY3Q6IHRydWUsXG4gICAgICBzdGF0dXNDaGVja0ludGVydmFsOiBudWxsLFxuICAgICAgdmFsaWQ6IHRydWVcbiAgICB9LFxuICAgIHF1aWNrSW5mbzoge1xuICAgICAgcGFkbG9jazogJ3VubG9jaycsXG4gICAgICBwYWRsb2NrTXNnOiAnJ1xuICAgIH0sXG4gICAgYWN0aXZlOiB0cnVlXG4gIH07XG4gIHNlcnZlcjogT3BjdWFTZXJ2ZXI7XG4gIGFjdGl2ZSA9IGZhbHNlO1xuICBwcml2YXRlIG1vSWQ6IHN0cmluZztcbiAgcHJpdmF0ZSBORVdfU0VSVkVSX0lEOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBvcGN1YVNlcnZpY2U6IE9wY3VhU2VydmljZSxcbiAgICBwcml2YXRlIGFsZXJ0U2VydmljZTogQWxlcnRTZXJ2aWNlLFxuICAgIHByaXZhdGUgdHJhbnNsYXRlU2VydmljZTogVHJhbnNsYXRlU2VydmljZSxcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGNvbnRleHQ6IENvbnRleHRSb3V0ZUNvbXBvbmVudFxuICApIHtcbiAgICB0aGlzLm1vSWQgPSAnJztcbiAgICB0aGlzLk5FV19TRVJWRVJfSUQgPSAnbmV3JztcbiAgICB0aGlzLmluaXRpYWxTZXJ2ZXJPYmplY3QuaWQgPSB0aGlzLk5FV19TRVJWRVJfSUQ7XG4gIH1cblxuICBhc3luYyBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLm1vSWQgPSB0aGlzLm9wY3VhU2VydmljZS5nZXRNb0lkKCk7XG4gICAgaWYgKHRoaXMubW9JZCAmJiB0aGlzLm1vSWQubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5vcGN1YVNlcnZpY2UuZ2V0U2VydmVycyh0aGlzLm1vSWQpO1xuICAgICAgaWYgKHJlcyAmJiByZXMuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHJlcy5qc29uID8gYXdhaXQgcmVzLmpzb24oKSA6IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5hbGVydFNlcnZpY2UuYWRkU2VydmVyRmFpbHVyZSh7IGRhdGEsIHJlcyB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2VydmVyT2JqZWN0TGlzdCA9IChhd2FpdCByZXMuanNvbigpKSBhcyBPcGN1YVNlcnZlcltdO1xuICAgICAgICB0aGlzLnNlcnZlck9iamVjdExpc3QubWFwKHNlcnZlciA9PiB0aGlzLnNldFF1aWNrSW5mbyhzZXJ2ZXIpKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBsb2NhbFNlcnZlck9iamVjdEV4aXN0KCkge1xuICAgIHJldHVybiAhIXRoaXMuc2VydmVyT2JqZWN0TGlzdC5maW5kKHNlcnZlciA9PiBzZXJ2ZXIuaWQgPT09IHRoaXMuTkVXX1NFUlZFUl9JRCk7XG4gIH1cblxuICBhZGRTZXJ2ZXIoKSB7XG4gICAgY29uc3Qgc2VydmVyOiBPcGN1YVNlcnZlciA9IHRoaXMuaW5pdGlhbFNlcnZlck9iamVjdDtcbiAgICB0aGlzLnNlcnZlck9iamVjdExpc3QucHVzaChzZXJ2ZXIpO1xuICAgIHRoaXMub25QcmVzZW50KHNlcnZlcik7XG4gIH1cblxuICBvblNhdmVkKHNlcnZlcjogT3BjdWFTZXJ2ZXIpIHtcbiAgICBpZiAoc2VydmVyICYmIHNlcnZlci5pZCkge1xuICAgICAgc2VydmVyLmdhdGV3YXlJZCA9IHRoaXMubW9JZDtcbiAgICAgIGlmIChzZXJ2ZXIuaWQgPT09IHRoaXMuTkVXX1NFUlZFUl9JRCkge1xuICAgICAgICB0aGlzLmNyZWF0ZVNlcnZlcihzZXJ2ZXIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy51cGRhdGVTZXJ2ZXIoc2VydmVyKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZWxvYWRUYWJzKCkge1xuICAgIGlmICh0aGlzLmNvbnRleHQpIHtcbiAgICAgIHRoaXMuY29udGV4dC5yZWZyZXNoVGFicygpO1xuICAgIH1cbiAgfVxuXG4gIG9uQ2FuY2VsZWQoc2VydmVyOiBPcGN1YVNlcnZlcikge1xuICAgIGlmIChzZXJ2ZXIgJiYgc2VydmVyLmlkICYmIHNlcnZlci5pZCA9PT0gdGhpcy5ORVdfU0VSVkVSX0lEKSB7XG4gICAgICB0aGlzLnJlbW92ZVNlcnZlck9iamVjdExpc3RCeUlkKHNlcnZlci5pZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIHVwZGF0ZSBhY3Rpdml0eSBzdGF0dXMgZm9yIFVJXG4gICAgICB0aGlzLnNlcnZlck9iamVjdExpc3QuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgaWYgKGl0ZW0uaWQgPT09IHNlcnZlci5pZCkge1xuICAgICAgICAgIGl0ZW0uYWN0aXZlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgLy8gV2hlbiBzZXJ2ZXIgaWQgaXMgbm90ICduZXcnIHdlIGp1c3QgY2xvc2UgdGhlIGRldGFpbHNcbiAgICAgIGRlbGV0ZSB0aGlzLnNlcnZlcjtcbiAgICB9XG4gIH1cblxuICBvblJlbW92ZWQoc2VydmVyOiBPcGN1YVNlcnZlcikge1xuICAgIGlmIChzZXJ2ZXIuaWQgPT09IHRoaXMuTkVXX1NFUlZFUl9JRCkge1xuICAgICAgdGhpcy5vbkNhbmNlbGVkKHNlcnZlcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucmVtb3ZlU2VydmVyKHNlcnZlcik7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0S2V5c3RvcmUoYmluYXJ5SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgdGhpcy5vcGN1YVNlcnZpY2UuZ2V0S2V5c3RvcmUoYmluYXJ5SWQpO1xuICAgIHJldHVybiBkYXRhO1xuICB9XG5cbiAgYXN5bmMgb25QcmVzZW50KHNlcnZlcjogT3BjdWFTZXJ2ZXIpIHtcbiAgICBpZiAoXG4gICAgICBzZXJ2ZXIgJiZcbiAgICAgIHNlcnZlci5pZCAhPT0gdGhpcy5ORVdfU0VSVkVSX0lEICYmXG4gICAgICBzZXJ2ZXIuY29uZmlnICYmXG4gICAgICBzZXJ2ZXIuY29uZmlnLmtleXN0b3JlQmluYXJ5SWRcbiAgICApIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG1vID0gYXdhaXQgdGhpcy5nZXRLZXlzdG9yZShzZXJ2ZXIuY29uZmlnLmtleXN0b3JlQmluYXJ5SWQpO1xuICAgICAgICBzZXJ2ZXIuY29uZmlnLmtleXN0b3JlRmlsZW5hbWUgPSBtby5uYW1lO1xuICAgICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgICAgdGhpcy5zZXJ2ZXIgPSBPYmplY3QuYXNzaWduKHt9LCBzZXJ2ZXIpO1xuICAgICAgICBjb25zb2xlLmxvZygnQ291bGQgbm90IGdldCBleGlzdGluZyBrZXlzdG9yZTonLCBleCk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh0aGlzLnNlcnZlck9iamVjdExpc3QubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5zZXJ2ZXJPYmplY3RMaXN0LmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgIGl0ZW0uYWN0aXZlID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKGl0ZW0uaWQgPT09IHNlcnZlci5pZCkge1xuICAgICAgICAgIGl0ZW0uYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICBzZXJ2ZXIuYWN0aXZlID0gaXRlbS5hY3RpdmU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdGhpcy5zZXRRdWlja0luZm8oc2VydmVyKTtcbiAgICAgIHRoaXMuc2VydmVyID0gT2JqZWN0LmFzc2lnbih7fSwgc2VydmVyKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNyZWF0ZVNlcnZlcihzZXJ2ZXI6IE9wY3VhU2VydmVyKSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm9wY3VhU2VydmljZS5jcmVhdGVTZXJ2ZXIoc2VydmVyKTtcbiAgICBjb25zdCBzdnIgPSAoYXdhaXQgcmVzcG9uc2UuanNvbigpKSBhcyBPcGN1YVNlcnZlcjtcbiAgICB0aGlzLnVwZGF0ZVNlcnZlck9iamVjdExpc3RCeUlkKHRoaXMuTkVXX1NFUlZFUl9JRCwgc3ZyKTtcbiAgICB0aGlzLnJlbG9hZFRhYnMoKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgdXBkYXRlU2VydmVyKHNlcnZlcjogT3BjdWFTZXJ2ZXIpIHtcbiAgICBjb25zdCB1cGRhdGVkU2VydmVyID0gKGF3YWl0IHRoaXMub3BjdWFTZXJ2aWNlLnVwZGF0ZVNlcnZlcihzZXJ2ZXIpKSBhcyBPcGN1YVNlcnZlcjtcbiAgICBpZiAodXBkYXRlZFNlcnZlcikge1xuICAgICAgdGhpcy51cGRhdGVTZXJ2ZXJPYmplY3RMaXN0QnlJZCh1cGRhdGVkU2VydmVyLmlkLCB1cGRhdGVkU2VydmVyKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHJlbW92ZVNlcnZlcihzZXJ2ZXI6IE9wY3VhU2VydmVyKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMub3BjdWFTZXJ2aWNlLnJlbW92ZVNlcnZlcihzZXJ2ZXIpO1xuICAgICAgdGhpcy5yZW1vdmVTZXJ2ZXJPYmplY3RMaXN0QnlJZChzZXJ2ZXIuaWQpO1xuICAgICAgdGhpcy5yZWxvYWRUYWJzKCk7XG4gICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdDb3VsZCBub3QgcmVtb3ZlIE9QQyBVQSBzZXJ2ZXI6JywgZXgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlU2VydmVyT2JqZWN0TGlzdEJ5SWQoaWQ6IHN0cmluZykge1xuICAgIHRoaXMuc2VydmVyT2JqZWN0TGlzdC5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4ge1xuICAgICAgaWYgKGl0ZW0uaWQgPT09IGlkKSB7XG4gICAgICAgIHRoaXMuc2VydmVyT2JqZWN0TGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICBkZWxldGUgdGhpcy5zZXJ2ZXI7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVNlcnZlck9iamVjdExpc3RCeUlkKGlkOiBzdHJpbmcsIHNlcnZlcjogT3BjdWFTZXJ2ZXIpIHtcbiAgICBjb25zdCBpZHggPSB0aGlzLnNlcnZlck9iamVjdExpc3QuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS5pZCA9PT0gaWQpO1xuICAgIGlmIChpZHggPiAtMSkge1xuICAgICAgdGhpcy5zZXRRdWlja0luZm8oc2VydmVyKTtcbiAgICAgIHRoaXMuc2VydmVyT2JqZWN0TGlzdFtpZHhdID0gc2VydmVyO1xuICAgIH1cbiAgICBkZWxldGUgdGhpcy5zZXJ2ZXI7XG4gIH1cblxuICBwcml2YXRlIHNldFF1aWNrSW5mbyhzZXJ2ZXI6IE9wY3VhU2VydmVyKSB7XG4gICAgc2VydmVyLnF1aWNrSW5mbyA9IHtcbiAgICAgIHBhZGxvY2s6ICd1bmxvY2snLFxuICAgICAgcGFkbG9ja01zZzogJydcbiAgICB9O1xuXG4gICAgaWYgKHNlcnZlciAmJiBzZXJ2ZXIuY29uZmlnKSB7XG4gICAgICBpZiAoc2VydmVyLmNvbmZpZy5zZWN1cml0eU1vZGUpIHtcbiAgICAgICAgc2VydmVyLnF1aWNrSW5mby5wYWRsb2NrID0gc2VydmVyLmNvbmZpZy5zZWN1cml0eU1vZGUgIT09ICdOT05FJyA/ICdsb2NrJyA6ICd1bmxvY2snO1xuICAgICAgICBzZXJ2ZXIucXVpY2tJbmZvLnBhZGxvY2tNc2cgPSB0aGlzLnRyYW5zbGF0ZVNlcnZpY2UuaW5zdGFudChcbiAgICAgICAgICBnZXR0ZXh0KCdUaGUgc2VjdXJpdHkgcG9saWN5IGlzIHNldCB0byB7e3BhcmFtfX0uJyksXG4gICAgICAgICAgeyBwYXJhbTogc2VydmVyLmNvbmZpZy5zZWN1cml0eU1vZGUgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIiwiPGRpdiBjbGFzcz1cImNhcmQgY29udGVudC1mdWxscGFnZSBzcGxpdC12aWV3LS01LTdcIj5cbiAgPGRpdiBjbGFzcz1cImNhcmQtaGVhZGVyIGdyaWRfX2NvbC0tZnVsbHNwYW4gc2VwYXJhdG9yXCI+XG4gICAgPGRpdiBjbGFzcz1cImg0IGNhcmQtdGl0bGVcIj5PUEMgVUEgc2VydmVyczwvZGl2PlxuICAgIDxidXR0b25cbiAgICAgIGNsYXNzPVwiYnRuLWhlbHBcIlxuICAgICAgdHlwZT1cImJ1dHRvblwiXG4gICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIidIZWxwJyB8IHRyYW5zbGF0ZVwiXG4gICAgICBwb3BvdmVyPVwie3tcbiAgICAgICAgJ0JlbG93IHlvdSBjYW4gY29uZmlndXJlIG9uZSBvciBtb3JlIE9QQyBVQSBzZXJ2ZXJzLiBUaGUgT1BDIFVBIGFnZW50IHdpbGwgY29ubmVjdCB0byB0aGVzZSBzZXJ2ZXJzIGlmIHRoZXkgYXJlIGVuYWJsZWQgYW5kIHRoZSBjb25uZWN0aW9uIHN0YXRlIGlzIHNldCB0byBjb25uZWN0ZWQuJ1xuICAgICAgICAgIHwgdHJhbnNsYXRlXG4gICAgICB9fVwiXG4gICAgICBwbGFjZW1lbnQ9XCJyaWdodFwiXG4gICAgICB0cmlnZ2Vycz1cImZvY3VzXCJcbiAgICA+PC9idXR0b24+XG4gIDwvZGl2PlxuICA8ZGl2IGNsYXNzPVwiaW5uZXItc2Nyb2xsIHNwbGl0LXZpZXdfX2xpc3RcIj5cbiAgICA8ZGl2IGNsYXNzPVwiYmctbGV2ZWwtMSBmbGV4LWdyb3dcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJjOHktbmF2LXN0YWNrZWRcIj5cbiAgICAgICAgPG9wY3VhLXNlcnZlci1saXN0XG4gICAgICAgICAgW3NlcnZlckxpc3RdPVwic2VydmVyT2JqZWN0TGlzdFwiXG4gICAgICAgICAgKHByZXNlbnQpPVwib25QcmVzZW50KCRldmVudClcIlxuICAgICAgICA+PC9vcGN1YS1zZXJ2ZXItbGlzdD5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJjYXJkLWZvb3RlciBzZXBhcmF0b3Igc3RpY2t5LWJvdHRvbVwiPlxuICAgICAgPGJ1dHRvblxuICAgICAgICBjbGFzcz1cImJ0biBidG4tZGVmYXVsdFwiXG4gICAgICAgIHRpdGxlPVwie3sgJ0FkZCBzZXJ2ZXInIHwgdHJhbnNsYXRlIH19XCJcbiAgICAgICAgdHlwZT1cImJ1dHRvblwiXG4gICAgICAgIFtkaXNhYmxlZF09XCJsb2NhbFNlcnZlck9iamVjdEV4aXN0KClcIlxuICAgICAgICAoY2xpY2spPVwiYWRkU2VydmVyKClcIlxuICAgICAgPlxuICAgICAgICA8aSBbYzh5SWNvbl09XCIncGx1cy1jaXJjbGUnXCI+PC9pPlxuICAgICAgICB7eyAnQWRkIHNlcnZlcicgfCB0cmFuc2xhdGUgfX1cbiAgICAgIDwvYnV0dG9uPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cblxuICA8b3BjdWEtc2VydmVyLWNvbmZpZ1xuICAgIGNsYXNzPVwiaW5uZXItc2Nyb2xsIHNwbGl0LXZpZXdfX2RldGFpbFwiXG4gICAgW25nQ2xhc3NdPVwieyAnc3BsaXQtdmlld19fZGV0YWlsLS1zZWxlY3RlZCc6IHNlcnZlciB9XCJcbiAgICAoY2FuY2VsZWQpPVwib25DYW5jZWxlZCgkZXZlbnQpXCJcbiAgICAocmVtb3ZlZCk9XCJvblJlbW92ZWQoJGV2ZW50KVwiXG4gICAgKHNhdmVkKT1cIm9uU2F2ZWQoJGV2ZW50KVwiXG4gICAgW3NlcnZlcl09XCJzZXJ2ZXJcIlxuICA+PC9vcGN1YS1zZXJ2ZXItY29uZmlnPlxuPC9kaXY+XG4iXX0=