import { TranslateDirective, TranslateService } from '@ngx-translate/core';
import { ChangeDetectorRef, Directive, ElementRef, EventEmitter } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "@ngx-translate/core";
export class C8yTranslateDirective extends TranslateDirective {
    /**
     * Used to get private element property from TranslateDirective, so it doesn't throw tsErrors
     */
    get _elementRef() {
        return this.element;
    }
    /**
     * Used to get private translateService property from TranslateDirective, so it doesn't throw tsErrors
     */
    get _translateService() {
        return this.translateService;
    }
    constructor(translateService, element, _ref) {
        super(translateService, element, _ref);
        /**
         * Used to trigger events when html is replaced by directive.
         */
        this.htmlUpdateEvent = new EventEmitter();
    }
    /**
     * Overridden method from original directive.
     * For simple text nodes, it just invokes the base method.
     * For complex nodes, it builds translation key from whole inner HTML
     * and replaces it with its translation.
     * This prevents splitting HTML into pieces and attempting to translate each one separately
     * which doesn't work, because we extract strings in whole.
     */
    checkNodes(forceUpdate = false, translations) {
        if (!this.htmlMode && (this.isElementSimpleTextType() || this.isElementInnerHtmlEmpty())) {
            /**
             * If element does not contain complex html, then fallBack to default logic.
             */
            super.checkNodes(forceUpdate, translations);
        }
        else {
            this.htmlMode = true;
            if (this.isLookupKeyMissing()) {
                this._elementRef.nativeElement.lookupKey = this.getLookupKey();
            }
            if (this.lookupKeyExist()) {
                const newTranslation = this.getNewTranslation();
                if (!this.lastTranslation || this.lastTranslation !== newTranslation) {
                    this.lastTranslation = newTranslation;
                    this.updateHtmlContent();
                    this.htmlUpdateEvent.emit();
                }
            }
        }
    }
    ngOnDestroy() {
        this.htmlUpdateEvent.complete();
        super.ngOnDestroy();
    }
    /**
     * Builds lookup key from innerHTML, removes comments (that might be added by Angular) and trims it.
     */
    getLookupKey() {
        return this._elementRef.nativeElement.innerHTML.replace(/<!--.*?-->/gs, '').trim();
    }
    isElementSimpleTextType() {
        return (this._elementRef.nativeElement.childNodes.length === 1 &&
            this._elementRef.nativeElement.childNodes[0].nodeType === 3);
    }
    isElementInnerHtmlEmpty() {
        return !this._elementRef.nativeElement.innerHTML;
    }
    isLookupKeyMissing() {
        return !this._elementRef.nativeElement.lookupKey;
    }
    lookupKeyExist() {
        return this._elementRef.nativeElement.lookupKey;
    }
    getNewTranslation() {
        return this._translateService.instant(this._elementRef.nativeElement.lookupKey, this.currentParams || {});
    }
    updateHtmlContent() {
        this._elementRef.nativeElement.innerHTML = this.lastTranslation;
    }
}
C8yTranslateDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: C8yTranslateDirective, deps: [{ token: i1.TranslateService }, { token: i0.ElementRef }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Directive });
C8yTranslateDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "15.2.7", type: C8yTranslateDirective, selector: "[translate],[ngx-translate]", usesInheritance: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: C8yTranslateDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[translate],[ngx-translate]'
                }]
        }], ctorParameters: function () { return [{ type: i1.TranslateService }, { type: i0.ElementRef }, { type: i0.ChangeDetectorRef }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYzh5LXRyYW5zbGF0ZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9jb3JlL2kxOG4vYzh5LXRyYW5zbGF0ZS5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGtCQUFrQixFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDM0UsT0FBTyxFQUFFLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDOzs7QUFLdkYsTUFBTSxPQUFPLHFCQUFzQixTQUFRLGtCQUFrQjtJQUMzRDs7T0FFRztJQUNILElBQVksV0FBVztRQUNyQixPQUFRLElBQVksQ0FBQyxPQUFPLENBQUM7SUFDL0IsQ0FBQztJQUVEOztPQUVHO0lBQ0gsSUFBWSxpQkFBaUI7UUFDM0IsT0FBUSxJQUFZLENBQUMsZ0JBQWdCLENBQUM7SUFDeEMsQ0FBQztJQW1CRCxZQUFZLGdCQUFrQyxFQUFFLE9BQW1CLEVBQUUsSUFBdUI7UUFDMUYsS0FBSyxDQUFDLGdCQUFnQixFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQztRQWxCekM7O1dBRUc7UUFDSCxvQkFBZSxHQUF1QixJQUFJLFlBQVksRUFBUSxDQUFDO0lBZ0IvRCxDQUFDO0lBRUQ7Ozs7Ozs7T0FPRztJQUNILFVBQVUsQ0FBQyxXQUFXLEdBQUcsS0FBSyxFQUFFLFlBQWtCO1FBQ2hELElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLElBQUksSUFBSSxDQUFDLHVCQUF1QixFQUFFLENBQUMsRUFBRTtZQUN4Rjs7ZUFFRztZQUNILEtBQUssQ0FBQyxVQUFVLENBQUMsV0FBVyxFQUFFLFlBQVksQ0FBQyxDQUFDO1NBQzdDO2FBQU07WUFDTCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztZQUNyQixJQUFJLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxFQUFFO2dCQUM3QixJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO2FBQ2hFO1lBQ0QsSUFBSSxJQUFJLENBQUMsY0FBYyxFQUFFLEVBQUU7Z0JBQ3pCLE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO2dCQUNoRCxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsSUFBSSxJQUFJLENBQUMsZUFBZSxLQUFLLGNBQWMsRUFBRTtvQkFDcEUsSUFBSSxDQUFDLGVBQWUsR0FBRyxjQUFjLENBQUM7b0JBQ3RDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO29CQUN6QixJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksRUFBRSxDQUFDO2lCQUM3QjthQUNGO1NBQ0Y7SUFDSCxDQUFDO0lBRUQsV0FBVztRQUNULElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDaEMsS0FBSyxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3RCLENBQUM7SUFFRDs7T0FFRztJQUNLLFlBQVk7UUFDbEIsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxFQUFFLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNyRixDQUFDO0lBRU8sdUJBQXVCO1FBQzdCLE9BQU8sQ0FDTCxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsTUFBTSxLQUFLLENBQUM7WUFDdEQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsS0FBSyxDQUFDLENBQzVELENBQUM7SUFDSixDQUFDO0lBRU8sdUJBQXVCO1FBQzdCLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUM7SUFDbkQsQ0FBQztJQUVPLGtCQUFrQjtRQUN4QixPQUFPLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDO0lBQ25ELENBQUM7SUFFTyxjQUFjO1FBQ3BCLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDO0lBQ2xELENBQUM7SUFFTyxpQkFBaUI7UUFDdkIsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUNuQyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxTQUFTLEVBQ3hDLElBQUksQ0FBQyxhQUFhLElBQUksRUFBRSxDQUN6QixDQUFDO0lBQ0osQ0FBQztJQUVPLGlCQUFpQjtRQUN2QixJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQztJQUNsRSxDQUFDOztrSEExR1UscUJBQXFCO3NHQUFyQixxQkFBcUI7MkZBQXJCLHFCQUFxQjtrQkFIakMsU0FBUzttQkFBQztvQkFDVCxRQUFRLEVBQUUsNkJBQTZCO2lCQUN4QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRyYW5zbGF0ZURpcmVjdGl2ZSwgVHJhbnNsYXRlU2VydmljZSB9IGZyb20gJ0BuZ3gtdHJhbnNsYXRlL2NvcmUnO1xuaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0b3JSZWYsIERpcmVjdGl2ZSwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1t0cmFuc2xhdGVdLFtuZ3gtdHJhbnNsYXRlXSdcbn0pXG5leHBvcnQgY2xhc3MgQzh5VHJhbnNsYXRlRGlyZWN0aXZlIGV4dGVuZHMgVHJhbnNsYXRlRGlyZWN0aXZlIHtcbiAgLyoqXG4gICAqIFVzZWQgdG8gZ2V0IHByaXZhdGUgZWxlbWVudCBwcm9wZXJ0eSBmcm9tIFRyYW5zbGF0ZURpcmVjdGl2ZSwgc28gaXQgZG9lc24ndCB0aHJvdyB0c0Vycm9yc1xuICAgKi9cbiAgcHJpdmF0ZSBnZXQgX2VsZW1lbnRSZWYoKTogRWxlbWVudFJlZiB7XG4gICAgcmV0dXJuICh0aGlzIGFzIGFueSkuZWxlbWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBVc2VkIHRvIGdldCBwcml2YXRlIHRyYW5zbGF0ZVNlcnZpY2UgcHJvcGVydHkgZnJvbSBUcmFuc2xhdGVEaXJlY3RpdmUsIHNvIGl0IGRvZXNuJ3QgdGhyb3cgdHNFcnJvcnNcbiAgICovXG4gIHByaXZhdGUgZ2V0IF90cmFuc2xhdGVTZXJ2aWNlKCk6IFRyYW5zbGF0ZVNlcnZpY2Uge1xuICAgIHJldHVybiAodGhpcyBhcyBhbnkpLnRyYW5zbGF0ZVNlcnZpY2U7XG4gIH1cblxuICAvKipcbiAgICogVXNlZCB0byB0cmlnZ2VyIGV2ZW50cyB3aGVuIGh0bWwgaXMgcmVwbGFjZWQgYnkgZGlyZWN0aXZlLlxuICAgKi9cbiAgaHRtbFVwZGF0ZUV2ZW50OiBFdmVudEVtaXR0ZXI8dm9pZD4gPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG5cbiAgLyoqXG4gICAqIFdoZW4gdGhpcyBkaXJlY3RpdmUgc3VjY2Vzc2Z1bGx5IHRyYW5zbGF0ZXMgbm9kZSwgaXQgc3RvcmVzIGl0cyB2YWx1ZSBpbiB0aGlzIHByb3BlcnR5LlxuICAgKiBBbm90aGVyIHRyYW5zbGF0aW9uIHdpbGwgYmUgcGVyZm9ybWVkIG9ubHkgaWYgbmV3IHRyYW5zbGF0aW9uIHZhbHVlIGRpZmZlcnMgZnJvbSBzdG9yZWQgb25lLlxuICAgKi9cbiAgbGFzdFRyYW5zbGF0aW9uOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFdoZW4gdGhpcyBkaXJlY3RpdmUgZW5jb3VudGVycyBlbGVtZW50IHRoYXQgaXMgSFRNTCwgaXQgc2hvdWxkIHN3aXRjaCB0byBIdG1sIG1vZGUgZXZlbiBpZlxuICAgKiBuZXcgdHJhbnNsYXRlZCBlbGVtZW50IGRvZXMgbm90IGNvbnRhaW4gYW55IEhUTUwuXG4gICAqL1xuICBodG1sTW9kZTogYm9vbGVhbjtcblxuICBjb25zdHJ1Y3Rvcih0cmFuc2xhdGVTZXJ2aWNlOiBUcmFuc2xhdGVTZXJ2aWNlLCBlbGVtZW50OiBFbGVtZW50UmVmLCBfcmVmOiBDaGFuZ2VEZXRlY3RvclJlZikge1xuICAgIHN1cGVyKHRyYW5zbGF0ZVNlcnZpY2UsIGVsZW1lbnQsIF9yZWYpO1xuICB9XG5cbiAgLyoqXG4gICAqIE92ZXJyaWRkZW4gbWV0aG9kIGZyb20gb3JpZ2luYWwgZGlyZWN0aXZlLlxuICAgKiBGb3Igc2ltcGxlIHRleHQgbm9kZXMsIGl0IGp1c3QgaW52b2tlcyB0aGUgYmFzZSBtZXRob2QuXG4gICAqIEZvciBjb21wbGV4IG5vZGVzLCBpdCBidWlsZHMgdHJhbnNsYXRpb24ga2V5IGZyb20gd2hvbGUgaW5uZXIgSFRNTFxuICAgKiBhbmQgcmVwbGFjZXMgaXQgd2l0aCBpdHMgdHJhbnNsYXRpb24uXG4gICAqIFRoaXMgcHJldmVudHMgc3BsaXR0aW5nIEhUTUwgaW50byBwaWVjZXMgYW5kIGF0dGVtcHRpbmcgdG8gdHJhbnNsYXRlIGVhY2ggb25lIHNlcGFyYXRlbHlcbiAgICogd2hpY2ggZG9lc24ndCB3b3JrLCBiZWNhdXNlIHdlIGV4dHJhY3Qgc3RyaW5ncyBpbiB3aG9sZS5cbiAgICovXG4gIGNoZWNrTm9kZXMoZm9yY2VVcGRhdGUgPSBmYWxzZSwgdHJhbnNsYXRpb25zPzogYW55KSB7XG4gICAgaWYgKCF0aGlzLmh0bWxNb2RlICYmICh0aGlzLmlzRWxlbWVudFNpbXBsZVRleHRUeXBlKCkgfHwgdGhpcy5pc0VsZW1lbnRJbm5lckh0bWxFbXB0eSgpKSkge1xuICAgICAgLyoqXG4gICAgICAgKiBJZiBlbGVtZW50IGRvZXMgbm90IGNvbnRhaW4gY29tcGxleCBodG1sLCB0aGVuIGZhbGxCYWNrIHRvIGRlZmF1bHQgbG9naWMuXG4gICAgICAgKi9cbiAgICAgIHN1cGVyLmNoZWNrTm9kZXMoZm9yY2VVcGRhdGUsIHRyYW5zbGF0aW9ucyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaHRtbE1vZGUgPSB0cnVlO1xuICAgICAgaWYgKHRoaXMuaXNMb29rdXBLZXlNaXNzaW5nKCkpIHtcbiAgICAgICAgdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50Lmxvb2t1cEtleSA9IHRoaXMuZ2V0TG9va3VwS2V5KCk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5sb29rdXBLZXlFeGlzdCgpKSB7XG4gICAgICAgIGNvbnN0IG5ld1RyYW5zbGF0aW9uID0gdGhpcy5nZXROZXdUcmFuc2xhdGlvbigpO1xuICAgICAgICBpZiAoIXRoaXMubGFzdFRyYW5zbGF0aW9uIHx8IHRoaXMubGFzdFRyYW5zbGF0aW9uICE9PSBuZXdUcmFuc2xhdGlvbikge1xuICAgICAgICAgIHRoaXMubGFzdFRyYW5zbGF0aW9uID0gbmV3VHJhbnNsYXRpb247XG4gICAgICAgICAgdGhpcy51cGRhdGVIdG1sQ29udGVudCgpO1xuICAgICAgICAgIHRoaXMuaHRtbFVwZGF0ZUV2ZW50LmVtaXQoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMuaHRtbFVwZGF0ZUV2ZW50LmNvbXBsZXRlKCk7XG4gICAgc3VwZXIubmdPbkRlc3Ryb3koKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdWlsZHMgbG9va3VwIGtleSBmcm9tIGlubmVySFRNTCwgcmVtb3ZlcyBjb21tZW50cyAodGhhdCBtaWdodCBiZSBhZGRlZCBieSBBbmd1bGFyKSBhbmQgdHJpbXMgaXQuXG4gICAqL1xuICBwcml2YXRlIGdldExvb2t1cEtleSgpIHtcbiAgICByZXR1cm4gdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmlubmVySFRNTC5yZXBsYWNlKC88IS0tLio/LS0+L2dzLCAnJykudHJpbSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0VsZW1lbnRTaW1wbGVUZXh0VHlwZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmNoaWxkTm9kZXMubGVuZ3RoID09PSAxICYmXG4gICAgICB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuY2hpbGROb2Rlc1swXS5ub2RlVHlwZSA9PT0gM1xuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGlzRWxlbWVudElubmVySHRtbEVtcHR5KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmlubmVySFRNTDtcbiAgfVxuXG4gIHByaXZhdGUgaXNMb29rdXBLZXlNaXNzaW5nKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50Lmxvb2t1cEtleTtcbiAgfVxuXG4gIHByaXZhdGUgbG9va3VwS2V5RXhpc3QoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5sb29rdXBLZXk7XG4gIH1cblxuICBwcml2YXRlIGdldE5ld1RyYW5zbGF0aW9uKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuX3RyYW5zbGF0ZVNlcnZpY2UuaW5zdGFudChcbiAgICAgIHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5sb29rdXBLZXksXG4gICAgICB0aGlzLmN1cnJlbnRQYXJhbXMgfHwge31cbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVIdG1sQ29udGVudCgpOiB2b2lkIHtcbiAgICB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuaW5uZXJIVE1MID0gdGhpcy5sYXN0VHJhbnNsYXRpb247XG4gIH1cbn1cbiJdfQ==