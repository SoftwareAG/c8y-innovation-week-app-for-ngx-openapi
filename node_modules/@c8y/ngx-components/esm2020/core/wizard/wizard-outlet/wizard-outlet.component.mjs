import { Component, EventEmitter, Injector, Input, Output, ViewChild, ViewContainerRef } from '@angular/core';
import { Router } from '@angular/router';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { WizardService } from '../wizard.service';
import * as i0 from "@angular/core";
import * as i1 from "@angular/router";
import * as i2 from "../wizard.service";
import * as i3 from "@angular/common";
import * as i4 from "../../common/icon.directive";
import * as i5 from "../../i18n/c8y-translate.directive";
import * as i6 from "../../i18n/c8y-translate.pipe";
export class WizardOutletComponent {
    constructor(router, c8yWizardService, viewContainerRef, injector) {
        this.router = router;
        this.c8yWizardService = c8yWizardService;
        this.viewContainerRef = viewContainerRef;
        this.injector = injector;
        /**
         * The initial state to be assigned to the created component.
         */
        this.initialState = {};
        /**
         * The event that is emitted when the wizard entry is clicked.
         */
        this.onSelect = new EventEmitter();
        /**
         * The event that is emitted when the URL path is provided.
         */
        this.onPath = new EventEmitter();
        /**
         * List of wizard entries.
         */
        this.entries = [];
        /**
         * @ignore
         */
        this.showList = true;
        /**
         * @ignore
         */
        this.destroy$ = new Subject();
    }
    ngAfterViewInit() {
        this.c8yWizardService
            .getEntriesListById(this.id)
            .pipe(takeUntil(this.destroy$))
            .subscribe((entries) => {
            this.container.clear();
            this.entries = entries;
            this.onEntriesLoaded();
        });
    }
    /**
     * Handles the wizard entry, if the entry contains a path, the user will be redirected to it.
     * Otherwise, an attempt will be made to create a dynamic component provided in the entry.
     * @param entry Wizard menu entry.
     */
    handleEntry(entry = {}) {
        const { path, component, injector } = entry;
        if (path) {
            this.handlePath(path);
            return;
        }
        if (component) {
            this.handleComponent(component, injector);
            this.onSelect.emit(entry);
        }
    }
    /**
     * Resets the wizard to its initial state.
     */
    reset() {
        if (this.componentInstance) {
            this.componentInstance = undefined;
            this.container.clear();
            this.showList = true;
        }
    }
    ngOnDestroy() {
        if (this.componentInstance) {
            this.container.clear();
        }
        this.destroy$.next(true);
        this.destroy$.unsubscribe();
    }
    onEntriesLoaded() {
        const [firstEntry] = this.entries;
        const isSingleEntry = this.entries.length === 1;
        const shouldRedirectToPath = firstEntry && !!firstEntry.path;
        const shouldOmitListOfEntries = isSingleEntry && !shouldRedirectToPath;
        if (shouldOmitListOfEntries) {
            this.handleEntry(firstEntry);
        }
    }
    handlePath(path) {
        this.router.navigateByUrl(path);
        this.onPath.emit(path);
    }
    handleComponent(component, injector) {
        this.showList = false;
        const componentInstance = this.viewContainerRef.createComponent(component, {
            environmentInjector: (injector || this.injector)
        });
        Object.assign(componentInstance.instance, this.initialState);
        this.componentInstance = componentInstance;
    }
}
WizardOutletComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: WizardOutletComponent, deps: [{ token: i1.Router }, { token: i2.WizardService }, { token: i0.ViewContainerRef }, { token: i0.Injector }], target: i0.ɵɵFactoryTarget.Component });
WizardOutletComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.7", type: WizardOutletComponent, selector: "c8y-wizard-outlet", inputs: { initialState: "initialState", id: "id" }, outputs: { onSelect: "onSelect", onPath: "onPath" }, viewQueries: [{ propertyName: "container", first: true, predicate: ["container"], descendants: true, read: ViewContainerRef }], ngImport: i0, template: "<ng-container>\n  <div class=\"modal-inner-scroll animated fadeIn\" *ngIf=\"showList\" id=\"modal-body\">\n    <p class=\"p-16 text-center text-medium separator-bottom\">\n      <span translate>Select method</span>\n    </p>\n    <div class=\"list-group list-group-links\" *ngIf=\"entries.length > 0; else emptyState\">\n      <button\n        *ngFor=\"let entry of entries\"\n        type=\"button\"\n        class=\"list-group-item d-flex a-i-center p-t-8 p-b-8\"\n        (click)=\"handleEntry(entry)\"\n      >\n        <div class=\"list-item-icon\">\n          <i [c8yIcon]=\"entry.c8yIcon || 'cogs'\"></i>\n        </div>\n        <div title=\"{{ entry.name | translate }}\" class=\"list-item-body text-truncate\">\n          {{ entry.name | translate }}\n        </div>\n      </button>\n    </div>\n\n    <ng-template #emptyState>\n      <div class=\"c8y-empty-state\">\n        <p>{{ 'No options available.' | translate }}</p>\n      </div>\n    </ng-template>\n  </div>\n</ng-container>\n<template #container [hidden]=\"showList\"></template>\n", dependencies: [{ kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i4.IconDirective, selector: "[c8yIcon]", inputs: ["c8yIcon"] }, { kind: "directive", type: i5.C8yTranslateDirective, selector: "[translate],[ngx-translate]" }, { kind: "pipe", type: i6.C8yTranslatePipe, name: "translate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: WizardOutletComponent, decorators: [{
            type: Component,
            args: [{ selector: 'c8y-wizard-outlet', template: "<ng-container>\n  <div class=\"modal-inner-scroll animated fadeIn\" *ngIf=\"showList\" id=\"modal-body\">\n    <p class=\"p-16 text-center text-medium separator-bottom\">\n      <span translate>Select method</span>\n    </p>\n    <div class=\"list-group list-group-links\" *ngIf=\"entries.length > 0; else emptyState\">\n      <button\n        *ngFor=\"let entry of entries\"\n        type=\"button\"\n        class=\"list-group-item d-flex a-i-center p-t-8 p-b-8\"\n        (click)=\"handleEntry(entry)\"\n      >\n        <div class=\"list-item-icon\">\n          <i [c8yIcon]=\"entry.c8yIcon || 'cogs'\"></i>\n        </div>\n        <div title=\"{{ entry.name | translate }}\" class=\"list-item-body text-truncate\">\n          {{ entry.name | translate }}\n        </div>\n      </button>\n    </div>\n\n    <ng-template #emptyState>\n      <div class=\"c8y-empty-state\">\n        <p>{{ 'No options available.' | translate }}</p>\n      </div>\n    </ng-template>\n  </div>\n</ng-container>\n<template #container [hidden]=\"showList\"></template>\n" }]
        }], ctorParameters: function () { return [{ type: i1.Router }, { type: i2.WizardService }, { type: i0.ViewContainerRef }, { type: i0.Injector }]; }, propDecorators: { container: [{
                type: ViewChild,
                args: ['container', { read: ViewContainerRef }]
            }], initialState: [{
                type: Input
            }], id: [{
                type: Input
            }], onSelect: [{
                type: Output
            }], onPath: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2l6YXJkLW91dGxldC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9jb3JlL3dpemFyZC93aXphcmQtb3V0bGV0L3dpemFyZC1vdXRsZXQuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vY29yZS93aXphcmQvd2l6YXJkLW91dGxldC93aXphcmQtb3V0bGV0LmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCxTQUFTLEVBR1QsWUFBWSxFQUNaLFFBQVEsRUFDUixLQUFLLEVBRUwsTUFBTSxFQUVOLFNBQVMsRUFDVCxnQkFBZ0IsRUFDakIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3pDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQzs7Ozs7Ozs7QUFNbEQsTUFBTSxPQUFPLHFCQUFxQjtJQW1DaEMsWUFDVSxNQUFjLEVBQ2QsZ0JBQStCLEVBQy9CLGdCQUFrQyxFQUNsQyxRQUFrQjtRQUhsQixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ2QscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFlO1FBQy9CLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEMsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQXJDNUI7O1dBRUc7UUFDTSxpQkFBWSxHQUFRLEVBQUUsQ0FBQztRQU1oQzs7V0FFRztRQUNPLGFBQVEsR0FBOEIsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNuRTs7V0FFRztRQUNPLFdBQU0sR0FBeUIsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUM1RDs7V0FFRztRQUNILFlBQU8sR0FBa0IsRUFBRSxDQUFDO1FBQzVCOztXQUVHO1FB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QUksQ0FBQyxpQkFBaUIsR0FBRyxpQkFBaUIsQ0FBQztJQUM3QyxDQUFDOztrSEFqSFUscUJBQXFCO3NHQUFyQixxQkFBcUIscVBBQ0EsZ0JBQWdCLDZCQ3pCbEQsZ2lDQTZCQTsyRkRMYSxxQkFBcUI7a0JBSmpDLFNBQVM7K0JBQ0UsbUJBQW1COytLQUl1QixTQUFTO3NCQUE1RCxTQUFTO3VCQUFDLFdBQVcsRUFBRSxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRTtnQkFJekMsWUFBWTtzQkFBcEIsS0FBSztnQkFLRyxFQUFFO3NCQUFWLEtBQUs7Z0JBSUksUUFBUTtzQkFBakIsTUFBTTtnQkFJRyxNQUFNO3NCQUFmLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBDb21wb25lbnQsXG4gIENvbXBvbmVudFJlZixcbiAgRW52aXJvbm1lbnRJbmplY3RvcixcbiAgRXZlbnRFbWl0dGVyLFxuICBJbmplY3RvcixcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgT3V0cHV0LFxuICBUeXBlLFxuICBWaWV3Q2hpbGQsXG4gIFZpZXdDb250YWluZXJSZWZcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgV2l6YXJkRW50cnkgfSBmcm9tICcuLi93aXphcmQubW9kZWwnO1xuaW1wb3J0IHsgV2l6YXJkU2VydmljZSB9IGZyb20gJy4uL3dpemFyZC5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYzh5LXdpemFyZC1vdXRsZXQnLFxuICB0ZW1wbGF0ZVVybDogJy4vd2l6YXJkLW91dGxldC5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgV2l6YXJkT3V0bGV0Q29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcbiAgQFZpZXdDaGlsZCgnY29udGFpbmVyJywgeyByZWFkOiBWaWV3Q29udGFpbmVyUmVmIH0pIGNvbnRhaW5lcjogVmlld0NvbnRhaW5lclJlZjtcbiAgLyoqXG4gICAqIFRoZSBpbml0aWFsIHN0YXRlIHRvIGJlIGFzc2lnbmVkIHRvIHRoZSBjcmVhdGVkIGNvbXBvbmVudC5cbiAgICovXG4gIEBJbnB1dCgpIGluaXRpYWxTdGF0ZTogYW55ID0ge307XG4gIC8qKlxuICAgKiBUaGUgaWQgcGFyYW1ldGVyIGlkZW50aWZpZXMgdGhlIHBhcnRpY3VsYXIgd2l6YXJkIGFuZCBjYW4gYmUgdXNlZCB0byByZWZlciB0byBpdCB3aGVuIGhvb2tpbmcgd2l6YXJkIGVudHJpZXMuXG4gICAqIEV4YW1wbGU6IFwid2l6YXJkSWRcIi5cbiAgICovXG4gIEBJbnB1dCgpIGlkOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgZXZlbnQgdGhhdCBpcyBlbWl0dGVkIHdoZW4gdGhlIHdpemFyZCBlbnRyeSBpcyBjbGlja2VkLlxuICAgKi9cbiAgQE91dHB1dCgpIG9uU2VsZWN0OiBFdmVudEVtaXR0ZXI8V2l6YXJkRW50cnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAvKipcbiAgICogVGhlIGV2ZW50IHRoYXQgaXMgZW1pdHRlZCB3aGVuIHRoZSBVUkwgcGF0aCBpcyBwcm92aWRlZC5cbiAgICovXG4gIEBPdXRwdXQoKSBvblBhdGg6IEV2ZW50RW1pdHRlcjxzdHJpbmc+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAvKipcbiAgICogTGlzdCBvZiB3aXphcmQgZW50cmllcy5cbiAgICovXG4gIGVudHJpZXM6IFdpemFyZEVudHJ5W10gPSBbXTtcbiAgLyoqXG4gICAqIEBpZ25vcmVcbiAgICovXG4gIHNob3dMaXN0ID0gdHJ1ZTtcbiAgLyoqXG4gICAqIEBpZ25vcmVcbiAgICovXG4gIHByaXZhdGUgZGVzdHJveSQ6IFN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgU3ViamVjdDxib29sZWFuPigpO1xuICAvKipcbiAgICogQGlnbm9yZVxuICAgKi9cbiAgcHJpdmF0ZSBjb21wb25lbnRJbnN0YW5jZTogQ29tcG9uZW50UmVmPHVua25vd24+O1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJvdXRlcjogUm91dGVyLFxuICAgIHByaXZhdGUgYzh5V2l6YXJkU2VydmljZTogV2l6YXJkU2VydmljZSxcbiAgICBwcml2YXRlIHZpZXdDb250YWluZXJSZWY6IFZpZXdDb250YWluZXJSZWYsXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3JcbiAgKSB7fVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLmM4eVdpemFyZFNlcnZpY2VcbiAgICAgIC5nZXRFbnRyaWVzTGlzdEJ5SWQodGhpcy5pZClcbiAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSlcbiAgICAgIC5zdWJzY3JpYmUoKGVudHJpZXM6IFdpemFyZEVudHJ5W10pID0+IHtcbiAgICAgICAgdGhpcy5jb250YWluZXIuY2xlYXIoKTtcbiAgICAgICAgdGhpcy5lbnRyaWVzID0gZW50cmllcztcbiAgICAgICAgdGhpcy5vbkVudHJpZXNMb2FkZWQoKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZXMgdGhlIHdpemFyZCBlbnRyeSwgaWYgdGhlIGVudHJ5IGNvbnRhaW5zIGEgcGF0aCwgdGhlIHVzZXIgd2lsbCBiZSByZWRpcmVjdGVkIHRvIGl0LlxuICAgKiBPdGhlcndpc2UsIGFuIGF0dGVtcHQgd2lsbCBiZSBtYWRlIHRvIGNyZWF0ZSBhIGR5bmFtaWMgY29tcG9uZW50IHByb3ZpZGVkIGluIHRoZSBlbnRyeS5cbiAgICogQHBhcmFtIGVudHJ5IFdpemFyZCBtZW51IGVudHJ5LlxuICAgKi9cbiAgaGFuZGxlRW50cnkoZW50cnk6IFdpemFyZEVudHJ5ID0ge30gYXMgV2l6YXJkRW50cnkpIHtcbiAgICBjb25zdCB7IHBhdGgsIGNvbXBvbmVudCwgaW5qZWN0b3IgfSA9IGVudHJ5O1xuICAgIGlmIChwYXRoKSB7XG4gICAgICB0aGlzLmhhbmRsZVBhdGgocGF0aCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGNvbXBvbmVudCkge1xuICAgICAgdGhpcy5oYW5kbGVDb21wb25lbnQoY29tcG9uZW50LCBpbmplY3Rvcik7XG4gICAgICB0aGlzLm9uU2VsZWN0LmVtaXQoZW50cnkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldHMgdGhlIHdpemFyZCB0byBpdHMgaW5pdGlhbCBzdGF0ZS5cbiAgICovXG4gIHJlc2V0KCkge1xuICAgIGlmICh0aGlzLmNvbXBvbmVudEluc3RhbmNlKSB7XG4gICAgICB0aGlzLmNvbXBvbmVudEluc3RhbmNlID0gdW5kZWZpbmVkO1xuICAgICAgdGhpcy5jb250YWluZXIuY2xlYXIoKTtcbiAgICAgIHRoaXMuc2hvd0xpc3QgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLmNvbXBvbmVudEluc3RhbmNlKSB7XG4gICAgICB0aGlzLmNvbnRhaW5lci5jbGVhcigpO1xuICAgIH1cbiAgICB0aGlzLmRlc3Ryb3kkLm5leHQodHJ1ZSk7XG4gICAgdGhpcy5kZXN0cm95JC51bnN1YnNjcmliZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBvbkVudHJpZXNMb2FkZWQoKSB7XG4gICAgY29uc3QgW2ZpcnN0RW50cnldID0gdGhpcy5lbnRyaWVzO1xuICAgIGNvbnN0IGlzU2luZ2xlRW50cnkgPSB0aGlzLmVudHJpZXMubGVuZ3RoID09PSAxO1xuICAgIGNvbnN0IHNob3VsZFJlZGlyZWN0VG9QYXRoID0gZmlyc3RFbnRyeSAmJiAhIWZpcnN0RW50cnkucGF0aDtcbiAgICBjb25zdCBzaG91bGRPbWl0TGlzdE9mRW50cmllcyA9IGlzU2luZ2xlRW50cnkgJiYgIXNob3VsZFJlZGlyZWN0VG9QYXRoO1xuXG4gICAgaWYgKHNob3VsZE9taXRMaXN0T2ZFbnRyaWVzKSB7XG4gICAgICB0aGlzLmhhbmRsZUVudHJ5KGZpcnN0RW50cnkpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlUGF0aChwYXRoOiBzdHJpbmcpIHtcbiAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZUJ5VXJsKHBhdGgpO1xuICAgIHRoaXMub25QYXRoLmVtaXQocGF0aCk7XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZUNvbXBvbmVudChjb21wb25lbnQ6IFR5cGU8dW5rbm93bj4sIGluamVjdG9yOiBJbmplY3Rvcikge1xuICAgIHRoaXMuc2hvd0xpc3QgPSBmYWxzZTtcbiAgICBjb25zdCBjb21wb25lbnRJbnN0YW5jZSA9IHRoaXMudmlld0NvbnRhaW5lclJlZi5jcmVhdGVDb21wb25lbnQoY29tcG9uZW50LCB7XG4gICAgICBlbnZpcm9ubWVudEluamVjdG9yOiAoaW5qZWN0b3IgfHwgdGhpcy5pbmplY3RvcikgYXMgRW52aXJvbm1lbnRJbmplY3RvclxuICAgIH0pO1xuICAgIE9iamVjdC5hc3NpZ24oY29tcG9uZW50SW5zdGFuY2UuaW5zdGFuY2UsIHRoaXMuaW5pdGlhbFN0YXRlKTtcbiAgICB0aGlzLmNvbXBvbmVudEluc3RhbmNlID0gY29tcG9uZW50SW5zdGFuY2U7XG4gIH1cbn1cbiIsIjxuZy1jb250YWluZXI+XG4gIDxkaXYgY2xhc3M9XCJtb2RhbC1pbm5lci1zY3JvbGwgYW5pbWF0ZWQgZmFkZUluXCIgKm5nSWY9XCJzaG93TGlzdFwiIGlkPVwibW9kYWwtYm9keVwiPlxuICAgIDxwIGNsYXNzPVwicC0xNiB0ZXh0LWNlbnRlciB0ZXh0LW1lZGl1bSBzZXBhcmF0b3ItYm90dG9tXCI+XG4gICAgICA8c3BhbiB0cmFuc2xhdGU+U2VsZWN0IG1ldGhvZDwvc3Bhbj5cbiAgICA8L3A+XG4gICAgPGRpdiBjbGFzcz1cImxpc3QtZ3JvdXAgbGlzdC1ncm91cC1saW5rc1wiICpuZ0lmPVwiZW50cmllcy5sZW5ndGggPiAwOyBlbHNlIGVtcHR5U3RhdGVcIj5cbiAgICAgIDxidXR0b25cbiAgICAgICAgKm5nRm9yPVwibGV0IGVudHJ5IG9mIGVudHJpZXNcIlxuICAgICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgY2xhc3M9XCJsaXN0LWdyb3VwLWl0ZW0gZC1mbGV4IGEtaS1jZW50ZXIgcC10LTggcC1iLThcIlxuICAgICAgICAoY2xpY2spPVwiaGFuZGxlRW50cnkoZW50cnkpXCJcbiAgICAgID5cbiAgICAgICAgPGRpdiBjbGFzcz1cImxpc3QtaXRlbS1pY29uXCI+XG4gICAgICAgICAgPGkgW2M4eUljb25dPVwiZW50cnkuYzh5SWNvbiB8fCAnY29ncydcIj48L2k+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IHRpdGxlPVwie3sgZW50cnkubmFtZSB8IHRyYW5zbGF0ZSB9fVwiIGNsYXNzPVwibGlzdC1pdGVtLWJvZHkgdGV4dC10cnVuY2F0ZVwiPlxuICAgICAgICAgIHt7IGVudHJ5Lm5hbWUgfCB0cmFuc2xhdGUgfX1cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2J1dHRvbj5cbiAgICA8L2Rpdj5cblxuICAgIDxuZy10ZW1wbGF0ZSAjZW1wdHlTdGF0ZT5cbiAgICAgIDxkaXYgY2xhc3M9XCJjOHktZW1wdHktc3RhdGVcIj5cbiAgICAgICAgPHA+e3sgJ05vIG9wdGlvbnMgYXZhaWxhYmxlLicgfCB0cmFuc2xhdGUgfX08L3A+XG4gICAgICA8L2Rpdj5cbiAgICA8L25nLXRlbXBsYXRlPlxuICA8L2Rpdj5cbjwvbmctY29udGFpbmVyPlxuPHRlbXBsYXRlICNjb250YWluZXIgW2hpZGRlbl09XCJzaG93TGlzdFwiPjwvdGVtcGxhdGU+XG4iXX0=