import { Injectable } from '@angular/core';
import { FormlyJsonschema } from '@ngx-formly/core/json-schema';
import { omit } from 'lodash-es';
import * as i0 from "@angular/core";
export class C8yJSONSchema extends FormlyJsonschema {
    toFieldConfig(schema, options) {
        const config = super.toFieldConfig(schema, this.c8yOptions((options || {}).map));
        return config;
    }
    c8yOptions(map) {
        return {
            map(mappedField, mapSource) {
                let result = mappedField;
                /** `const` type is represented as hidden input */
                if (mapSource.const) {
                    result = {
                        ...result,
                        defaultValue: mapSource.const,
                        type: 'input',
                        props: {
                            ...result.props,
                            type: 'hidden'
                        }
                    };
                }
                /** `writeOnly` field represented as password input */
                if (mapSource.writeOnly) {
                    result = {
                        ...result,
                        props: {
                            ...(result.props || {}),
                            attributes: { ...result.props?.attributes, type: 'password', autocomplete: 'off' }
                        }
                    };
                }
                /** `examples` values used as placeholder */
                if (mapSource.examples) {
                    result = {
                        ...result,
                        props: {
                            ...(result.props || {}),
                            placeholder: mapSource.examples.join(', ')
                        }
                    };
                }
                /** `enum` field represented as radio button group */
                if (mapSource.enum) {
                    result = {
                        ...result,
                        type: 'radio'
                    };
                }
                /** fields with `contentMediaType` or `contentEncoding` are represented as file inputs */
                if (mapSource.contentMediaType || mapSource.contentEncoding) {
                    result = {
                        ...result,
                        type: 'file',
                        props: {
                            ...(result.props || {}),
                            accept: mapSource.contentMediaType,
                            maxAllowedFiles: 1,
                            contentEncoding: mapSource.contentEncoding
                        }
                    };
                    // TODO: Remove this line when base64 encoding is done by file.type.component
                    // and control's value would pass 'string' type validator.
                    if (mapSource.contentEncoding === 'base64') {
                        result.validators = omit(result.validators, ['type']);
                    }
                }
                /** file extension validation for fields with `allowedFileTypes` */
                if (mapSource.allowedFileTypes) {
                    result = {
                        ...result,
                        type: 'file',
                        props: {
                            ...(result.props || {}),
                            ...(mapSource.allowedFileTypes && {
                                accept: mapSource.allowedFileTypes.join(',')
                            })
                        }
                    };
                }
                /** max size file validation` */
                if (mapSource.maxSize) {
                    result = {
                        ...result,
                        type: 'file',
                        props: {
                            ...(result.props || {}),
                            maxFileSizeInMegaBytes: mapSource.maxSize
                        }
                    };
                }
                /** Provides a way to use templateOptions in JSONSchema forms */
                if (mapSource.templateOptions) {
                    result = {
                        ...result,
                        props: {
                            ...mapSource.templateOptions,
                            ...result.props
                        }
                    };
                }
                return map ? map(result, mapSource) : result;
            }
        };
    }
}
C8yJSONSchema.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: C8yJSONSchema, deps: null, target: i0.ɵɵFactoryTarget.Injectable });
C8yJSONSchema.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: C8yJSONSchema, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: C8yJSONSchema, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYzh5LWpzb24tc2NoZW1hLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9jb3JlL2R5bmFtaWMtZm9ybXMvanNvbi1zY2hlbWEvYzh5LWpzb24tc2NoZW1hLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUzQyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUVoRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sV0FBVyxDQUFDOztBQUtqQyxNQUFNLE9BQU8sYUFBYyxTQUFRLGdCQUFnQjtJQUNqRCxhQUFhLENBQUMsTUFBbUIsRUFBRSxPQUFhO1FBQzlDLE1BQU0sTUFBTSxHQUFzQixLQUFLLENBQUMsYUFBYSxDQUNuRCxNQUFNLEVBQ04sSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLE9BQU8sSUFBSSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FDckMsQ0FBQztRQUNGLE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7SUFFTyxVQUFVLENBQ2hCLEdBQWtGO1FBRWxGLE9BQU87WUFDTCxHQUFHLENBQ0QsV0FBOEIsRUFDOUIsU0FHQztnQkFFRCxJQUFJLE1BQU0sR0FBc0IsV0FBVyxDQUFDO2dCQUU1QyxrREFBa0Q7Z0JBQ2xELElBQUksU0FBUyxDQUFDLEtBQUssRUFBRTtvQkFDbkIsTUFBTSxHQUFHO3dCQUNQLEdBQUcsTUFBTTt3QkFDVCxZQUFZLEVBQUUsU0FBUyxDQUFDLEtBQUs7d0JBQzdCLElBQUksRUFBRSxPQUFPO3dCQUNiLEtBQUssRUFBRTs0QkFDTCxHQUFHLE1BQU0sQ0FBQyxLQUFLOzRCQUNmLElBQUksRUFBRSxRQUFRO3lCQUNmO3FCQUNGLENBQUM7aUJBQ0g7Z0JBRUQsc0RBQXNEO2dCQUN0RCxJQUFJLFNBQVMsQ0FBQyxTQUFTLEVBQUU7b0JBQ3ZCLE1BQU0sR0FBRzt3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SFUsYUFBYTs4R0FBYixhQUFhLGNBRlosTUFBTTsyRkFFUCxhQUFhO2tCQUh6QixVQUFVO21CQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1seUZpZWxkQ29uZmlnLCBGb3JtbHlUZW1wbGF0ZU9wdGlvbnMgfSBmcm9tICdAbmd4LWZvcm1seS9jb3JlJztcbmltcG9ydCB7IEZvcm1seUpzb25zY2hlbWEgfSBmcm9tICdAbmd4LWZvcm1seS9jb3JlL2pzb24tc2NoZW1hJztcbmltcG9ydCB7IEpTT05TY2hlbWE3IH0gZnJvbSAnanNvbi1zY2hlbWEnO1xuaW1wb3J0IHsgb21pdCB9IGZyb20gJ2xvZGFzaC1lcyc7XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIEM4eUpTT05TY2hlbWEgZXh0ZW5kcyBGb3JtbHlKc29uc2NoZW1hIHtcbiAgdG9GaWVsZENvbmZpZyhzY2hlbWE6IEpTT05TY2hlbWE3LCBvcHRpb25zPzogYW55KTogRm9ybWx5RmllbGRDb25maWcge1xuICAgIGNvbnN0IGNvbmZpZzogRm9ybWx5RmllbGRDb25maWcgPSBzdXBlci50b0ZpZWxkQ29uZmlnKFxuICAgICAgc2NoZW1hLFxuICAgICAgdGhpcy5jOHlPcHRpb25zKChvcHRpb25zIHx8IHt9KS5tYXApXG4gICAgKTtcbiAgICByZXR1cm4gY29uZmlnO1xuICB9XG5cbiAgcHJpdmF0ZSBjOHlPcHRpb25zKFxuICAgIG1hcDogKG1hcHBlZEZpZWxkOiBGb3JtbHlGaWVsZENvbmZpZywgbWFwU291cmNlOiBKU09OU2NoZW1hNykgPT4gRm9ybWx5RmllbGRDb25maWdcbiAgKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1hcChcbiAgICAgICAgbWFwcGVkRmllbGQ6IEZvcm1seUZpZWxkQ29uZmlnLFxuICAgICAgICBtYXBTb3VyY2U6IEpTT05TY2hlbWE3ICYge1xuICAgICAgICAgIGFsbG93ZWRGaWxlVHlwZXM6IHN0cmluZ1tdO1xuICAgICAgICAgIHRlbXBsYXRlT3B0aW9uczogRm9ybWx5VGVtcGxhdGVPcHRpb25zO1xuICAgICAgICB9XG4gICAgICApIHtcbiAgICAgICAgbGV0IHJlc3VsdDogRm9ybWx5RmllbGRDb25maWcgPSBtYXBwZWRGaWVsZDtcblxuICAgICAgICAvKiogYGNvbnN0YCB0eXBlIGlzIHJlcHJlc2VudGVkIGFzIGhpZGRlbiBpbnB1dCAqL1xuICAgICAgICBpZiAobWFwU291cmNlLmNvbnN0KSB7XG4gICAgICAgICAgcmVzdWx0ID0ge1xuICAgICAgICAgICAgLi4ucmVzdWx0LFxuICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBtYXBTb3VyY2UuY29uc3QsXG4gICAgICAgICAgICB0eXBlOiAnaW5wdXQnLFxuICAgICAgICAgICAgcHJvcHM6IHtcbiAgICAgICAgICAgICAgLi4ucmVzdWx0LnByb3BzLFxuICAgICAgICAgICAgICB0eXBlOiAnaGlkZGVuJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICAvKiogYHdyaXRlT25seWAgZmllbGQgcmVwcmVzZW50ZWQgYXMgcGFzc3dvcmQgaW5wdXQgKi9cbiAgICAgICAgaWYgKG1hcFNvdXJjZS53cml0ZU9ubHkpIHtcbiAgICAgICAgICByZXN1bHQgPSB7XG4gICAgICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgICAgICBwcm9wczoge1xuICAgICAgICAgICAgICAuLi4ocmVzdWx0LnByb3BzIHx8IHt9KSxcbiAgICAgICAgICAgICAgYXR0cmlidXRlczogeyAuLi5yZXN1bHQucHJvcHM/LmF0dHJpYnV0ZXMsIHR5cGU6ICdwYXNzd29yZCcsIGF1dG9jb21wbGV0ZTogJ29mZicgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICAvKiogYGV4YW1wbGVzYCB2YWx1ZXMgdXNlZCBhcyBwbGFjZWhvbGRlciAqL1xuICAgICAgICBpZiAobWFwU291cmNlLmV4YW1wbGVzKSB7XG4gICAgICAgICAgcmVzdWx0ID0ge1xuICAgICAgICAgICAgLi4ucmVzdWx0LFxuICAgICAgICAgICAgcHJvcHM6IHtcbiAgICAgICAgICAgICAgLi4uKHJlc3VsdC5wcm9wcyB8fCB7fSksXG4gICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAobWFwU291cmNlLmV4YW1wbGVzIGFzIHN0cmluZ1tdKS5qb2luKCcsICcpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBgZW51bWAgZmllbGQgcmVwcmVzZW50ZWQgYXMgcmFkaW8gYnV0dG9uIGdyb3VwICovXG4gICAgICAgIGlmIChtYXBTb3VyY2UuZW51bSkge1xuICAgICAgICAgIHJlc3VsdCA9IHtcbiAgICAgICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgICAgIHR5cGU6ICdyYWRpbydcbiAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqIGZpZWxkcyB3aXRoIGBjb250ZW50TWVkaWFUeXBlYCBvciBgY29udGVudEVuY29kaW5nYCBhcmUgcmVwcmVzZW50ZWQgYXMgZmlsZSBpbnB1dHMgKi9cbiAgICAgICAgaWYgKG1hcFNvdXJjZS5jb250ZW50TWVkaWFUeXBlIHx8IG1hcFNvdXJjZS5jb250ZW50RW5jb2RpbmcpIHtcbiAgICAgICAgICByZXN1bHQgPSB7XG4gICAgICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgICAgICB0eXBlOiAnZmlsZScsXG4gICAgICAgICAgICBwcm9wczoge1xuICAgICAgICAgICAgICAuLi4ocmVzdWx0LnByb3BzIHx8IHt9KSxcbiAgICAgICAgICAgICAgYWNjZXB0OiBtYXBTb3VyY2UuY29udGVudE1lZGlhVHlwZSxcbiAgICAgICAgICAgICAgbWF4QWxsb3dlZEZpbGVzOiAxLFxuICAgICAgICAgICAgICBjb250ZW50RW5jb2Rpbmc6IG1hcFNvdXJjZS5jb250ZW50RW5jb2RpbmdcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgLy8gVE9ETzogUmVtb3ZlIHRoaXMgbGluZSB3aGVuIGJhc2U2NCBlbmNvZGluZyBpcyBkb25lIGJ5IGZpbGUudHlwZS5jb21wb25lbnRcbiAgICAgICAgICAvLyBhbmQgY29udHJvbCdzIHZhbHVlIHdvdWxkIHBhc3MgJ3N0cmluZycgdHlwZSB2YWxpZGF0b3IuXG4gICAgICAgICAgaWYgKG1hcFNvdXJjZS5jb250ZW50RW5jb2RpbmcgPT09ICdiYXNlNjQnKSB7XG4gICAgICAgICAgICByZXN1bHQudmFsaWRhdG9ycyA9IG9taXQocmVzdWx0LnZhbGlkYXRvcnMsIFsndHlwZSddKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvKiogZmlsZSBleHRlbnNpb24gdmFsaWRhdGlvbiBmb3IgZmllbGRzIHdpdGggYGFsbG93ZWRGaWxlVHlwZXNgICovXG4gICAgICAgIGlmICgobWFwU291cmNlIGFzIGFueSkuYWxsb3dlZEZpbGVUeXBlcykge1xuICAgICAgICAgIHJlc3VsdCA9IHtcbiAgICAgICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgICAgIHR5cGU6ICdmaWxlJyxcbiAgICAgICAgICAgIHByb3BzOiB7XG4gICAgICAgICAgICAgIC4uLihyZXN1bHQucHJvcHMgfHwge30pLFxuICAgICAgICAgICAgICAuLi4obWFwU291cmNlLmFsbG93ZWRGaWxlVHlwZXMgJiYge1xuICAgICAgICAgICAgICAgIGFjY2VwdDogbWFwU291cmNlLmFsbG93ZWRGaWxlVHlwZXMuam9pbignLCcpXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICAvKiogbWF4IHNpemUgZmlsZSB2YWxpZGF0aW9uYCAqL1xuICAgICAgICBpZiAoKG1hcFNvdXJjZSBhcyBhbnkpLm1heFNpemUpIHtcbiAgICAgICAgICByZXN1bHQgPSB7XG4gICAgICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgICAgICB0eXBlOiAnZmlsZScsXG4gICAgICAgICAgICBwcm9wczoge1xuICAgICAgICAgICAgICAuLi4ocmVzdWx0LnByb3BzIHx8IHt9KSxcbiAgICAgICAgICAgICAgbWF4RmlsZVNpemVJbk1lZ2FCeXRlczogKG1hcFNvdXJjZSBhcyBhbnkpLm1heFNpemVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqIFByb3ZpZGVzIGEgd2F5IHRvIHVzZSB0ZW1wbGF0ZU9wdGlvbnMgaW4gSlNPTlNjaGVtYSBmb3JtcyAqL1xuICAgICAgICBpZiAobWFwU291cmNlLnRlbXBsYXRlT3B0aW9ucykge1xuICAgICAgICAgIHJlc3VsdCA9IHtcbiAgICAgICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgICAgIHByb3BzOiB7XG4gICAgICAgICAgICAgIC4uLm1hcFNvdXJjZS50ZW1wbGF0ZU9wdGlvbnMsXG4gICAgICAgICAgICAgIC4uLnJlc3VsdC5wcm9wc1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbWFwID8gbWFwKHJlc3VsdCwgbWFwU291cmNlKSA6IHJlc3VsdDtcbiAgICAgIH1cbiAgICB9O1xuICB9XG59XG4iXX0=