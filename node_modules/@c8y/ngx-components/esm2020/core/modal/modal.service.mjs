import { Injectable } from '@angular/core';
import { BsModalService } from 'ngx-bootstrap/modal';
import { Status } from '../common/status.model';
import { gettext } from '../i18n/gettext';
import { GainsightService } from '../product-experience/gainsight.service';
import { ConfirmModalComponent } from './modal-confirm.component';
import * as i0 from "@angular/core";
import * as i1 from "ngx-bootstrap/modal";
import * as i2 from "../product-experience/gainsight.service";
/**
 * Service to show a modal.
 */
export class ModalService {
    constructor(modalService, gainsightService) {
        this.modalService = modalService;
        this.gainsightService = gainsightService;
    }
    /**
     * Shows a quick confirm message modal.
     * @param title The title of that modal.
     * @param body The text body to display.
     * @param status The status.
     * @param labels The labels to use. Default: { ok: 'Confirm', cancel: 'Cancel'}
     * @param confirmOptions Selection options to display as checkbox list.
     * @param productExperienceEvent Additional data to attach to custom product experience events.
     */
    async confirm(title, body, status = Status.INFO, labels = {}, confirmOptions = {}, productExperienceEvent = { eventName: 'confirmModal' }) {
        const modalLabels = {
            ok: labels.ok || gettext('Confirm'),
            cancel: labels.cancel || gettext('Cancel')
        };
        const modalRef = this.modalService.show(ConfirmModalComponent, {
            initialState: { title, body, labels: modalLabels, status, confirmOptions },
            ariaDescribedby: 'modal-body',
            ariaLabelledBy: 'modal-title',
            ignoreBackdropClick: true
        });
        if (productExperienceEvent) {
            productExperienceEvent.data = { ...productExperienceEvent.data, title };
        }
        this.triggerEvent(modalRef.content.result, modalLabels, productExperienceEvent);
        return await modalRef.content.result;
    }
    /**
     * Shows a quick acknowledge message modal.
     * @param title The title of that modal.
     * @param body The text body to display.
     * @param status The status.
     * @param acknowledgeLabel The label to use.
     * @param productExperienceEvent Additional data to attach to custom product experience events.
     */
    async acknowledge(title, body, status = Status.INFO, acknowledgeLabel = gettext('Confirm'), productExperienceEvent = { eventName: 'confirmModal' }) {
        const labels = { ok: acknowledgeLabel, cancel: null };
        const modalRef = this.modalService.show(ConfirmModalComponent, {
            initialState: { title, body, labels, status },
            ariaDescribedby: 'modal-body',
            ariaLabelledBy: 'modal-title',
            ignoreBackdropClick: true
        });
        if (productExperienceEvent) {
            productExperienceEvent.data = { ...productExperienceEvent.data, title };
        }
        this.triggerEvent(modalRef.content.result, labels, productExperienceEvent);
        return await modalRef.content.result;
    }
    /**
     * Shows a quick logout confirmation modal.
     * @param body The text body to display. Default: 'You will be logged out to apply your changes. Do you want to proceed?'
     * @param status The status.
     * @param labels The labels to use. Default: { ok: 'Confirm and log out', cancel: 'Cancel' }
     */
    async confirmLogout(body, status = Status.WARNING, labels = {}) {
        const modalLabels = {
            ok: labels.ok || gettext('Confirm and log out'),
            cancel: labels.cancel || gettext('Cancel')
        };
        const modalBody = body || gettext('You must log out to apply your changes. Do you want to proceed?');
        return await this.confirm(gettext('Logout required'), modalBody, status, modalLabels);
    }
    triggerEvent(result, labels, productExperienceEvent) {
        const data = { ...productExperienceEvent.data, url: window.location.href };
        result
            .then(() => {
            this.gainsightService.triggerEvent(productExperienceEvent.eventName, {
                ...data,
                result: labels.ok
            });
        })
            .catch(() => {
            this.gainsightService.triggerEvent(productExperienceEvent.eventName, {
                ...data,
                result: labels.cancel
            });
        });
    }
}
ModalService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: ModalService, deps: [{ token: i1.BsModalService }, { token: i2.GainsightService }], target: i0.ɵɵFactoryTarget.Injectable });
ModalService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: ModalService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: ModalService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: i1.BsModalService }, { type: i2.GainsightService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kYWwuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2NvcmUvbW9kYWwvbW9kYWwuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNyRCxPQUFPLEVBQUUsTUFBTSxFQUFjLE1BQU0sd0JBQXdCLENBQUM7QUFDNUQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzFDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBRTNFLE9BQU8sRUFBRSxxQkFBcUIsRUFBa0IsTUFBTSwyQkFBMkIsQ0FBQzs7OztBQUVsRjs7R0FFRztBQUlILE1BQU0sT0FBTyxZQUFZO0lBQ3ZCLFlBQW9CLFlBQTRCLEVBQVUsZ0JBQWtDO1FBQXhFLGlCQUFZLEdBQVosWUFBWSxDQUFnQjtRQUFVLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7SUFBRyxDQUFDO0lBRWhHOzs7Ozs7OztPQVFHO0lBQ0gsS0FBSyxDQUFDLE9BQU8sQ0FDWCxLQUFhLEVBQ2IsSUFBWSxFQUNaLFNBQXFCLE1BQU0sQ0FBQyxJQUFJLEVBQ2hDLFNBQWMsRUFBRSxFQUNoQixpQkFBaUMsRUFBRSxFQUNuQyx5QkFBaUQsRUFBRSxTQUFTLEVBQUUsY0FBYyxFQUFFO1FBRTlFLE1BQU0sV0FBVyxHQUFHO1lBQ2xCLEVBQUUsRUFBRSxNQUFNLENBQUMsRUFBRSxJQUFJLE9BQU8sQ0FBQyxTQUFTLENBQUM7WUFDbkMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxNQUFNLElBQUksT0FBTyxDQUFDLFFBQVEsQ0FBQztTQUMzQyxDQUFDO1FBQ0YsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUU7WUFDN0QsWUFBWSxF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QUFFO1lBQ1YsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxzQkFBc0IsQ0FBQyxTQUFTLEVBQUU7Z0JBQ25FLEdBQUcsSUFBSTtnQkFDUCxNQUFNLEVBQUUsTUFBTSxDQUFDLE1BQU07YUFDdEIsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDOzt5R0FyR1UsWUFBWTs2R0FBWixZQUFZLGNBRlgsTUFBTTsyRkFFUCxZQUFZO2tCQUh4QixVQUFVO21CQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEJzTW9kYWxTZXJ2aWNlIH0gZnJvbSAnbmd4LWJvb3RzdHJhcC9tb2RhbCc7XG5pbXBvcnQgeyBTdGF0dXMsIFN0YXR1c1R5cGUgfSBmcm9tICcuLi9jb21tb24vc3RhdHVzLm1vZGVsJztcbmltcG9ydCB7IGdldHRleHQgfSBmcm9tICcuLi9pMThuL2dldHRleHQnO1xuaW1wb3J0IHsgR2FpbnNpZ2h0U2VydmljZSB9IGZyb20gJy4uL3Byb2R1Y3QtZXhwZXJpZW5jZS9nYWluc2lnaHQuc2VydmljZSc7XG5pbXBvcnQgeyBQcm9kdWN0RXhwZXJpZW5jZUV2ZW50IH0gZnJvbSAnLi4vcHJvZHVjdC1leHBlcmllbmNlL3Byb2R1Y3QtZXhwZXJpZW5jZS5tb2RlbCc7XG5pbXBvcnQgeyBDb25maXJtTW9kYWxDb21wb25lbnQsIENvbmZpcm1PcHRpb25zIH0gZnJvbSAnLi9tb2RhbC1jb25maXJtLmNvbXBvbmVudCc7XG5cbi8qKlxuICogU2VydmljZSB0byBzaG93IGEgbW9kYWwuXG4gKi9cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIE1vZGFsU2VydmljZSB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSwgcHJpdmF0ZSBnYWluc2lnaHRTZXJ2aWNlOiBHYWluc2lnaHRTZXJ2aWNlKSB7fVxuXG4gIC8qKlxuICAgKiBTaG93cyBhIHF1aWNrIGNvbmZpcm0gbWVzc2FnZSBtb2RhbC5cbiAgICogQHBhcmFtIHRpdGxlIFRoZSB0aXRsZSBvZiB0aGF0IG1vZGFsLlxuICAgKiBAcGFyYW0gYm9keSBUaGUgdGV4dCBib2R5IHRvIGRpc3BsYXkuXG4gICAqIEBwYXJhbSBzdGF0dXMgVGhlIHN0YXR1cy5cbiAgICogQHBhcmFtIGxhYmVscyBUaGUgbGFiZWxzIHRvIHVzZS4gRGVmYXVsdDogeyBvazogJ0NvbmZpcm0nLCBjYW5jZWw6ICdDYW5jZWwnfVxuICAgKiBAcGFyYW0gY29uZmlybU9wdGlvbnMgU2VsZWN0aW9uIG9wdGlvbnMgdG8gZGlzcGxheSBhcyBjaGVja2JveCBsaXN0LlxuICAgKiBAcGFyYW0gcHJvZHVjdEV4cGVyaWVuY2VFdmVudCBBZGRpdGlvbmFsIGRhdGEgdG8gYXR0YWNoIHRvIGN1c3RvbSBwcm9kdWN0IGV4cGVyaWVuY2UgZXZlbnRzLlxuICAgKi9cbiAgYXN5bmMgY29uZmlybShcbiAgICB0aXRsZTogc3RyaW5nLFxuICAgIGJvZHk6IHN0cmluZyxcbiAgICBzdGF0dXM6IFN0YXR1c1R5cGUgPSBTdGF0dXMuSU5GTyxcbiAgICBsYWJlbHM6IGFueSA9IHt9LFxuICAgIGNvbmZpcm1PcHRpb25zOiBDb25maXJtT3B0aW9ucyA9IHt9LFxuICAgIHByb2R1Y3RFeHBlcmllbmNlRXZlbnQ6IFByb2R1Y3RFeHBlcmllbmNlRXZlbnQgPSB7IGV2ZW50TmFtZTogJ2NvbmZpcm1Nb2RhbCcgfVxuICApIHtcbiAgICBjb25zdCBtb2RhbExhYmVscyA9IHtcbiAgICAgIG9rOiBsYWJlbHMub2sgfHwgZ2V0dGV4dCgnQ29uZmlybScpLFxuICAgICAgY2FuY2VsOiBsYWJlbHMuY2FuY2VsIHx8IGdldHRleHQoJ0NhbmNlbCcpXG4gICAgfTtcbiAgICBjb25zdCBtb2RhbFJlZiA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coQ29uZmlybU1vZGFsQ29tcG9uZW50LCB7XG4gICAgICBpbml0aWFsU3RhdGU6IHsgdGl0bGUsIGJvZHksIGxhYmVsczogbW9kYWxMYWJlbHMsIHN0YXR1cywgY29uZmlybU9wdGlvbnMgfSxcbiAgICAgIGFyaWFEZXNjcmliZWRieTogJ21vZGFsLWJvZHknLFxuICAgICAgYXJpYUxhYmVsbGVkQnk6ICdtb2RhbC10aXRsZScsXG4gICAgICBpZ25vcmVCYWNrZHJvcENsaWNrOiB0cnVlXG4gICAgfSk7XG4gICAgaWYgKHByb2R1Y3RFeHBlcmllbmNlRXZlbnQpIHtcbiAgICAgIHByb2R1Y3RFeHBlcmllbmNlRXZlbnQuZGF0YSA9IHsgLi4ucHJvZHVjdEV4cGVyaWVuY2VFdmVudC5kYXRhLCB0aXRsZSB9O1xuICAgIH1cbiAgICB0aGlzLnRyaWdnZXJFdmVudChtb2RhbFJlZi5jb250ZW50LnJlc3VsdCwgbW9kYWxMYWJlbHMsIHByb2R1Y3RFeHBlcmllbmNlRXZlbnQpO1xuICAgIHJldHVybiBhd2FpdCBtb2RhbFJlZi5jb250ZW50LnJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaG93cyBhIHF1aWNrIGFja25vd2xlZGdlIG1lc3NhZ2UgbW9kYWwuXG4gICAqIEBwYXJhbSB0aXRsZSBUaGUgdGl0bGUgb2YgdGhhdCBtb2RhbC5cbiAgICogQHBhcmFtIGJvZHkgVGhlIHRleHQgYm9keSB0byBkaXNwbGF5LlxuICAgKiBAcGFyYW0gc3RhdHVzIFRoZSBzdGF0dXMuXG4gICAqIEBwYXJhbSBhY2tub3dsZWRnZUxhYmVsIFRoZSBsYWJlbCB0byB1c2UuXG4gICAqIEBwYXJhbSBwcm9kdWN0RXhwZXJpZW5jZUV2ZW50IEFkZGl0aW9uYWwgZGF0YSB0byBhdHRhY2ggdG8gY3VzdG9tIHByb2R1Y3QgZXhwZXJpZW5jZSBldmVudHMuXG4gICAqL1xuICBhc3luYyBhY2tub3dsZWRnZShcbiAgICB0aXRsZTogc3RyaW5nLFxuICAgIGJvZHk6IHN0cmluZyxcbiAgICBzdGF0dXM6IFN0YXR1c1R5cGUgPSBTdGF0dXMuSU5GTyxcbiAgICBhY2tub3dsZWRnZUxhYmVsOiBzdHJpbmcgPSBnZXR0ZXh0KCdDb25maXJtJyksXG4gICAgcHJvZHVjdEV4cGVyaWVuY2VFdmVudDogUHJvZHVjdEV4cGVyaWVuY2VFdmVudCA9IHsgZXZlbnROYW1lOiAnY29uZmlybU1vZGFsJyB9XG4gICkge1xuICAgIGNvbnN0IGxhYmVscyA9IHsgb2s6IGFja25vd2xlZGdlTGFiZWwsIGNhbmNlbDogbnVsbCB9O1xuICAgIGNvbnN0IG1vZGFsUmVmID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhDb25maXJtTW9kYWxDb21wb25lbnQsIHtcbiAgICAgIGluaXRpYWxTdGF0ZTogeyB0aXRsZSwgYm9keSwgbGFiZWxzLCBzdGF0dXMgfSxcbiAgICAgIGFyaWFEZXNjcmliZWRieTogJ21vZGFsLWJvZHknLFxuICAgICAgYXJpYUxhYmVsbGVkQnk6ICdtb2RhbC10aXRsZScsXG4gICAgICBpZ25vcmVCYWNrZHJvcENsaWNrOiB0cnVlXG4gICAgfSk7XG4gICAgaWYgKHByb2R1Y3RFeHBlcmllbmNlRXZlbnQpIHtcbiAgICAgIHByb2R1Y3RFeHBlcmllbmNlRXZlbnQuZGF0YSA9IHsgLi4ucHJvZHVjdEV4cGVyaWVuY2VFdmVudC5kYXRhLCB0aXRsZSB9O1xuICAgIH1cbiAgICB0aGlzLnRyaWdnZXJFdmVudChtb2RhbFJlZi5jb250ZW50LnJlc3VsdCwgbGFiZWxzLCBwcm9kdWN0RXhwZXJpZW5jZUV2ZW50KTtcbiAgICByZXR1cm4gYXdhaXQgbW9kYWxSZWYuY29udGVudC5yZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogU2hvd3MgYSBxdWljayBsb2dvdXQgY29uZmlybWF0aW9uIG1vZGFsLlxuICAgKiBAcGFyYW0gYm9keSBUaGUgdGV4dCBib2R5IHRvIGRpc3BsYXkuIERlZmF1bHQ6ICdZb3Ugd2lsbCBiZSBsb2dnZWQgb3V0IHRvIGFwcGx5IHlvdXIgY2hhbmdlcy4gRG8geW91IHdhbnQgdG8gcHJvY2VlZD8nXG4gICAqIEBwYXJhbSBzdGF0dXMgVGhlIHN0YXR1cy5cbiAgICogQHBhcmFtIGxhYmVscyBUaGUgbGFiZWxzIHRvIHVzZS4gRGVmYXVsdDogeyBvazogJ0NvbmZpcm0gYW5kIGxvZyBvdXQnLCBjYW5jZWw6ICdDYW5jZWwnIH1cbiAgICovXG4gIGFzeW5jIGNvbmZpcm1Mb2dvdXQoYm9keT86IHN0cmluZywgc3RhdHVzOiBTdGF0dXNUeXBlID0gU3RhdHVzLldBUk5JTkcsIGxhYmVsczogYW55ID0ge30pIHtcbiAgICBjb25zdCBtb2RhbExhYmVscyA9IHtcbiAgICAgIG9rOiBsYWJlbHMub2sgfHwgZ2V0dGV4dCgnQ29uZmlybSBhbmQgbG9nIG91dCcpLFxuICAgICAgY2FuY2VsOiBsYWJlbHMuY2FuY2VsIHx8IGdldHRleHQoJ0NhbmNlbCcpXG4gICAgfTtcbiAgICBjb25zdCBtb2RhbEJvZHkgPVxuICAgICAgYm9keSB8fCBnZXR0ZXh0KCdZb3UgbXVzdCBsb2cgb3V0IHRvIGFwcGx5IHlvdXIgY2hhbmdlcy4gRG8geW91IHdhbnQgdG8gcHJvY2VlZD8nKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5jb25maXJtKGdldHRleHQoJ0xvZ291dCByZXF1aXJlZCcpLCBtb2RhbEJvZHksIHN0YXR1cywgbW9kYWxMYWJlbHMpO1xuICB9XG5cbiAgcHJpdmF0ZSB0cmlnZ2VyRXZlbnQoXG4gICAgcmVzdWx0OiBQcm9taXNlPGJvb2xlYW4gfCB7IGNvbmZpcm1lZDogYm9vbGVhbjsgY29uZmlybU9wdGlvbnM6IHsgW2tleTogc3RyaW5nXTogYm9vbGVhbiB9IH0+LFxuICAgIGxhYmVsczogYW55LFxuICAgIHByb2R1Y3RFeHBlcmllbmNlRXZlbnQ6IFByb2R1Y3RFeHBlcmllbmNlRXZlbnRcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgZGF0YSA9IHsgLi4ucHJvZHVjdEV4cGVyaWVuY2VFdmVudC5kYXRhLCB1cmw6IHdpbmRvdy5sb2NhdGlvbi5ocmVmIH07XG4gICAgcmVzdWx0XG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIHRoaXMuZ2FpbnNpZ2h0U2VydmljZS50cmlnZ2VyRXZlbnQocHJvZHVjdEV4cGVyaWVuY2VFdmVudC5ldmVudE5hbWUsIHtcbiAgICAgICAgICAuLi5kYXRhLFxuICAgICAgICAgIHJlc3VsdDogbGFiZWxzLm9rXG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoKSA9PiB7XG4gICAgICAgIHRoaXMuZ2FpbnNpZ2h0U2VydmljZS50cmlnZ2VyRXZlbnQocHJvZHVjdEV4cGVyaWVuY2VFdmVudC5ldmVudE5hbWUsIHtcbiAgICAgICAgICAuLi5kYXRhLFxuICAgICAgICAgIHJlc3VsdDogbGFiZWxzLmNhbmNlbFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICB9XG59XG4iXX0=