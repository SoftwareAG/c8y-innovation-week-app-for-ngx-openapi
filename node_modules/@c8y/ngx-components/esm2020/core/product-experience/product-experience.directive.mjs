import { Directive, HostListener, Inject, Input, Optional, Self, SkipSelf } from '@angular/core';
import { GainsightService } from './gainsight.service';
import { PRODUCT_EXPERIENCE_EVENT_SOURCE } from './product-experience.model';
import * as i0 from "@angular/core";
import * as i1 from "./gainsight.service";
export class ProductExperienceDirective {
    /**
     * If set to <code>true</code>, <code>actionName</code> and <code>actionData</code> will be
     * inherited from the parent component if it has the <code>c8yProductExperience</code> applied to it.
     * With <code>inherit</code> set to <code>true</code> the local <code>actionName</code> value is
     * ignored and overriden by the parent component's <code>actionName</code>. This allows for easy
     * re-use of core components (e.g. <code>&lt;c8y-li-action&gt;</code>) that would use the inherited
     * action name rather than their generic action name. Own <code>actionData</code> properties with
     * the same name take precedence to those inheritted from the parent component.
     */
    set _inherit(inherit) {
        // allows to use the <input c8yProductExperience inherit [actionData]="{...}"> syntax
        this.inherit = inherit === '' || (inherit ?? true);
    }
    /**
     * If set to <code>true</code> own <code>actionData</code> properties would not override
     * <code>actionData</code> properties of the parent component. Instead, values will be
     * inherited from the parent component. It is only effective if <code>inherit</code>
     * is set to <code>true</code>.
     */
    set _suppressDataOverriding(suppressDataOverriding) {
        // allows to use the <input c8yProductExperience suppressDataOverriding [actionData]="{...}"> syntax
        this.suppressDataOverriding = suppressDataOverriding === '' || (suppressDataOverriding ?? true);
    }
    constructor(component, parentEventSource, gainsightService) {
        this.component = component;
        this.parentEventSource = parentEventSource;
        this.gainsightService = gainsightService;
    }
    onClick() {
        if (!this.component) {
            const { actionName, actionData } = this.getAction(this.suppressDataOverriding);
            if (actionName) {
                this.gainsightService.triggerEvent(actionName, actionData);
            }
        }
    }
    ngOnInit() {
        if (this.component) {
            const { actionName, actionData } = this.getAction();
            this.component.productExperienceEvent = {
                eventName: actionName,
                data: this.mergeData(actionData, this.component?.productExperienceEvent?.data, this.suppressDataOverriding)
            };
        }
    }
    getAction(reverse = false) {
        let { actionName, actionData } = this;
        if (this.inherit && this.parentEventSource?.productExperienceEvent) {
            const { productExperienceEvent } = this.parentEventSource;
            actionName = productExperienceEvent.eventName;
            actionData = this.mergeData(productExperienceEvent.data, this.actionData, reverse);
        }
        return { actionName, actionData };
    }
    mergeData(dataA, dataB, reverse = false) {
        return reverse ? { ...dataB, ...dataA } : { ...dataA, ...dataB };
    }
}
ProductExperienceDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: ProductExperienceDirective, deps: [{ token: PRODUCT_EXPERIENCE_EVENT_SOURCE, optional: true, self: true }, { token: PRODUCT_EXPERIENCE_EVENT_SOURCE, optional: true, skipSelf: true }, { token: i1.GainsightService }], target: i0.ɵɵFactoryTarget.Directive });
ProductExperienceDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "15.2.7", type: ProductExperienceDirective, selector: "[c8yProductExperience]", inputs: { actionName: "actionName", actionData: "actionData", _inherit: ["inherit", "_inherit"], _suppressDataOverriding: ["suppressDataOverriding", "_suppressDataOverriding"] }, host: { listeners: { "click": "onClick()" } }, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: ProductExperienceDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[c8yProductExperience]'
                }]
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Self
                }, {
                    type: Optional
                }, {
                    type: Inject,
                    args: [PRODUCT_EXPERIENCE_EVENT_SOURCE]
                }] }, { type: undefined, decorators: [{
                    type: SkipSelf
                }, {
                    type: Optional
                }, {
                    type: Inject,
                    args: [PRODUCT_EXPERIENCE_EVENT_SOURCE]
                }] }, { type: i1.GainsightService }]; }, propDecorators: { actionName: [{
                type: Input
            }], actionData: [{
                type: Input
            }], _inherit: [{
                type: Input,
                args: ['inherit']
            }], _suppressDataOverriding: [{
                type: Input,
                args: ['suppressDataOverriding']
            }], onClick: [{
                type: HostListener,
                args: ['click']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjdC1leHBlcmllbmNlLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2NvcmUvcHJvZHVjdC1leHBlcmllbmNlL3Byb2R1Y3QtZXhwZXJpZW5jZS5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNqRyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN2RCxPQUFPLEVBRUwsK0JBQStCLEVBRWhDLE1BQU0sNEJBQTRCLENBQUM7OztBQUtwQyxNQUFNLE9BQU8sMEJBQTBCO0lBU3JDOzs7Ozs7OztPQVFHO0lBQ0gsSUFBc0IsUUFBUSxDQUFDLE9BQU87UUFDcEMscUZBQXFGO1FBQ3JGLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxLQUFLLEVBQUUsSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsQ0FBQztJQUNyRCxDQUFDO0lBQ0Q7Ozs7O09BS0c7SUFDSCxJQUFxQyx1QkFBdUIsQ0FBQyxzQkFBc0I7UUFDakYsb0dBQW9HO1FBQ3BHLElBQUksQ0FBQyxzQkFBc0IsR0FBRyxzQkFBc0IsS0FBSyxFQUFFLElBQUksQ0FBQyxzQkFBc0IsSUFBSSxJQUFJLENBQUMsQ0FBQztJQUNsRyxDQUFDO0lBSUQsWUFJVSxTQUF1QyxFQUl2QyxpQkFBK0MsRUFDL0MsZ0JBQWtDO1FBTGxDLGNBQVMsR0FBVCxTQUFTLENBQThCO1FBSXZDLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBOEI7UUFDL0MscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtJQUN6QyxDQUFDO0lBR0osT0FBTztRQUNMLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ25CLE1BQU0sRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQztZQUUvRSxJQUFJLFVBQVUsRUFBRTtnQkFDZCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUMsQ0FBQzthQUM1RDtTQUNGO0lBQ0gsQ0FBQztJQUVELFFBQVE7UUFDTixJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDbEIsTUFBTSxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsR0FBRyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDcEQsSUFBSSxDQUFDLFNBQVMsQ0FBQyxzQkFBc0IsR0FBRztnQkFDdEMsU0FBUyxFQUFFLFVBQVU7Z0JBQ3JCLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUNsQixVQUFVLEVBQ1YsSUFBSSxDQUFDLFNBQVMsRUFBRSxzQkFBc0IsRUFBRSxJQUFJLEVBQzVDLElBQUksQ0FBQyxzQkFBc0IsQ0FDNUI7YUFDRixDQUFDO1NBQ0g7SUFDSCxDQUFDO0lBRU8sU0FBUyxDQUFDLE9BQU8sR0FBRyxLQUFLO1FBQy9CLElBQUksRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLEdBQUcsSUFBSSxDQUFDO1FBRXRDLElBQUksSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsaUJBQWlCLEVBQUUsc0JBQXNCLEVBQUU7WUFDbEUsTUFBTSxFQUFFLHNCQUFzQixFQUFFLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDO1lBQzFELFVBQVUsR0FBRyxzQkFBc0IsQ0FBQyxTQUFTLENBQUM7WUFDOUMsVUFBVSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsc0JBQXNCLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDLENBQUM7U0FDcEY7UUFFRCxPQUFPLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxDQUFDO0lBQ3BDLENBQUM7SUFFTyxTQUFTLENBQUMsS0FBa0IsRUFBRSxLQUFrQixFQUFFLE9BQU8sR0FBRyxLQUFLO1FBQ3ZFLE9BQU8sT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsS0FBSyxFQUFFLEdBQUcsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxLQUFLLEVBQUUsR0FBRyxLQUFLLEVBQUUsQ0FBQztJQUNuRSxDQUFDOzt1SEF0RlUsMEJBQTBCLGtCQXNDM0IsK0JBQStCLHlDQUkvQiwrQkFBK0I7MkdBMUM5QiwwQkFBMEI7MkZBQTFCLDBCQUEwQjtrQkFIdEMsU0FBUzttQkFBQztvQkFDVCxRQUFRLEVBQUUsd0JBQXdCO2lCQUNuQzs7MEJBcUNJLElBQUk7OzBCQUNKLFFBQVE7OzBCQUNSLE1BQU07MkJBQUMsK0JBQStCOzswQkFFdEMsUUFBUTs7MEJBQ1IsUUFBUTs7MEJBQ1IsTUFBTTsyQkFBQywrQkFBK0I7MkVBdENoQyxVQUFVO3NCQUFsQixLQUFLO2dCQUlHLFVBQVU7c0JBQWxCLEtBQUs7Z0JBVWdCLFFBQVE7c0JBQTdCLEtBQUs7dUJBQUMsU0FBUztnQkFVcUIsdUJBQXVCO3NCQUEzRCxLQUFLO3VCQUFDLHdCQUF3QjtnQkFvQi9CLE9BQU87c0JBRE4sWUFBWTt1QkFBQyxPQUFPIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlyZWN0aXZlLCBIb3N0TGlzdGVuZXIsIEluamVjdCwgSW5wdXQsIE9wdGlvbmFsLCBTZWxmLCBTa2lwU2VsZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgR2FpbnNpZ2h0U2VydmljZSB9IGZyb20gJy4vZ2FpbnNpZ2h0LnNlcnZpY2UnO1xuaW1wb3J0IHtcbiAgUHJvZHVjdEV4cGVyaWVuY2VFdmVudFNvdXJjZSxcbiAgUFJPRFVDVF9FWFBFUklFTkNFX0VWRU5UX1NPVVJDRSxcbiAgUHhFdmVudERhdGFcbn0gZnJvbSAnLi9wcm9kdWN0LWV4cGVyaWVuY2UubW9kZWwnO1xuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbYzh5UHJvZHVjdEV4cGVyaWVuY2VdJ1xufSlcbmV4cG9ydCBjbGFzcyBQcm9kdWN0RXhwZXJpZW5jZURpcmVjdGl2ZSB7XG4gIC8qKlxuICAgKiBBIHZhbHVlIHRoYXQgd2lsbCBiZSB1c2VkIGFzIGEgY3VzdG9tIGV2ZW50IG5hbWUuXG4gICAqL1xuICBASW5wdXQoKSBhY3Rpb25OYW1lOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBEYXRhIHRoYXQgd2lsbCBiZSB1c2VkIGFzIGV2ZW50IHByb3BlcnRpZXMuXG4gICAqL1xuICBASW5wdXQoKSBhY3Rpb25EYXRhOiBvYmplY3Q7XG4gIC8qKlxuICAgKiBJZiBzZXQgdG8gPGNvZGU+dHJ1ZTwvY29kZT4sIDxjb2RlPmFjdGlvbk5hbWU8L2NvZGU+IGFuZCA8Y29kZT5hY3Rpb25EYXRhPC9jb2RlPiB3aWxsIGJlXG4gICAqIGluaGVyaXRlZCBmcm9tIHRoZSBwYXJlbnQgY29tcG9uZW50IGlmIGl0IGhhcyB0aGUgPGNvZGU+Yzh5UHJvZHVjdEV4cGVyaWVuY2U8L2NvZGU+IGFwcGxpZWQgdG8gaXQuXG4gICAqIFdpdGggPGNvZGU+aW5oZXJpdDwvY29kZT4gc2V0IHRvIDxjb2RlPnRydWU8L2NvZGU+IHRoZSBsb2NhbCA8Y29kZT5hY3Rpb25OYW1lPC9jb2RlPiB2YWx1ZSBpc1xuICAgKiBpZ25vcmVkIGFuZCBvdmVycmlkZW4gYnkgdGhlIHBhcmVudCBjb21wb25lbnQncyA8Y29kZT5hY3Rpb25OYW1lPC9jb2RlPi4gVGhpcyBhbGxvd3MgZm9yIGVhc3lcbiAgICogcmUtdXNlIG9mIGNvcmUgY29tcG9uZW50cyAoZS5nLiA8Y29kZT4mbHQ7Yzh5LWxpLWFjdGlvbiZndDs8L2NvZGU+KSB0aGF0IHdvdWxkIHVzZSB0aGUgaW5oZXJpdGVkXG4gICAqIGFjdGlvbiBuYW1lIHJhdGhlciB0aGFuIHRoZWlyIGdlbmVyaWMgYWN0aW9uIG5hbWUuIE93biA8Y29kZT5hY3Rpb25EYXRhPC9jb2RlPiBwcm9wZXJ0aWVzIHdpdGhcbiAgICogdGhlIHNhbWUgbmFtZSB0YWtlIHByZWNlZGVuY2UgdG8gdGhvc2UgaW5oZXJpdHRlZCBmcm9tIHRoZSBwYXJlbnQgY29tcG9uZW50LlxuICAgKi9cbiAgQElucHV0KCdpbmhlcml0Jykgc2V0IF9pbmhlcml0KGluaGVyaXQpIHtcbiAgICAvLyBhbGxvd3MgdG8gdXNlIHRoZSA8aW5wdXQgYzh5UHJvZHVjdEV4cGVyaWVuY2UgaW5oZXJpdCBbYWN0aW9uRGF0YV09XCJ7Li4ufVwiPiBzeW50YXhcbiAgICB0aGlzLmluaGVyaXQgPSBpbmhlcml0ID09PSAnJyB8fCAoaW5oZXJpdCA/PyB0cnVlKTtcbiAgfVxuICAvKipcbiAgICogSWYgc2V0IHRvIDxjb2RlPnRydWU8L2NvZGU+IG93biA8Y29kZT5hY3Rpb25EYXRhPC9jb2RlPiBwcm9wZXJ0aWVzIHdvdWxkIG5vdCBvdmVycmlkZVxuICAgKiA8Y29kZT5hY3Rpb25EYXRhPC9jb2RlPiBwcm9wZXJ0aWVzIG9mIHRoZSBwYXJlbnQgY29tcG9uZW50LiBJbnN0ZWFkLCB2YWx1ZXMgd2lsbCBiZVxuICAgKiBpbmhlcml0ZWQgZnJvbSB0aGUgcGFyZW50IGNvbXBvbmVudC4gSXQgaXMgb25seSBlZmZlY3RpdmUgaWYgPGNvZGU+aW5oZXJpdDwvY29kZT5cbiAgICogaXMgc2V0IHRvIDxjb2RlPnRydWU8L2NvZGU+LlxuICAgKi9cbiAgQElucHV0KCdzdXBwcmVzc0RhdGFPdmVycmlkaW5nJykgc2V0IF9zdXBwcmVzc0RhdGFPdmVycmlkaW5nKHN1cHByZXNzRGF0YU92ZXJyaWRpbmcpIHtcbiAgICAvLyBhbGxvd3MgdG8gdXNlIHRoZSA8aW5wdXQgYzh5UHJvZHVjdEV4cGVyaWVuY2Ugc3VwcHJlc3NEYXRhT3ZlcnJpZGluZyBbYWN0aW9uRGF0YV09XCJ7Li4ufVwiPiBzeW50YXhcbiAgICB0aGlzLnN1cHByZXNzRGF0YU92ZXJyaWRpbmcgPSBzdXBwcmVzc0RhdGFPdmVycmlkaW5nID09PSAnJyB8fCAoc3VwcHJlc3NEYXRhT3ZlcnJpZGluZyA/PyB0cnVlKTtcbiAgfVxuICBwcml2YXRlIGluaGVyaXQ6IGJvb2xlYW47XG4gIHByaXZhdGUgc3VwcHJlc3NEYXRhT3ZlcnJpZGluZzogYm9vbGVhbjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBAU2VsZigpXG4gICAgQE9wdGlvbmFsKClcbiAgICBASW5qZWN0KFBST0RVQ1RfRVhQRVJJRU5DRV9FVkVOVF9TT1VSQ0UpXG4gICAgcHJpdmF0ZSBjb21wb25lbnQ6IFByb2R1Y3RFeHBlcmllbmNlRXZlbnRTb3VyY2UsXG4gICAgQFNraXBTZWxmKClcbiAgICBAT3B0aW9uYWwoKVxuICAgIEBJbmplY3QoUFJPRFVDVF9FWFBFUklFTkNFX0VWRU5UX1NPVVJDRSlcbiAgICBwcml2YXRlIHBhcmVudEV2ZW50U291cmNlOiBQcm9kdWN0RXhwZXJpZW5jZUV2ZW50U291cmNlLFxuICAgIHByaXZhdGUgZ2FpbnNpZ2h0U2VydmljZTogR2FpbnNpZ2h0U2VydmljZVxuICApIHt9XG5cbiAgQEhvc3RMaXN0ZW5lcignY2xpY2snKVxuICBvbkNsaWNrKCkge1xuICAgIGlmICghdGhpcy5jb21wb25lbnQpIHtcbiAgICAgIGNvbnN0IHsgYWN0aW9uTmFtZSwgYWN0aW9uRGF0YSB9ID0gdGhpcy5nZXRBY3Rpb24odGhpcy5zdXBwcmVzc0RhdGFPdmVycmlkaW5nKTtcblxuICAgICAgaWYgKGFjdGlvbk5hbWUpIHtcbiAgICAgICAgdGhpcy5nYWluc2lnaHRTZXJ2aWNlLnRyaWdnZXJFdmVudChhY3Rpb25OYW1lLCBhY3Rpb25EYXRhKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jb21wb25lbnQpIHtcbiAgICAgIGNvbnN0IHsgYWN0aW9uTmFtZSwgYWN0aW9uRGF0YSB9ID0gdGhpcy5nZXRBY3Rpb24oKTtcbiAgICAgIHRoaXMuY29tcG9uZW50LnByb2R1Y3RFeHBlcmllbmNlRXZlbnQgPSB7XG4gICAgICAgIGV2ZW50TmFtZTogYWN0aW9uTmFtZSxcbiAgICAgICAgZGF0YTogdGhpcy5tZXJnZURhdGEoXG4gICAgICAgICAgYWN0aW9uRGF0YSxcbiAgICAgICAgICB0aGlzLmNvbXBvbmVudD8ucHJvZHVjdEV4cGVyaWVuY2VFdmVudD8uZGF0YSxcbiAgICAgICAgICB0aGlzLnN1cHByZXNzRGF0YU92ZXJyaWRpbmdcbiAgICAgICAgKVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldEFjdGlvbihyZXZlcnNlID0gZmFsc2UpOiB7IGFjdGlvbk5hbWU6IHN0cmluZzsgYWN0aW9uRGF0YTogUHhFdmVudERhdGEgfSB7XG4gICAgbGV0IHsgYWN0aW9uTmFtZSwgYWN0aW9uRGF0YSB9ID0gdGhpcztcblxuICAgIGlmICh0aGlzLmluaGVyaXQgJiYgdGhpcy5wYXJlbnRFdmVudFNvdXJjZT8ucHJvZHVjdEV4cGVyaWVuY2VFdmVudCkge1xuICAgICAgY29uc3QgeyBwcm9kdWN0RXhwZXJpZW5jZUV2ZW50IH0gPSB0aGlzLnBhcmVudEV2ZW50U291cmNlO1xuICAgICAgYWN0aW9uTmFtZSA9IHByb2R1Y3RFeHBlcmllbmNlRXZlbnQuZXZlbnROYW1lO1xuICAgICAgYWN0aW9uRGF0YSA9IHRoaXMubWVyZ2VEYXRhKHByb2R1Y3RFeHBlcmllbmNlRXZlbnQuZGF0YSwgdGhpcy5hY3Rpb25EYXRhLCByZXZlcnNlKTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBhY3Rpb25OYW1lLCBhY3Rpb25EYXRhIH07XG4gIH1cblxuICBwcml2YXRlIG1lcmdlRGF0YShkYXRhQTogUHhFdmVudERhdGEsIGRhdGFCOiBQeEV2ZW50RGF0YSwgcmV2ZXJzZSA9IGZhbHNlKTogUHhFdmVudERhdGEge1xuICAgIHJldHVybiByZXZlcnNlID8geyAuLi5kYXRhQiwgLi4uZGF0YUEgfSA6IHsgLi4uZGF0YUEsIC4uLmRhdGFCIH07XG4gIH1cbn1cbiJdfQ==