import { Injectable } from '@angular/core';
import { get } from 'lodash-es';
import { of } from 'rxjs';
import { map } from 'rxjs/operators';
import { DatePipe } from '../../common';
import { toObservable } from '../../common/extension-hooks';
import * as i0 from "@angular/core";
import * as i1 from "../../common";
export class BooleanFilterMapper {
    constructor() {
        this.fieldType = ['switch', 'boolean', 'checkbox'];
    }
    map(field, filter) {
        if (this.fieldType.includes(field.type.toString())) {
            if (get(filter.externalFilterQuery, filter.path)) {
                return of({
                    ...filter,
                    value: get(filter.externalFilterQuery, filter.path),
                    displayValue: field.props?.label
                });
            }
        }
    }
}
BooleanFilterMapper.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: BooleanFilterMapper, deps: [], target: i0.ɵɵFactoryTarget.Injectable });
BooleanFilterMapper.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: BooleanFilterMapper, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: BooleanFilterMapper, decorators: [{
            type: Injectable,
            args: [{ providedIn: 'root' }]
        }] });
export class RadioFilterMapper {
    constructor() {
        this.fieldType = ['radio', 'enum'];
    }
    map(field, filter) {
        if (this.fieldType.includes(field.type.toString())) {
            const fieldOptions = field.props?.options || field.props?.enum;
            return toObservable(fieldOptions).pipe(map(options => {
                const object = options.find(option => option.value === get(filter.externalFilterQuery, filter.path)) ??
                    options.find(option => option === get(filter.externalFilterQuery, filter.path));
                return {
                    ...filter,
                    value: object,
                    displayValue: object?.label
                };
            }));
        }
    }
}
RadioFilterMapper.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: RadioFilterMapper, deps: [], target: i0.ɵɵFactoryTarget.Injectable });
RadioFilterMapper.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: RadioFilterMapper, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: RadioFilterMapper, decorators: [{
            type: Injectable,
            args: [{ providedIn: 'root' }]
        }] });
export class TypeaheadFilterMapper {
    constructor() {
        this.fieldType = 'typeahead';
    }
    map(field, filter) {
        if (this.fieldType === field.type) {
            const displayProperty = field.props?.displayProperty;
            const valueNoProps = get(filter.externalFilterQuery, filter.path);
            const valueProperties = field.props?.valueProperties;
            let value = valueNoProps;
            if (valueProperties) {
                value = valueProperties.reduce((acc, prop) => {
                    const value = get(filter.externalFilterQuery, [...filter.path, prop]);
                    return { ...acc, [prop]: value };
                }, {});
            }
            return of({
                ...filter,
                value,
                displayValue: get(filter.externalFilterQuery, [...filter.path, displayProperty])
            });
        }
    }
}
TypeaheadFilterMapper.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: TypeaheadFilterMapper, deps: [], target: i0.ɵɵFactoryTarget.Injectable });
TypeaheadFilterMapper.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: TypeaheadFilterMapper, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: TypeaheadFilterMapper, decorators: [{
            type: Injectable,
            args: [{ providedIn: 'root' }]
        }] });
export class DateFilterMapper {
    constructor(datePipe) {
        this.datePipe = datePipe;
        this.fieldType = ['date-time', 'date'];
    }
    map(field, filter) {
        if (this.fieldType.includes(field.type.toString())) {
            return of({
                ...filter,
                label: field.props?.label,
                displayValue: this.datePipe
                    .transform(new Date(get(filter.externalFilterQuery, filter.path)))
                    .toString(),
                value: get(filter.externalFilterQuery, filter.path)
            });
        }
    }
}
DateFilterMapper.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: DateFilterMapper, deps: [{ token: i1.DatePipe }], target: i0.ɵɵFactoryTarget.Injectable });
DateFilterMapper.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: DateFilterMapper, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: DateFilterMapper, decorators: [{
            type: Injectable,
            args: [{ providedIn: 'root' }]
        }], ctorParameters: function () { return [{ type: i1.DatePipe }]; } });
export class SelectFilterMapper {
    constructor() {
        this.fieldType = 'select';
    }
    map(field, filter) {
        if (this.fieldType === field.type) {
            return toObservable(field.props?.options).pipe(map(options => {
                const selectedOption = options.find(option => option.value === get(filter.externalFilterQuery, filter.path));
                return {
                    ...filter,
                    value: get(filter.externalFilterQuery, filter.path),
                    displayValue: selectedOption.label
                };
            }));
        }
    }
}
SelectFilterMapper.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: SelectFilterMapper, deps: [], target: i0.ɵɵFactoryTarget.Injectable });
SelectFilterMapper.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: SelectFilterMapper, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: SelectFilterMapper, decorators: [{
            type: Injectable,
            args: [{ providedIn: 'root' }]
        }] });
export class StringFilterMapper {
    constructor() {
        this.fieldType = ['string', 'input'];
    }
    map(field, filter) {
        if (this.fieldType.includes(field.type.toString())) {
            if (get(filter.externalFilterQuery, filter.path)) {
                return of({
                    ...filter,
                    value: get(filter.externalFilterQuery, filter.path),
                    displayValue: get(filter.externalFilterQuery, filter.path)
                });
            }
        }
    }
}
StringFilterMapper.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: StringFilterMapper, deps: [], target: i0.ɵɵFactoryTarget.Injectable });
StringFilterMapper.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: StringFilterMapper, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: StringFilterMapper, decorators: [{
            type: Injectable,
            args: [{ providedIn: 'root' }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLW1hcHBlci1pbXBsLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9jb3JlL2RhdGEtZ3JpZC9maWx0ZXItY2hpcC9maWx0ZXItbWFwcGVyLWltcGwuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTNDLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDaEMsT0FBTyxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN0QyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDckMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUN4QyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sOEJBQThCLENBQUM7OztBQUk1RCxNQUFNLE9BQU8sbUJBQW1CO0lBRGhDO1FBRUUsY0FBUyxHQUFHLENBQUMsUUFBUSxFQUFFLFNBQVMsRUFBRSxVQUFVLENBQUMsQ0FBQztLQVkvQztJQVhDLEdBQUcsQ0FBQyxLQUF3QixFQUFFLE1BQWtCO1FBQzlDLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxFQUFFO1lBQ2xELElBQUksR0FBRyxDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQ2hELE9BQU8sRUFBRSxDQUFDO29CQUNSLEdBQUcsTUFBTTtvQkFDVCxLQUFLLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDO29CQUNuRCxZQUFZLEVBQUUsS0FBSyxDQUFDLEtBQUssRUFBRSxLQUFLO2lCQUNqQyxDQUFDLENBQUM7YUFDSjtTQUNGO0lBQ0gsQ0FBQzs7Z0hBWlUsbUJBQW1CO29I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QUFDO2FBQ0o7U0FDRjtJQUNILENBQUM7OytHQVpVLGtCQUFrQjttSEFBbEIsa0JBQWtCLGNBREwsTUFBTTsyRkFDbkIsa0JBQWtCO2tCQUQ5QixVQUFVO21CQUFDLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1seUZpZWxkQ29uZmlnIH0gZnJvbSAnQG5neC1mb3JtbHkvY29yZSc7XG5pbXBvcnQgeyBnZXQgfSBmcm9tICdsb2Rhc2gtZXMnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IERhdGVQaXBlIH0gZnJvbSAnLi4vLi4vY29tbW9uJztcbmltcG9ydCB7IHRvT2JzZXJ2YWJsZSB9IGZyb20gJy4uLy4uL2NvbW1vbi9leHRlbnNpb24taG9va3MnO1xuaW1wb3J0IHsgRmlsdGVyQ2hpcCwgRmlsdGVyTWFwcGVyIH0gZnJvbSAnLi4vZGF0YS1ncmlkLm1vZGVsJztcblxuQEluamVjdGFibGUoeyBwcm92aWRlZEluOiAncm9vdCcgfSlcbmV4cG9ydCBjbGFzcyBCb29sZWFuRmlsdGVyTWFwcGVyIGltcGxlbWVudHMgRmlsdGVyTWFwcGVyIHtcbiAgZmllbGRUeXBlID0gWydzd2l0Y2gnLCAnYm9vbGVhbicsICdjaGVja2JveCddO1xuICBtYXAoZmllbGQ6IEZvcm1seUZpZWxkQ29uZmlnLCBmaWx0ZXI6IEZpbHRlckNoaXApOiBPYnNlcnZhYmxlPEZpbHRlckNoaXA+IHtcbiAgICBpZiAodGhpcy5maWVsZFR5cGUuaW5jbHVkZXMoZmllbGQudHlwZS50b1N0cmluZygpKSkge1xuICAgICAgaWYgKGdldChmaWx0ZXIuZXh0ZXJuYWxGaWx0ZXJRdWVyeSwgZmlsdGVyLnBhdGgpKSB7XG4gICAgICAgIHJldHVybiBvZih7XG4gICAgICAgICAgLi4uZmlsdGVyLFxuICAgICAgICAgIHZhbHVlOiBnZXQoZmlsdGVyLmV4dGVybmFsRmlsdGVyUXVlcnksIGZpbHRlci5wYXRoKSxcbiAgICAgICAgICBkaXNwbGF5VmFsdWU6IGZpZWxkLnByb3BzPy5sYWJlbFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuQEluamVjdGFibGUoeyBwcm92aWRlZEluOiAncm9vdCcgfSlcbmV4cG9ydCBjbGFzcyBSYWRpb0ZpbHRlck1hcHBlciBpbXBsZW1lbnRzIEZpbHRlck1hcHBlciB7XG4gIGZpZWxkVHlwZSA9IFsncmFkaW8nLCAnZW51bSddO1xuICBtYXAoZmllbGQ6IEZvcm1seUZpZWxkQ29uZmlnLCBmaWx0ZXI6IEZpbHRlckNoaXApIHtcbiAgICBpZiAodGhpcy5maWVsZFR5cGUuaW5jbHVkZXMoZmllbGQudHlwZS50b1N0cmluZygpKSkge1xuICAgICAgY29uc3QgZmllbGRPcHRpb25zID0gZmllbGQucHJvcHM/Lm9wdGlvbnMgfHwgZmllbGQucHJvcHM/LmVudW07XG4gICAgICByZXR1cm4gdG9PYnNlcnZhYmxlKGZpZWxkT3B0aW9ucykucGlwZShcbiAgICAgICAgbWFwKG9wdGlvbnMgPT4ge1xuICAgICAgICAgIGNvbnN0IG9iamVjdCA9XG4gICAgICAgICAgICBvcHRpb25zLmZpbmQob3B0aW9uID0+IG9wdGlvbi52YWx1ZSA9PT0gZ2V0KGZpbHRlci5leHRlcm5hbEZpbHRlclF1ZXJ5LCBmaWx0ZXIucGF0aCkpID8/XG4gICAgICAgICAgICBvcHRpb25zLmZpbmQob3B0aW9uID0+IG9wdGlvbiA9PT0gZ2V0KGZpbHRlci5leHRlcm5hbEZpbHRlclF1ZXJ5LCBmaWx0ZXIucGF0aCkpO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5maWx0ZXIsXG4gICAgICAgICAgICB2YWx1ZTogb2JqZWN0LFxuICAgICAgICAgICAgZGlzcGxheVZhbHVlOiBvYmplY3Q/LmxhYmVsXG4gICAgICAgICAgfTtcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfVxuICB9XG59XG5cbkBJbmplY3RhYmxlKHsgcHJvdmlkZWRJbjogJ3Jvb3QnIH0pXG5leHBvcnQgY2xhc3MgVHlwZWFoZWFkRmlsdGVyTWFwcGVyIGltcGxlbWVudHMgRmlsdGVyTWFwcGVyIHtcbiAgZmllbGRUeXBlID0gJ3R5cGVhaGVhZCc7XG4gIG1hcChmaWVsZDogRm9ybWx5RmllbGRDb25maWcsIGZpbHRlcjogRmlsdGVyQ2hpcCkge1xuICAgIGlmICh0aGlzLmZpZWxkVHlwZSA9PT0gZmllbGQudHlwZSkge1xuICAgICAgY29uc3QgZGlzcGxheVByb3BlcnR5ID0gZmllbGQucHJvcHM/LmRpc3BsYXlQcm9wZXJ0eTtcblxuICAgICAgY29uc3QgdmFsdWVOb1Byb3BzID0gZ2V0KGZpbHRlci5leHRlcm5hbEZpbHRlclF1ZXJ5LCBmaWx0ZXIucGF0aCk7XG4gICAgICBjb25zdCB2YWx1ZVByb3BlcnRpZXMgPSBmaWVsZC5wcm9wcz8udmFsdWVQcm9wZXJ0aWVzO1xuXG4gICAgICBsZXQgdmFsdWUgPSB2YWx1ZU5vUHJvcHM7XG4gICAgICBpZiAodmFsdWVQcm9wZXJ0aWVzKSB7XG4gICAgICAgIHZhbHVlID0gdmFsdWVQcm9wZXJ0aWVzLnJlZHVjZSgoYWNjLCBwcm9wKSA9PiB7XG4gICAgICAgICAgY29uc3QgdmFsdWUgPSBnZXQoZmlsdGVyLmV4dGVybmFsRmlsdGVyUXVlcnksIFsuLi5maWx0ZXIucGF0aCwgcHJvcF0pO1xuICAgICAgICAgIHJldHVybiB7IC4uLmFjYywgW3Byb3BdOiB2YWx1ZSB9O1xuICAgICAgICB9LCB7fSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBvZih7XG4gICAgICAgIC4uLmZpbHRlcixcbiAgICAgICAgdmFsdWUsXG4gICAgICAgIGRpc3BsYXlWYWx1ZTogZ2V0KGZpbHRlci5leHRlcm5hbEZpbHRlclF1ZXJ5LCBbLi4uZmlsdGVyLnBhdGgsIGRpc3BsYXlQcm9wZXJ0eV0pXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn1cblxuQEluamVjdGFibGUoeyBwcm92aWRlZEluOiAncm9vdCcgfSlcbmV4cG9ydCBjbGFzcyBEYXRlRmlsdGVyTWFwcGVyIGltcGxlbWVudHMgRmlsdGVyTWFwcGVyIHtcbiAgZmllbGRUeXBlID0gWydkYXRlLXRpbWUnLCAnZGF0ZSddO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZGF0ZVBpcGU6IERhdGVQaXBlKSB7fVxuXG4gIG1hcChmaWVsZDogRm9ybWx5RmllbGRDb25maWcsIGZpbHRlcjogRmlsdGVyQ2hpcCkge1xuICAgIGlmICh0aGlzLmZpZWxkVHlwZS5pbmNsdWRlcyhmaWVsZC50eXBlLnRvU3RyaW5nKCkpKSB7XG4gICAgICByZXR1cm4gb2Yoe1xuICAgICAgICAuLi5maWx0ZXIsXG4gICAgICAgIGxhYmVsOiBmaWVsZC5wcm9wcz8ubGFiZWwsXG4gICAgICAgIGRpc3BsYXlWYWx1ZTogdGhpcy5kYXRlUGlwZVxuICAgICAgICAgIC50cmFuc2Zvcm0obmV3IERhdGUoZ2V0KGZpbHRlci5leHRlcm5hbEZpbHRlclF1ZXJ5LCBmaWx0ZXIucGF0aCkpKVxuICAgICAgICAgIC50b1N0cmluZygpLFxuICAgICAgICB2YWx1ZTogZ2V0KGZpbHRlci5leHRlcm5hbEZpbHRlclF1ZXJ5LCBmaWx0ZXIucGF0aClcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuXG5ASW5qZWN0YWJsZSh7IHByb3ZpZGVkSW46ICdyb290JyB9KVxuZXhwb3J0IGNsYXNzIFNlbGVjdEZpbHRlck1hcHBlciBpbXBsZW1lbnRzIEZpbHRlck1hcHBlciB7XG4gIGZpZWxkVHlwZSA9ICdzZWxlY3QnO1xuICBtYXAoZmllbGQ6IEZvcm1seUZpZWxkQ29uZmlnLCBmaWx0ZXI6IEZpbHRlckNoaXApIHtcbiAgICBpZiAodGhpcy5maWVsZFR5cGUgPT09IGZpZWxkLnR5cGUpIHtcbiAgICAgIHJldHVybiB0b09ic2VydmFibGUoZmllbGQucHJvcHM/Lm9wdGlvbnMpLnBpcGUoXG4gICAgICAgIG1hcChvcHRpb25zID0+IHtcbiAgICAgICAgICBjb25zdCBzZWxlY3RlZE9wdGlvbiA9IG9wdGlvbnMuZmluZChcbiAgICAgICAgICAgIG9wdGlvbiA9PiBvcHRpb24udmFsdWUgPT09IGdldChmaWx0ZXIuZXh0ZXJuYWxGaWx0ZXJRdWVyeSwgZmlsdGVyLnBhdGgpXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4uZmlsdGVyLFxuICAgICAgICAgICAgdmFsdWU6IGdldChmaWx0ZXIuZXh0ZXJuYWxGaWx0ZXJRdWVyeSwgZmlsdGVyLnBhdGgpLFxuICAgICAgICAgICAgZGlzcGxheVZhbHVlOiBzZWxlY3RlZE9wdGlvbi5sYWJlbFxuICAgICAgICAgIH07XG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuXG5ASW5qZWN0YWJsZSh7IHByb3ZpZGVkSW46ICdyb290JyB9KVxuZXhwb3J0IGNsYXNzIFN0cmluZ0ZpbHRlck1hcHBlciBpbXBsZW1lbnRzIEZpbHRlck1hcHBlciB7XG4gIGZpZWxkVHlwZSA9IFsnc3RyaW5nJywgJ2lucHV0J107XG4gIG1hcChmaWVsZDogRm9ybWx5RmllbGRDb25maWcsIGZpbHRlcjogRmlsdGVyQ2hpcCk6IE9ic2VydmFibGU8RmlsdGVyQ2hpcD4ge1xuICAgIGlmICh0aGlzLmZpZWxkVHlwZS5pbmNsdWRlcyhmaWVsZC50eXBlLnRvU3RyaW5nKCkpKSB7XG4gICAgICBpZiAoZ2V0KGZpbHRlci5leHRlcm5hbEZpbHRlclF1ZXJ5LCBmaWx0ZXIucGF0aCkpIHtcbiAgICAgICAgcmV0dXJuIG9mKHtcbiAgICAgICAgICAuLi5maWx0ZXIsXG4gICAgICAgICAgdmFsdWU6IGdldChmaWx0ZXIuZXh0ZXJuYWxGaWx0ZXJRdWVyeSwgZmlsdGVyLnBhdGgpLFxuICAgICAgICAgIGRpc3BsYXlWYWx1ZTogZ2V0KGZpbHRlci5leHRlcm5hbEZpbHRlclF1ZXJ5LCBmaWx0ZXIucGF0aClcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG4iXX0=