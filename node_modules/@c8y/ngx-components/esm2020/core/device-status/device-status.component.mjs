import { Component, Input } from '@angular/core';
import { deviceAvailabilityIconMap, PushStatusLabels, SendStatusLabels, tooltips } from './device-availability';
import { TranslateService } from '@ngx-translate/core';
import { get } from 'lodash-es';
import * as i0 from "@angular/core";
import * as i1 from "@ngx-translate/core";
import * as i2 from "../common/icon.directive";
import * as i3 from "@angular/common";
import * as i4 from "ngx-bootstrap/tooltip";
import * as i5 from "../i18n/c8y-translate.pipe";
export class DeviceStatusComponent {
    set node(value) {
        this._mo = value.mo || value;
    }
    constructor(translateService) {
        this.translateService = translateService;
    }
    get() {
        return this._mo;
    }
    ngOnChanges() {
        this.setStatusProperites();
    }
    ngAfterContentInit() {
        this.setStatusProperites();
    }
    setStatusProperites() {
        this.requiredAvailability = get(this._mo, 'c8y_RequiredAvailability');
        this.availabilityStatus = get(this._mo, 'c8y_Availability.status');
        this.pushStatus = get(this._mo, 'c8y_Connection.status') || 'UNKNOWN';
        this.sendStatus =
            this.availabilityStatus || (this.requiredAvailability ? 'UNKNOWN' : 'NOT_MONITORED');
    }
    status() {
        let statuses;
        if (this.availabilityStatus === 'MAINTENANCE' || this.pushStatus === 'MAINTENANCE') {
            statuses = this.getMaintenanceStatus();
        }
        else {
            statuses = this.getSendPushStatus();
        }
        return statuses;
    }
    getMaintenanceStatus() {
        return {
            sendStatus: false,
            pushStatus: false,
            maintenanceStatus: {
                icon: deviceAvailabilityIconMap.device.MAINTENANCE.icon,
                class: deviceAvailabilityIconMap.device.MAINTENANCE.class,
                tooltip: tooltips.maintenance
            }
        };
    }
    getSendPushStatus() {
        return {
            sendStatus: {
                icon: deviceAvailabilityIconMap.sendData[this.sendStatus].icon,
                class: deviceAvailabilityIconMap.sendData[this.sendStatus].class,
                status: this.sendStatus,
                label: SendStatusLabels[this.sendStatus],
                tooltip: this.getSendStatusTooltip(this._mo)
            },
            pushStatus: {
                icon: deviceAvailabilityIconMap.push[this.pushStatus].icon,
                class: deviceAvailabilityIconMap.push[this.pushStatus].class,
                status: this.pushStatus,
                label: PushStatusLabels[this.pushStatus],
                tooltip: this.getPushStatusTooltip(this.pushStatus === 'CONNECTED')
            },
            maintenanceStatus: false
        };
    }
    getSendStatusTooltip(device) {
        const availability = device && device.c8y_Availability;
        const lastMessage = availability && availability.lastMessage;
        if (lastMessage) {
            return tooltips.sendStatusConnected(lastMessage, this.translateService);
        }
        return tooltips.sendStatusDisconnected;
    }
    getPushStatusTooltip(isActive) {
        return isActive ? tooltips.pushStatusConnected : tooltips.pushStatusDisconnected;
    }
}
DeviceStatusComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: DeviceStatusComponent, deps: [{ token: i1.TranslateService }], target: i0.ɵɵFactoryTarget.Component });
DeviceStatusComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.7", type: DeviceStatusComponent, selector: "device-status", inputs: { node: ["mo", "node"] }, usesOnChanges: true, ngImport: i0, template: "<div class=\"d-contents\">\n  <button\n    class=\"statusContainer\"\n    [attr.aria-label]=\"'Connection status' | translate\"\n    tooltip=\"{{ status().sendStatus.tooltip | translate }}\n    {{ status().pushStatus.tooltip | translate }}\"\n    placement=\"right\"\n    container=\"body\"\n    [adaptivePosition]=\"false\"\n    [delay]=\"500\"\n    *ngIf=\"!!status().sendStatus || !!status().pushStatus\"\n  >\n    <div\n      *ngIf=\"!!status().sendStatus\"\n      class=\"sendStatus\"\n      [c8yIcon]=\"status().sendStatus.icon\"\n      [ngClass]=\"status().sendStatus.class\"\n    ></div>\n    <div\n      *ngIf=\"!!status().pushStatus\"\n      class=\"pushStatus\"\n      [c8yIcon]=\"status().pushStatus.icon\"\n      [ngClass]=\"status().pushStatus.class\"\n    ></div>\n  </button>\n  <button\n    class=\"statusContainer\"\n    [attr.aria-label]=\"'Connection status' | translate\"\n    tooltip=\"{{ status().maintenanceStatus.tooltip | translate }}\"\n    placement=\"right\"\n    container=\"body\"\n    [adaptivePosition]=\"false\"\n    [delay]=\"500\"\n    *ngIf=\"!!status().maintenanceStatus\"\n  >\n    <div\n      class=\"maintenanceStatus\"\n      [c8yIcon]=\"status().maintenanceStatus.icon\"\n      [ngClass]=\"status().maintenanceStatus.class\"\n    ></div>\n  </button>\n</div>\n", dependencies: [{ kind: "directive", type: i2.IconDirective, selector: "[c8yIcon]", inputs: ["c8yIcon"] }, { kind: "directive", type: i3.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i4.TooltipDirective, selector: "[tooltip], [tooltipHtml]", inputs: ["adaptivePosition", "tooltip", "placement", "triggers", "container", "containerClass", "boundariesElement", "isOpen", "isDisabled", "delay", "tooltipHtml", "tooltipPlacement", "tooltipIsOpen", "tooltipEnable", "tooltipAppendToBody", "tooltipAnimation", "tooltipClass", "tooltipContext", "tooltipPopupDelay", "tooltipFadeDuration", "tooltipTrigger"], outputs: ["tooltipChange", "onShown", "onHidden", "tooltipStateChanged"], exportAs: ["bs-tooltip"] }, { kind: "pipe", type: i5.C8yTranslatePipe, name: "translate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.7", ngImport: i0, type: DeviceStatusComponent, decorators: [{
            type: Component,
            args: [{ selector: 'device-status', template: "<div class=\"d-contents\">\n  <button\n    class=\"statusContainer\"\n    [attr.aria-label]=\"'Connection status' | translate\"\n    tooltip=\"{{ status().sendStatus.tooltip | translate }}\n    {{ status().pushStatus.tooltip | translate }}\"\n    placement=\"right\"\n    container=\"body\"\n    [adaptivePosition]=\"false\"\n    [delay]=\"500\"\n    *ngIf=\"!!status().sendStatus || !!status().pushStatus\"\n  >\n    <div\n      *ngIf=\"!!status().sendStatus\"\n      class=\"sendStatus\"\n      [c8yIcon]=\"status().sendStatus.icon\"\n      [ngClass]=\"status().sendStatus.class\"\n    ></div>\n    <div\n      *ngIf=\"!!status().pushStatus\"\n      class=\"pushStatus\"\n      [c8yIcon]=\"status().pushStatus.icon\"\n      [ngClass]=\"status().pushStatus.class\"\n    ></div>\n  </button>\n  <button\n    class=\"statusContainer\"\n    [attr.aria-label]=\"'Connection status' | translate\"\n    tooltip=\"{{ status().maintenanceStatus.tooltip | translate }}\"\n    placement=\"right\"\n    container=\"body\"\n    [adaptivePosition]=\"false\"\n    [delay]=\"500\"\n    *ngIf=\"!!status().maintenanceStatus\"\n  >\n    <div\n      class=\"maintenanceStatus\"\n      [c8yIcon]=\"status().maintenanceStatus.icon\"\n      [ngClass]=\"status().maintenanceStatus.class\"\n    ></div>\n  </button>\n</div>\n" }]
        }], ctorParameters: function () { return [{ type: i1.TranslateService }]; }, propDecorators: { node: [{
                type: Input,
                args: ['mo']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV2aWNlLXN0YXR1cy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9jb3JlL2RldmljZS1zdGF0dXMvZGV2aWNlLXN0YXR1cy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9jb3JlL2RldmljZS1zdGF0dXMvZGV2aWNlLXN0YXR1cy5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBK0IsTUFBTSxlQUFlLENBQUM7QUFDOUUsT0FBTyxFQUNMLHlCQUF5QixFQUN6QixnQkFBZ0IsRUFDaEIsZ0JBQWdCLEVBQ2hCLFFBQVEsRUFDVCxNQUFNLHVCQUF1QixDQUFDO0FBQy9CLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxXQUFXLENBQUM7Ozs7Ozs7QUFNaEMsTUFBTSxPQUFPLHFCQUFxQjtJQUNoQyxJQUFpQixJQUFJLENBQUMsS0FBSztRQUN6QixJQUFJLENBQUMsR0FBRyxHQUFHLEtBQUssQ0FBQyxFQUFFLElBQUksS0FBSyxDQUFDO0lBQy9CLENBQUM7SUFRRCxZQUFvQixnQkFBa0M7UUFBbEMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtJQUFHLENBQUM7SUFFMUQsR0FBRztRQUNELE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQztJQUNsQixDQUFDO0lBRUQsV0FBVztRQUNULElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFFRCxrQkFBa0I7UUFDaEIsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7SUFDN0IsQ0FBQztJQUVELG1CQUFtQjtRQUNqQixJQUFJLENBQUMsb0JBQW9CLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsMEJBQTBCLENBQUMsQ0FBQztRQUN0RSxJQUFJLENBQUMsa0JBQWtCLEdBQUcs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a0hBekZVLHFCQUFxQjtzR0FBckIscUJBQXFCLDRHQ2RsQyx5eENBMENBOzJGRDVCYSxxQkFBcUI7a0JBSmpDLFNBQVM7K0JBQ0UsZUFBZTt1R0FJUixJQUFJO3NCQUFwQixLQUFLO3VCQUFDLElBQUkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBBZnRlckNvbnRlbnRJbml0LCBPbkNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIGRldmljZUF2YWlsYWJpbGl0eUljb25NYXAsXG4gIFB1c2hTdGF0dXNMYWJlbHMsXG4gIFNlbmRTdGF0dXNMYWJlbHMsXG4gIHRvb2x0aXBzXG59IGZyb20gJy4vZGV2aWNlLWF2YWlsYWJpbGl0eSc7XG5pbXBvcnQgeyBUcmFuc2xhdGVTZXJ2aWNlIH0gZnJvbSAnQG5neC10cmFuc2xhdGUvY29yZSc7XG5pbXBvcnQgeyBnZXQgfSBmcm9tICdsb2Rhc2gtZXMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdkZXZpY2Utc3RhdHVzJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2RldmljZS1zdGF0dXMuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIERldmljZVN0YXR1c0NvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyQ29udGVudEluaXQsIE9uQ2hhbmdlcyB7XG4gIEBJbnB1dCgnbW8nKSBzZXQgbm9kZSh2YWx1ZSkge1xuICAgIHRoaXMuX21vID0gdmFsdWUubW8gfHwgdmFsdWU7XG4gIH1cblxuICBwcml2YXRlIF9tbztcbiAgcHJpdmF0ZSByZXF1aXJlZEF2YWlsYWJpbGl0eTtcbiAgcHJpdmF0ZSBhdmFpbGFiaWxpdHlTdGF0dXM7XG4gIHByaXZhdGUgcHVzaFN0YXR1cztcbiAgcHJpdmF0ZSBzZW5kU3RhdHVzO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgdHJhbnNsYXRlU2VydmljZTogVHJhbnNsYXRlU2VydmljZSkge31cblxuICBnZXQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX21vO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoKSB7XG4gICAgdGhpcy5zZXRTdGF0dXNQcm9wZXJpdGVzKCk7XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgdGhpcy5zZXRTdGF0dXNQcm9wZXJpdGVzKCk7XG4gIH1cblxuICBzZXRTdGF0dXNQcm9wZXJpdGVzKCkge1xuICAgIHRoaXMucmVxdWlyZWRBdmFpbGFiaWxpdHkgPSBnZXQodGhpcy5fbW8sICdjOHlfUmVxdWlyZWRBdmFpbGFiaWxpdHknKTtcbiAgICB0aGlzLmF2YWlsYWJpbGl0eVN0YXR1cyA9IGdldCh0aGlzLl9tbywgJ2M4eV9BdmFpbGFiaWxpdHkuc3RhdHVzJyk7XG5cbiAgICB0aGlzLnB1c2hTdGF0dXMgPSBnZXQodGhpcy5fbW8sICdjOHlfQ29ubmVjdGlvbi5zdGF0dXMnKSB8fCAnVU5LTk9XTic7XG4gICAgdGhpcy5zZW5kU3RhdHVzID1cbiAgICAgIHRoaXMuYXZhaWxhYmlsaXR5U3RhdHVzIHx8ICh0aGlzLnJlcXVpcmVkQXZhaWxhYmlsaXR5ID8gJ1VOS05PV04nIDogJ05PVF9NT05JVE9SRUQnKTtcbiAgfVxuXG4gIHN0YXR1cygpIHtcbiAgICBsZXQgc3RhdHVzZXM7XG5cbiAgICBpZiAodGhpcy5hdmFpbGFiaWxpdHlTdGF0dXMgPT09ICdNQUlOVEVOQU5DRScgfHwgdGhpcy5wdXNoU3RhdHVzID09PSAnTUFJTlRFTkFOQ0UnKSB7XG4gICAgICBzdGF0dXNlcyA9IHRoaXMuZ2V0TWFpbnRlbmFuY2VTdGF0dXMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RhdHVzZXMgPSB0aGlzLmdldFNlbmRQdXNoU3RhdHVzKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0YXR1c2VzO1xuICB9XG5cbiAgZ2V0TWFpbnRlbmFuY2VTdGF0dXMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNlbmRTdGF0dXM6IGZhbHNlLFxuICAgICAgcHVzaFN0YXR1czogZmFsc2UsXG4gICAgICBtYWludGVuYW5jZVN0YXR1czoge1xuICAgICAgICBpY29uOiBkZXZpY2VBdmFpbGFiaWxpdHlJY29uTWFwLmRldmljZS5NQUlOVEVOQU5DRS5pY29uLFxuICAgICAgICBjbGFzczogZGV2aWNlQXZhaWxhYmlsaXR5SWNvbk1hcC5kZXZpY2UuTUFJTlRFTkFOQ0UuY2xhc3MsXG4gICAgICAgIHRvb2x0aXA6IHRvb2x0aXBzLm1haW50ZW5hbmNlXG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0U2VuZFB1c2hTdGF0dXMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNlbmRTdGF0dXM6IHtcbiAgICAgICAgaWNvbjogZGV2aWNlQXZhaWxhYmlsaXR5SWNvbk1hcC5zZW5kRGF0YVt0aGlzLnNlbmRTdGF0dXNdLmljb24sXG4gICAgICAgIGNsYXNzOiBkZXZpY2VBdmFpbGFiaWxpdHlJY29uTWFwLnNlbmREYXRhW3RoaXMuc2VuZFN0YXR1c10uY2xhc3MsXG4gICAgICAgIHN0YXR1czogdGhpcy5zZW5kU3RhdHVzLFxuICAgICAgICBsYWJlbDogU2VuZFN0YXR1c0xhYmVsc1t0aGlzLnNlbmRTdGF0dXNdLFxuICAgICAgICB0b29sdGlwOiB0aGlzLmdldFNlbmRTdGF0dXNUb29sdGlwKHRoaXMuX21vKVxuICAgICAgfSxcbiAgICAgIHB1c2hTdGF0dXM6IHtcbiAgICAgICAgaWNvbjogZGV2aWNlQXZhaWxhYmlsaXR5SWNvbk1hcC5wdXNoW3RoaXMucHVzaFN0YXR1c10uaWNvbixcbiAgICAgICAgY2xhc3M6IGRldmljZUF2YWlsYWJpbGl0eUljb25NYXAucHVzaFt0aGlzLnB1c2hTdGF0dXNdLmNsYXNzLFxuICAgICAgICBzdGF0dXM6IHRoaXMucHVzaFN0YXR1cyxcbiAgICAgICAgbGFiZWw6IFB1c2hTdGF0dXNMYWJlbHNbdGhpcy5wdXNoU3RhdHVzXSxcbiAgICAgICAgdG9vbHRpcDogdGhpcy5nZXRQdXNoU3RhdHVzVG9vbHRpcCh0aGlzLnB1c2hTdGF0dXMgPT09ICdDT05ORUNURUQnKVxuICAgICAgfSxcbiAgICAgIG1haW50ZW5hbmNlU3RhdHVzOiBmYWxzZVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGdldFNlbmRTdGF0dXNUb29sdGlwKGRldmljZSkge1xuICAgIGNvbnN0IGF2YWlsYWJpbGl0eSA9IGRldmljZSAmJiBkZXZpY2UuYzh5X0F2YWlsYWJpbGl0eTtcbiAgICBjb25zdCBsYXN0TWVzc2FnZSA9IGF2YWlsYWJpbGl0eSAmJiBhdmFpbGFiaWxpdHkubGFzdE1lc3NhZ2U7XG4gICAgaWYgKGxhc3RNZXNzYWdlKSB7XG4gICAgICByZXR1cm4gdG9vbHRpcHMuc2VuZFN0YXR1c0Nvbm5lY3RlZChsYXN0TWVzc2FnZSwgdGhpcy50cmFuc2xhdGVTZXJ2aWNlKTtcbiAgICB9XG4gICAgcmV0dXJuIHRvb2x0aXBzLnNlbmRTdGF0dXNEaXNjb25uZWN0ZWQ7XG4gIH1cblxuICBwcml2YXRlIGdldFB1c2hTdGF0dXNUb29sdGlwKGlzQWN0aXZlKSB7XG4gICAgcmV0dXJuIGlzQWN0aXZlID8gdG9vbHRpcHMucHVzaFN0YXR1c0Nvbm5lY3RlZCA6IHRvb2x0aXBzLnB1c2hTdGF0dXNEaXNjb25uZWN0ZWQ7XG4gIH1cbn1cbiIsIjxkaXYgY2xhc3M9XCJkLWNvbnRlbnRzXCI+XG4gIDxidXR0b25cbiAgICBjbGFzcz1cInN0YXR1c0NvbnRhaW5lclwiXG4gICAgW2F0dHIuYXJpYS1sYWJlbF09XCInQ29ubmVjdGlvbiBzdGF0dXMnIHwgdHJhbnNsYXRlXCJcbiAgICB0b29sdGlwPVwie3sgc3RhdHVzKCkuc2VuZFN0YXR1cy50b29sdGlwIHwgdHJhbnNsYXRlIH19XG4gICAge3sgc3RhdHVzKCkucHVzaFN0YXR1cy50b29sdGlwIHwgdHJhbnNsYXRlIH19XCJcbiAgICBwbGFjZW1lbnQ9XCJyaWdodFwiXG4gICAgY29udGFpbmVyPVwiYm9keVwiXG4gICAgW2FkYXB0aXZlUG9zaXRpb25dPVwiZmFsc2VcIlxuICAgIFtkZWxheV09XCI1MDBcIlxuICAgICpuZ0lmPVwiISFzdGF0dXMoKS5zZW5kU3RhdHVzIHx8ICEhc3RhdHVzKCkucHVzaFN0YXR1c1wiXG4gID5cbiAgICA8ZGl2XG4gICAgICAqbmdJZj1cIiEhc3RhdHVzKCkuc2VuZFN0YXR1c1wiXG4gICAgICBjbGFzcz1cInNlbmRTdGF0dXNcIlxuICAgICAgW2M4eUljb25dPVwic3RhdHVzKCkuc2VuZFN0YXR1cy5pY29uXCJcbiAgICAgIFtuZ0NsYXNzXT1cInN0YXR1cygpLnNlbmRTdGF0dXMuY2xhc3NcIlxuICAgID48L2Rpdj5cbiAgICA8ZGl2XG4gICAgICAqbmdJZj1cIiEhc3RhdHVzKCkucHVzaFN0YXR1c1wiXG4gICAgICBjbGFzcz1cInB1c2hTdGF0dXNcIlxuICAgICAgW2M4eUljb25dPVwic3RhdHVzKCkucHVzaFN0YXR1cy5pY29uXCJcbiAgICAgIFtuZ0NsYXNzXT1cInN0YXR1cygpLnB1c2hTdGF0dXMuY2xhc3NcIlxuICAgID48L2Rpdj5cbiAgPC9idXR0b24+XG4gIDxidXR0b25cbiAgICBjbGFzcz1cInN0YXR1c0NvbnRhaW5lclwiXG4gICAgW2F0dHIuYXJpYS1sYWJlbF09XCInQ29ubmVjdGlvbiBzdGF0dXMnIHwgdHJhbnNsYXRlXCJcbiAgICB0b29sdGlwPVwie3sgc3RhdHVzKCkubWFpbnRlbmFuY2VTdGF0dXMudG9vbHRpcCB8IHRyYW5zbGF0ZSB9fVwiXG4gICAgcGxhY2VtZW50PVwicmlnaHRcIlxuICAgIGNvbnRhaW5lcj1cImJvZHlcIlxuICAgIFthZGFwdGl2ZVBvc2l0aW9uXT1cImZhbHNlXCJcbiAgICBbZGVsYXldPVwiNTAwXCJcbiAgICAqbmdJZj1cIiEhc3RhdHVzKCkubWFpbnRlbmFuY2VTdGF0dXNcIlxuICA+XG4gICAgPGRpdlxuICAgICAgY2xhc3M9XCJtYWludGVuYW5jZVN0YXR1c1wiXG4gICAgICBbYzh5SWNvbl09XCJzdGF0dXMoKS5tYWludGVuYW5jZVN0YXR1cy5pY29uXCJcbiAgICAgIFtuZ0NsYXNzXT1cInN0YXR1cygpLm1haW50ZW5hbmNlU3RhdHVzLmNsYXNzXCJcbiAgICA+PC9kaXY+XG4gIDwvYnV0dG9uPlxuPC9kaXY+XG4iXX0=